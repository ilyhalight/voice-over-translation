// ==UserScript==
// @name            [VOT] - Voice Over Translation
// @name:de         [VOT] - Voice-Over-Video-Übersetzung
// @name:es         [VOT] - Traducción de vídeo en off
// @name:fr         [VOT] - Traduction vidéo voix-off
// @name:it         [VOT] - Traduzione Video fuori campo
// @name:ru         [VOT] - Закадровый перевод видео
// @name:zh         [VOT] - 画外音视频翻译
// @namespace       vot
// @version         1.11.0
// @author          Toil, SashaXser, MrSoczekXD, mynovelhost, sodapng
// @description     A small extension that adds a Yandex Browser video translation to other browsers
// @description:de  Eine kleine Erweiterung, die eine Voice-over-Übersetzung von Videos aus dem Yandex-Browser zu anderen Browsern hinzufügt
// @description:es  Una pequeña extensión que agrega una traducción de voz en off de un video de Yandex Browser a otros navegadores
// @description:fr  Une petite extension qui ajoute la traduction vocale de la vidéo du Navigateur Yandex à d'autres navigateurs
// @description:it  Una piccola estensione che aggiunge la traduzione vocale del video dal browser Yandex ad altri browser
// @description:ru  Небольшое расширение, которое добавляет закадровый перевод видео из Яндекс Браузера в другие браузеры
// @description:zh  一个小扩展，它增加了视频从Yandex浏览器到其他浏览器的画外音翻译
// @license         MIT
// @icon            https://translate.yandex.ru/icons/favicon.ico
// @homepageURL     https://github.com/ilyhalight/voice-over-translation
// @source          https://github.com/ilyhalight/voice-over-translation.git
// @supportURL      https://github.com/ilyhalight/voice-over-translation/issues
// @downloadURL     https://raw.githubusercontent.com/ilyhalight/voice-over-translation/master/dist/vot-min.user.js
// @updateURL       https://raw.githubusercontent.com/ilyhalight/voice-over-translation/master/dist/vot-min.user.js
// @match           *://*.youtube.com/*
// @match           *://*.youtube-nocookie.com/*
// @match           *://*.youtubekids.com/*
// @match           *://*.twitch.tv/*
// @match           *://*.xvideos.com/*
// @match           *://*.xvideos-ar.com/*
// @match           *://*.xvideos005.com/*
// @match           *://*.xv-ru.com/*
// @match           *://*.xhamster.com/*
// @match           *://*.xhamster.desi/*
// @match           *://*.xhvid.com/*
// @match           *://*.spankbang.com/*
// @match           *://*.rule34video.com/*
// @match           *://*.picarto.tv/*
// @match           *://*.olympics.com/*
// @match           *://*.pornhub.com/*
// @match           *://*.pornhub.org/*
// @match           *://*.vk.com/*
// @match           *://*.vkvideo.ru/*
// @match           *://*.vk.ru/*
// @match           *://*.vimeo.com/*
// @match           *://*.imdb.com/*
// @match           *://*.9gag.com/*
// @match           *://*.twitter.com/*
// @match           *://*.x.com/*
// @match           *://*.facebook.com/*
// @match           *://*.rutube.ru/*
// @match           *://*.bilibili.com/*
// @match           *://*.bilibili.tv/*
// @match           *://my.mail.ru/*
// @match           *://*.bitchute.com/*
// @match           *://*.coursera.org/*
// @match           *://*.udemy.com/course/*
// @match           *://*.tiktok.com/*
// @match           *://*.douyin.com/*
// @match           *://rumble.com/*
// @match           *://*.eporner.com/*
// @match           *://*.dailymotion.com/*
// @match           *://*.ok.ru/*
// @match           *://trovo.live/*
// @match           *://disk.yandex.ru/*
// @match           *://disk.yandex.kz/*
// @match           *://disk.yandex.com/*
// @match           *://disk.yandex.com.am/*
// @match           *://disk.yandex.com.ge/*
// @match           *://disk.yandex.com.tr/*
// @match           *://disk.yandex.by/*
// @match           *://disk.yandex.az/*
// @match           *://disk.yandex.co.il/*
// @match           *://disk.yandex.ee/*
// @match           *://disk.yandex.lt/*
// @match           *://disk.yandex.lv/*
// @match           *://disk.yandex.md/*
// @match           *://disk.yandex.net/*
// @match           *://disk.yandex.tj/*
// @match           *://disk.yandex.tm/*
// @match           *://disk.yandex.uz/*
// @match           *://disk.360.yandex.ru/*
// @match           *://youtube.googleapis.com/embed/*
// @match           *://*.banned.video/*
// @match           *://*.madmaxworld.tv/*
// @match           *://*.weverse.io/*
// @match           *://*.newgrounds.com/*
// @match           *://*.egghead.io/*
// @match           *://*.youku.com/*
// @match           *://*.archive.org/*
// @match           *://*.patreon.com/*
// @match           *://*.reddit.com/*
// @match           *://*.kodik.info/*
// @match           *://*.kodik.biz/*
// @match           *://*.kodik.cc/*
// @match           *://*.kick.com/*
// @match           *://developer.apple.com/*
// @match           *://dev.epicgames.com/*
// @match           *://*.rapid-cloud.co/*
// @match           *://odysee.com/*
// @match           *://learning.sap.com/*
// @match           *://*.watchporn.to/*
// @match           *://*.linkedin.com/*
// @match           *://*.incestflix.net/*
// @match           *://*.incestflix.to/*
// @match           *://*.porntn.com/*
// @match           *://*.dzen.ru/*
// @match           *://*.cloudflarestream.com/*
// @match           *://*.loom.com/*
// @match           *://*.artstation.com/learning/*
// @match           *://*.rt.com/*
// @match           *://*.bitview.net/*
// @match           *://*.kickstarter.com/*
// @match           *://*.thisvid.com/*
// @match           *://*.ign.com/*
// @match           *://*.bunkr.site/*
// @match           *://*.bunkr.black/*
// @match           *://*.bunkr.cat/*
// @match           *://*.bunkr.media/*
// @match           *://*.bunkr.red/*
// @match           *://*.bunkr.ws/*
// @match           *://*.bunkr.org/*
// @match           *://*.bunkr.sk/*
// @match           *://*.bunkr.si/*
// @match           *://*.bunkr.su/*
// @match           *://*.bunkr.ci/*
// @match           *://*.bunkr.cr/*
// @match           *://*.bunkr.fi/*
// @match           *://*.bunkr.ph/*
// @match           *://*.bunkr.pk/*
// @match           *://*.bunkr.ps/*
// @match           *://*.bunkr.ru/*
// @match           *://*.bunkr.la/*
// @match           *://*.bunkr.is/*
// @match           *://*.bunkr.to/*
// @match           *://*.bunkr.ac/*
// @match           *://*.bunkr.ax/*
// @match           *://web.telegram.org/k/*
// @match           *://t2mc.toil.cc/*
// @match           *://mylearn.oracle.com/*
// @match           *://learn.deeplearning.ai/*
// @match           *://learn-staging.deeplearning.ai/*
// @match           *://learn-dev.deeplearning.ai/*
// @match           *://*.netacad.com/content/i2cs/*
// @match           *://*.nicovideo.jp/*
// @match           *://*.zdf.de/*
// @match           *://*.weibo.com/*
// @match           *://*/*.mp4*
// @match           *://*/*.webm*
// @match           *://*.yewtu.be/*
// @match           *://inv.nadeko.net/*
// @match           *://invidious.nerdvpn.de/*
// @match           *://invidious.protokolla.fi/*
// @match           *://invidious.materialio.us/*
// @match           *://iv.melmac.space/*
// @match           *://*.piped.video/*
// @match           *://piped.kavin.rocks/*
// @match           *://piped.private.coffee/*
// @match           *://proxitok.pabloferreiro.es/*
// @match           *://proxitok.pussthecat.org/*
// @match           *://tok.habedieeh.re/*
// @match           *://proxitok.esmailelbob.xyz/*
// @match           *://proxitok.privacydev.net/*
// @match           *://tok.artemislena.eu/*
// @match           *://tok.adminforge.de/*
// @match           *://tt.vern.cc/*
// @match           *://cringe.whatever.social/*
// @match           *://proxitok.lunar.icu/*
// @match           *://proxitok.privacy.com.de/*
// @match           *://peertube.tmp.rcp.tf/*
// @match           *://*.dalek.zone/*
// @match           *://video.sadmin.io/*
// @match           *://videos.viorsan.com/*
// @match           *://peertube.1312.media/*
// @match           *://tube.shanti.cafe/*
// @match           *://*.bee-tube.fr/*
// @match           *://video.blender.org/*
// @match           *://*.beetoons.tv/*
// @match           *://*.makertube.net/*
// @match           *://*.peertube.tv/*
// @match           *://*.framatube.org/*
// @match           *://*.tilvids.com/*
// @match           *://*.diode.zone/*
// @match           *://*.fedimovie.com/*
// @match           *://video.hardlimit.com/*
// @match           *://*.share.tube/*
// @match           *://*.peervideo.club/*
// @match           *://*.coursehunter.net/*
// @match           *://*.coursetrain.net/*
// @exclude         file://*/*.mp4*
// @exclude         file://*/*.webm*
// @exclude         *://accounts.youtube.com/*
// @require         https://gist.githubusercontent.com/ilyhalight/6eb5bb4dffc7ca9e3c57d6933e2452f3/raw/7ab38af2228d0bed13912e503bc8a9ee4b11828d/gm-addstyle-polyfill.js
// @connect         yandex.ru
// @connect         disk.yandex.kz
// @connect         disk.yandex.com
// @connect         disk.yandex.com.am
// @connect         disk.yandex.com.ge
// @connect         disk.yandex.com.tr
// @connect         disk.yandex.by
// @connect         disk.yandex.az
// @connect         disk.yandex.co.il
// @connect         disk.yandex.ee
// @connect         disk.yandex.lt
// @connect         disk.yandex.lv
// @connect         disk.yandex.md
// @connect         disk.yandex.net
// @connect         disk.yandex.tj
// @connect         disk.yandex.tm
// @connect         disk.yandex.uz
// @connect         disk.360.yandex.ru
// @connect         yandex.net
// @connect         timeweb.cloud
// @connect         raw.githubusercontent.com
// @connect         vimeo.com
// @connect         toil.cc
// @connect         deno.dev
// @connect         onrender.com
// @connect         workers.dev
// @connect         cloudflare-dns.com
// @connect         porntn.com
// @connect         googlevideo.com
// @grant           GM.deleteValue
// @grant           GM.getValue
// @grant           GM.getValues
// @grant           GM.listValues
// @grant           GM.setValue
// @grant           GM_addStyle
// @grant           GM_deleteValue
// @grant           GM_getValue
// @grant           GM_info
// @grant           GM_listValues
// @grant           GM_notification
// @grant           GM_setValue
// @grant           GM_xmlhttpRequest
// @grant           unsafeWindow
// @grant           window.focus
// ==/UserScript==

!function(){function e(e,t){return(t||"")+" (SystemJS Error#"+e+" https://github.com/systemjs/systemjs/blob/main/docs/errors.md#"+e+")"}function t(e,t){if(-1!==e.indexOf("\\")&&(e=e.replace(j,"/")),"/"===e[0]&&"/"===e[1])return t.slice(0,t.indexOf(":")+1)+e;if("."===e[0]&&("/"===e[1]||"."===e[1]&&("/"===e[2]||2===e.length&&(e+="/"))||1===e.length&&(e+="/"))||"/"===e[0]){var n,r=t.slice(0,t.indexOf(":")+1);if(n="/"===t[r.length+1]?"file:"!==r?(n=t.slice(r.length+2)).slice(n.indexOf("/")+1):t.slice(8):t.slice(r.length+("/"===t[r.length])),"/"===e[0])return t.slice(0,t.length-n.length-1)+e;for(var i=n.slice(0,n.lastIndexOf("/")+1)+e,o=[],s=-1,u=0;u<i.length;u++)-1!==s?"/"===i[u]&&(o.push(i.slice(s,u+1)),s=-1):"."===i[u]?"."!==i[u+1]||"/"!==i[u+2]&&u+2!==i.length?"/"===i[u+1]||u+1===i.length?u+=1:s=u:(o.pop(),u+=2):s=u;return-1!==s&&o.push(i.slice(s)),t.slice(0,t.length-n.length)+o.join("")}}function n(e,n){return t(e,n)||(-1!==e.indexOf(":")?e:t("./"+e,n))}function r(e,n,r,i,o){for(var s in e){var a=t(s,r)||s,f=e[s];if("string"==typeof f){var l=c(i,t(f,r)||f,o);l?n[a]=l:u("W1",s,f,"bare specifier did not resolve")}}}function i(e,t,i){var o;for(o in e.imports&&r(e.imports,i.imports,t,i,null),e.scopes||{}){var s=n(o,t);r(e.scopes[o],i.scopes[s]||(i.scopes[s]={}),t,i,s)}for(o in e.depcache||{})i.depcache[n(o,t)]=e.depcache[o];for(o in e.integrity||{})i.integrity[n(o,t)]=e.integrity[o]}function o(e,t){if(t[e])return e;var n=e.length;do{var r=e.slice(0,n+1);if(r in t)return r}while(-1!==(n=e.lastIndexOf("/",n-1)))}function s(e,t){var n=o(e,t);if(n){var r=t[n];if(null===r)return;if(!(e.length>n.length&&"/"!==r[r.length-1]))return r+e.slice(n.length);u("W2",n,r,"should have a trailing '/'")}}function u(t,n,r,i){console.warn(e(t,"Package target "+i+", resolving target '"+r+"' for "+n))}function c(e,t,n){for(var r=e.scopes,i=n&&o(n,r);i;){var u=s(t,r[i]);if(u)return u;i=o(i.slice(0,i.lastIndexOf("/")),r)}return s(t,e.imports)||-1!==t.indexOf(":")&&t}function a(){this[M]={}}function f(e){return e.id}function l(e,t,n,r){if(e.onload(n,t.id,t.d&&t.d.map(f),!!r),n)throw n}function d(t,n,r,i){var o=t[M][n];if(o)return o;var s=[],u=Object.create(null);P&&Object.defineProperty(u,P,{value:"Module"});var c=Promise.resolve().then((function(){return t.instantiate(n,r,i)})).then((function(r){if(!r)throw Error(e(2,"Module "+n+" did not instantiate"));var i=r[1]((function(e,t){o.h=!0;var n=!1;if("string"==typeof e)e in u&&u[e]===t||(u[e]=t,n=!0);else{for(var r in e)t=e[r],r in u&&u[r]===t||(u[r]=t,n=!0);e&&e.__esModule&&(u.__esModule=e.__esModule)}if(n)for(var i=0;i<s.length;i++){var c=s[i];c&&c(u)}return t}),2===r[1].length?{import:function(e,r){return t.import(e,n,r)},meta:t.createContext(n)}:void 0);return o.e=i.execute||function(){},[r[0],i.setters||[],r[2]||[]]}),(function(e){throw o.e=null,o.er=e,l(t,o,e,!0),e})),a=c.then((function(e){return Promise.all(e[0].map((function(r,i){var o=e[1][i],s=e[2][i];return Promise.resolve(t.resolve(r,n)).then((function(e){var r=d(t,e,n,s);return Promise.resolve(r.I).then((function(){return o&&(r.i.push(o),!r.h&&r.I||o(r.n)),r}))}))}))).then((function(e){o.d=e}))}));return o=t[M][n]={id:n,i:s,n:u,m:i,I:c,L:a,h:!1,d:void 0,e:void 0,er:void 0,E:void 0,C:void 0,p:void 0}}function h(e,t,n,r){if(!r[t.id])return r[t.id]=!0,Promise.resolve(t.L).then((function(){return t.p&&null!==t.p.e||(t.p=n),Promise.all(t.d.map((function(t){return h(e,t,n,r)})))})).catch((function(n){if(t.er)throw n;throw t.e=null,l(e,t,n,!1),n}))}function p(e,t){return t.C=h(e,t,t,{}).then((function(){return v(e,t,{})})).then((function(){return t.n}))}function v(e,t,n){function r(){try{var n=o.call(L);if(n)return n=n.then((function(){t.C=t.n,t.E=null,l(e,t,null,!0)}),(function(n){throw t.er=n,t.E=null,l(e,t,n,!0),n})),t.E=n;t.C=t.n,t.L=t.I=void 0}catch(r){throw t.er=r,r}finally{l(e,t,t.er,!0)}}if(!n[t.id]){if(n[t.id]=!0,!t.e){if(t.er)throw t.er;return t.E?t.E:void 0}var i,o=t.e;return t.e=null,t.d.forEach((function(r){try{var o=v(e,r,n);o&&(i=i||[]).push(o)}catch(s){throw t.er=s,l(e,t,s,!1),s}})),i?Promise.all(i).then(r):r()}}function m(){[].forEach.call(document.querySelectorAll("script"),(function(t){if(!t.sp)if("systemjs-module"===t.type){if(t.sp=!0,!t.src)return;System.import("import:"===t.src.slice(0,7)?t.src.slice(7):n(t.src,g)).catch((function(e){if(e.message.indexOf("https://github.com/systemjs/systemjs/blob/main/docs/errors.md#3")>-1){var n=document.createEvent("Event");n.initEvent("error",!1,!1),t.dispatchEvent(n)}return Promise.reject(e)}))}else if("systemjs-importmap"===t.type){t.sp=!0;var r=t.src?(System.fetch||fetch)(t.src,{integrity:t.integrity,priority:t.fetchPriority,passThrough:!0}).then((function(e){if(!e.ok)throw Error("Invalid status code: "+e.status);return e.text()})).catch((function(n){return n.message=e("W4","Error fetching systemjs-import map "+t.src)+"\n"+n.message,console.warn(n),"function"==typeof t.onerror&&t.onerror(),"{}"})):t.innerHTML;W=W.then((function(){return r})).then((function(n){!function(t,n,r){var o={};try{o=JSON.parse(n)}catch(s){console.warn(Error(e("W5","systemjs-importmap contains invalid JSON")+"\n\n"+n+"\n"))}i(o,r,t)}(N,n,t.src||g)}))}}))}var g,y="undefined"!=typeof Symbol,b="undefined"!=typeof self,S="undefined"!=typeof document,w=b?self:global;if(S){var O=document.querySelector("base[href]");O&&(g=O.href)}if(!g&&"undefined"!=typeof location){var E=(g=location.href.split("#")[0].split("?")[0]).lastIndexOf("/");-1!==E&&(g=g.slice(0,E+1))}var x,j=/\\/g,P=y&&Symbol.toStringTag,M=y?Symbol():"@",I=a.prototype;I.import=function(e,t,n){var r=this;return t&&"object"==typeof t&&(n=t,t=void 0),Promise.resolve(r.prepareImport()).then((function(){return r.resolve(e,t,n)})).then((function(e){var t=d(r,e,void 0,n);return t.C||p(r,t)}))},I.createContext=function(e){var t=this;return{url:e,resolve:function(n,r){return Promise.resolve(t.resolve(n,r||e))}}},I.onload=function(){},I.register=function(e,t,n){x=[e,t,n]},I.getRegister=function(){var e=x;return x=void 0,e};var L=Object.freeze(Object.create(null));w.System=new a;var C,R,W=Promise.resolve(),N={imports:{},scopes:{},depcache:{},integrity:{}},T=S;if(I.prepareImport=function(e){return(T||e)&&(m(),T=!1),W},I.getImportMap=function(){return JSON.parse(JSON.stringify(N))},S&&(m(),window.addEventListener("DOMContentLoaded",m)),I.addImportMap=function(e,t){i(e,t||g,N)},S){window.addEventListener("error",(function(e){J=e.filename,_=e.error}));var A=location.origin}I.createScript=function(e){var t=document.createElement("script");t.async=!0,e.indexOf(A+"/")&&(t.crossOrigin="anonymous");var n=N.integrity[e];return n&&(t.integrity=n),t.src=e,t};var J,_,k={},U=I.register;I.register=function(e,t){if(S&&"loading"===document.readyState&&"string"!=typeof e){var n=document.querySelectorAll("script[src]"),r=n[n.length-1];if(r){C=e;var i=this;R=setTimeout((function(){k[r.src]=[e,t],i.import(r.src)}))}}else C=void 0;return U.call(this,e,t)},I.instantiate=function(t,n){var r=k[t];if(r)return delete k[t],r;var i=this;return Promise.resolve(I.createScript(t)).then((function(r){return new Promise((function(o,s){r.addEventListener("error",(function(){s(Error(e(3,"Error loading "+t+(n?" from "+n:""))))})),r.addEventListener("load",(function(){if(document.head.removeChild(r),J===t)s(_);else{var e=i.getRegister(t);e&&e[0]===C&&clearTimeout(R),o(e)}})),document.head.appendChild(r)}))}))},I.shouldFetch=function(){return!1},"undefined"!=typeof fetch&&(I.fetch=fetch);var $=I.instantiate,B=/^(text|application)\/(x-)?javascript(;|$)/;I.instantiate=function(t,n,r){var i=this;return this.shouldFetch(t,n,r)?this.fetch(t,{credentials:"same-origin",integrity:N.integrity[t],meta:r}).then((function(r){if(!r.ok)throw Error(e(7,r.status+" "+r.statusText+", loading "+t+(n?" from "+n:"")));var o=r.headers.get("content-type");if(!o||!B.test(o))throw Error(e(4,'Unknown Content-Type "'+o+'", loading '+t+(n?" from "+n:"")));return r.text().then((function(e){return e.indexOf("//# sourceURL=")<0&&(e+="\n//# sourceURL="+t),(0,eval)(e),i.getRegister(t)}))})):$.apply(this,arguments)},I.resolve=function(n,r){return c(N,t(n,r=r||g)||n,r)||function(t,n){throw Error(e(8,"Unable to resolve bare specifier '"+t+(n?"' from "+n:"'")))}(n,r)};var F=I.instantiate;I.instantiate=function(e,t,n){var r=N.depcache[e];if(r)for(var i=0;i<r.length;i++)d(this,this.resolve(r[i],e),e);return F.call(this,e,t,n)},b&&"function"==typeof importScripts&&(I.instantiate=function(e){var t=this;return Promise.resolve().then((function(){return importScripts(e),t.getRegister(e)}))}),function(e){function t(t){return!e.hasOwnProperty(t)||!isNaN(t)&&t<e.length||a&&e[t]&&"undefined"!=typeof window&&e[t].parent===window}var n,r,i,o=e.System.constructor.prototype,s=o.import;o.import=function(o,u,c){return function(){for(var o in n=r=void 0,e)t(o)||(n?r||(r=o):n=o,i=o)}(),s.call(this,o,u,c)};var u=[[],function(){return{}}],c=o.getRegister;o.getRegister=function(){var o=c.call(this);if(o)return o;var s,a=function(o){var s,u,c=0;for(var a in e)if(!t(a)){if(0===c&&a!==n||1===c&&a!==r)return a;s?(i=a,u=o&&u||a):s=a===i,c++}return u}(this.firstGlobalProp);if(!a)return u;try{s=e[a]}catch(f){return u}return[[],function(e){return{execute:function(){e(s),e({default:s,__useDefault:!0})}}}]};var a="undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Trident")}("undefined"!=typeof self?self:global),function(e){var t=e.System.constructor.prototype,r=/^[^#?]+\.(css|html|json|wasm)([?#].*)?$/,i=t.shouldFetch.bind(t);t.shouldFetch=function(e){return i(e)||r.test(e)};var o=/^application\/json(;|$)/,s=/^text\/css(;|$)/,u=/^application\/wasm(;|$)/,c=t.fetch;t.fetch=function(t,r){return c(t,r).then((function(i){if(r.passThrough)return i;if(!i.ok)return i;var c=i.headers.get("content-type");return o.test(c)?i.json().then((function(e){return new Response(new Blob(['System.register([],function(e){return{execute:function(){e("default",'+JSON.stringify(e)+")}}})"],{type:"application/javascript"}))})):s.test(c)?i.text().then((function(e){return e=e.replace(/url\(\s*(?:(["'])((?:\\.|[^\n\\"'])+)\1|((?:\\.|[^\s,"'()\\])+))\s*\)/g,(function(e,r,i,o){return["url(",r,n(i||o,t),r,")"].join("")})),new Response(new Blob(["System.register([],function(e){return{execute:function(){var s=new CSSStyleSheet();s.replaceSync("+JSON.stringify(e)+');e("default",s)}}})'],{type:"application/javascript"}))})):u.test(c)?(WebAssembly.compileStreaming?WebAssembly.compileStreaming(i):i.arrayBuffer().then(WebAssembly.compile)).then((function(n){e.System.wasmModules||(e.System.wasmModules=Object.create(null)),e.System.wasmModules[t]=n;var r=[],i=[];return WebAssembly.Module.imports&&WebAssembly.Module.imports(n).forEach((function(e){var t=JSON.stringify(e.module);-1===r.indexOf(t)&&(r.push(t),i.push("function(m){i["+t+"]=m}"))})),new Response(new Blob(["System.register(["+r.join(",")+"],function(e){var i={};return{setters:["+i.join(",")+"],execute:function(){return WebAssembly.instantiate(System.wasmModules["+JSON.stringify(t)+"],i).then(function(m){e(m.exports)})}}})"],{type:"application/javascript"}))})):i}))}}("undefined"!=typeof self?self:global);var q="undefined"!=typeof Symbol&&Symbol.toStringTag;I.get=function(e){var t=this[M][e];if(t&&null===t.e&&!t.E)return t.er?null:t.n},I.set=function(t,n){try{new URL(t)}catch(s){console.warn(Error(e("W3",'"'+t+'" is not a valid URL to set in the module registry')))}var r;q&&"Module"===n[q]?r=n:(r=Object.assign(Object.create(null),n),q&&Object.defineProperty(r,q,{value:"Module"}));var i=Promise.resolve(r),o=this[M][t]||(this[M][t]={id:t,i:[],h:!1,d:[],e:null,er:void 0,E:void 0});return!o.e&&!o.E&&(Object.assign(o,{n:r,I:void 0,L:void 0,C:i}),r)},I.has=function(e){return!!this[M][e]},I.delete=function(e){var t=this[M],n=t[e];if(!n||n.p&&null!==n.p.e||n.E)return!1;var r=n.i;return n.d&&n.d.forEach((function(e){var t=e.i.indexOf(n);-1!==t&&e.i.splice(t,1)})),delete t[e],function(){var n=t[e];if(!n||!r||null!==n.e||n.E)return!1;r.forEach((function(e){n.i.push(e),e(n.n)})),r=null}};var D="undefined"!=typeof Symbol&&Symbol.iterator;I.entries=function(){var e,t,n=this,r=Object.keys(n[M]),i=0,o={next:function(){for(;void 0!==(t=r[i++])&&void 0===(e=n.get(t)););return{done:void 0===t,value:void 0!==t&&[t,e]}}};return o[D]=function(){return this},o}}();
!function(t){function e(t){t.registerRegistry=Object.create(null),t.namedRegisterAliases=Object.create(null)}var r=t.System;e(r);var i,s,n=r.constructor.prototype,l=r.constructor,a=function(){l.call(this),e(this)};a.prototype=n,r.constructor=a;var o=n.register;n.register=function(t,e,r,n){if("string"!=typeof t)return o.apply(this,arguments);var l=[e,r,n];return this.registerRegistry[t]=l,i||(i=l,s=t),Promise.resolve().then((function(){i=null,s=null})),o.apply(this,[e,r,n])};var u=n.resolve;n.resolve=function(t,e){try{return u.call(this,t,e)}catch(r){if(t in this.registerRegistry)return this.namedRegisterAliases[t]||t;throw r}};var c=n.instantiate;n.instantiate=function(t,e,r){var i=this.registerRegistry[t];return i?(this.registerRegistry[t]=null,i):c.call(this,t,e,r)};var g=n.getRegister;n.getRegister=function(t){var e=g.call(this,t);s&&t&&(this.namedRegisterAliases[s]=t);var r=i||e;return i=null,s=null,r}}("undefined"!=typeof self?self:global);
;(typeof System!='undefined')&&(System=new System.constructor());

System.register("./__entry.js", [], (function (exports, module) {
  'use strict';
  return {
    execute: (function () {

      const t=new Set;const Ks = async e=>{t.has(e)||(t.add(e),(a=>GM_addStyle(a))(e));};

      const X={host:"api.browser.yandex.ru",hostVOT:"vot.toil.cc/v1",hostWorker:"vot-worker.toil.cc",mediaProxy:"media-proxy.toil.cc",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 YaBrowser/25.12.0.0 Safari/537.36",componentVersion:"25.12.4.1198",hmac:"bt8xH3VOlb4mqf0nqAibnDOoiPlXsisf",defaultDuration:343,minChunkSize:5295308,loggerLevel:1,version:"2.4.14"};function Ys(){let n=0,t=0;for(let i=0;i<28;i+=7){let o=this.buf[this.pos++];if(n|=(o&127)<<i,(o&128)==0)return this.assertBounds(),[n,t]}let e=this.buf[this.pos++];if(n|=(e&15)<<28,t=(e&112)>>4,(e&128)==0)return this.assertBounds(),[n,t];for(let i=3;i<=31;i+=7){let o=this.buf[this.pos++];if(t|=(o&127)<<i,(o&128)==0)return this.assertBounds(),[n,t]}throw new Error("invalid varint")}function Qe(n,t,e){for(let r=0;r<28;r=r+7){const s=n>>>r,a=!(!(s>>>7)&&t==0),l=(a?s|128:s)&255;if(e.push(l),!a)return}const i=n>>>28&15|(t&7)<<4,o=t>>3!=0;if(e.push((o?i|128:i)&255),!!o){for(let r=3;r<31;r=r+7){const s=t>>>r,a=!!(s>>>7),l=(a?s|128:s)&255;if(e.push(l),!a)return}e.push(t>>>31&1);}}const Oe=4294967296;function ei(n){const t=n[0]==="-";t&&(n=n.slice(1));const e=1e6;let i=0,o=0;function r(s,a){const l=Number(n.slice(s,a));o*=e,i=i*e+l,i>=Oe&&(o=o+(i/Oe|0),i=i%Oe);}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),t?Jo(i,o):Cn(i,o)}function Xs(n,t){let e=Cn(n,t);const i=e.hi&2147483648;i&&(e=Jo(e.lo,e.hi));const o=Xo(e.lo,e.hi);return i?"-"+o:o}function Xo(n,t){if({lo:n,hi:t}=Js(n,t),t<=2097151)return String(Oe*t+n);const e=n&16777215,i=(n>>>24|t<<8)&16777215,o=t>>16&65535;let r=e+i*6777216+o*6710656,s=i+o*8147497,a=o*2;const l=1e7;return r>=l&&(s+=Math.floor(r/l),r%=l),s>=l&&(a+=Math.floor(s/l),s%=l),a.toString()+ni(s)+ni(r)}function Js(n,t){return {lo:n>>>0,hi:t>>>0}}function Cn(n,t){return {lo:n|0,hi:t|0}}function Jo(n,t){return t=~t,n?n=~n+1:t+=1,Cn(n,t)}const ni=n=>{const t=String(n);return "0000000".slice(t.length)+t};function ii(n,t){if(n>=0){for(;n>127;)t.push(n&127|128),n=n>>>7;t.push(n);}else {for(let e=0;e<9;e++)t.push(n&127|128),n=n>>7;t.push(1);}}function js(){let n=this.buf[this.pos++],t=n&127;if((n&128)==0)return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<7,(n&128)==0)return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<14,(n&128)==0)return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<21,(n&128)==0)return this.assertBounds(),t;n=this.buf[this.pos++],t|=(n&15)<<28;for(let e=5;(n&128)!==0&&e<10;e++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var oi={};const pt=Zs();function Zs(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(!!globalThis.Deno||typeof process!="object"||typeof oi!="object"||oi.BUF_BIGINT_DISABLE!=="1")){const e=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),o=BigInt("0"),r=BigInt("18446744073709551615");return {zero:BigInt(0),supported:true,parse(s){const a=typeof s=="bigint"?s:BigInt(s);if(a>i||a<e)throw new Error(`invalid int64: ${s}`);return a},uParse(s){const a=typeof s=="bigint"?s:BigInt(s);if(a>r||a<o)throw new Error(`invalid uint64: ${s}`);return a},enc(s){return n.setBigInt64(0,this.parse(s),true),{lo:n.getInt32(0,true),hi:n.getInt32(4,true)}},uEnc(s){return n.setBigInt64(0,this.uParse(s),true),{lo:n.getInt32(0,true),hi:n.getInt32(4,true)}},dec(s,a){return n.setInt32(0,s,true),n.setInt32(4,a,true),n.getBigInt64(0,true)},uDec(s,a){return n.setInt32(0,s,true),n.setInt32(4,a,true),n.getBigUint64(0,true)}}}return {zero:"0",supported:false,parse(e){return typeof e!="string"&&(e=e.toString()),ri(e),e},uParse(e){return typeof e!="string"&&(e=e.toString()),si(e),e},enc(e){return typeof e!="string"&&(e=e.toString()),ri(e),ei(e)},uEnc(e){return typeof e!="string"&&(e=e.toString()),si(e),ei(e)},dec(e,i){return Xs(e,i)},uDec(e,i){return Xo(e,i)}}}function ri(n){if(!/^-?[0-9]+$/.test(n))throw new Error("invalid int64: "+n)}function si(n){if(!/^[0-9]+$/.test(n))throw new Error("invalid uint64: "+n)}const tn=Symbol.for("@bufbuild/protobuf/text-encoding");function jo(){if(globalThis[tn]==null){const n=new globalThis.TextEncoder,t=new globalThis.TextDecoder;globalThis[tn]={encodeUtf8(e){return n.encode(e)},decodeUtf8(e){return t.decode(e)},checkUtf8(e){try{return encodeURIComponent(e),!0}catch{return  false}}};}return globalThis[tn]}var St;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32";})(St||(St={}));const Qs=34028234663852886e22,ta=-34028234663852886e22,ea=4294967295,na=2147483647,ia=-2147483648;class z{constructor(t=jo().encodeUtf8){this.encodeUtf8=t,this.stack=[],this.chunks=[],this.buf=[];}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let t=0;for(let o=0;o<this.chunks.length;o++)t+=this.chunks[o].length;let e=new Uint8Array(t),i=0;for(let o=0;o<this.chunks.length;o++)e.set(this.chunks[o],i),i+=this.chunks[o].length;return this.chunks=[],e}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),e=this.stack.pop();if(!e)throw new Error("invalid state, fork stack empty");return this.chunks=e.chunks,this.buf=e.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,e){return this.uint32((t<<3|e)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(ai(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return en(t),ii(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let e=this.encodeUtf8(t);return this.uint32(e.byteLength),this.raw(e)}float(t){oa(t);let e=new Uint8Array(4);return new DataView(e.buffer).setFloat32(0,t,true),this.raw(e)}double(t){let e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,t,true),this.raw(e)}fixed32(t){ai(t);let e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t,true),this.raw(e)}sfixed32(t){en(t);let e=new Uint8Array(4);return new DataView(e.buffer).setInt32(0,t,true),this.raw(e)}sint32(t){return en(t),t=(t<<1^t>>31)>>>0,ii(t,this.buf),this}sfixed64(t){let e=new Uint8Array(8),i=new DataView(e.buffer),o=pt.enc(t);return i.setInt32(0,o.lo,true),i.setInt32(4,o.hi,true),this.raw(e)}fixed64(t){let e=new Uint8Array(8),i=new DataView(e.buffer),o=pt.uEnc(t);return i.setInt32(0,o.lo,true),i.setInt32(4,o.hi,true),this.raw(e)}int64(t){let e=pt.enc(t);return Qe(e.lo,e.hi,this.buf),this}sint64(t){const e=pt.enc(t),i=e.hi>>31,o=e.lo<<1^i,r=(e.hi<<1|e.lo>>>31)^i;return Qe(o,r,this.buf),this}uint64(t){const e=pt.uEnc(t);return Qe(e.lo,e.hi,this.buf),this}}class V{constructor(t,e=jo().decodeUtf8){this.decodeUtf8=e,this.varint64=Ys,this.uint32=js,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength);}tag(){let t=this.uint32(),e=t>>>3,i=t&7;if(e<=0||i<0||i>5)throw new Error("illegal tag: field no "+e+" wire type "+i);return [e,i]}skip(t,e){let i=this.pos;switch(t){case St.Varint:for(;this.buf[this.pos++]&128;);break;case St.Bit64:this.pos+=4;case St.Bit32:this.pos+=4;break;case St.LengthDelimited:let o=this.uint32();this.pos+=o;break;case St.StartGroup:for(;;){const[r,s]=this.tag();if(s===St.EndGroup){if(e!==void 0&&r!==e)throw new Error("invalid end group tag");break}this.skip(s,r);}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return pt.dec(...this.varint64())}uint64(){return pt.uDec(...this.varint64())}sint64(){let[t,e]=this.varint64(),i=-(t&1);return t=(t>>>1|(e&1)<<31)^i,e=e>>>1^i,pt.dec(t,e)}bool(){let[t,e]=this.varint64();return t!==0||e!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,true)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,true)}fixed64(){return pt.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return pt.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,true)}double(){return this.view.getFloat64((this.pos+=8)-8,true)}bytes(){let t=this.uint32(),e=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(e,e+t)}string(){return this.decodeUtf8(this.bytes())}}function en(n){if(typeof n=="string")n=Number(n);else if(typeof n!="number")throw new Error("invalid int32: "+typeof n);if(!Number.isInteger(n)||n>na||n<ia)throw new Error("invalid int32: "+n)}function ai(n){if(typeof n=="string")n=Number(n);else if(typeof n!="number")throw new Error("invalid uint32: "+typeof n);if(!Number.isInteger(n)||n>ea||n<0)throw new Error("invalid uint32: "+n)}function oa(n){if(typeof n=="string"){const t=n;if(n=Number(n),Number.isNaN(n)&&t!=="NaN")throw new Error("invalid float32: "+t)}else if(typeof n!="number")throw new Error("invalid float32: "+typeof n);if(Number.isFinite(n)&&(n>Qs||n<ta))throw new Error("invalid float32: "+n)}var tt;(function(n){n[n.NO_CONNECTION=0]="NO_CONNECTION",n[n.TRANSLATING=10]="TRANSLATING",n[n.STREAMING=20]="STREAMING",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED";})(tt||(tt={}));function ra(n){switch(n){case 0:case "NO_CONNECTION":return tt.NO_CONNECTION;case 10:case "TRANSLATING":return tt.TRANSLATING;case 20:case "STREAMING":return tt.STREAMING;default:return tt.UNRECOGNIZED}}function sa(n){switch(n){case tt.NO_CONNECTION:return "NO_CONNECTION";case tt.TRANSLATING:return "TRANSLATING";case tt.STREAMING:return "STREAMING";case tt.UNRECOGNIZED:default:return "UNRECOGNIZED"}}function li(){return {target:"",targetUrl:""}}const Wt={encode(n,t=new z){return n.target!==""&&t.uint32(10).string(n.target),n.targetUrl!==""&&t.uint32(18).string(n.targetUrl),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=li();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.target=e.string();continue}case 2:{if(r!==18)break;o.targetUrl=e.string();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {target:S(n.target)?globalThis.String(n.target):"",targetUrl:S(n.targetUrl)?globalThis.String(n.targetUrl):""}},toJSON(n){const t={};return n.target!==""&&(t.target=n.target),n.targetUrl!==""&&(t.targetUrl=n.targetUrl),t},create(n){return Wt.fromPartial(n??{})},fromPartial(n){const t=li();return t.target=n.target??"",t.targetUrl=n.targetUrl??"",t}};function ci(){return {url:"",deviceId:void 0,firstRequest:false,duration:0,unknown0:0,language:"",forceSourceLang:false,unknown1:0,translationHelp:[],wasStream:false,responseLanguage:"",unknown2:0,unknown3:0,bypassCache:false,useLivelyVoice:false,videoTitle:""}}const Zo={encode(n,t=new z){n.url!==""&&t.uint32(26).string(n.url),n.deviceId!==void 0&&t.uint32(34).string(n.deviceId),n.firstRequest!==false&&t.uint32(40).bool(n.firstRequest),n.duration!==0&&t.uint32(49).double(n.duration),n.unknown0!==0&&t.uint32(56).int32(n.unknown0),n.language!==""&&t.uint32(66).string(n.language),n.forceSourceLang!==false&&t.uint32(72).bool(n.forceSourceLang),n.unknown1!==0&&t.uint32(80).int32(n.unknown1);for(const e of n.translationHelp)Wt.encode(e,t.uint32(90).fork()).join();return n.wasStream!==false&&t.uint32(104).bool(n.wasStream),n.responseLanguage!==""&&t.uint32(114).string(n.responseLanguage),n.unknown2!==0&&t.uint32(120).int32(n.unknown2),n.unknown3!==0&&t.uint32(128).int32(n.unknown3),n.bypassCache!==false&&t.uint32(136).bool(n.bypassCache),n.useLivelyVoice!==false&&t.uint32(144).bool(n.useLivelyVoice),n.videoTitle!==""&&t.uint32(154).string(n.videoTitle),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=ci();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 3:{if(r!==26)break;o.url=e.string();continue}case 4:{if(r!==34)break;o.deviceId=e.string();continue}case 5:{if(r!==40)break;o.firstRequest=e.bool();continue}case 6:{if(r!==49)break;o.duration=e.double();continue}case 7:{if(r!==56)break;o.unknown0=e.int32();continue}case 8:{if(r!==66)break;o.language=e.string();continue}case 9:{if(r!==72)break;o.forceSourceLang=e.bool();continue}case 10:{if(r!==80)break;o.unknown1=e.int32();continue}case 11:{if(r!==90)break;o.translationHelp.push(Wt.decode(e,e.uint32()));continue}case 13:{if(r!==104)break;o.wasStream=e.bool();continue}case 14:{if(r!==114)break;o.responseLanguage=e.string();continue}case 15:{if(r!==120)break;o.unknown2=e.int32();continue}case 16:{if(r!==128)break;o.unknown3=e.int32();continue}case 17:{if(r!==136)break;o.bypassCache=e.bool();continue}case 18:{if(r!==144)break;o.useLivelyVoice=e.bool();continue}case 19:{if(r!==154)break;o.videoTitle=e.string();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {url:S(n.url)?globalThis.String(n.url):"",deviceId:S(n.deviceId)?globalThis.String(n.deviceId):void 0,firstRequest:S(n.firstRequest)?globalThis.Boolean(n.firstRequest):false,duration:S(n.duration)?globalThis.Number(n.duration):0,unknown0:S(n.unknown0)?globalThis.Number(n.unknown0):0,language:S(n.language)?globalThis.String(n.language):"",forceSourceLang:S(n.forceSourceLang)?globalThis.Boolean(n.forceSourceLang):false,unknown1:S(n.unknown1)?globalThis.Number(n.unknown1):0,translationHelp:globalThis.Array.isArray(n?.translationHelp)?n.translationHelp.map(t=>Wt.fromJSON(t)):[],wasStream:S(n.wasStream)?globalThis.Boolean(n.wasStream):false,responseLanguage:S(n.responseLanguage)?globalThis.String(n.responseLanguage):"",unknown2:S(n.unknown2)?globalThis.Number(n.unknown2):0,unknown3:S(n.unknown3)?globalThis.Number(n.unknown3):0,bypassCache:S(n.bypassCache)?globalThis.Boolean(n.bypassCache):false,useLivelyVoice:S(n.useLivelyVoice)?globalThis.Boolean(n.useLivelyVoice):false,videoTitle:S(n.videoTitle)?globalThis.String(n.videoTitle):""}},toJSON(n){const t={};return n.url!==""&&(t.url=n.url),n.deviceId!==void 0&&(t.deviceId=n.deviceId),n.firstRequest!==false&&(t.firstRequest=n.firstRequest),n.duration!==0&&(t.duration=n.duration),n.unknown0!==0&&(t.unknown0=Math.round(n.unknown0)),n.language!==""&&(t.language=n.language),n.forceSourceLang!==false&&(t.forceSourceLang=n.forceSourceLang),n.unknown1!==0&&(t.unknown1=Math.round(n.unknown1)),n.translationHelp?.length&&(t.translationHelp=n.translationHelp.map(e=>Wt.toJSON(e))),n.wasStream!==false&&(t.wasStream=n.wasStream),n.responseLanguage!==""&&(t.responseLanguage=n.responseLanguage),n.unknown2!==0&&(t.unknown2=Math.round(n.unknown2)),n.unknown3!==0&&(t.unknown3=Math.round(n.unknown3)),n.bypassCache!==false&&(t.bypassCache=n.bypassCache),n.useLivelyVoice!==false&&(t.useLivelyVoice=n.useLivelyVoice),n.videoTitle!==""&&(t.videoTitle=n.videoTitle),t},create(n){return Zo.fromPartial(n??{})},fromPartial(n){const t=ci();return t.url=n.url??"",t.deviceId=n.deviceId??void 0,t.firstRequest=n.firstRequest??false,t.duration=n.duration??0,t.unknown0=n.unknown0??0,t.language=n.language??"",t.forceSourceLang=n.forceSourceLang??false,t.unknown1=n.unknown1??0,t.translationHelp=n.translationHelp?.map(e=>Wt.fromPartial(e))||[],t.wasStream=n.wasStream??false,t.responseLanguage=n.responseLanguage??"",t.unknown2=n.unknown2??0,t.unknown3=n.unknown3??0,t.bypassCache=n.bypassCache??false,t.useLivelyVoice=n.useLivelyVoice??false,t.videoTitle=n.videoTitle??"",t}};function di(){return {url:void 0,duration:void 0,status:0,remainingTime:void 0,unknown0:void 0,translationId:"",language:void 0,message:void 0,isLivelyVoice:false,unknown2:void 0,shouldRetry:void 0,unknown3:void 0}}const Qo={encode(n,t=new z){return n.url!==void 0&&t.uint32(10).string(n.url),n.duration!==void 0&&t.uint32(17).double(n.duration),n.status!==0&&t.uint32(32).int32(n.status),n.remainingTime!==void 0&&t.uint32(40).int32(n.remainingTime),n.unknown0!==void 0&&t.uint32(48).int32(n.unknown0),n.translationId!==""&&t.uint32(58).string(n.translationId),n.language!==void 0&&t.uint32(66).string(n.language),n.message!==void 0&&t.uint32(74).string(n.message),n.isLivelyVoice!==false&&t.uint32(80).bool(n.isLivelyVoice),n.unknown2!==void 0&&t.uint32(88).int32(n.unknown2),n.shouldRetry!==void 0&&t.uint32(96).int32(n.shouldRetry),n.unknown3!==void 0&&t.uint32(104).int32(n.unknown3),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=di();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.url=e.string();continue}case 2:{if(r!==17)break;o.duration=e.double();continue}case 4:{if(r!==32)break;o.status=e.int32();continue}case 5:{if(r!==40)break;o.remainingTime=e.int32();continue}case 6:{if(r!==48)break;o.unknown0=e.int32();continue}case 7:{if(r!==58)break;o.translationId=e.string();continue}case 8:{if(r!==66)break;o.language=e.string();continue}case 9:{if(r!==74)break;o.message=e.string();continue}case 10:{if(r!==80)break;o.isLivelyVoice=e.bool();continue}case 11:{if(r!==88)break;o.unknown2=e.int32();continue}case 12:{if(r!==96)break;o.shouldRetry=e.int32();continue}case 13:{if(r!==104)break;o.unknown3=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {url:S(n.url)?globalThis.String(n.url):void 0,duration:S(n.duration)?globalThis.Number(n.duration):void 0,status:S(n.status)?globalThis.Number(n.status):0,remainingTime:S(n.remainingTime)?globalThis.Number(n.remainingTime):void 0,unknown0:S(n.unknown0)?globalThis.Number(n.unknown0):void 0,translationId:S(n.translationId)?globalThis.String(n.translationId):"",language:S(n.language)?globalThis.String(n.language):void 0,message:S(n.message)?globalThis.String(n.message):void 0,isLivelyVoice:S(n.isLivelyVoice)?globalThis.Boolean(n.isLivelyVoice):false,unknown2:S(n.unknown2)?globalThis.Number(n.unknown2):void 0,shouldRetry:S(n.shouldRetry)?globalThis.Number(n.shouldRetry):void 0,unknown3:S(n.unknown3)?globalThis.Number(n.unknown3):void 0}},toJSON(n){const t={};return n.url!==void 0&&(t.url=n.url),n.duration!==void 0&&(t.duration=n.duration),n.status!==0&&(t.status=Math.round(n.status)),n.remainingTime!==void 0&&(t.remainingTime=Math.round(n.remainingTime)),n.unknown0!==void 0&&(t.unknown0=Math.round(n.unknown0)),n.translationId!==""&&(t.translationId=n.translationId),n.language!==void 0&&(t.language=n.language),n.message!==void 0&&(t.message=n.message),n.isLivelyVoice!==false&&(t.isLivelyVoice=n.isLivelyVoice),n.unknown2!==void 0&&(t.unknown2=Math.round(n.unknown2)),n.shouldRetry!==void 0&&(t.shouldRetry=Math.round(n.shouldRetry)),n.unknown3!==void 0&&(t.unknown3=Math.round(n.unknown3)),t},create(n){return Qo.fromPartial(n??{})},fromPartial(n){const t=di();return t.url=n.url??void 0,t.duration=n.duration??void 0,t.status=n.status??0,t.remainingTime=n.remainingTime??void 0,t.unknown0=n.unknown0??void 0,t.translationId=n.translationId??"",t.language=n.language??void 0,t.message=n.message??void 0,t.isLivelyVoice=n.isLivelyVoice??false,t.unknown2=n.unknown2??void 0,t.shouldRetry=n.shouldRetry??void 0,t.unknown3=n.unknown3??void 0,t}};function ui(){return {status:0,remainingTime:void 0,message:void 0,unknown0:void 0}}const ct={encode(n,t=new z){return n.status!==0&&t.uint32(8).int32(n.status),n.remainingTime!==void 0&&t.uint32(16).int32(n.remainingTime),n.message!==void 0&&t.uint32(26).string(n.message),n.unknown0!==void 0&&t.uint32(32).int32(n.unknown0),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=ui();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==8)break;o.status=e.int32();continue}case 2:{if(r!==16)break;o.remainingTime=e.int32();continue}case 3:{if(r!==26)break;o.message=e.string();continue}case 4:{if(r!==32)break;o.unknown0=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {status:S(n.status)?globalThis.Number(n.status):0,remainingTime:S(n.remainingTime)?globalThis.Number(n.remainingTime):void 0,message:S(n.message)?globalThis.String(n.message):void 0,unknown0:S(n.unknown0)?globalThis.Number(n.unknown0):void 0}},toJSON(n){const t={};return n.status!==0&&(t.status=Math.round(n.status)),n.remainingTime!==void 0&&(t.remainingTime=Math.round(n.remainingTime)),n.message!==void 0&&(t.message=n.message),n.unknown0!==void 0&&(t.unknown0=Math.round(n.unknown0)),t},create(n){return ct.fromPartial(n??{})},fromPartial(n){const t=ui();return t.status=n.status??0,t.remainingTime=n.remainingTime??void 0,t.message=n.message??void 0,t.unknown0=n.unknown0??void 0,t}};function hi(){return {url:"",duration:0,language:"",responseLanguage:""}}const tr={encode(n,t=new z){return n.url!==""&&t.uint32(10).string(n.url),n.duration!==0&&t.uint32(17).double(n.duration),n.language!==""&&t.uint32(26).string(n.language),n.responseLanguage!==""&&t.uint32(34).string(n.responseLanguage),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=hi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.url=e.string();continue}case 2:{if(r!==17)break;o.duration=e.double();continue}case 3:{if(r!==26)break;o.language=e.string();continue}case 4:{if(r!==34)break;o.responseLanguage=e.string();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {url:S(n.url)?globalThis.String(n.url):"",duration:S(n.duration)?globalThis.Number(n.duration):0,language:S(n.language)?globalThis.String(n.language):"",responseLanguage:S(n.responseLanguage)?globalThis.String(n.responseLanguage):""}},toJSON(n){const t={};return n.url!==""&&(t.url=n.url),n.duration!==0&&(t.duration=n.duration),n.language!==""&&(t.language=n.language),n.responseLanguage!==""&&(t.responseLanguage=n.responseLanguage),t},create(n){return tr.fromPartial(n??{})},fromPartial(n){const t=hi();return t.url=n.url??"",t.duration=n.duration??0,t.language=n.language??"",t.responseLanguage=n.responseLanguage??"",t}};function fi(){return {default:void 0,cloning:void 0}}const er={encode(n,t=new z){return n.default!==void 0&&ct.encode(n.default,t.uint32(10).fork()).join(),n.cloning!==void 0&&ct.encode(n.cloning,t.uint32(18).fork()).join(),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=fi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.default=ct.decode(e,e.uint32());continue}case 2:{if(r!==18)break;o.cloning=ct.decode(e,e.uint32());continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {default:S(n.default)?ct.fromJSON(n.default):void 0,cloning:S(n.cloning)?ct.fromJSON(n.cloning):void 0}},toJSON(n){const t={};return n.default!==void 0&&(t.default=ct.toJSON(n.default)),n.cloning!==void 0&&(t.cloning=ct.toJSON(n.cloning)),t},create(n){return er.fromPartial(n??{})},fromPartial(n){const t=fi();return t.default=n.default!==void 0&&n.default!==null?ct.fromPartial(n.default):void 0,t.cloning=n.cloning!==void 0&&n.cloning!==null?ct.fromPartial(n.cloning):void 0,t}};function pi(){return {audioFile:new Uint8Array(0),fileId:""}}const qt={encode(n,t=new z){return n.audioFile.length!==0&&t.uint32(18).bytes(n.audioFile),n.fileId!==""&&t.uint32(10).string(n.fileId),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=pi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 2:{if(r!==18)break;o.audioFile=e.bytes();continue}case 1:{if(r!==10)break;o.fileId=e.string();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {audioFile:S(n.audioFile)?dr(n.audioFile):new Uint8Array(0),fileId:S(n.fileId)?globalThis.String(n.fileId):""}},toJSON(n){const t={};return n.audioFile.length!==0&&(t.audioFile=ur(n.audioFile)),n.fileId!==""&&(t.fileId=n.fileId),t},create(n){return qt.fromPartial(n??{})},fromPartial(n){const t=pi();return t.audioFile=n.audioFile??new Uint8Array(0),t.fileId=n.fileId??"",t}};function gi(){return {audioFile:new Uint8Array(0),chunkId:0}}const Gt={encode(n,t=new z){return n.audioFile.length!==0&&t.uint32(18).bytes(n.audioFile),n.chunkId!==0&&t.uint32(8).int32(n.chunkId),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=gi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 2:{if(r!==18)break;o.audioFile=e.bytes();continue}case 1:{if(r!==8)break;o.chunkId=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {audioFile:S(n.audioFile)?dr(n.audioFile):new Uint8Array(0),chunkId:S(n.chunkId)?globalThis.Number(n.chunkId):0}},toJSON(n){const t={};return n.audioFile.length!==0&&(t.audioFile=ur(n.audioFile)),n.chunkId!==0&&(t.chunkId=Math.round(n.chunkId)),t},create(n){return Gt.fromPartial(n??{})},fromPartial(n){const t=gi();return t.audioFile=n.audioFile??new Uint8Array(0),t.chunkId=n.chunkId??0,t}};function mi(){return {audioBuffer:void 0,audioPartsLength:0,fileId:"",version:0}}const Kt={encode(n,t=new z){return n.audioBuffer!==void 0&&Gt.encode(n.audioBuffer,t.uint32(10).fork()).join(),n.audioPartsLength!==0&&t.uint32(16).int32(n.audioPartsLength),n.fileId!==""&&t.uint32(26).string(n.fileId),n.version!==0&&t.uint32(32).int32(n.version),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=mi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.audioBuffer=Gt.decode(e,e.uint32());continue}case 2:{if(r!==16)break;o.audioPartsLength=e.int32();continue}case 3:{if(r!==26)break;o.fileId=e.string();continue}case 4:{if(r!==32)break;o.version=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {audioBuffer:S(n.audioBuffer)?Gt.fromJSON(n.audioBuffer):void 0,audioPartsLength:S(n.audioPartsLength)?globalThis.Number(n.audioPartsLength):0,fileId:S(n.fileId)?globalThis.String(n.fileId):"",version:S(n.version)?globalThis.Number(n.version):0}},toJSON(n){const t={};return n.audioBuffer!==void 0&&(t.audioBuffer=Gt.toJSON(n.audioBuffer)),n.audioPartsLength!==0&&(t.audioPartsLength=Math.round(n.audioPartsLength)),n.fileId!==""&&(t.fileId=n.fileId),n.version!==0&&(t.version=Math.round(n.version)),t},create(n){return Kt.fromPartial(n??{})},fromPartial(n){const t=mi();return t.audioBuffer=n.audioBuffer!==void 0&&n.audioBuffer!==null?Gt.fromPartial(n.audioBuffer):void 0,t.audioPartsLength=n.audioPartsLength??0,t.fileId=n.fileId??"",t.version=n.version??0,t}};function vi(){return {translationId:"",url:"",partialAudioInfo:void 0,audioInfo:void 0}}const bn={encode(n,t=new z){return n.translationId!==""&&t.uint32(10).string(n.translationId),n.url!==""&&t.uint32(18).string(n.url),n.partialAudioInfo!==void 0&&Kt.encode(n.partialAudioInfo,t.uint32(34).fork()).join(),n.audioInfo!==void 0&&qt.encode(n.audioInfo,t.uint32(50).fork()).join(),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=vi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.translationId=e.string();continue}case 2:{if(r!==18)break;o.url=e.string();continue}case 4:{if(r!==34)break;o.partialAudioInfo=Kt.decode(e,e.uint32());continue}case 6:{if(r!==50)break;o.audioInfo=qt.decode(e,e.uint32());continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {translationId:S(n.translationId)?globalThis.String(n.translationId):"",url:S(n.url)?globalThis.String(n.url):"",partialAudioInfo:S(n.partialAudioInfo)?Kt.fromJSON(n.partialAudioInfo):void 0,audioInfo:S(n.audioInfo)?qt.fromJSON(n.audioInfo):void 0}},toJSON(n){const t={};return n.translationId!==""&&(t.translationId=n.translationId),n.url!==""&&(t.url=n.url),n.partialAudioInfo!==void 0&&(t.partialAudioInfo=Kt.toJSON(n.partialAudioInfo)),n.audioInfo!==void 0&&(t.audioInfo=qt.toJSON(n.audioInfo)),t},create(n){return bn.fromPartial(n??{})},fromPartial(n){const t=vi();return t.translationId=n.translationId??"",t.url=n.url??"",t.partialAudioInfo=n.partialAudioInfo!==void 0&&n.partialAudioInfo!==null?Kt.fromPartial(n.partialAudioInfo):void 0,t.audioInfo=n.audioInfo!==void 0&&n.audioInfo!==null?qt.fromPartial(n.audioInfo):void 0,t}};function bi(){return {status:0,remainingChunks:[]}}const nr={encode(n,t=new z){n.status!==0&&t.uint32(8).int32(n.status);for(const e of n.remainingChunks)t.uint32(18).string(e);return t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=bi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==8)break;o.status=e.int32();continue}case 2:{if(r!==18)break;o.remainingChunks.push(e.string());continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {status:S(n.status)?globalThis.Number(n.status):0,remainingChunks:globalThis.Array.isArray(n?.remainingChunks)?n.remainingChunks.map(t=>globalThis.String(t)):[]}},toJSON(n){const t={};return n.status!==0&&(t.status=Math.round(n.status)),n.remainingChunks?.length&&(t.remainingChunks=n.remainingChunks),t},create(n){return nr.fromPartial(n??{})},fromPartial(n){const t=bi();return t.status=n.status??0,t.remainingChunks=n.remainingChunks?.map(e=>e)||[],t}};function yi(){return {language:"",url:"",unknown0:0,translatedLanguage:"",translatedUrl:"",unknown1:0,unknown2:0}}const Yt={encode(n,t=new z){return n.language!==""&&t.uint32(10).string(n.language),n.url!==""&&t.uint32(18).string(n.url),n.unknown0!==0&&t.uint32(24).int32(n.unknown0),n.translatedLanguage!==""&&t.uint32(34).string(n.translatedLanguage),n.translatedUrl!==""&&t.uint32(42).string(n.translatedUrl),n.unknown1!==0&&t.uint32(48).int32(n.unknown1),n.unknown2!==0&&t.uint32(56).int32(n.unknown2),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=yi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.language=e.string();continue}case 2:{if(r!==18)break;o.url=e.string();continue}case 3:{if(r!==24)break;o.unknown0=e.int32();continue}case 4:{if(r!==34)break;o.translatedLanguage=e.string();continue}case 5:{if(r!==42)break;o.translatedUrl=e.string();continue}case 6:{if(r!==48)break;o.unknown1=e.int32();continue}case 7:{if(r!==56)break;o.unknown2=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {language:S(n.language)?globalThis.String(n.language):"",url:S(n.url)?globalThis.String(n.url):"",unknown0:S(n.unknown0)?globalThis.Number(n.unknown0):0,translatedLanguage:S(n.translatedLanguage)?globalThis.String(n.translatedLanguage):"",translatedUrl:S(n.translatedUrl)?globalThis.String(n.translatedUrl):"",unknown1:S(n.unknown1)?globalThis.Number(n.unknown1):0,unknown2:S(n.unknown2)?globalThis.Number(n.unknown2):0}},toJSON(n){const t={};return n.language!==""&&(t.language=n.language),n.url!==""&&(t.url=n.url),n.unknown0!==0&&(t.unknown0=Math.round(n.unknown0)),n.translatedLanguage!==""&&(t.translatedLanguage=n.translatedLanguage),n.translatedUrl!==""&&(t.translatedUrl=n.translatedUrl),n.unknown1!==0&&(t.unknown1=Math.round(n.unknown1)),n.unknown2!==0&&(t.unknown2=Math.round(n.unknown2)),t},create(n){return Yt.fromPartial(n??{})},fromPartial(n){const t=yi();return t.language=n.language??"",t.url=n.url??"",t.unknown0=n.unknown0??0,t.translatedLanguage=n.translatedLanguage??"",t.translatedUrl=n.translatedUrl??"",t.unknown1=n.unknown1??0,t.unknown2=n.unknown2??0,t}};function wi(){return {url:"",language:""}}const ir={encode(n,t=new z){return n.url!==""&&t.uint32(10).string(n.url),n.language!==""&&t.uint32(18).string(n.language),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=wi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.url=e.string();continue}case 2:{if(r!==18)break;o.language=e.string();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {url:S(n.url)?globalThis.String(n.url):"",language:S(n.language)?globalThis.String(n.language):""}},toJSON(n){const t={};return n.url!==""&&(t.url=n.url),n.language!==""&&(t.language=n.language),t},create(n){return ir.fromPartial(n??{})},fromPartial(n){const t=wi();return t.url=n.url??"",t.language=n.language??"",t}};function ki(){return {waiting:false,subtitles:[]}}const or={encode(n,t=new z){n.waiting!==false&&t.uint32(8).bool(n.waiting);for(const e of n.subtitles)Yt.encode(e,t.uint32(18).fork()).join();return t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=ki();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==8)break;o.waiting=e.bool();continue}case 2:{if(r!==18)break;o.subtitles.push(Yt.decode(e,e.uint32()));continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {waiting:S(n.waiting)?globalThis.Boolean(n.waiting):false,subtitles:globalThis.Array.isArray(n?.subtitles)?n.subtitles.map(t=>Yt.fromJSON(t)):[]}},toJSON(n){const t={};return n.waiting!==false&&(t.waiting=n.waiting),n.subtitles?.length&&(t.subtitles=n.subtitles.map(e=>Yt.toJSON(e))),t},create(n){return or.fromPartial(n??{})},fromPartial(n){const t=ki();return t.waiting=n.waiting??false,t.subtitles=n.subtitles?.map(e=>Yt.fromPartial(e))||[],t}};function Si(){return {url:"",timestamp:""}}const Xt={encode(n,t=new z){return n.url!==""&&t.uint32(10).string(n.url),n.timestamp!==""&&t.uint32(18).string(n.timestamp),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=Si();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.url=e.string();continue}case 2:{if(r!==18)break;o.timestamp=e.string();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {url:S(n.url)?globalThis.String(n.url):"",timestamp:S(n.timestamp)?globalThis.String(n.timestamp):""}},toJSON(n){const t={};return n.url!==""&&(t.url=n.url),n.timestamp!==""&&(t.timestamp=n.timestamp),t},create(n){return Xt.fromPartial(n??{})},fromPartial(n){const t=Si();return t.url=n.url??"",t.timestamp=n.timestamp??"",t}};function xi(){return {url:"",language:"",responseLanguage:"",unknown0:0,unknown1:0}}const rr={encode(n,t=new z){return n.url!==""&&t.uint32(10).string(n.url),n.language!==""&&t.uint32(18).string(n.language),n.responseLanguage!==""&&t.uint32(26).string(n.responseLanguage),n.unknown0!==0&&t.uint32(40).int32(n.unknown0),n.unknown1!==0&&t.uint32(48).int32(n.unknown1),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=xi();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.url=e.string();continue}case 2:{if(r!==18)break;o.language=e.string();continue}case 3:{if(r!==26)break;o.responseLanguage=e.string();continue}case 5:{if(r!==40)break;o.unknown0=e.int32();continue}case 6:{if(r!==48)break;o.unknown1=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {url:S(n.url)?globalThis.String(n.url):"",language:S(n.language)?globalThis.String(n.language):"",responseLanguage:S(n.responseLanguage)?globalThis.String(n.responseLanguage):"",unknown0:S(n.unknown0)?globalThis.Number(n.unknown0):0,unknown1:S(n.unknown1)?globalThis.Number(n.unknown1):0}},toJSON(n){const t={};return n.url!==""&&(t.url=n.url),n.language!==""&&(t.language=n.language),n.responseLanguage!==""&&(t.responseLanguage=n.responseLanguage),n.unknown0!==0&&(t.unknown0=Math.round(n.unknown0)),n.unknown1!==0&&(t.unknown1=Math.round(n.unknown1)),t},create(n){return rr.fromPartial(n??{})},fromPartial(n){const t=xi();return t.url=n.url??"",t.language=n.language??"",t.responseLanguage=n.responseLanguage??"",t.unknown0=n.unknown0??0,t.unknown1=n.unknown1??0,t}};function Ti(){return {interval:0,translatedInfo:void 0,pingId:void 0}}const sr={encode(n,t=new z){return n.interval!==0&&t.uint32(8).int32(n.interval),n.translatedInfo!==void 0&&Xt.encode(n.translatedInfo,t.uint32(18).fork()).join(),n.pingId!==void 0&&t.uint32(24).int32(n.pingId),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=Ti();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==8)break;o.interval=e.int32();continue}case 2:{if(r!==18)break;o.translatedInfo=Xt.decode(e,e.uint32());continue}case 3:{if(r!==24)break;o.pingId=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {interval:S(n.interval)?ra(n.interval):0,translatedInfo:S(n.translatedInfo)?Xt.fromJSON(n.translatedInfo):void 0,pingId:S(n.pingId)?globalThis.Number(n.pingId):void 0}},toJSON(n){const t={};return n.interval!==0&&(t.interval=sa(n.interval)),n.translatedInfo!==void 0&&(t.translatedInfo=Xt.toJSON(n.translatedInfo)),n.pingId!==void 0&&(t.pingId=Math.round(n.pingId)),t},create(n){return sr.fromPartial(n??{})},fromPartial(n){const t=Ti();return t.interval=n.interval??0,t.translatedInfo=n.translatedInfo!==void 0&&n.translatedInfo!==null?Xt.fromPartial(n.translatedInfo):void 0,t.pingId=n.pingId??void 0,t}};function Ai(){return {pingId:0}}const ar={encode(n,t=new z){return n.pingId!==0&&t.uint32(8).int32(n.pingId),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=Ai();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==8)break;o.pingId=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {pingId:S(n.pingId)?globalThis.Number(n.pingId):0}},toJSON(n){const t={};return n.pingId!==0&&(t.pingId=Math.round(n.pingId)),t},create(n){return ar.fromPartial(n??{})},fromPartial(n){const t=Ai();return t.pingId=n.pingId??0,t}};function Li(){return {uuid:"",module:""}}const lr={encode(n,t=new z){return n.uuid!==""&&t.uint32(10).string(n.uuid),n.module!==""&&t.uint32(18).string(n.module),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=Li();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.uuid=e.string();continue}case 2:{if(r!==18)break;o.module=e.string();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {uuid:S(n.uuid)?globalThis.String(n.uuid):"",module:S(n.module)?globalThis.String(n.module):""}},toJSON(n){const t={};return n.uuid!==""&&(t.uuid=n.uuid),n.module!==""&&(t.module=n.module),t},create(n){return lr.fromPartial(n??{})},fromPartial(n){const t=Li();return t.uuid=n.uuid??"",t.module=n.module??"",t}};function Ii(){return {secretKey:"",expires:0}}const cr={encode(n,t=new z){return n.secretKey!==""&&t.uint32(10).string(n.secretKey),n.expires!==0&&t.uint32(16).int32(n.expires),t},decode(n,t){const e=n instanceof V?n:new V(n);let i=t===void 0?e.len:e.pos+t;const o=Ii();for(;e.pos<i;){const r=e.uint32();switch(r>>>3){case 1:{if(r!==10)break;o.secretKey=e.string();continue}case 2:{if(r!==16)break;o.expires=e.int32();continue}}if((r&7)===4||r===0)break;e.skip(r&7);}return o},fromJSON(n){return {secretKey:S(n.secretKey)?globalThis.String(n.secretKey):"",expires:S(n.expires)?globalThis.Number(n.expires):0}},toJSON(n){const t={};return n.secretKey!==""&&(t.secretKey=n.secretKey),n.expires!==0&&(t.expires=Math.round(n.expires)),t},create(n){return cr.fromPartial(n??{})},fromPartial(n){const t=Ii();return t.secretKey=n.secretKey??"",t.expires=n.expires??0,t}};function dr(n){if(globalThis.Buffer)return Uint8Array.from(globalThis.Buffer.from(n,"base64"));{const t=globalThis.atob(n),e=new Uint8Array(t.length);for(let i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e}}function ur(n){if(globalThis.Buffer)return globalThis.Buffer.from(n).toString("base64");{const t=[];return n.forEach(e=>{t.push(globalThis.String.fromCharCode(e));}),globalThis.btoa(t.join(""))}}function S(n){return n!=null}const aa=(function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"})(),la=function(n){return "/"+n},Ei={},ca=function(t,e,i){let o=Promise.resolve();if(e&&e.length>0){let l=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");o=l(e.map(c=>{if(c=la(c),c in Ei)return;Ei[c]=true;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":aa,d||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),d)return new Promise((f,v)=>{h.addEventListener("load",f),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)));})}));}function r(s){const a=new Event("vite:preloadError",{cancelable:true});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};var ee;(function(n){n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n[n.SILENCE=4]="SILENCE";})(ee||(ee={}));const Ye=`[vot.js v${X.version}]`;function Te(n){return X.loggerLevel<=n}function da(...n){Te(ee.DEBUG)&&console.log(Ye,...n);}function ua(...n){Te(ee.INFO)&&console.info(Ye,...n);}function ha(...n){Te(ee.WARN)&&console.warn(Ye,...n);}function fa(...n){Te(ee.ERROR)&&console.error(Ye,...n);}const C={canLog:Te,log:da,info:ua,warn:ha,error:fa},{componentVersion:yn}=X;async function pa(){return typeof window<"u"&&window.crypto?window.crypto:await ca(()=>module.import('./__vite-browser-external-BIHI7g3E-DUmwvnCo.js'),void 0)}const Mn=new TextEncoder;async function hr(n,t,e){const i=await pa(),o=await i.subtle.importKey("raw",Mn.encode(t),{name:"HMAC",hash:{name:n}},false,["sign","verify"]);return await i.subtle.sign("HMAC",o,e)}async function wn(n){const t=await hr("SHA-256",X.hmac,n);return new Uint8Array(t).reduce((e,i)=>e+i.toString(16).padStart(2,"0"),"")}async function zt(n,t,e,i){const{secretKey:o,uuid:r}=t,s=`${r}:${i}:${yn}`,a=Mn.encode(s),l=await wn(a);if(n==="Ya-Summary")return {[`X-${n}-Sk`]:o,[`X-${n}-Token`]:`${l}:${s}`};if(!e)throw new TypeError(`Body is required for sec type ${n}`);const c=await wn(e);return {[`${n}-Signature`]:c,[`Sec-${n}-Sk`]:o,[`Sec-${n}-Token`]:`${l}:${s}`}}function ga(){const n="0123456789ABCDEF";let t="";for(let e=0;e<32;e++){const i=Math.floor(Math.random()*16);t+=n[i];}return t}async function ma(n,t){try{const e=Mn.encode(t),i=await hr("SHA-1",n,e);return btoa(String.fromCharCode(...new Uint8Array(i)))}catch(e){return C.error(e),false}}const fr={"sec-ch-ua":`"Chromium";v="142", "YaBrowser";v="${yn.slice(0,5)}", "Not?A_Brand";v="24", "Yowser";v="2.5"`,"sec-ch-ua-full-version-list":`"Chromium";v="142.0.7444.59", "YaBrowser";v="${yn}", "Not?A_Brand";v="24.0.0.0", "Yowser";v="2.5"`,"Sec-Fetch-Mode":"no-cors"},va={afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arm:"hy",asm:"as",aym:"ay",aze:"az",baq:"eu",bel:"be",ben:"bn",bos:"bs",bul:"bg",bur:"my",cat:"ca",chi:"zh",cos:"co",cze:"cs",dan:"da",div:"dv",dut:"nl",eng:"en",epo:"eo",est:"et",ewe:"ee",fin:"fi",fre:"fr",fry:"fy",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",hin:"hi",hrv:"hr",hun:"hu",ibo:"ig",ice:"is",ind:"id",ita:"it",jav:"jv",jpn:"ja",kan:"kn",kaz:"kk",khm:"km",kin:"rw",kir:"ky",kor:"ko",kur:"ku",lao:"lo",lat:"la",lav:"lv",lin:"ln",lit:"lt",ltz:"lb",lug:"lg",mac:"mk",mal:"ml",mao:"mi",mar:"mr",may:"ms",mlg:"mg",mlt:"mt",mon:"mn",nep:"ne",nor:"no",nya:"ny",ori:"or",orm:"om",pan:"pa",per:"fa",pol:"pl",por:"pt",pus:"ps",que:"qu",rum:"ro",rus:"ru",san:"sa",sin:"si",slo:"sk",slv:"sl",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",srp:"sr",sun:"su",swa:"sw",swe:"sv",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tha:"th",tir:"ti",tso:"ts",tuk:"tk",tur:"tr",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",vie:"vi",wel:"cy",xho:"xh",yid:"yi",yor:"yo",zul:"zu"};async function pr(n,t={headers:{"User-Agent":X.userAgent}}){const{timeout:e=3e3,signal:i,...o}=t;if(!i&&(!e||e<=0))return await fetch(n,o);const r=new AbortController,s=l=>{r.signal.aborted||r.abort(l);};i&&(i.aborted?s(i.reason):i.addEventListener("abort",()=>s(i.reason),{once:true}));let a;e&&e>0&&(a=setTimeout(()=>s(new Error("Fetch timeout")),e));try{return await fetch(n,{...o,signal:r.signal})}finally{a&&clearTimeout(a);}}function ba(){return Math.floor(Date.now()/1e3)}function J(n){return n.length===3?va[n]:n.toLowerCase().split(/[_;-]/)[0].trim()}function ut(n,t="mp4"){const e=`https://${X.mediaProxy}/v1/proxy/video.${t}?format=base64&force=true`;return n instanceof URL?`${e}&url=${btoa(n.href)}&origin=${n.origin}&referer=${n.origin}`:`${e}&url=${btoa(n)}`}function he(n,t){const e="https:",i=t.hostname.replace(/^m\./,""),o=n.replace(/^\/+/,""),r=i.endsWith("vkvideo.ru")?"vkvideo.ru":i.endsWith("vk.com")||i.endsWith("vk.ru")?"vk.com":i,s=t.pathname.replace(/\/+$/,""),l=/^\/(?:video|clip)-?\d+_\d+$/.test(s)?`${e}//${r}${s}`:`${e}//${r}/${o}`,c=new URL(l);for(const d of ["list","access_key"]){const u=t.searchParams.get(d);u&&c.searchParams.set(d,u);}return c.toString()}function ya(n,t,e,i,o,{forceSourceLang:r=false,wasStream:s=false,videoTitle:a="",bypassCache:l=false,useLivelyVoice:c=false,firstRequest:d=true}={}){return Zo.encode({url:n,firstRequest:d,duration:t,unknown0:1,language:e,forceSourceLang:r,unknown1:0,translationHelp:o??[],responseLanguage:i,wasStream:s,unknown2:1,unknown3:2,bypassCache:l,useLivelyVoice:c,videoTitle:a}).finish()}function wa(n){return Qo.decode(new Uint8Array(n))}function ka(n,t,e,i){return tr.encode({url:n,duration:t,language:e,responseLanguage:i}).finish()}function Sa(n){return er.decode(new Uint8Array(n))}function gr(n){return "chunkId"in n}function xa(n,t,e,i){return i&&gr(e)?bn.encode({url:n,translationId:t,partialAudioInfo:{...i,audioBuffer:e}}).finish():bn.encode({url:n,translationId:t,audioInfo:e}).finish()}function Ta(n){return nr.decode(new Uint8Array(n))}function Aa(n,t){return ir.encode({url:n,language:t}).finish()}function La(n){return or.decode(new Uint8Array(n))}function Ia(n){return ar.encode({pingId:n}).finish()}function Ea(n,t,e){return rr.encode({url:n,language:t,responseLanguage:e,unknown0:1,unknown1:0}).finish()}function Pa(n){return sr.decode(new Uint8Array(n))}const ot={encodeTranslationRequest:ya,decodeTranslationResponse:wa,encodeTranslationCacheRequest:ka,decodeTranslationCacheResponse:Sa,isPartialAudioBuffer:gr,encodeTranslationAudioRequest:xa,decodeTranslationAudioResponse:Ta,encodeSubtitlesRequest:Aa,decodeSubtitlesResponse:La,encodeStreamPingRequest:Ia,encodeStreamRequest:Ea,decodeStreamResponse:Pa};function Ca(n,t){return lr.encode({uuid:n,module:t}).finish()}function Ma(n){return cr.decode(new Uint8Array(n))}const Pi={encodeSessionRequest:Ca,decodeSessionResponse:Ma};var ft;(function(n){n[n.FAILED=0]="FAILED",n[n.FINISHED=1]="FINISHED",n[n.WAITING=2]="WAITING",n[n.LONG_WAITING=3]="LONG_WAITING",n[n.PART_CONTENT=5]="PART_CONTENT",n[n.AUDIO_REQUESTED=6]="AUDIO_REQUESTED",n[n.SESSION_REQUIRED=7]="SESSION_REQUIRED";})(ft||(ft={}));var ne;(function(n){n.WEB_API_VIDEO_SRC_FROM_IFRAME="web_api_video_src_from_iframe",n.WEB_API_VIDEO_SRC="web_api_video_src",n.WEB_API_GET_ALL_GENERATING_URLS_DATA_FROM_IFRAME="web_api_get_all_generating_urls_data_from_iframe",n.WEB_API_GET_ALL_GENERATING_URLS_DATA_FROM_IFRAME_TMP_EXP="web_api_get_all_generating_urls_data_from_iframe_tmp_exp",n.WEB_API_REPLACED_FETCH_INSIDE_IFRAME="web_api_replaced_fetch_inside_iframe",n.ANDROID_API="android_api",n.WEB_API_SLOW="web_api_slow",n.WEB_API_STEAL_SIG_AND_N="web_api_steal_sig_and_n",n.WEB_API_COMBINED="web_api_get_all_generating_urls_data_from_iframe,web_api_steal_sig_and_n";})(ne||(ne={}));var m;(function(n){n.custom="custom",n.directlink="custom",n.youtube="youtube",n.piped="piped",n.invidious="invidious",n.niconico="niconico",n.vk="vk",n.nine_gag="nine_gag",n.gag="nine_gag",n.twitch="twitch",n.proxitok="proxitok",n.tiktok="tiktok",n.vimeo="vimeo",n.xvideos="xvideos",n.xhamster="xhamster",n.spankbang="spankbang",n.rule34video="rule34video",n.picarto="picarto",n.olympicsreplay="olympics_replay",n.pornhub="pornhub",n.twitter="twitter",n.x="twitter",n.rumble="rumble",n.facebook="facebook",n.rutube="rutube",n.coub="coub",n.bilibili="bilibili",n.mail_ru="mailru",n.mailru="mailru",n.bitchute="bitchute",n.eporner="eporner",n.peertube="peertube",n.dailymotion="dailymotion",n.trovo="trovo",n.yandexdisk="yandexdisk",n.ok_ru="okru",n.okru="okru",n.googledrive="googledrive",n.bannedvideo="bannedvideo",n.weverse="weverse",n.weibo="weibo",n.newgrounds="newgrounds",n.egghead="egghead",n.youku="youku",n.archive="archive",n.kodik="kodik",n.patreon="patreon",n.reddit="reddit",n.kick="kick",n.apple_developer="apple_developer",n.appledeveloper="apple_developer",n.epicgames="epicgames",n.odysee="odysee",n.coursehunterLike="coursehunterLike",n.sap="sap",n.watchpornto="watchpornto",n.linkedin="linkedin",n.incestflix="incestflix",n.porntn="porntn",n.dzen="dzen",n.cloudflarestream="cloudflarestream",n.loom="loom",n.rtnews="rtnews",n.bitview="bitview",n.thisvid="thisvid",n.ign="ign",n.zdf="zdf",n.bunkr="bunkr",n.imdb="imdb",n.telegram="telegram";})(m||(m={}));function Ci(n,t,e){return n===m.patreon?{service:"mux",videoId:new URL(e).pathname.slice(1)}:{service:n,videoId:t}}class U extends Error{data;constructor(t,e=void 0){super(t),this.data=e,this.name="VOTJSError";}}class Va{host;schema;fetch;fetchOpts;sessions={};userAgent=X.userAgent;headers={"User-Agent":this.userAgent,Accept:"application/x-protobuf","Accept-Language":"en","Content-Type":"application/x-protobuf",Pragma:"no-cache","Cache-Control":"no-cache"};hostSchemaRe=/(http(s)?):\/\//;constructor({host:t=X.host,fetchFn:e=pr,fetchOpts:i={},headers:o={}}={}){const r=this.hostSchemaRe.exec(t)?.[1];this.host=r?t.replace(`${r}://`,""):t,this.schema=r??"https",this.fetch=e,this.fetchOpts=i,this.headers={...this.headers,...o};}async request(t,e,i={},o="POST"){const r=this.getOpts(new Blob([e]),i,o);try{const s=await this.fetch(`${this.schema}://${this.host}${t}`,r),a=await s.arrayBuffer();return {success:s.status===200,data:a}}catch(s){return {success:false,data:s?.message}}}async requestJSON(t,e=null,i={},o="POST"){const r=this.getOpts(e,{"Content-Type":"application/json",...i},o);try{const s=await this.fetch(`${this.schema}://${this.host}${t}`,r),a=await s.json();return {success:s.status===200,data:a}}catch(s){return {success:false,data:s?.message}}}getOpts(t,e={},i="POST"){return {method:i,headers:{...this.headers,...e},body:t,...this.fetchOpts}}async getSession(t){const e=ba(),i=this.sessions[t];if(i&&i.timestamp+i.expires>e)return i;const{secretKey:o,expires:r,uuid:s}=await this.createSession(t);return this.sessions[t]={secretKey:o,expires:r,timestamp:e,uuid:s},this.sessions[t]}async createSession(t){const e=ga(),i=Pi.encodeSessionRequest(e,t),o=await this.request("/session/create",i,{"Vtrans-Signature":await wn(i)});if(!o.success)throw new U("Failed to request create session",o);return {...Pi.decodeSessionResponse(o.data),uuid:e}}}let mr=class extends Va{hostVOT;schemaVOT;apiToken;requestLang;responseLang;paths={videoTranslation:"/video-translation/translate",videoTranslationFailAudio:"/video-translation/fail-audio-js",videoTranslationAudio:"/video-translation/audio",videoTranslationCache:"/video-translation/cache",videoSubtitles:"/video-subtitles/get-subtitles",streamPing:"/stream-translation/ping-stream",streamTranslation:"/stream-translation/translate-stream"};isCustomLink(t){return !!(/\.(m3u8|m4(a|v)|mpd)/.exec(t)??/^https:\/\/cdn\.qstv\.on\.epicgames\.com/.exec(t))}headersVOT={"User-Agent":`vot.js/${X.version}`,"Content-Type":"application/json",Pragma:"no-cache","Cache-Control":"no-cache"};constructor({host:t,hostVOT:e=X.hostVOT,fetchFn:i,fetchOpts:o,requestLang:r="en",responseLang:s="ru",apiToken:a,headers:l}={}){super({host:t,fetchFn:i,fetchOpts:o,headers:l});const c=this.hostSchemaRe.exec(e)?.[1];this.hostVOT=c?e.replace(`${c}://`,""):e,this.schemaVOT=c??"https",this.requestLang=r,this.responseLang=s,this.apiToken=a;}get apiTokenHeader(){return this.apiToken?{Authorization:`OAuth ${this.apiToken}`}:{}}async requestVOT(t,e,i={}){const o=this.getOpts(JSON.stringify(e),{...this.headersVOT,...i});try{const r=await this.fetch(`${this.schemaVOT}://${this.hostVOT}${t}`,o),s=await r.json();return {success:r.status===200,data:s}}catch(r){return {success:false,data:r?.message}}}async translateVideoYAImpl({videoData:t,requestLang:e=this.requestLang,responseLang:i=this.responseLang,translationHelp:o=null,headers:r={},extraOpts:s={},shouldSendFailedAudio:a=true}){const{url:l,duration:c=X.defaultDuration}=t,d=await this.getSession("video-translation"),u=ot.encodeTranslationRequest(l,c,e,i,o,s),h=this.paths.videoTranslation,f=await zt("Vtrans",d,u,h),v=s.useLivelyVoice?this.apiTokenHeader:{},b=await this.request(h,u,{...f,...v,...r});if(!b.success)throw new U("Failed to request video translation",b);const y=ot.decodeTranslationResponse(b.data);C.log("translateVideo",y);const{status:x,translationId:w}=y;switch(x){case ft.FAILED:throw new U("Yandex couldn't translate video",y);case ft.FINISHED:case ft.PART_CONTENT:if(!y.url)throw new U("Audio link wasn't received from Yandex response",y);return {translationId:w,translated:true,url:y.url,status:x,remainingTime:y.remainingTime??-1};case ft.WAITING:case ft.LONG_WAITING:return {translationId:w,translated:false,status:x,remainingTime:y.remainingTime??-1};case ft.AUDIO_REQUESTED:return l.startsWith("https://youtu.be/")&&a?(await this.requestVtransFailAudio(l),await this.requestVtransAudio(l,y.translationId,{audioFile:new Uint8Array,fileId:ne.WEB_API_GET_ALL_GENERATING_URLS_DATA_FROM_IFRAME}),await this.translateVideoYAImpl({videoData:t,requestLang:e,responseLang:i,translationHelp:o,headers:r,shouldSendFailedAudio:false})):{translationId:w,translated:false,status:x,remainingTime:y.remainingTime??-1};case ft.SESSION_REQUIRED:throw new U("Yandex auth required to translate video. See docs for more info",y);default:throw C.error("Unknown response",y),new U("Unknown response from Yandex",y)}}async translateVideoVOTImpl({url:t,videoId:e,service:i,requestLang:o=this.requestLang,responseLang:r=this.responseLang,headers:s={},provider:a="yandex"}){const l=Ci(i,e,t),c=await this.requestVOT(this.paths.videoTranslation,{provider:a,service:l.service,video_id:l.videoId,from_lang:o,to_lang:r,raw_video:t},{...s});if(!c.success)throw new U("Failed to request video translation",c);const d=c.data;switch(d.status){case "failed":throw new U("Yandex couldn't translate video",d);case "success":if(!d.translated_url)throw new U("Audio link wasn't received from VOT response",d);return {translationId:String(d.id),translated:true,url:d.translated_url,status:1,remainingTime:-1};case "waiting":return {translationId:"",translated:false,remainingTime:d.remaining_time,status:2,message:d.message}}}async requestVtransFailAudio(t){const e=await this.requestJSON(this.paths.videoTranslationFailAudio,JSON.stringify({video_url:t}),void 0,"PUT");if(!e.data||typeof e.data=="string"||e.data.status!==1)throw new U("Failed to request to fake video translation fail audio js",e);return e}async requestVtransAudio(t,e,i,o,r={}){const s=await this.getSession("video-translation");let a;if(ot.isPartialAudioBuffer(i)){if(!o)throw new U("Partial audio metadata is required for partial audio buffer",i);a=ot.encodeTranslationAudioRequest(t,e,i,o);}else a=ot.encodeTranslationAudioRequest(t,e,i,void 0);const l=this.paths.videoTranslationAudio,c=await zt("Vtrans",s,a,l),d=await this.request(l,a,{...c,...r},"PUT");if(!d.success)throw new U("Failed to request video translation audio",d);return ot.decodeTranslationAudioResponse(d.data)}async translateVideoCache({videoData:t,requestLang:e=this.requestLang,responseLang:i=this.responseLang,headers:o={}}){const{url:r,duration:s=X.defaultDuration}=t,a=await this.getSession("video-translation"),l=ot.encodeTranslationCacheRequest(r,s,e,i),c=this.paths.videoTranslationCache,d=await zt("Vtrans",a,l,c),u=await this.request(c,l,{...d,...o},"POST");if(!u.success)throw new U("Failed to request video translation cache",u);return ot.decodeTranslationCacheResponse(u.data)}async translateVideo({videoData:t,requestLang:e=this.requestLang,responseLang:i=this.responseLang,translationHelp:o=null,headers:r={},extraOpts:s={},shouldSendFailedAudio:a=true}){const{url:l,videoId:c,host:d}=t;return this.isCustomLink(l)?await this.translateVideoVOTImpl({url:l,videoId:c,service:d,requestLang:e,responseLang:i,headers:r,provider:s.useLivelyVoice?"yandex_lively":"yandex"}):await this.translateVideoYAImpl({videoData:t,requestLang:e,responseLang:i,translationHelp:o,headers:r,extraOpts:s,shouldSendFailedAudio:a})}async getSubtitlesYAImpl({videoData:t,requestLang:e=this.requestLang,headers:i={}}){const{url:o}=t,r=await this.getSession("video-translation"),s=ot.encodeSubtitlesRequest(o,e),a=this.paths.videoSubtitles,l=await zt("Vsubs",r,s,a),c=await this.request(a,s,{...l,...i});if(!c.success)throw new U("Failed to request video subtitles",c);const d=ot.decodeSubtitlesResponse(c.data),u=d.subtitles.map(h=>{const{language:f,url:v,translatedLanguage:b,translatedUrl:y}=h;return {language:f,url:v,translatedLanguage:b,translatedUrl:y}});return {waiting:d.waiting,subtitles:u}}async getSubtitlesVOTImpl({url:t,videoId:e,service:i,headers:o={}}){const r=Ci(i,e,t),s=await this.requestVOT(this.paths.videoSubtitles,{provider:"yandex",service:r.service,video_id:r.videoId},o);if(!s.success)throw new U("Failed to request video subtitles",s);const a=s.data;return {waiting:false,subtitles:a.reduce((c,d)=>{if(!d.lang_from)return c;const u=a.find(h=>h.lang===d.lang_from);return u&&c.push({language:u.lang,url:u.subtitle_url,translatedLanguage:d.lang,translatedUrl:d.subtitle_url}),c},[])}}async getSubtitles({videoData:t,requestLang:e=this.requestLang,headers:i={}}){const{url:o,videoId:r,host:s}=t;return this.isCustomLink(o)?await this.getSubtitlesVOTImpl({url:o,videoId:r,service:s,headers:i}):await this.getSubtitlesYAImpl({videoData:t,requestLang:e,headers:i})}async pingStream({pingId:t,headers:e={}}){const i=await this.getSession("video-translation"),o=ot.encodeStreamPingRequest(t),r=this.paths.streamPing,s=await zt("Vtrans",i,o,r),a=await this.request(r,o,{...s,...e});if(!a.success)throw new U("Failed to request stream ping",a);return  true}async translateStream({videoData:t,requestLang:e=this.requestLang,responseLang:i=this.responseLang,headers:o={}}){const{url:r}=t;if(this.isCustomLink(r))throw new U("Unsupported video URL for getting stream translation");const s=await this.getSession("video-translation"),a=ot.encodeStreamRequest(r,e,i),l=this.paths.streamTranslation,c=await zt("Vtrans",s,a,l),d=await this.request(l,a,{...c,...o});if(!d.success)throw new U("Failed to request stream translation",d);const u=ot.decodeStreamResponse(d.data),h=u.interval;switch(h){case tt.NO_CONNECTION:case tt.TRANSLATING:return {translated:false,interval:h,message:h===tt.NO_CONNECTION?"streamNoConnectionToServer":"translationTakeFewMinutes"};case tt.STREAMING:{if(u.pingId===void 0)throw new U("Stream ping id wasn't received from Yandex response",u);return {translated:true,interval:h,pingId:u.pingId,result:u.translatedInfo}}default:throw C.error("Unknown response",u),new U("Unknown response from Yandex",u)}}},_a=class extends mr{constructor(t={}){t.host=t.host??X.hostWorker,super(t);}async request(t,e,i={},o="POST"){const r=this.getOpts(JSON.stringify({headers:{...this.headers,...i},body:Array.from(e)}),{"Content-Type":"application/json"},o);try{const s=await this.fetch(`${this.schema}://${this.host}${t}`,r),a=await s.arrayBuffer();return {success:s.status===200,data:a}}catch(s){return {success:false,data:s?.message}}}async requestJSON(t,e=null,i={},o="POST"){const r=this.getOpts(JSON.stringify({headers:{...this.headers,"Content-Type":"application/json",Accept:"application/json",...i},body:e}),{Accept:"application/json","Content-Type":"application/json"},o);try{const s=await this.fetch(`${this.schema}://${this.host}${t}`,r),a=await s.json();return {success:s.status===200,data:a}}catch(s){return {success:false,data:s?.message}}}};class Oa extends mr{constructor(t){super(t),this.headers={...fr,...this.headers};}}class Ba extends _a{constructor(t){super(t),this.headers={...fr,...this.headers};}}class fe extends Error{constructor(t){super(t),this.name="VideoDataError";}}const Da=/(file:\/\/(\/)?|(http(s)?:\/\/)(127\.0\.0\.1|localhost|192\.168\.(\d){1,3}\.(\d){1,3}))/,Ra=["yewtu.be","inv.nadeko.net","invidious.nerdvpn.de","invidious.protokolla.fi","invidious.materialio.us","iv.melmac.space"],Fa=["piped.video","piped.kavin.rocks","piped.private.coffee"],Na=["proxitok.pabloferreiro.es","proxitok.pussthecat.org","tok.habedieeh.re","proxitok.esmailelbob.xyz","proxitok.privacydev.net","tok.artemislena.eu","tok.adminforge.de","tt.vern.cc","cringe.whatever.social","proxitok.lunar.icu","proxitok.privacy.com.de"],Ha=["peertube.tmp.rcp.tf","dalek.zone","video.sadmin.io","videos.viorsan.com","peertube.1312.media","tube.shanti.cafe","bee-tube.fr","video.blender.org","beetoons.tv","makertube.net","peertube.tv","framatube.org","tilvids.com","diode.zone","fedimovie.com","video.hardlimit.com","share.tube","peervideo.club"],$a=["coursehunter.net","coursetrain.net"];var W;(function(n){n.udemy="udemy",n.coursera="coursera",n.douyin="douyin",n.artstation="artstation",n.kickstarter="kickstarter",n.oraclelearn="oraclelearn",n.deeplearningai="deeplearningai",n.netacad="netacad";})(W||(W={}));({...m,...W});const B={bilibiliPlayer:".bpx-player-video-wrap, div.player-mobile-box.player-mobile-autoplay",flowplayer:".fp-player",idPlayer:"#player",jwPlayer:".jwplayer, .jw-media",player:".player",videoJsUniversal:"video-js, .video-js:not(video), .vjs-player, [data-vjs-player], [id^='vjs_video_']:not(video)",vkVideoPlayer:"vk-video-player"},Ua=[{additionalData:"mobile",host:m.youtube,url:"https://youtu.be/",match:/^m.youtube.com$/,selector:".player-container",needExtraData:true},{host:m.youtube,url:"https://youtu.be/",match:/^(www.)?youtube(-nocookie|kids)?.com$/,selector:".html5-video-container:not(#inline-player *)",needExtraData:true},{host:m.invidious,url:"https://youtu.be/",match:Ra,selector:B.idPlayer,needBypassCSP:true},{host:m.piped,url:"https://youtu.be/",match:Fa,selector:".shaka-video-container",needBypassCSP:true},{host:m.zdf,url:"https://www.zdf.de/play/",match:[/^zdf.de$/,/^(www.)?zdf.de$/],selector:"div.zdfplayer-app.zdfplayer-desktop, div.zdfplayer-app"},{host:m.niconico,url:"https://www.nicovideo.jp/watch/",match:[/^(www\.|sp\.)?nicovideo\.jp$/,/^nico\.ms$/],selector:'[class*="grid-area_[player]"] > div'},{additionalData:"mobile",host:m.vk,url:"https://vk.com/video?z=",match:[/^m.vk.(com|ru)$/,/^m.vkvideo.ru$/],selector:B.vkVideoPlayer,shadowRoot:true,needExtraData:true},{additionalData:"clips",host:m.vk,url:"https://vk.com/video?z=",match:/^(www.|m.)?vk.(com|ru)$/,selector:'div[data-testid="clipcontainer-video"]',needExtraData:true},{host:m.vk,url:"https://vk.com/video?z=",match:[/^(www\.|m\.)?vk\.(com|ru)$/,/^(.*\.)?vkvideo\.ru$/],selector:B.vkVideoPlayer,needExtraData:true},{host:m.nine_gag,url:"https://9gag.com/gag/",match:/^9gag.com$/,selector:".video-post",needExtraData:true},{host:m.twitch,url:"https://twitch.tv/",match:[/^m.twitch.tv$/,/^(www.)?twitch.tv$/,/^clips.twitch.tv$/,/^player.twitch.tv$/],needExtraData:true,selector:".video-ref, main > div > section > div > div > div"},{host:m.proxitok,url:"https://www.tiktok.com/",match:Na,selector:".column.has-text-centered"},{host:m.tiktok,url:"https://www.tiktok.com/",match:/^(www.)?tiktok.com$/,selector:null},{host:W.douyin,url:"https://www.douyin.com/",match:/^(www.)?douyin.com/,selector:".xg-video-container",needExtraData:true,needBypassCSP:true},{host:m.vimeo,url:"https://vimeo.com/",match:/^(www\.|m\.)?vimeo.com$/,needExtraData:true,selector:B.player},{host:m.vimeo,url:"https://player.vimeo.com/",match:/^player.vimeo.com$/,additionalData:"embed",needExtraData:true,needBypassCSP:true,selector:B.player},{host:m.xvideos,url:"https://www.xvideos.com/",match:[/^(www.)?xvideos(-ar)?.com$/,/^(www.)?xvideos(\d\d\d).com$/,/^(www.)?xv-ru.com$/],selector:"#hlsplayer",needBypassCSP:true},{host:m.xhamster,url:"https://xhamster.com/",match:n=>/^(?:[^.]+\.)?(?:xhamster\.(?:com|desi)|xhamster\d+\.(?:com|desi)|xhvid\.com)$/.test(n.host)&&/\/(?:videos\/[^/]+-[\dA-Za-z]+)\/?$/.test(n.pathname),selector:"#player-container"},{host:m.spankbang,url:"https://spankbang.com/",match:n=>/^(?:[^.]+\.)?spankbang\.com$/.test(n.host)&&/\/(?:[\da-z]+\/(?:video|play|embed)(?:\/[^/]+)?|[\da-z]+-[\da-z]+\/playlist\/[^/?#&]+)\/?$/i.test(n.pathname),selector:"#main_video_player"},{host:m.rule34video,url:"https://rule34video.com/video/",match:n=>/^(www\.)?rule34video\.com$/.test(n.host)&&/\/videos?\/\d+/.test(n.pathname),selector:B.flowplayer},{host:m.picarto,url:"https://picarto.tv/",match:n=>/^(www\.)?picarto\.tv$/.test(n.host)&&/^(?:\/[^/]+\/(?:profile\/)?videos\/[^/?#&]+|\/videopopout\/[^/?#&]+|\/[^/#?]+\/?)$/.test(n.pathname),selector:'[class*="VideosTab__PlayerWrapper"]'},{host:m.olympicsreplay,url:"https://olympics.com/",match:n=>/^(www\.)?olympics\.com$/.test(n.host)&&/^\/[a-z]{2}\/(?:paris-2024\/)?(?:replay|videos?|original-series\/episode)\/[\w-]+\/?$/i.test(n.pathname),selector:B.videoJsUniversal},{host:m.pornhub,url:"https://rt.pornhub.com/view_video.php?viewkey=",match:/^[a-z]+.pornhub.(com|org)$/,selector:".mainPlayerDiv > .video-element-wrapper-js > div",eventSelector:".mgp_eventCatcher"},{additionalData:"embed",host:m.pornhub,url:"https://rt.pornhub.com/view_video.php?viewkey=",match:n=>/^[a-z]+.pornhub.(com|org)$/.exec(n.host)&&n.pathname.startsWith("/embed/"),selector:B.idPlayer},{host:m.twitter,url:"https://twitter.com/i/status/",match:/^(twitter|x).com$/,selector:'div[data-testid="videoComponent"] > div:nth-child(1) > div',eventSelector:'div[data-testid="videoPlayer"]',needBypassCSP:true},{host:m.rumble,url:"https://rumble.com/",match:/^rumble.com$/,selector:"#videoPlayer > .videoPlayer-Rumble-cls > div"},{host:m.facebook,url:"https://facebook.com/",match:n=>n.host.includes("facebook.com")&&n.pathname.includes("/videos/"),selector:'div[role="main"] div[data-pagelet$="video" i]',needBypassCSP:true},{additionalData:"reels",host:m.facebook,url:"https://facebook.com/",match:n=>n.host.includes("facebook.com")&&n.pathname.includes("/reel/"),selector:'div[role="main"]',needBypassCSP:true},{host:m.rutube,url:"https://rutube.ru/video/",match:/^rutube.ru$/,selector:".video-player > div > div > div:nth-child(2)"},{additionalData:"embed",host:m.rutube,url:"https://rutube.ru/video/",match:/^rutube.ru$/,selector:"#app > div > div"},{host:m.bilibili,url:"https://www.bilibili.com/",match:/^(www|m|player).bilibili.com$/,selector:B.bilibiliPlayer},{host:m.bilibili,url:"https://www.bilibili.tv/",match:/^(?:www\.|m\.)?bilibili\.tv$/,selector:B.bilibiliPlayer},{additionalData:"old",host:m.bilibili,url:"https://www.bilibili.com/",match:/^(www|m).bilibili.com$/,selector:null},{host:m.mailru,url:"https://my.mail.ru/",match:/^my.mail.ru$/,selector:"#b-video-wrapper"},{host:m.bitchute,url:"https://www.bitchute.com/video/",match:/^(www.)?bitchute.com$/,selector:B.videoJsUniversal},{host:m.eporner,url:"https://www.eporner.com/",match:/^(www.)?eporner.com$/,selector:B.videoJsUniversal},{host:m.peertube,url:"stub",match:Ha,selector:B.videoJsUniversal},{host:m.dailymotion,url:"https://www.dailymotion.com/video/",match:/^((www\.)?dailymotion\.com|geo(\d+)?\.dailymotion\.com|dai\.ly)$/,selector:B.player},{host:m.trovo,url:"https://trovo.live/s/",match:/^trovo.live$/,selector:".player-video"},{host:m.yandexdisk,url:"https://yadi.sk/",match:/^disk.yandex.(ru|kz|com(\.(am|ge|tr))?|by|az|co\.il|ee|lt|lv|md|net|tj|tm|uz)$/,selector:".video-player__player > div:nth-child(1)",eventSelector:".video-player__player",needBypassCSP:true,needExtraData:true},{host:m.okru,url:"https://ok.ru/video/",match:/^ok.ru$/,selector:B.vkVideoPlayer,shadowRoot:true},{host:m.googledrive,url:"https://drive.google.com/file/d/",match:/^youtube.googleapis.com$/,selector:".html5-video-container"},{host:m.bannedvideo,url:"https://madmaxworld.tv/watch?id=",match:/^(www.)?banned.video|madmaxworld.tv$/,selector:B.videoJsUniversal,needExtraData:true},{host:m.weverse,url:"https://weverse.io/",match:/^weverse.io$/,selector:".webplayer-internal-source-wrapper",needExtraData:true},{host:m.weibo,url:"https://weibo.com/",match:n=>/^(?:www\.)?weibo\.com$/.test(n.host)&&/^\/(?:\d+\/[A-Za-z0-9]+|0\/[A-Za-z0-9]+|tv\/show\/\d+:(?:[\da-f]{32}|\d{16,}))\/?$/.test(n.pathname)||/^video\.weibo\.com$/.test(n.host)&&/^\/show\/?$/.test(n.pathname)&&/^\d+:(?:[\da-f]{32}|\d{16,})$/i.test(n.searchParams.get("fid")??""),selector:"#playVideo, sharedSelectors.videoJsUniversal"},{host:m.newgrounds,url:"https://www.newgrounds.com/",match:/^(www.)?newgrounds.com$/,selector:".ng-video-player"},{host:m.egghead,url:"https://egghead.io/",match:/^egghead.io$/,selector:".cueplayer-react-video-holder"},{host:m.youku,url:"https://v.youku.com/",match:/^v.youku.com$/,selector:"#ykPlayer"},{host:m.archive,url:"https://archive.org/details/",match:/^archive.org$/,selector:B.jwPlayer},{host:m.kodik,url:"stub",match:/^kodik.(info|biz|cc)$/,selector:B.flowplayer,needExtraData:true},{host:m.patreon,url:"stub",match:/^(www.)?patreon.com$/,selector:'div[data-tag="post-card"] div[elevation="subtle"] > div > div > div > div',needExtraData:true},{additionalData:"old",host:m.reddit,url:"stub",match:/^old.reddit.com$/,selector:".reddit-video-player-root",needExtraData:true,needBypassCSP:true},{host:m.reddit,url:"stub",match:/^(www.|new.)?reddit.com$/,selector:"div[slot=post-media-container]",shadowRoot:true,needExtraData:true,needBypassCSP:true},{host:m.kick,url:"https://kick.com/",match:/^kick.com$/,selector:"#injected-embedded-channel-player-video > div",needExtraData:true},{host:m.appledeveloper,url:"https://developer.apple.com/",match:/^developer.apple.com$/,selector:".developer-video-player",needExtraData:true,needBypassCSP:true},{host:m.epicgames,url:"https://dev.epicgames.com/community/learning/",match:/^dev.epicgames.com$/,selector:B.videoJsUniversal,needExtraData:true},{host:m.odysee,url:"stub",match:/^odysee.com$/,selector:B.videoJsUniversal,needExtraData:true},{host:m.coursehunterLike,url:"stub",match:$a,selector:"#oframeplayer > pjsdiv:has(video)",needExtraData:true},{host:m.sap,url:"https://learning.sap.com/courses/",match:/^learning.sap.com$/,selector:".playkit-container",eventSelector:".playkit-player",needExtraData:true,needBypassCSP:true},{host:W.udemy,url:"https://www.udemy.com/",match:/udemy.com$/,selector:'div[data-purpose="curriculum-item-viewer-content"] > section > div > div > div > div:nth-of-type(2)',needExtraData:true},{host:W.coursera,url:"https://www.coursera.org/",match:/coursera.org$/,selector:B.videoJsUniversal,needExtraData:true},{host:m.watchpornto,url:"https://watchporn.to/",match:/^watchporn.to$/,selector:B.flowplayer},{host:m.linkedin,url:"https://www.linkedin.com/learning/",match:/^(www.)?linkedin.com$/,selector:B.videoJsUniversal,needExtraData:true,needBypassCSP:true},{host:m.incestflix,url:"https://www.incestflix.net/watch/",match:/^(www.)?incestflix.(net|to|com)$/,selector:"#incflix-stream",needExtraData:true},{host:m.porntn,url:"https://porntn.com/videos/",match:/^porntn.com$/,selector:B.flowplayer,needExtraData:true},{host:m.dzen,url:"https://dzen.ru/video/watch/",match:/^dzen.ru$/,selector:".zen-ui-video-video-player"},{host:m.cloudflarestream,url:"stub",match:/^(watch|embed|iframe|customer-[^.]+).cloudflarestream.com$/,selector:null},{host:m.loom,url:"https://www.loom.com/share/",match:/^(www.)?loom.com$/,selector:".VideoLayersContainer",needExtraData:true,needBypassCSP:true},{host:W.artstation,url:"https://www.artstation.com/learning/",match:/^(www.)?artstation.com$/,selector:B.videoJsUniversal,needExtraData:true},{host:m.rtnews,url:"https://www.rt.com/",match:/^(www.)?rt.com$/,selector:B.jwPlayer,needExtraData:true},{host:m.bitview,url:"https://www.bitview.net/watch?v=",match:/^(www.)?bitview.net$/,selector:".vlScreen",needExtraData:true},{host:W.kickstarter,url:"https://www.kickstarter.com/",match:/^(www.)?kickstarter.com/,selector:".ksr-video-player",needExtraData:true},{host:m.thisvid,url:"https://thisvid.com/",match:/^(www.)?thisvid.com$/,selector:B.flowplayer},{additionalData:"regional",host:m.ign,url:"https://de.ign.com/",match:/^(\w{2}.)?ign.com$/,needExtraData:true,selector:".video-container"},{host:m.ign,url:"https://www.ign.com/",match:/^(www.)?ign.com$/,selector:B.player,needExtraData:true},{host:m.bunkr,url:"https://bunkr.site/",match:/^bunkr\.(site|black|cat|media|red|site|ws|org|s[kiu]|c[ir]|fi|p[hks]|ru|la|is|to|a[cx])$/,needExtraData:true,selector:".plyr__video-wrapper"},{host:m.imdb,url:"https://www.imdb.com/video/",match:/^(www\.)?imdb\.com$/,selector:B.jwPlayer},{host:m.telegram,url:"https://t.me/",match:n=>/^web\.telegram\.org$/.test(n.hostname)&&n.pathname.startsWith("/k"),selector:".ckin__player"},{host:W.oraclelearn,url:"https://mylearn.oracle.com/ou/course/",match:/^mylearn\.oracle\.com/,selector:B.videoJsUniversal,needExtraData:true,needBypassCSP:true},{host:W.deeplearningai,url:"https://learn.deeplearning.ai/courses/",match:/^learn(-dev|-staging)?\.deeplearning\.ai/,selector:".lesson-video-player",needExtraData:true},{host:W.netacad,url:"https://www.netacad.com/",match:/^(www\.)?netacad\.com/,selector:B.videoJsUniversal,needExtraData:true},{host:m.custom,url:"stub",match:n=>/([^.]+)\.(mp4|webm)/.test(n.pathname),rawResult:true}];class O extends Error{constructor(t){super(t),this.name="VideoHelperError";}}class T{API_ORIGIN=window.location.origin;fetch;extraInfo;referer;origin;service;video;language;constructor({fetchFn:t=pr,extraInfo:e=true,referer:i=document.referrer??`${window.location.origin}/`,origin:o=window.location.origin,service:r,video:s,language:a="en"}={}){this.fetch=t,this.extraInfo=e,this.referer=i,this.origin=/^(http(s)?):\/\//.test(String(o))?o:window.location.origin,this.service=r,this.video=s,this.language=a;}getVideoData(t){return Promise.resolve(void 0)}getVideoId(t){return Promise.resolve(void 0)}returnBaseData(t){if(this.service)return {url:this.service.url+t,videoId:t,host:this.service.host,duration:void 0}}}class za extends T{API_ORIGIN="https://developer.apple.com";async getVideoData(t){try{const e=document.querySelector("meta[property='og:video']")?.content;if(!e)throw new O("Failed to find content url");return {url:e}}catch(e){C.error(`Failed to get apple developer video data by video ID: ${t}`,e.message);return}}async getVideoId(t){return /videos\/play\/([^/]+)\/([\d]+)/.exec(t.pathname)?.[0]}}class Wa extends T{async getVideoId(t){return /(details|embed)\/([^/]+)/.exec(t.pathname)?.[2]}}class qa extends T{API_ORIGIN="https://www.artstation.com/api/v2/learning";getCSRFToken(){return document.querySelector('meta[name="public-csrf-token"]')?.content}async getCourseInfo(t){try{const e=this.getCSRFToken();return await(await this.fetch(`${this.API_ORIGIN}/courses/${t}/autoplay.json`,{method:"POST",headers:e?{"PUBLIC-CSRF-TOKEN":e}:{}})).json()}catch(e){return C.error(`Failed to get artstation course info by courseId: ${t}.`,e.message),false}}async getVideoUrl(t){try{return (await(await this.fetch(`${this.API_ORIGIN}/quicksilver/video_url.json?chapter_id=${t}`)).json()).url.replace("qsep://","https://")}catch(e){return C.error(`Failed to get artstation video url by chapterId: ${t}.`,e.message),false}}async getVideoData(t){const[,e,,,i]=t.split("/"),o=await this.getCourseInfo(e);if(!o)return;const r=o.chapters.find(u=>u.hash_id===i);if(!r)return;const s=await this.getVideoUrl(r.id);if(!s)return;const{title:a,duration:l,subtitles:c}=r,d=c.filter(u=>u.format==="vtt").map(u=>({language:J(u.locale),source:"artstation",format:"vtt",url:u.file_url}));return {url:s,title:a,duration:l,subtitles:d}}async getVideoId(t){return /courses\/(\w{3,5})\/([^/]+)\/chapters\/(\w{3,5})/.exec(t.pathname)?.[0]}}class Ga extends T{API_ORIGIN="https://api.banned.video";async getVideoInfo(t){try{return await(await this.fetch(`${this.API_ORIGIN}/graphql`,{method:"POST",body:JSON.stringify({operationName:"GetVideo",query:`query GetVideo($id: String!) {
            getVideo(id: $id) {
              title
              description: summary
              duration: videoDuration
              videoUrl: directUrl
              isStream: live
            }
          }`,variables:{id:t}}),headers:{"User-Agent":"bannedVideoFrontEnd","apollographql-client-name":"banned-web","apollographql-client-version":"1.3","content-type":"application/json"}})).json()}catch(e){return console.error(`Failed to get bannedvideo video info by videoId: ${t}.`,e.message),false}}async getVideoData(t){const e=await this.getVideoInfo(t);if(!e)return;const{videoUrl:i,duration:o,isStream:r,description:s,title:a}=e.data.getVideo;return {url:i,duration:o,isStream:r,title:a,description:s}}async getVideoId(t){return t.searchParams.get("id")??void 0}}class Ka extends T{async getVideoId(t){const e=/bangumi\/play\/([^/]+)/.exec(t.pathname)?.[0];if(e)return e;const i=t.searchParams.get("bvid");if(i)return `video/${i}`;const o=/^\/(?:[a-z]{2}\/)?((?:play\/\d+(?:\/\d+)?|video\/\d+))\/?$/i.exec(t.pathname)?.[1];if(o)return o;let r=/video\/([^/]+)/.exec(t.pathname)?.[0];return r&&t.searchParams.get("p")!==null&&(r+=`/?p=${t.searchParams.get("p")}`),r}}class Ya extends T{async getVideoId(t){return /(video|embed)\/([^/]+)/.exec(t.pathname)?.[2]}}class Xa extends T{async getVideoData(t){try{const e=document.querySelector(".vlScreen > video")?.src;if(!e)throw new O("Failed to find video URL");return {url:e}}catch(e){C.error(`Failed to get Bitview data by videoId: ${t}`,e.message);return}}async getVideoId(t){return t.searchParams.get("v")}}class Ja extends T{async getVideoData(t){const e=document.querySelector('#player > source[type="video/mp4"]')?.src;if(e)return {url:e}}async getVideoId(t){return /\/f\/([^/]+)/.exec(t.pathname)?.[1]}}class ja extends T{async getVideoId(t){return t.pathname+t.search}}class Za extends T{API_ORIGIN=this.origin??"https://coursehunter.net";async getCourseId(){const t=window.course_id;return t!==void 0?String(t):document.querySelector('input[name="course_id"]')?.value}async getLessonsData(t){const e=window.lessons;if(e?.length)return e;try{return await(await this.fetch(`${this.API_ORIGIN}/api/v1/course/${t}/lessons`)).json()}catch(i){C.error(`Failed to get CoursehunterLike lessons data by courseId: ${t}, because ${i.message}`);return}}getLessondId(t){let e=t.split("?lesson=")?.[1];return e||(e=document.querySelector(".lessons-item_active")?.dataset?.index,e)?+e:1}async getVideoData(t){const e=await this.getCourseId();if(!e)return;const i=await this.getLessonsData(e);if(!i)return;const o=this.getLessondId(t),r=i?.[o-1],{file:s,duration:a,title:l}=r;if(s)return {url:ut(s),duration:a,title:l}}async getVideoId(t){const e=/course\/([^/]+)/.exec(t.pathname)?.[0];return e?e+t.search:void 0}}const Ut=["auto","ru","en","zh","ko","lt","lv","ar","fr","it","es","de","ja"],Vn=["ru","en","kk"],Qa=["srt","vtt","json"];class Ft extends T{SUBTITLE_SOURCE="videojs";SUBTITLE_FORMAT="vtt";static getPlayer(){const t=window.videojs,e=document.querySelector("video.vjs-tech[id], video[id$='_html5_api']"),i=e?.id?.endsWith("_html5_api")?e.id.slice(0,-10):void 0;if(t?.getPlayer){if(i){const r=t.getPlayer(i);if(r)return r}if(e){const r=t.getPlayer(e);if(r)return r}}const o=(typeof t?.getPlayers=="function"?t.getPlayers():t?.players)??{};for(const r of Object.values(o)){const s=r,l=(typeof s.el=="function"?s.el():null)?.querySelector?.("video.vjs-tech, video")??null;if(l&&e&&l===e||i&&typeof s.id=="function"&&s.id()===i)return r}}getVideoDataByPlayer(t){try{const e=Ft.getPlayer(),i=document.querySelector("video.vjs-tech, video[id$='_html5_api'], video[src]");if(!e&&!i)throw new Error(`Video player/video element not found, videoId ${t}`);const o=e?.duration?.()??i?.duration;let r;if(e){const l=typeof e.currentSources=="function"?e.currentSources():e.getCache?.()?.sources;r=(Array.isArray(l)?l.find(d=>d?.type==="video/mp4"||d?.type==="video/webm"||d?.src):void 0)?.src;}if(r??=i?.currentSrc||i?.src||i?.getAttribute?.("src")||void 0,!r)throw new Error(`Failed to find video url for videoID ${t}`);const a=(i?Array.from(i.querySelectorAll("track[src]")):[]).filter(l=>l.kind!=="metadata").flatMap(l=>{const c=l.getAttribute("src");if(!c)return [];const d=new URL(c,window.location.href).toString();return [{language:J(l.srclang||""),source:this.SUBTITLE_SOURCE,format:this.SUBTITLE_FORMAT,url:d}]});return {url:r,duration:o,subtitles:a}}catch(e){C.error("Failed to get videojs video data",e.message);return}}}class _n extends Ft{API_ORIGIN="https://www.coursera.org/api";SUBTITLE_SOURCE="coursera";async getCourseData(t){try{return (await(await this.fetch(`${this.API_ORIGIN}/onDemandCourses.v1/${t}`)).json())?.elements?.[0]}catch(e){C.error(`Failed to get course data by courseId: ${t}`,e.message);return}}static getPlayer(){return Ft.getPlayer()}async getVideoData(t){const e=this.getVideoDataByPlayer(t);if(!e)return;const{options_:i}=_n.getPlayer()??{};!e.subtitles?.length&&i&&(e.subtitles=i.tracks.map(h=>({url:h.src,language:J(h.srclang),source:this.SUBTITLE_SOURCE,format:this.SUBTITLE_FORMAT})));const o=i?.courseId;if(!o)return e;let r="en";const s=await this.getCourseData(o);if(s){const{primaryLanguageCodes:[h]}=s;r=h?J(h):"en";}Ut.includes(r)||(r="en");const l=(e.subtitles.find(h=>h.language===r)??e.subtitles?.[0])?.url;l||C.warn("Failed to find any subtitle file");const{url:c,duration:d}=e,u=l?[{target:"subtitles_file_url",targetUrl:l},{target:"video_file_url",targetUrl:c}]:null;return {...l?{url:this.service?.url+t,translationHelp:u}:{url:c,translationHelp:u},detectedLanguage:r,duration:d}}async getVideoId(t){return (/learn\/([^/]+)\/lecture\/([^/]+)/.exec(t.pathname)??/lecture\/([^/]+)\/([^/]+)/.exec(t.pathname))?.[0]}}class tl extends T{async getVideoId(t){return new Promise(e=>{const i="https://www.dailymotion.com",o=setTimeout(()=>e(void 0),3e3);window.addEventListener("message",r=>{r.origin===i&&(typeof r.data!="object"||r.data?.type!=="dailymotionVideoId"||(clearTimeout(o),e(r.data.videoId)));}),window.top?.postMessage({type:"getDailymotionVideoId"},i);})}}class el extends T{async getVideoData(t){if(!this.video)return;const e=this.video.querySelector('source[type="application/x-mpegurl"]')?.src;if(e)return {url:e}}async getVideoId(t){return /courses\/(([^/]+)\/lesson\/([^/]+)\/([^/]+))/.exec(t.pathname)?.[1]}}class Fe extends T{static getPlayer(){if(!(typeof player>"u"))return player}async getVideoData(t){const e=Fe.getPlayer();if(!e)return;const{config:{url:i,duration:o,lang:r,isLive:s}}=e;if(!i)return;const a=i.find(l=>l.src.includes("www.douyin.com/aweme/v1/play/"));if(a)return {url:ut(a.src),duration:o,isStream:s,...Ut.includes(r)?{detectedLanguage:r}:{}}}async getVideoId(t){const e=/video\/([\d]+)/.exec(t.pathname)?.[0];return e||Fe.getPlayer()?.config.vid}}class nl extends T{async getVideoId(t){return /video\/watch\/([^/]+)/.exec(t.pathname)?.[1]}}class il extends T{async getVideoId(t){return t.pathname.slice(1)}}class ol extends T{API_ORIGIN="https://dev.epicgames.com/community/api/learning";async getPostInfo(t){try{return await(await this.fetch(`${this.API_ORIGIN}/post.json?hash_id=${t}`)).json()}catch(e){return C.error(`Failed to get epicgames post info by videoId: ${t}.`,e.message),false}}getVideoBlock(){const t=/videoUrl\s?=\s"([^"]+)"?/,e=Array.from(document.body.querySelectorAll("script")).find(s=>t.exec(s.innerHTML));if(!e)return;const i=e.innerHTML.trim(),o=t.exec(i)?.[1]?.replace("qsep://","https://");if(!o)return;let r=/sources\s?=\s(\[([^\]]+)\])?/.exec(i)?.[1];if(!r)return {playlistUrl:o,subtitles:[]};try{r=`${r.replace(/src:(\s)+?(videoUrl)/g,'src:"removed"').substring(0,r.lastIndexOf("},"))}]`.split(`
`).map(l=>l.replace(/([^\s]+):\s?(?!.*\1)/,'"$1":')).join(`
`);const a=JSON.parse(r).filter(l=>l.type==="captions");return {playlistUrl:o,subtitles:a}}catch{return {playlistUrl:o,subtitles:[]}}}async getVideoData(t){const e=t.split(":")?.[1],i=await this.getPostInfo(e);if(!i)return;const o=this.getVideoBlock();if(!o)return;const{playlistUrl:r,subtitles:s}=o,{title:a,description:l}=i,c=s.map(d=>({language:J(d.srclang),source:"epicgames",format:"vtt",url:d.src}));return {url:r,title:a,description:l,subtitles:c}}async getVideoId(t){return new Promise(e=>{const i="https://dev.epicgames.com",o=btoa(window.location.href);window.addEventListener("message",r=>{if(r.origin!==i||!(typeof r.data=="string"&&r.data.startsWith("getVideoId:")))return;const s=r.data.replace("getVideoId:","");return e(s)}),window.top?.postMessage(`getVideoId:${o}`,i);})}}class rl extends T{async getVideoId(t){return /video-([^/]+)\/([^/]+)/.exec(t.pathname)?.[0]}}class sl extends T{async getVideoId(t){return t.pathname.slice(1)}}class al extends T{getPlayerData(){return document.querySelector("#movie_player")?.getVideoData?.()??void 0}async getVideoId(t){return this.getPlayerData()?.video_id}}class ll extends T{getVideoDataBySource(t){const e=document.querySelector('.icms.video > source[type="video/mp4"][data-quality="360"]')?.src;return e?{url:ut(e)}:this.returnBaseData(t)}getVideoDataByNext(t){try{const e=document.getElementById("__NEXT_DATA__")?.textContent;if(!e)throw new fe("Not found __NEXT_DATA__ content");const i=JSON.parse(e),{props:{pageProps:{page:{description:o,title:r,video:{videoMetadata:{duration:s},assets:a}}}}}=i,l=a.find(c=>c.height===360&&c.url.includes(".mp4"))?.url;if(!l)throw new fe("Not found video URL in assets");return {url:ut(l),duration:s,title:r,description:o}}catch(e){return C.warn(`Failed to get ign video data by video ID: ${t}, because ${e.message}. Using clear link instead...`),this.returnBaseData(t)}}async getVideoData(t){return document.getElementById("__NEXT_DATA__")?this.getVideoDataByNext(t):this.getVideoDataBySource(t)}async getVideoId(t){return /([^/]+)\/([\d]+)\/video\/([^/]+)/.exec(t.pathname)?.[0]??/\/videos\/([^/]+)/.exec(t.pathname)?.[0]}}class cl extends T{async getVideoId(t){return /video\/([^/]+)/.exec(t.pathname)?.[1]}}class dl extends T{async getVideoData(t){try{const e=document.querySelector("#incflix-stream source:first-of-type");if(!e)throw new O("Failed to find source element");const i=e.getAttribute("src");if(!i)throw new O("Failed to find source link");const o=new URL(i.startsWith("//")?`https:${i}`:i);return o.searchParams.append("media-proxy","video.mp4"),{url:ut(o)}}catch(e){C.error(`Failed to get Incestflix data by videoId: ${t}`,e.message);return}}async getVideoId(t){return /\/watch\/([^/]+)/.exec(t.pathname)?.[1]}}class ul extends T{API_ORIGIN="https://kick.com/api";async getClipInfo(t){try{const i=await(await this.fetch(`${this.API_ORIGIN}/v2/clips/${t}`)).json(),{clip_url:o,duration:r,title:s}=i.clip;return {url:o,duration:r,title:s}}catch(e){C.error(`Failed to get kick clip info by clipId: ${t}.`,e.message);return}}async getVideoInfo(t){try{const i=await(await this.fetch(`${this.API_ORIGIN}/v1/video/${t}`)).json(),{source:o,livestream:r}=i,{session_title:s,duration:a}=r;return {url:o,duration:Math.round(a/1e3),title:s}}catch(e){C.error(`Failed to get kick video info by videoId: ${t}.`,e.message);return}}async getVideoData(t){return t.startsWith("videos")?await this.getVideoInfo(t.replace("videos/","")):await this.getClipInfo(t.replace("clips/",""))}async getVideoId(t){return /([^/]+)\/((videos|clips)\/([^/]+))/.exec(t.pathname)?.[2]}}class hl extends T{async getVideoData(t){try{const e=document.querySelector(".ksr-video-player > video"),i=e?.querySelector("source[type^='video/mp4']")?.src;if(!i)throw new O("Failed to find video URL");const o=e?.querySelectorAll("track")??[];return {url:i,subtitles:Array.from(o).reduce((r,s)=>{const a=s.getAttribute("srclang"),l=s.getAttribute("src");return !a||!l||r.push({language:J(a),url:l,format:"vtt",source:"kickstarter"}),r},[])}}catch(e){C.error(`Failed to get Kickstarter data by videoId: ${t}`,e.message);return}}async getVideoId(t){return t.pathname.slice(1)}}class fl extends T{API_ORIGIN=window.location.origin;getSecureData(t){try{const[e,i,o]=t.split("/").filter(v=>v),r=Array.from(document.getElementsByTagName("script")),s=r.filter(v=>v.innerHTML.includes(`videoId = "${i}"`)||v.innerHTML.includes(`serialId = Number(${i})`));if(!s.length)throw new O("Failed to find secure script");const a=s[0]?.textContent?.trim();if(!a)throw new O("Secure script content is empty");const l=/'{[^']+}'/.exec(a)?.[0];if(!l)throw new O("Secure json wasn't found in secure script");const c=JSON.parse(l.replaceAll("'",""));if(e!=="serial")return {videoType:e,videoId:i,hash:o,...c};const d=r.find(v=>v.innerHTML.includes("var videoInfo = {}"))?.textContent?.trim();if(!d)throw new O("Failed to find videoInfo content");const u=/videoInfo\.type\s+?=\s+?'([^']+)'/.exec(d)?.[1],h=/videoInfo\.id\s+?=\s+?'([^']+)'/.exec(d)?.[1],f=/videoInfo\.hash\s+?=\s+?'([^']+)'/.exec(d)?.[1];if(!u||!h||!f)throw new O("Failed to parse videoInfo content");return {videoType:u,videoId:h,hash:f,...c}}catch(e){return C.error(`Failed to get kodik secure data by videoPath: ${t}.`,e.message),false}}async getFtor(t){const{videoType:e,videoId:i,hash:o,d:r,d_sign:s,pd:a,pd_sign:l,ref:c,ref_sign:d}=t;try{return await(await this.fetch(`${this.API_ORIGIN}/ftor`,{method:"POST",headers:{"User-Agent":X.userAgent,Origin:this.API_ORIGIN,Referer:`${this.API_ORIGIN}/${e}/${i}/${o}/360p`},body:new URLSearchParams({d:r,d_sign:s,pd:a,pd_sign:l,ref:decodeURIComponent(c),ref_sign:d,bad_user:"false",cdn_is_working:"true",info:"{}",type:e,hash:o,id:i})})).json()}catch(u){return C.error(`Failed to get kodik video data (type: ${e}, id: ${i}, hash: ${o})`,u.message),false}}decryptUrl(t){return `https:${atob(t.replace(/[a-zA-Z]/g,i=>{const o=i.charCodeAt(0)+18,r=i<="Z"?90:122;return String.fromCharCode(r>=o?o:o-26)}))}`}async getVideoData(t){const e=this.getSecureData(t);if(!e)return;const i=await this.getFtor(e);if(!i)return;const r=Object.entries(i.links[i.default.toString()]).find(([,s])=>s.type==="application/x-mpegURL")?.[1];if(r)return {url:r.src.startsWith("//")?`https:${r.src}`:this.decryptUrl(r.src)}}async getVideoId(t){return /\/(uv|video|seria|episode|season|serial)\/([^/]+)\/([^/]+)\/([\d]+)p/.exec(t.pathname)?.[0]}}class pl extends Ft{SUBTITLE_SOURCE="linkedin";async getVideoData(t){const e=this.getVideoDataByPlayer(t);if(!e)return;const{url:i,duration:o,subtitles:r}=e;return {url:ut(new URL(i)),duration:o,subtitles:r}}async getVideoId(t){return /\/learning\/(([^/]+)\/([^/]+))/.exec(t.pathname)?.[1]}}var Mi;(function(n){n.Channel="Channel",n.Video="Video";})(Mi||(Mi={}));function Vi(n,t=","){const e=n/1e3,i=Math.floor(e/3600),o=Math.floor(e%3600/60),r=Math.floor(e%60),s=Math.floor(n%1e3);return `${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}${t}${s.toString().padStart(3,"0")}`}function _i(n){const t=n.split(" ")?.[0]?.split(":");t.length<3&&t.unshift("00");const[e,i,o]=t,r=+o.replace(/[,.]/,""),s=+i*6e4;return +e*36e5+s+r}function Oi(n,t="srt"){const e=t==="vtt",i=e?".":",",o=n.subtitles.map((r,s)=>(e?"":`${s+1}
`)+`${Vi(r.startMs,i)} --> ${Vi(r.startMs+r.durationMs,i)}
${r.text}

`).join("").trim();return e?`WEBVTT

${o}`:o}function gl(n,t="srt"){const e=n.split(/\r?\n\r?\n/g);t==="vtt"&&e.shift(),/^\d+\r?\n/.exec(e?.[0]??"")&&(t="srt");const i=+(t==="srt");return {containsTokens:false,subtitles:e.reduce((r,s)=>{const a=s.trim().split(`
`),l=a[i],c=a.slice(i+1).join(`
`);if((a.length!==2||!s.includes(" --> "))&&!l?.includes(" --> "))return r.length===0||(r[r.length-1].text+=`

${a.join(`
`)}`),r;const[d,u]=l.split(" --> "),h=_i(d),v=_i(u)-h;return r.push({text:c,startMs:h,durationMs:v,speakerId:"0"}),r},[])}}function ml(n){return typeof n!="string"?"json":/^(WEBVTT([^\n]+)?)(\r?\n)/.exec(n)?"vtt":"srt"}function vr(n,t="srt"){const e=ml(n);return e===t?n:e==="json"?Oi(n,t):(n=gl(n,e),t==="json"?n:Oi(n,t))}class vl extends T{getClientVersion(){if(!(typeof SENTRY_RELEASE>"u"))return SENTRY_RELEASE.id}async getVideoData(t){try{const e=this.getClientVersion();if(!e)throw new O("Failed to get client version");const i=await this.fetch("https://www.loom.com/graphql",{headers:{"User-Agent":X.userAgent,"content-type":"application/json","x-loom-request-source":`loom_web_${e}`,"apollographql-client-name":"web","apollographql-client-version":e,"Alt-Used":"www.loom.com"},body:`{"operationName":"FetchCaptions","variables":{"videoId":"${t}"},"query":"query FetchCaptions($videoId: ID!, $password: String) {\\n  fetchVideoTranscript(videoId: $videoId, password: $password) {\\n    ... on VideoTranscriptDetails {\\n      id\\n      captions_source_url\\n      language\\n      __typename\\n    }\\n    ... on GenericError {\\n      message\\n      __typename\\n    }\\n    __typename\\n  }\\n}"}`,method:"POST"});if(i.status!==200)throw new O("Failed to get data from graphql");const r=(await i.json()).data.fetchVideoTranscript;if(r.__typename==="GenericError")throw new O(r.message);return {url:this.service?.url+t,subtitles:[{format:"vtt",language:J(r.language),source:"loom",url:r.captions_source_url}]}}catch(e){return C.error(`Failed to get Loom video data, because: ${e.message}`),this.returnBaseData(t)}}async getVideoId(t){return /(embed|share)\/([^/]+)?/.exec(t.pathname)?.[2]}}class bl extends T{API_ORIGIN="https://my.mail.ru";async getVideoMeta(t){try{return await(await this.fetch(`${this.API_ORIGIN}/+/video/meta/${t}?xemail=&ajax_call=1&func_name=&mna=&mnb=&ext=1&_=${Date.now()}`)).json()}catch(e){C.error("Failed to get mail.ru video data",e.message);return}}async getVideoId(t){const e=t.pathname;if(/\/(v|mail|bk|inbox)\//.exec(e))return e.slice(1);const i=/video\/embed\/([^/]+)/.exec(e)?.[1];if(!i)return;const o=await this.getVideoMeta(i);if(o)return o.meta.url.replace("//my.mail.ru/","")}}class yl extends Ft{SUBTITLE_SOURCE="netacad";async getVideoData(t){const e=this.getVideoDataByPlayer(t);if(!e)return;const{url:i,duration:o,subtitles:r}=e;return {url:ut(new URL(i)),duration:o,subtitles:r}}async getVideoId(t){return t.pathname+t.search}}class wl extends T{async getVideoId(t){return /([^/]+)\/(view)\/([^/]+)/.exec(t.pathname)?.[0]}}class kl extends T{async getVideoId(t){return t.hostname==="nico.ms"?t.pathname.replace(/^\//,"").split("/")[0]||void 0:/\/watch\/([^/?#]+)/.exec(t.pathname)?.[1]}}class Sl extends T{async getVideoData(t){const e=this.returnBaseData(t);if(!e)return e;try{if(!this.video)throw new Error("Video element not found");const i=this.video.querySelector('source[type^="video/mp4"], source[type^="video/webm"]')?.src;if(!i||!/^https?:\/\//.test(i))throw new Error("Video source not found");return {...e,translationHelp:[{target:"video_file_url",targetUrl:i}]}}catch{return e}}async getVideoId(t){return /gag\/([^/]+)/.exec(t.pathname)?.[1]}}class xl extends T{API_ORIGIN="https://odysee.com";async getVideoData(t){try{const i=await(await this.fetch(`${this.API_ORIGIN}/${t}`)).text(),o=/"contentUrl":(\s)?"([^"]+)"/.exec(i)?.[2];if(!o)throw new O("Odysee url doesn't parsed");return {url:o}}catch(e){C.error(`Failed to get odysee video data by video ID: ${t}`,e.message);return}}async getVideoId(t){return t.pathname.slice(1)}}class Tl extends T{async getVideoId(t){return /\/video\/(\d+)/.exec(t.pathname)?.[1]}}class Al extends T{async getVideoId(t){return /\/([a-z]{2}\/(?:paris-2024\/)?(?:replay|videos?|original-series\/episode)\/[\w-]+)\/?$/i.exec(t.pathname)?.[1]}}class Ll extends Ft{SUBTITLE_SOURCE="oraclelearn";async getVideoData(t){const e=this.getVideoDataByPlayer(t);if(!e)return;const{url:i,duration:o,subtitles:r}=e,s=this.returnBaseData(t),a=ut(new URL(i));return s?{url:s.url,duration:o,subtitles:r,translationHelp:[{target:"video_file_url",targetUrl:a}]}:{url:a,duration:o,subtitles:r}}async getVideoId(t){return /\/ou\/course\/(([^/]+)\/(\d+)\/(\d+))/.exec(t.pathname)?.[1]}}class Il extends T{API_ORIGIN="https://www.patreon.com/api";async getPosts(t){try{return await(await this.fetch(`${this.API_ORIGIN}/posts/${t}?json-api-use-default-includes=false`)).json()}catch(e){return C.error(`Failed to get patreon posts by postId: ${t}.`,e.message),false}}async getVideoData(t){const e=await this.getPosts(t);if(!e)return;const i=e.data.attributes.post_file.url;if(i)return {url:i}}async getVideoId(t){const e=/posts\/([^/]+)/.exec(t.pathname)?.[1];if(e)return e.replace(/[^\d.]/g,"")}}class El extends T{async getVideoId(t){return /\/w\/([^/]+)/.exec(t.pathname)?.[0]}}class Pl extends T{async getVideoId(t){return /\/((?:videopopout|[^/]+(?:\/profile)?\/videos)\/[^/?#&/]+)\/?$/.exec(t.pathname)?.[1]??/^\/([^/#?]+)\/?$/.exec(t.pathname)?.[1]}}class Cl extends T{async getVideoId(t){return t.searchParams.get("viewkey")??/embed\/([^/]+)/.exec(t.pathname)?.[1]}}class Ml extends T{async getVideoData(t){try{if(typeof flashvars>"u")return;const{rnd:e,video_url:i,video_title:o}=flashvars;if(!i||!e)throw new O("Failed to find video source or rnd");const r=new URL(i);r.searchParams.append("rnd",e),C.log("PornTN get_file link",r.href);const s=await this.fetch(r.href,{method:"head"}),a=new URL(s.url);return C.log("PornTN cdn link",a.href),{url:ut(a),title:o}}catch(e){C.error(`Failed to get PornTN data by videoId: ${t}`,e.message);return}}async getVideoId(t){return /\/videos\/(([^/]+)\/([^/]+))/.exec(t.pathname)?.[1]}}class Vl extends T{API_ORIGIN="https://www.reddit.com";async getContentUrl(t){if(this.service?.additionalData!=="old"){const i=document.querySelector("shreddit-player-2, shreddit-player");return (i?.getAttribute("src")??i?.querySelector('source[type="application/vnd.apple.mpegURL"]')?.getAttribute("src"))?.replaceAll("&amp;","&")}return document.querySelector("[data-hls-url]")?.dataset.hlsUrl?.replaceAll("&amp;","&")}async getVideoData(t){try{const e=await this.getContentUrl(t);if(!e)throw new O("Failed to find content url");return {url:decodeURIComponent(e)}}catch(e){C.error(`Failed to get reddit video data by video ID: ${t}`,e.message);return}}async getVideoId(t){return /\/r\/(([^/]+)\/([^/]+)\/([^/]+)\/([^/]+))/.exec(t.pathname)?.[1]}}class _l extends T{async getVideoData(t){const e=document.querySelector(".jw-video, .media__video_noscript");if(!e)return;let i=e.getAttribute("src");if(i)return i.endsWith(".MP4")&&(i=ut(i)),{videoId:t,url:i}}async getVideoId(t){return t.pathname.slice(1)}}class Ol extends T{async getVideoId(t){const e=/\/videos?\/(\d+)(?:\/(.+))?\/?$/.exec(t.pathname);if(!e)return;const[,i,o]=e;return o?`${i}/${o.replace(/\/+$/,"")}/`:i}}class Bl extends T{async getVideoId(t){return t.pathname.slice(1)}}class Dl extends T{async getVideoId(t){return /(?:video|embed)\/([^/]+)/.exec(t.pathname)?.[1]}}class Rl extends T{API_ORIGIN="https://learning.sap.com/";async requestKaltura(t,e,i){const o="html5:v3.17.22",r="3.3.0";try{return await(await this.fetch(`https://${t}/api_v3/service/multirequest`,{method:"POST",body:JSON.stringify({1:{service:"session",action:"startWidgetSession",widgetId:`_${e}`},2:{service:"baseEntry",action:"list",ks:"{1:result:ks}",filter:{redirectFromEntryId:i},responseProfile:{type:1,fields:"id,referenceId,name,description,dataUrl,duration,flavorParamsIds,type,dvrStatus,externalSourceType,createdAt,updatedAt,endDate,plays,views,downloadUrl,creatorId"}},3:{service:"baseEntry",action:"getPlaybackContext",entryId:"{2:result:objects:0:id}",ks:"{1:result:ks}",contextDataParams:{objectType:"KalturaContextDataParams",flavorTags:"all"}},apiVersion:r,format:1,ks:"",clientTag:o,partnerId:e}),headers:{"Content-Type":"application/json"}})).json()}catch(s){C.error("Failed to request kaltura data",s.message);return}}async getKalturaData(t){try{const e=document.querySelector('script[data-nscript="beforeInteractive"]');if(!e)throw new O("Failed to find script element");const i=/https:\/\/([^"]+)\/p\/([^"]+)\/embedPlaykitJs\/uiconf_id\/([^"]+)/.exec(e?.src);if(!i)throw new O(`Failed to get sap data for videoId: ${t}`);const[,o,r]=i;let s=document.querySelector("#shadow")?.firstChild?.getAttribute("id");if(!s){const a=document.querySelector("#__NEXT_DATA__");if(!a)throw new O("Failed to find next data element");s=/"sourceId":\s?"([^"]+)"/.exec(a.innerText)?.[1];}if(!o||Number.isNaN(+r)||!s)throw new O(`One of the necessary parameters for getting a link to a sap video in wasn't found for ${t}. Params: kalturaDomain = ${o}, partnerId = ${r}, entryId = ${s}`);return await this.requestKaltura(o,r,s)}catch(e){C.error("Failed to get kaltura data",e.message);return}}async getVideoData(t){const e=await this.getKalturaData(t);if(!e)return;const[,i,o]=e,{duration:r}=i.objects[0],s=o.sources.find(l=>l.format==="url"&&l.protocols==="http,https"&&l.url.includes(".mp4"))?.url;if(!s)return;const a=o.playbackCaptions.map(l=>({language:J(l.languageCode),source:"sap",format:"vtt",url:l.webVttUrl,isAutoGenerated:l.label.includes("auto-generated")}));return {url:s,subtitles:a,duration:r}}async getVideoId(t){return /((courses|learning-journeys)\/([^/]+)(\/[^/]+)?)/.exec(t.pathname)?.[1]}}class Fl extends T{async getVideoId(t){return /\/([\da-z]+\/(?:video|play|embed)(?:\/[^/]+)?)\/?$/i.exec(t.pathname)?.[1]??/\/([\da-z]+-[\da-z]+\/playlist\/[^/]+)\/?$/i.exec(t.pathname)?.[1]}}class On extends T{static getMediaViewer(){if(!(typeof appMediaViewer>"u"))return appMediaViewer}async getVideoId(t){const e=On.getMediaViewer();if(!e||e.live)return;const i=e.target.message;if(i.peer_id._!=="peerChannel")return;const o=i.media;if(o._!=="messageMediaDocument"||o.document.type!=="video")return;const r=i.mid&4294967295;return `${await e.managers.appPeersManager.getPeerUsername(i.peerId)}/${r}`}}class Nl extends T{async getVideoId(t){return /(videos|embed)\/[^/]+/.exec(t.pathname)?.[0]}}class Bi extends T{async getVideoId(t){return /([^/]+)\/video\/([^/]+)/.exec(t.pathname)?.[0]}}class Hl extends T{async getVideoId(t){const e=t.searchParams.get("vid"),i=/([^/]+)\/([\d]+)/.exec(t.pathname)?.[0];if(!(!e||!i))return `${i}?vid=${e}`}}class $l extends T{API_ORIGIN="https://clips.twitch.tv";async getClipLink(t,e){const i=document.querySelector("script[type='application/ld+json']"),o=t.slice(1);if(i){const c=JSON.parse(i.innerText)["@graph"].find(u=>u["@type"]==="VideoObject")?.creator.url;if(!c)throw new O("Failed to find channel link");return `${c.replace("https://www.twitch.tv/","")}/clip/${o}`}const r=o==="embed",s=document.querySelector(r?".tw-link[data-test-selector='stream-info-card-component__stream-avatar-link']":".clips-player a:not([class])");return s?`${s.href.replace("https://www.twitch.tv/","")}/clip/${r?e:o}`:void 0}async getVideoData(t){const e=document.querySelector('[data-a-target="stream-title"], [data-test-selector="stream-info-card-component__subtitle"]')?.innerText,i=!!document.querySelector('[data-a-target="animated-channel-viewers-count"], .channel-status-info--live, .top-bar--pointer-enabled .tw-channel-status-text-indicator');return {url:this.service?.url+t,isStream:i,title:e}}async getVideoId(t){const e=t.pathname;if(/^m\.twitch\.tv$/.test(e))return /videos\/([^/]+)/.exec(t.href)?.[0]??e.slice(1);if(/^player\.twitch\.tv$/.test(t.hostname))return `videos/${t.searchParams.get("video")}`;const i=/([^/]+)\/(?:clip)\/([^/]+)/.exec(e);if(i)return i[0];if(/^clips\.twitch\.tv$/.test(t.hostname))return await this.getClipLink(e,t.searchParams.get("clip"));const r=/(?:videos)\/([^/]+)/.exec(e);if(r)return r[0];const s=document.querySelector(".home-offline-hero .tw-link");if(s?.href){const a=new URL(s.href);return /(?:videos)\/([^/]+)/.exec(a.pathname)?.[0]}return document.querySelector(".persistent-player")?e:void 0}}class Ul extends T{async getVideoId(t){const e=/status\/([^/]+)/.exec(t.pathname)?.[1];if(e)return e;const o=this.video?.closest('[data-testid="tweet"]')?.querySelector('a[role="link"][aria-label]')?.href;return o?/status\/([^/]+)/.exec(o)?.[1]:void 0}}function Di(n){return typeof n=="object"&&n!==null}function Ri(n){if(Array.isArray(n))return n.filter(Di);if(typeof n!="object"||n===null)return [];const t=n;return (Array.isArray(t.Video)?t.Video:Array.isArray(t.video)?t.video:[]).filter(Di)}class zl extends T{API_ORIGIN=`${window.location.origin}/api-2.0`;getModuleData(){const e=(document.querySelector(".ud-app-loader[data-module-id='course-taking']")??document.querySelector("[data-module-id='course-taking']"))?.dataset?.moduleArgs;if(e)try{return JSON.parse(e)}catch{return}}getLectureId(){return /learn\/lecture\/([^/]+)/.exec(window.location.pathname)?.[1]}isErrorData(t){return Object.hasOwn(t,"error")||Object.hasOwn(t,"detail")&&!Object.hasOwn(t,"_class")}async getLectureData(t,e){try{const o=await(await this.fetch(`${this.API_ORIGIN}/users/me/subscribed-courses/${t}/lectures/${e}/?`+new URLSearchParams({"fields[lecture]":"title,description,asset,download_url,is_free,last_watched_second","fields[asset]":"asset_type,length,media_sources,stream_urls,download_urls,external_url,captions,thumbnail_sprite,slides,slide_urls,course_is_drmed,media_license_token"}).toString())).json();if(this.isErrorData(o))throw new O(o.detail??"unknown error");return o}catch(i){C.error(`Failed to get lecture data by courseId: ${t} and lectureId: ${e}`,i.message);return}}async getCourseLang(t){try{const i=await(await this.fetch(`${this.API_ORIGIN}/users/me/subscribed-courses/${t}?`+new URLSearchParams({"fields[course]":"locale"}).toString())).json();if(!this.isErrorData(i))return i;const r=await(await this.fetch(`${this.API_ORIGIN}/courses/${t}/?`+new URLSearchParams({"fields[course]":"locale"}).toString())).json();if(this.isErrorData(r))throw new O(r.detail??"unknown error");return r}catch(e){C.error(`Failed to get course lang by courseId: ${t}`,e.message);return}}findVideoUrl(t,e,i){const o=(t??[]).filter(c=>c?.type==="video/mp4"&&typeof c.src=="string");if(o.length){const c=d=>Number(String(d??"").match(/(\d{3,4})/)?.[1]??0);return o.sort((d,u)=>c(u.label??u.quality)-c(d.label??d.quality)),o[0]?.src}const r=Ri(e),s=r.find(c=>typeof c?.src=="string"&&c?.type==="video/mp4")?.src??r.find(c=>typeof c?.src=="string"&&(String(c?.type).toLowerCase().includes("mpegurl")||String(c?.src).toLowerCase().includes(".m3u8")))?.src??r.find(c=>typeof c?.src=="string"&&(String(c?.type).toLowerCase().includes("dash")||String(c?.src).toLowerCase().includes(".mpd")))?.src;if(typeof s=="string")return s;const a=Ri(i),l=a.find(c=>typeof c?.file=="string"&&c?.type==="video/mp4")?.file??a.find(c=>typeof c?.file=="string")?.file??a.find(c=>typeof c?.src=="string")?.src;return typeof l=="string"?l:void 0}findSubtitleUrl(t,e){const i=t,o=i.find(r=>J(r.locale_id)===e)??i.find(r=>J(r.locale_id)==="en")??i[0];return o?.url??o?.download_url}async getVideoData(t){const e=this.getModuleData();if(!e)return;const{courseId:i}=e,o=this.getLectureId();if(C.log(`[Udemy] courseId: ${i}, lectureId: ${o}`),!o)return;const r=await this.getLectureData(i,o);if(!r)return;const{title:s,description:a,asset:l}=r,{length:c,media_sources:d,captions:u}=l,h=l,f=h.stream_urls,v=h.download_urls,b=this.findVideoUrl(d,f,v);if(!b){C.log("Failed to find video file in asset sources",l);return}let y="en";const x=await this.getCourseLang(i);if(x){const{locale:{locale:L}}=x;y=L?J(L):y;}Ut.includes(y)||(y="en");const w=this.findSubtitleUrl(u,y);return w||C.log("Failed to find subtitle file in captions",u),{...w?{url:this.service?.url+t,translationHelp:[{target:"subtitles_file_url",targetUrl:w},{target:"video_file_url",targetUrl:b}],detectedLanguage:y}:{url:b,translationHelp:null},duration:c,title:s,description:a}}async getVideoId(t){return t.pathname.slice(1)}}class Wl extends T{API_KEY="";DEFAULT_SITE_ORIGIN="https://vimeo.com";SITE_ORIGIN=this.service?.url?.slice(0,-1)??this.DEFAULT_SITE_ORIGIN;isErrorData(t){return Object.hasOwn(t,"error")}isPrivatePlayer(){return this.referer&&!this.referer.includes("vimeo.com")&&this.origin.endsWith("player.vimeo.com")}async getViewerData(){try{const e=await(await this.fetch("https://vimeo.com/_next/viewer")).json(),{apiUrl:i,jwt:o}=e;return this.API_ORIGIN=`https://${i}`,this.API_KEY=`jwt ${o}`,e}catch(t){return C.error("Failed to get default viewer data.",t.message),false}}async getVideoInfo(t){try{const e=new URLSearchParams({fields:"name,link,description,duration"}).toString(),o=await(await this.fetch(`${this.API_ORIGIN}/videos/${t}?${e}`,{headers:{Authorization:this.API_KEY}})).json();if(this.isErrorData(o))throw new Error(o.developer_message??o.error);return o}catch(e){return C.error(`Failed to get video info by video ID: ${t}`,e.message),false}}async getPrivateVideoSource(t){try{const{default_cdn:e,cdns:i}=t.dash,o=i[e].url,r=await this.fetch(o);if(r.status!==200)throw new O(await r.text());const s=await r.json(),a=new URL(s.base_url,o),l=s.audio.find(f=>f.mime_type==="audio/mp4"&&f.format==="dash");if(!l)throw new O("Failed to find video data");const c=l.segments?.[0]?.url;if(!c)throw new O("Failed to find first segment url");const[d,u]=c.split("?",2),h=new URLSearchParams(u);return h.delete("range"),new URL(`${l.base_url}${d}?${h.toString()}`,a).href}catch(e){return C.error("Failed to get private video source",e.message),false}}async getPrivateVideoInfo(t){try{if(typeof playerConfig>"u")return;const e=await this.getPrivateVideoSource(playerConfig.request.files);if(!e)throw new O("Failed to get private video source");const{video:{title:i,duration:o},request:{text_tracks:r}}=playerConfig;return {url:`${this.SITE_ORIGIN}/${t}`,video_url:e,title:i,duration:o,subs:r}}catch(e){return C.error(`Failed to get private video info by video ID: ${t}`,e.message),false}}async getSubsInfo(t){try{const e=new URLSearchParams({per_page:"100",fields:"language,type,link"}).toString(),o=await(await this.fetch(`${this.API_ORIGIN}/videos/${t}/texttracks?${e}`,{headers:{Authorization:this.API_KEY}})).json();if(this.isErrorData(o))throw new Error(o.developer_message??o.error);return o.data}catch(e){return C.error(`Failed to get subtitles info by video ID: ${t}`,e.message),[]}}async getVideoData(t){if(this.isPrivatePlayer()){const u=await this.getPrivateVideoInfo(t);if(!u)return;const{url:h,subs:f,video_url:v,title:b,duration:y}=u,x=f.map(L=>({language:J(L.lang),source:"vimeo",format:"vtt",url:this.SITE_ORIGIN+L.url,isAutoGenerated:L.lang.includes("autogenerated")})),w=x.length?[{target:"video_file_url",targetUrl:v},{target:"subtitles_file_url",targetUrl:x[0].url}]:null;return {...w?{url:h,translationHelp:w}:{url:v},subtitles:x,title:b,duration:y}}if(!this.extraInfo)return this.returnBaseData(t);if(t.includes("/")&&(t=t.replace("/",":")),!await this.getViewerData())return this.returnBaseData(t);const o=await this.getVideoInfo(t);if(!o)return this.returnBaseData(t);const s=(await this.getSubsInfo(t)).map(u=>({language:J(u.language),source:"vimeo",format:"vtt",url:u.link,isAutoGenerated:u.language.includes("autogen")})),{link:a,duration:l,name:c,description:d}=o;return {url:a,title:c,description:d,subtitles:s,duration:l}}async getVideoId(t){const e=/video\/[^/]+$/.exec(t.pathname)?.[0];if(this.isPrivatePlayer())return e;if(e){const o=t.searchParams.get("h"),r=e.replace("video/","");return o?`${r}/${o}`:r}const i=/channels\/[^/]+\/([^/]+)/.exec(t.pathname)?.[1]??/groups\/[^/]+\/videos\/([^/]+)/.exec(t.pathname)?.[1]??/(showcase|album)\/[^/]+\/video\/([^/]+)/.exec(t.pathname)?.[2];return i||/([^/]+\/)?[^/]+$/.exec(t.pathname)?.[0]}}class Bn extends T{static getPlayer(){if(!(typeof Videoview>"u"))try{return Videoview?.getPlayerObject?.()}catch{return}}async getVideoData(t){const e=new URL(window.location.href),i=Bn.getPlayer();if(!i){const o=this.returnBaseData(t);return o&&{...o,url:he(t,e)}}try{const{description:o,duration:r,md_title:s}=i.vars,l=new DOMParser().parseFromString(o,"text/html"),c=Array.from(l.body.childNodes).filter(u=>u.nodeName!=="BR").map(u=>u.textContent).join(`
`);let d;return Object.hasOwn(i.vars,"subs")&&(d=i.vars.subs.map(u=>({language:J(u.lang),source:"vk",format:"vtt",url:u.url,isAutoGenerated:!!u.is_auto}))),{url:he(t,e),title:s,description:c,duration:r,subtitles:d}}catch(o){C.error(`Failed to get VK video data, because: ${o.message}`);const r=this.returnBaseData(t);return r&&{...r,url:he(t,e)}}}async getVideoId(t){const e=/^\/((?:video|clip)-?\d+_\d+)(?:\/)?$/.exec(t.pathname);if(e)return e[1];const i=/\/playlist\/[^/]+\/(video-?\d+_\d+)/.exec(t.pathname);if(i)return i[1];const o=t.searchParams.get("z");if(o)return o.split("/")[0];const r=t.searchParams.get("oid"),s=t.searchParams.get("id");if(r&&s){const a=Math.abs(Number.parseInt(r,10));if(!Number.isNaN(a))return `video-${a}_${s}`}}}class ql extends T{async getVideoId(t){return /(video|embed)\/(\d+)(\/[^/]+\/)?/.exec(t.pathname)?.[0]}}const Gl=/^\d+:(?:[\da-f]{32}|\d{16,})$/i;class Kl extends T{async getVideoId(t){if(t.hostname==="video.weibo.com"){const i=t.searchParams.get("fid");return !i||!Gl.test(i)?void 0:`tv/show/${i}`}const e=t.pathname.replace(/\/+$/,"");if(/^\/\d+\/[A-Za-z0-9]+$/.test(e)||/^\/0\/[A-Za-z0-9]+$/.test(e)||/^\/tv\/show\/\d+:(?:[\da-f]{32}|\d{16,})$/i.test(e))return e.slice(1)}}class Yl extends T{API_ORIGIN="https://global.apis.naver.com/weverse/wevweb";API_APP_ID="be4d79eb8fc7bd008ee82c8ec4ff6fd4";API_HMAC_KEY="1b9cb6378d959b45714bec49971ade22e6e24e42";HEADERS={Accept:"application/json, text/plain, */*",Origin:"https://weverse.io",Referer:"https://weverse.io/"};getURLData(){return {appId:this.API_APP_ID,language:"en",os:"WEB",platform:"WEB",wpf:"pc"}}async createHash(t){const e=Date.now(),i=t.substring(0,Math.min(255,t.length))+e,o=await ma(this.API_HMAC_KEY,i);if(!o)throw new O("Failed to get weverse HMAC signature");return {wmsgpad:e.toString(),wmd:o}}async getHashURLParams(t){const e=await this.createHash(t);return new URLSearchParams(e).toString()}async getPostPreview(t){const e=`/post/v1.0/post-${t}/preview?`+new URLSearchParams({fieldSet:"postForPreview",...this.getURLData()}).toString();try{const i=await this.getHashURLParams(e);return await(await this.fetch(`${this.API_ORIGIN+e}&${i}`,{headers:this.HEADERS})).json()}catch(i){return C.error(`Failed to get weverse post preview by postId: ${t}`,i.message),false}}async getVideoInKey(t){const e=`/video/v1.1/vod/${t}/inKey?`+new URLSearchParams({gcc:"RU",...this.getURLData()}).toString();try{const i=await this.getHashURLParams(e);return await(await this.fetch(`${this.API_ORIGIN+e}&${i}`,{method:"POST",headers:this.HEADERS})).json()}catch(i){return C.error(`Failed to get weverse InKey by videoId: ${t}`,i.message),false}}async getVideoInfo(t,e,i){const o=Date.now();try{const r=new URLSearchParams({key:e,sid:i,nonce:o.toString(),devt:"html5_pc",prv:"N",aup:"N",stpb:"N",cpl:"en",env:"prod",lc:"en",adi:JSON.stringify([{adSystem:null}]),adu:"/"}).toString();return await(await this.fetch(`https://global.apis.naver.com/rmcnmv/rmcnmv/vod/play/v2.0/${t}?`+r,{headers:this.HEADERS})).json()}catch(r){return C.error(`Failed to get weverse video info (infraVideoId: ${t}, inkey: ${e}, serviceId: ${i}`,r.message),false}}extractVideoInfo(t){return t.find(e=>e.useP2P===false&&e.source.includes(".mp4"))}async getVideoData(t){const e=await this.getPostPreview(t);if(!e)return;const{videoId:i,serviceId:o,infraVideoId:r}=e.extension.video;if(!(i&&o&&r))return;const s=await this.getVideoInKey(i);if(!s)return;const a=await this.getVideoInfo(r,s.inKey,o);if(!a)return;const l=this.extractVideoInfo(a.videos.list);if(l)return {url:l.source,duration:l.duration}}async getVideoId(t){return /([^/]+)\/(live|media)\/([^/]+)/.exec(t.pathname)?.[3]}}class Xl extends T{async getVideoId(t){return /\/(videos\/[^/]+-[\dA-Za-z]+)\/?$/.exec(t.pathname)?.[1]}}class Jl extends T{async getVideoId(t){return /[^/]+\/[^/]+$/.exec(t.pathname)?.[0]}}class jl extends T{API_ORIGIN=window.location.origin;CLIENT_PREFIX="/client/disk";INLINE_PREFIX="/i/";DISK_PREFIX="/d/";isErrorData(t){return Object.hasOwn(t,"error")}async getClientVideoData(t){const i=new URL(window.location.href).searchParams.get("idDialog");if(!i)return;const o=document.querySelector("#preloaded-data");if(o)try{const r=JSON.parse(o.innerText),{idClient:s,sk:a}=r.config,c=await(await this.fetch(`${this.API_ORIGIN}/models-v2?m=mpfs/info`,{method:"POST",body:JSON.stringify({apiMethod:"mpfs/info",connection_id:s,requestParams:{path:i},sk:a}),headers:{"Content-Type":"application/json"}})).json();if(this.isErrorData(c))throw new O(c.error?.message??c.error?.code);if(c?.type!=="file")throw new O("Failed to get resource info");const{meta:{short_url:d,video_info:u},name:h}=c;if(!u)throw new O("There's no video open right now");if(!d)throw new O("Access to the video is limited");const f=this.clearTitle(h),v=Math.round(u.duration/1e3);return {url:d,title:f,duration:v}}catch(r){C.error(`Failed to get yandex disk video data by video ID: ${t}, because ${r.message}`);return}}clearTitle(t){return t.replace(/(\.[^.]+)$/,"")}getBodyHash(t,e){const i=JSON.stringify({hash:t,sk:e});return encodeURIComponent(i)}async fetchList(t,e){const i=this.getBodyHash(t,e),r=await(await this.fetch(`${this.API_ORIGIN}/public/api/fetch-list`,{method:"POST",body:i})).json();if(Object.hasOwn(r,"error"))throw new O("Failed to fetch folder list");return r.resources}async getDownloadUrl(t,e){const i=this.getBodyHash(t,e),r=await(await this.fetch(`${this.API_ORIGIN}/public/api/download-url`,{method:"POST",body:i})).json();if(r.error)throw new O("Failed to get download url");return r.data.url}async getDiskVideoData(t){try{const e=document.getElementById("store-prefetch");if(!e)throw new O("Failed to get prefetch data");const i=t.split("/").slice(3);if(!i.length)throw new O("Failed to find video file path");const o=JSON.parse(e.innerText),{resources:r,rootResourceId:s,environment:{sk:a}}=o,l=r[s],c=i.length-1,d=i.filter((K,N)=>N!==c).join("/");let u=Object.values(r);d.includes("/")&&(u=await this.fetchList(`${l.hash}:/${d}`,a));const h=u.find(K=>K.name===i[c]);if(!h)throw new O("Failed to find resource");if(h&&h.type==="dir")throw new O("Path is dir, but expected file");const{meta:{short_url:f,mediatype:v,videoDuration:b},path:y,name:x}=h;if(v!=="video")throw new O("Resource isn't a video");const w=this.clearTitle(x),L=Math.round(b/1e3);if(f)return {url:f,duration:L,title:w};const D=await this.getDownloadUrl(y,a);return {url:ut(new URL(D)),duration:L,title:w}}catch(e){C.error(`Failed to get yandex disk video data by disk video ID: ${t}`,e.message);return}}async getVideoData(t){return t.startsWith(this.INLINE_PREFIX)||/^\/d\/([^/]+)$/.exec(t)?{url:this.service?.url+t.slice(1)}:(t=decodeURIComponent(t),t.startsWith(this.CLIENT_PREFIX)?await this.getClientVideoData(t):await this.getDiskVideoData(t))}async getVideoId(t){if(t.pathname.startsWith(this.CLIENT_PREFIX))return t.pathname+t.search;const e=/\/i\/([^/]+)/.exec(t.pathname)?.[0];return e||(/\/d\/([^/]+)/.exec(t.pathname)?t.pathname:void 0)}}class Zl extends T{async getVideoId(t){return /v_show\/id_[\w=]+/.exec(t.pathname)?.[0]}}class _ extends T{static isMobile(){return /^m\.youtube\.com$/.test(window.location.hostname)}static getPlayer(){return window.location.pathname.startsWith("/shorts/")&&!_.isMobile()?document.querySelector("#shorts-player"):document.querySelector("#movie_player")}static getPlayerResponse(){return _.getPlayer()?.getPlayerResponse?.call(void 0)}static getPlayerData(){return _.getPlayer()?.getVideoData?.call(void 0)}static getVolume(){const t=_.getPlayer();return t?.getVolume?t.getVolume()/100:1}static setVolume(t){const e=_.getPlayer();return e?.setVolume?(e.setVolume(Math.round(t*100)),true):false}static isMuted(){const t=_.getPlayer();return t?.isMuted?t.isMuted():false}static videoSeek(t,e){C.log("videoSeek",e);const o=(_.getPlayer()?.getProgressState()?.seekableEnd??t.currentTime)-e;t.currentTime=o;}static getPoToken(){const t=_.getPlayer();if(!t)return;const e=t.getAudioTrack?.call(void 0);if(!e?.captionTracks?.length)return;const i=e.captionTracks.find(o=>o.url.includes("&pot="));if(i)return /&pot=([^&]+)/.exec(i.url)?.[1]}static getGlobalConfig(){return typeof yt<"u"?yt?.config_:typeof ytcfg<"u"?ytcfg?.data_:void 0}static getDeviceParams(){const t=_.getGlobalConfig();if(!t)return "c=WEB";const e=t.INNERTUBE_CONTEXT?.client,i=new URLSearchParams(t.DEVICE);return i.delete("ceng"),i.delete("cengver"),i.set("c",e?.clientName??t.INNERTUBE_CLIENT_NAME),i.set("cver",e?.clientVersion??t.INNERTUBE_CLIENT_VERSION),i.set("cplayer","UNIPLAYER"),i.toString()}static getSubtitles(t){const i=_.getPlayerResponse()?.captions?.playerCaptionsTracklistRenderer;if(!i)return [];const o=i.captionTracks??[],s=(i.translationLanguages??[]).find(d=>d.languageCode===t),l=o.find(d=>d?.kind==="asr")?.languageCode??"en",c=o.reduce((d,u)=>{if(!("languageCode"in u))return d;const h=u.languageCode?J(u.languageCode):void 0,f=u.baseUrl;if(!h||!f)return d;const v=`${f.startsWith("http")?f:`${window.location.origin}/${f}`}&fmt=json3`;return d.push({source:"youtube",format:"json",language:h,isAutoGenerated:u?.kind==="asr",url:v}),s&&u.isTranslatable&&u.languageCode===l&&t!==h&&d.push({source:"youtube",format:"json",language:t,isAutoGenerated:u?.kind==="asr",translatedFromLanguage:h,url:`${v}&tlang=${t}`}),d},[]);return C.log("youtube subtitles:",c),c}static getLanguage(){if(!_.isMobile()){const o=_.getPlayer()?.getAudioTrack?.call(void 0)?.getLanguageInfo();if(o&&o.id!=="und")return J(o.id.split(".")[0])}const e=_.getPlayerResponse()?.captions?.playerCaptionsTracklistRenderer.captionTracks.find(i=>i.kind==="asr"&&i.languageCode);return e?J(e.languageCode):void 0}async getVideoData(t){const{title:e}=_.getPlayerData()??{},{shortDescription:i,isLive:o,title:r}=_.getPlayerResponse()?.videoDetails??{},s=_.getSubtitles(this.language);let a=_.getLanguage();a&&!Ut.includes(a)&&(a=void 0);const l=_.getPlayer()?.getDuration?.call(void 0)??void 0;return {url:this.service?.url+t,isStream:o,title:r,localizedTitle:e,detectedLanguage:a,description:i,subtitles:s,duration:l}}async getVideoId(t){if(t.hostname==="youtu.be"&&(t.search=`?v=${t.pathname.replace("/","")}`,t.pathname="/watch"),t.searchParams.has("enablejsapi")){const e=_.getPlayer()?.getVideoUrl();t=e?new URL(e):t;}return /(?:watch|embed|shorts|live)\/([^/]+)/.exec(t.pathname)?.[1]??t.searchParams.get("v")}}const Ql=/^\/play\/([^/?#]+)\/([^/?#]+)\/([^/?#]+)\/?$/i;class tc extends T{async getVideoId(t){const e=Ql.exec(t.pathname);if(!e)return;const[,i,o,r]=e;return `${i}/${o}/${r}`}}const br={[m.mailru]:bl,[m.weverse]:Yl,[m.weibo]:Kl,[m.kodik]:fl,[m.patreon]:Il,[m.reddit]:Vl,[m.bannedvideo]:Ga,[m.kick]:ul,[m.appledeveloper]:za,[m.epicgames]:ol,[m.odysee]:xl,[m.coursehunterLike]:Za,[m.twitch]:$l,[m.sap]:Rl,[m.linkedin]:pl,[m.vimeo]:Wl,[m.yandexdisk]:jl,[m.vk]:Bn,[m.trovo]:Hl,[m.incestflix]:dl,[m.porntn]:Ml,[m.googledrive]:al,[m.bilibili]:Ka,[m.xvideos]:Jl,[m.xhamster]:Xl,[m.spankbang]:Fl,[m.rule34video]:Ol,[m.picarto]:Pl,[m.olympicsreplay]:Al,[m.watchpornto]:ql,[m.archive]:Wa,[m.dailymotion]:tl,[m.youku]:Zl,[m.egghead]:il,[m.newgrounds]:wl,[m.okru]:Tl,[m.peertube]:El,[m.eporner]:rl,[m.bitchute]:Ya,[m.rutube]:Dl,[m.facebook]:sl,[m.rumble]:Bl,[m.twitter]:Ul,[m.pornhub]:Cl,[m.tiktok]:Bi,[m.proxitok]:Bi,[m.nine_gag]:Sl,[m.youtube]:_,[m.invidious]:_,[m.piped]:_,[m.zdf]:tc,[m.dzen]:nl,[m.cloudflarestream]:ja,[m.loom]:vl,[m.rtnews]:_l,[m.bitview]:Xa,[m.thisvid]:Nl,[m.ign]:ll,[m.bunkr]:Ja,[m.imdb]:cl,[m.telegram]:On,[m.niconico]:kl,[W.udemy]:zl,[W.coursera]:_n,[W.douyin]:Fe,[W.artstation]:qa,[W.kickstarter]:hl,[W.oraclelearn]:Ll,[W.deeplearningai]:el,[W.netacad]:yl};class yr{helpersData;constructor(t={}){this.helpersData=t;}getHelper(t){return new br[t](this.helpersData)}}function wr(n){return n in br}function ec(){if(Da.exec(window.location.href))return [];const n=window.location.hostname,t=new URL(window.location.href),e=i=>i instanceof RegExp?i.test(n):typeof i=="string"?n.includes(i):typeof i=="function"?i(t):false;return Ua.filter(i=>!!i.match&&(Array.isArray(i.match)?i.match.some(e):e(i.match))&&i.host&&i.url)}async function kr(n,t={}){const e=new URL(window.location.href),i=n.host;return wr(i)?await new yr(t).getHelper(i).getVideoId(e):i===m.custom?e.href:void 0}async function nc(n,t={}){const e=new URL(window.location.href),i=await kr(n,t);if(!i)throw new fe(`Entered unsupported link: "${n.host}"`);const o=e.origin;if([m.peertube,m.coursehunterLike,m.cloudflarestream].includes(n.host)&&(n.url=o),n.rawResult)return {url:i,videoId:i,host:n.host,duration:void 0};if(!n.needExtraData)return n.host===m.vk?{url:he(i,e),videoId:i,host:n.host,duration:void 0}:{url:n.url+i,videoId:i,host:n.host,duration:void 0};if(!wr(n.host))throw new fe(`No helper is available for "${n.host}"`);const s=await new yr({...t,service:n,origin:o}).getHelper(n.host).getVideoData(i);if(!s)throw new fe(`Failed to get video raw url for ${n.host}`);return {...s,url:n.host===m.vk?he(i,e):s.url,videoId:i,host:n.host}}const ic=(n,t)=>{const e=globalThis.fetch;if(typeof e!="function")throw new Error("chaimu: global fetch() is not available in this runtime. Please provide `fetchFn` in the Chaimu constructor options.");return e(n,t)},pe={version:"1.0.6",debug:false,fetchFn:ic},F={log:(...n)=>{pe.debug&&console.log(`%c✦ chaimu.js v${pe.version} ✦`,"background: #000; color: #fff; padding: 0 8px",...n);}},Fi=["playing","ratechange","play","waiting","pause","seeked"],Ni=["pointerdown","touchend","keydown"],oc=1e6,Ie=1800*1e3,Hi=512*1024,rc=3,sc=90,$i=30,Ui=5,ac=200,lc=128*1024,Ne=4096,cc=5e3,dc=15e3;function uc(n){return new Promise(t=>setTimeout(t,n))}async function hc(n,t,e){let i;const o=new Promise((r,s)=>{i=setTimeout(()=>s(new Error(e)),t);});try{return await Promise.race([n,o])}finally{i!==void 0&&clearTimeout(i);}}function fc(n){return !n||typeof n!="object"?false:n.name==="QuotaExceededError"}function pc(n,t,e,i){return (n&127)<<21|(t&127)<<14|(e&127)<<7|i&127}function gc(n){return n.length<10||n[0]!==73||n[1]!==68||n[2]!==51?0:10+pc(n[6],n[7],n[8],n[9])}function Sr(n,t){if(t+3>=n.length||n[t]!==255||(n[t+1]&224)!==224)return  false;const e=n[t+1]>>3&3,i=n[t+1]>>1&3;if(e===1||i===0)return  false;const o=n[t+2]>>4&15,r=n[t+2]>>2&3;return !(o===15||r===3)}function xr(n,t=0,e=Ne){const i=Math.min(n.length-4,t+e);for(let o=t;o<i;o++)if(Sr(n,o))return o;return t}function mc(n,t){return !(t+3>=n.length||n[t]!==255||(n[t+1]&240)!==240||(n[t+1]&6)!==0||(n[t+2]>>2&15)===15)}function vc(n,t=0,e=Ne){const i=Math.min(n.length-4,t+e);for(let o=t;o<i;o++)if(mc(n,o))return o;return t}function bc(n){const t=gc(n),e=xr(n,t,16*1024);if(!Sr(n,e))return {audioStart:t};const i=n[e+1]>>3&3;if((n[e+1]>>1&3)!==1)return {audioStart:t};const s=(n[e+3]>>6&3)===3;let a=0;i===3?a=s?17:32:a=s?9:17;const l=e+4+a;if(l+16>=n.length)return {audioStart:t};const c=String.fromCharCode(n[l],n[l+1],n[l+2],n[l+3]);if(c!=="Xing"&&c!=="Info")return {audioStart:t};const d=n[l+4]<<24|n[l+5]<<16|n[l+6]<<8|n[l+7];let u=l+8;d&1&&(u+=4),d&2&&(u+=4);let h;return d&4&&(u+100<=n.length&&(h=n.slice(u,u+100)),u+=100),{audioStart:t,toc:h}}const Tr=.075,zi=250,yc=.05;function Zt(){return typeof window<"u"&&typeof document<"u"}function dt(n,t,e){return Math.min(e,Math.max(t,n))}function Wi(n,t="audio/mpeg"){const e=n.headers.get("Content-Type")?.trim();if(!e)return t;const i=e.split(";").map(s=>s.trim()).filter(Boolean),o=i[0]??"";if(!o)return t;const r=i.find(s=>s.toLowerCase().startsWith("codecs="));return r?`${o}; ${r}`:o}function qi(n){if(!n)return;const t=n.match(/bytes\s+(\d+)-(\d+)\/(\d+|\*)/i);if(!t)return;const e=Number(t[1]),i=Number(t[2]),o=t[3],r=o==="*"?Number.NaN:Number(o);if(!(!Number.isFinite(e)||!Number.isFinite(i)||e<0||i<e)&&!(!Number.isFinite(r)||r<=0||i>=r))return {start:e,end:i,size:r}}function wc(n){if(!Zt())return;const t=()=>{n.resume().then(()=>{if(n.state==="running")for(const e of Ni)document.removeEventListener(e,t,true);}).catch(e=>{F.log("[AudioContext] resume() failed",e);});};for(const e of Ni)document.addEventListener(e,t,{passive:true,capture:true});}function Ar(){if(!Zt())return;const n=window,t=n.AudioContext??n.webkitAudioContext;if(!t)return;const e=new t;return e.state==="suspended"&&wc(e),e}async function Lr(n){if(n&&n.state!=="running"&&n.state!=="closed")try{await n.resume();}catch(t){F.log("[AudioContext] resume() failed",t);}}function Ir(n,t){const e=n;"preservesPitch"in e&&(e.preservesPitch=t),"mozPreservesPitch"in e&&(e.mozPreservesPitch=t),"webkitPreservesPitch"in e&&(e.webkitPreservesPitch=t);}function Be(n,t,e=yc){const i=n.buffered;if(!i||i.length===0)return  false;for(let o=0;o<i.length;o++){const r=i.start(o),s=i.end(o);if(t>=r&&t<=s-e)return  true}return  false}function kc(n,t){const e=n.buffered;for(let i=0;i<e.length;i++){const o=e.start(i),r=e.end(i);if(t>=o&&t<=r)return {start:o,end:r}}}function Gi(n,t,e=Tr){const i=Math.abs(n.currentTime-t.currentTime);Number.isFinite(i)&&i>e&&(n.currentTime=t.currentTime),n.playbackRate!==t.playbackRate&&(n.playbackRate=t.playbackRate);}function Sc(n,t,e=Tr){const i=Math.abs(n.currentTime-t.currentTime);Number.isFinite(i)&&i>e&&Be(n,t.currentTime)&&(n.currentTime=t.currentTime),n.playbackRate!==t.playbackRate&&(n.playbackRate=t.playbackRate);}function xc(n,t){n.currentTime=t.currentTime,n.playbackRate!==t.playbackRate&&(n.playbackRate=t.playbackRate);}class Er{static playerName="BasePlayer";chaimu;fetchFn;fetchOpts;_src;analyser;analyserSource;analyserData;syncIntervalId;videoFrameCallbackId;lastSyncMs=0;constructor(t,e){this.chaimu=t,this._src=e,this.fetchFn=t.fetchFn,this.fetchOpts=t.fetchOpts;}async init(){return this}async clear(){return this.stopLipSyncLoop(),this.disconnectAnalyser(),this}getMediaElement(){}getAudioRms(){const t=this.analyser;if(!t)return;const e=this.analyserData;(!e||e.length!==t.fftSize)&&(this.analyserData=new Uint8Array(t.fftSize));const i=this.analyserData;if(!i)return;t.getByteTimeDomainData(i);let o=0;for(let r=0;r<i.length;r++){const s=(i[r]-128)/128;o+=s*s;}return Math.sqrt(o/i.length)}attachAnalyserToNode(t){if(!Zt())return;const e=this.chaimu.audioContext;if(!e||this.analyser&&this.analyserSource===t)return;this.disconnectAnalyser();const i=e.createAnalyser();i.fftSize=512,i.smoothingTimeConstant=.8;try{t.connect(i),this.analyser=i,this.analyserSource=t,this.analyserData=new Uint8Array(i.fftSize);}catch(o){F.log("[BasePlayer] failed to attach analyser",o),this.disconnectAnalyser();}}disconnectAnalyser(){try{if(this.analyserSource&&this.analyser)try{this.analyserSource.disconnect(this.analyser);}catch{}try{this.analyser?.disconnect();}catch{}}finally{this.analyser=void 0,this.analyserSource=void 0,this.analyserData=void 0;}}lipSync(t=false){return this}onLipSyncTick(){}startLipSyncLoop(){if(!Zt()||this.syncIntervalId!==void 0||this.videoFrameCallbackId!==void 0)return;const t=this.chaimu.video;if(typeof t?.requestVideoFrameCallback=="function"){const e=i=>{if(i-this.lastSyncMs>=zi){this.lastSyncMs=i;try{this.onLipSyncTick();}catch(o){F.log("[BasePlayer] lip-sync tick error",o);}}this.videoFrameCallbackId=t.requestVideoFrameCallback?.(e);};this.videoFrameCallbackId=t.requestVideoFrameCallback(e);return}this.syncIntervalId=window.setInterval(()=>{try{this.onLipSyncTick();}catch(e){F.log("[BasePlayer] lip-sync tick error",e);}},zi);}stopLipSyncLoop(){Zt()&&(this.syncIntervalId!==void 0&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=void 0),this.videoFrameCallbackId!==void 0&&(this.chaimu.video.cancelVideoFrameCallback?.(this.videoFrameCallbackId),this.videoFrameCallbackId=void 0));}handleVideoEvent=t=>(F.log(`handle video ${t.type}`),this.lipSync(t.type),this);removeVideoEvents(){for(const t of Fi)this.chaimu.video?.removeEventListener(t,this.handleVideoEvent);return this}addVideoEvents(){for(const t of Fi)this.chaimu.video?.addEventListener(t,this.handleVideoEvent);return this}async play(){return this}async pause(){return this}get name(){return this.constructor.playerName??this.constructor.name}set src(t){this._src=t;}get src(){return this._src}get currentSrc(){return this._src}set volume(t){}get volume(){return 0}get playbackRate(){return 0}set playbackRate(t){}get currentTime(){return 0}}class Tc extends Er{static playerName="AudioPlayer";audio;gainNode;audioSource;volumeValue=1;constructor(t,e){super(t,e),this.recreateAudioElement(),this.rebuildWebAudioGraph();}recreateAudioElement(){const t=this._src?new Audio(this._src):new Audio;t.crossOrigin="anonymous",t.preload="auto",Ir(t,true),t.volume=dt(this.volumeValue,0,1),this.audio=t;}disconnectWebAudioGraph(){this.audioSource?.disconnect(),this.gainNode?.disconnect(),this.audioSource=void 0,this.gainNode=void 0,this.disconnectAnalyser();}rebuildWebAudioGraph(){this.disconnectWebAudioGraph();const t=this.chaimu.audioContext;if(!t)return;const e=t.createGain();e.gain.value=Math.max(0,this.volumeValue);const i=t.createMediaElementSource(this.audio);i.connect(e),e.connect(t.destination),this.attachAnalyserToNode(e),this.gainNode=e,this.audioSource=i;}async init(){return this.chaimu.audioContext&&!this.audioSource&&(this.recreateAudioElement(),this.rebuildWebAudioGraph()),this}onPlayError=t=>{F.log("[AudioPlayer] play() failed",t);};onLipSyncTick(){const t=this.chaimu.video;t&&(t.paused||this.audio.paused||Gi(this.audio,t));}lipSync(t=false){const e=this.chaimu.video;if(!e)return this;if(Gi(this.audio,e),!t)return this;switch(t){case "play":case "playing":case "seeked":{e.paused||this.play().catch(this.onPlayError);break}case "pause":case "waiting":{this.pause();break}}return this}async clear(){return this.stopLipSyncLoop(),this.audio.pause(),this.audio.src="",this.audio.removeAttribute("src"),this.audio.load(),this.disconnectWebAudioGraph(),this}async play(){const t=this.chaimu.audioContext;return t&&await Lr(t),await this.audio.play().catch(this.onPlayError),this.startLipSyncLoop(),this}async pause(){return this.audio.pause(),this.stopLipSyncLoop(),this}set src(t){if(this._src=t,!t){this.clear();return}this.audio.src=t,this.audio.load();}get src(){return this._src}get currentSrc(){return this.audio.currentSrc}getMediaElement(){return this.audio}set volume(t){this.volumeValue=Math.max(0,t),this.gainNode?this.gainNode.gain.value=this.volumeValue:this.audio.volume=dt(this.volumeValue,0,1);}get volume(){return this.gainNode?this.gainNode.gain.value:this.audio.volume}get playbackRate(){return this.audio.playbackRate}set playbackRate(t){this.audio.playbackRate=t;}get currentTime(){return this.audio.currentTime}}class Ac extends Er{static playerName="ChaimuPlayer";audioElement;mediaElementSource;gainNode;mediaUrl;mediaSource;sourceBuffer;streamingPromise;rangeTotalSizeBytes;rangeMimeType;mp3SeekTable;rangeSeekId=0;rangeReadyPromise;resolveRangeReady;rejectRangeReady;streamAbortController;streamAbortCleanup;initPromise;clearPromise;startToken=0;isStarting=false;hasPendingStart=false;volumeValue=1;async fetchAudio(){if(!this._src)throw new Error("No audio source provided");if(!this.chaimu.audioContext)throw new Error("No audio context available");if(F.log(`[ChaimuPlayer] Fetching audio from ${this._src}...`),await this.stopStreaming(),await this.trySetupRangeStreamingAudio())return this;const e=await this.fetchFn(this._src,this.buildAudioFetchOpts());if(!this.isFetchResponseOk(e))throw new Error(`Failed to fetch audio: ${e.status} ${e.statusText}`);return await this.loadBufferedAudio(e),this}initGainNode(){const t=this.chaimu.audioContext;if(!t)return;this.disconnectAudioNodes();const e=t.createGain();e.gain.value=Math.max(0,this.volumeValue),this.gainNode=e;}disconnectAudioNodes(){this.mediaElementSource?.disconnect(),this.gainNode?.disconnect(),this.mediaElementSource=void 0,this.gainNode=void 0,this.disconnectAnalyser();}async init(){return this.initPromise?this.initPromise:(this.initPromise=(async()=>(await this.fetchAudio(),this.initGainNode(),this.createAudioElement(),this))().finally(()=>{this.initPromise=void 0;}),this.initPromise)}createAudioElement(){const t=this.chaimu.audioContext;if(!t)throw new Error("No audio context available");if(!this.mediaUrl)throw new Error("No media URL available");if(!this.gainNode)throw new Error("Audio graph is not initialized");const e=new Audio(this.mediaUrl);e.crossOrigin="anonymous",e.preload="auto",Ir(e,true),e.volume=dt(this.volumeValue,0,1),this.audioElement=e;try{e.load();}catch(i){F.log("[ChaimuPlayer] audio.load() failed",i);}this.mediaElementSource=t.createMediaElementSource(e),this.mediaElementSource.connect(this.gainNode),this.gainNode.connect(t.destination),this.attachAnalyserToNode(this.gainNode);}onLipSyncTick(){const t=this.chaimu.video,e=this.audioElement;!t||!e||t.paused||e.paused||Sc(e,t);}lipSync(t=false){const e=this.chaimu.video,i=this.audioElement;if(!e||!i)return this;if(!t)return this;switch(t){case "play":case "seeked":{e.paused||this.start();break}case "playing":{!e.paused&&i.paused&&this.start();break}case "ratechange":{i.playbackRate!==e.playbackRate&&(i.playbackRate=e.playbackRate);break}case "pause":case "waiting":{this.pause();break}}return this}async clear(){return this.clearPromise?this.clearPromise:(this.clearPromise=(async()=>(F.log("[ChaimuPlayer] clearing audio graph"),this.stopLipSyncLoop(),await this.pause(),await this.stopStreaming(),this.audioElement&&(this.audioElement.pause(),this.audioElement.src="",this.audioElement.removeAttribute("src"),this.audioElement.load(),this.audioElement=void 0),this.mediaUrl&&(URL.revokeObjectURL(this.mediaUrl),this.mediaUrl=void 0),this.disconnectAudioNodes(),this))().finally(()=>{this.clearPromise=void 0;}),this.clearPromise)}async start(){if(this.isStarting)return this.hasPendingStart=true,this.startToken++,this;this.isStarting=true;const t=++this.startToken;try{const e=this.chaimu.audioContext;if(!e)throw new Error("No audio context available");const i=this.audioElement;if(!i)throw new Error("Audio element is missing");this.clearPromise&&await this.clearPromise,await Lr(e);try{i.load();}catch{}const o=this.chaimu.video;if(o){i.pause();try{i.load();}catch{}if(await this.ensureRangeStreamingForTime(o.currentTime,t),t!==this.startToken)return this;if(await this.waitUntilBuffered(o.currentTime,t),t!==this.startToken)return this;xc(i,o);}return t!==this.startToken?this:this.hasPendingStart?this:o?.paused?this:(await i.play().catch(r=>F.log("[ChaimuPlayer] audio.play() failed",r)),this.startLipSyncLoop(),this)}finally{this.isStarting=false,this.hasPendingStart&&(this.hasPendingStart=false,this.start());}}async pause(){return this.startToken++,this.hasPendingStart=false,this.audioElement?.pause(),this.stopLipSyncLoop(),this}async play(){return this.start()}set src(t){this._src=t;}get src(){return this._src}get currentSrc(){return this._src}getMediaElement(){return this.audioElement}set volume(t){this.volumeValue=Math.max(0,t),this.gainNode&&(this.gainNode.gain.value=this.volumeValue),this.audioElement&&(this.audioElement.volume=dt(this.volumeValue,0,1));}get volume(){return this.gainNode?this.gainNode.gain.value:this.volumeValue}set playbackRate(t){this.audioElement&&(this.audioElement.playbackRate=t);}get playbackRate(){return this.audioElement?.playbackRate??this.chaimu.video?.playbackRate??1}get currentTime(){return this.chaimu.video?.currentTime??0}async loadBufferedAudio(t){let e;try{e=await t.arrayBuffer();}catch(o){throw new Error(`Failed to read audio buffer: ${o.message}`)}const i=Wi(t);if(typeof Blob>"u"||typeof URL>"u")throw new Error("Blob/URL APIs are not available in this runtime");this.setMediaUrl(URL.createObjectURL(new Blob([e],{type:i})));}buildAudioFetchOpts(t){const e={...this.fetchOpts??{}};if(e.timeout==null&&(e.timeout=Ie),t?.signal&&(e.signal=t.signal),t?.headers){const i=new Headers(e.headers);new Headers(t.headers).forEach((r,s)=>{i.set(s,r);}),e.headers=i;}return e}isFetchResponseOk(t){return !!(t.ok||t.status===0&&(t.body||t.headers.has("Content-Type")))}createStreamAbortController(){this.streamAbortCleanup?.(),this.streamAbortCleanup=void 0,this.streamAbortController?.abort();const t=new AbortController;this.streamAbortController=t;const e=this.fetchOpts?.signal;if(e){const i=()=>t.abort();e.aborted?t.abort():(e.addEventListener("abort",i,{once:true}),this.streamAbortCleanup=()=>e.removeEventListener("abort",i));}return t}async trySetupRangeStreamingAudio(){if(typeof MediaSource>"u"||typeof URL>"u")return  false;if(!this._src)throw new Error("[ChaimuPlayer] src is not set");const t=lc-1,e=new Headers(this.fetchOpts?.headers);e.set("Range",`bytes=0-${t}`);let i;try{i=await this.fetchFn(this._src,{...this.fetchOpts,headers:e,timeout:Ie});}catch(d){return F.log("[ChaimuPlayer] Range probe request failed",d),false}if(!i.ok||i.status!==206)return  false;const o=i.headers.get("Content-Range"),r=qi(o);if(!r?.size)return  false;const s=r.size;if(s<oc)return  false;const a=Wi(i);if(!this.isSeekableRangeStreamingMimeType(a))return  false;try{if(typeof MediaSource.isTypeSupported=="function"&&!MediaSource.isTypeSupported(a))return !1}catch{return  false}let l;try{l=new Uint8Array(await i.arrayBuffer());}catch{l=void 0;}this.rangeTotalSizeBytes=s,this.rangeMimeType=a,a.toLowerCase().includes("audio/mpeg")&&l?this.mp3SeekTable=bc(l):this.mp3SeekTable=void 0;const c=new MediaSource;return this.mediaSource=c,this.rangeReadyPromise=new Promise((d,u)=>{this.resolveRangeReady=d,this.rejectRangeReady=u;}),c.addEventListener("sourceopen",()=>{this.setupSeekableRangeStreamingAudio().catch(d=>{F.log("[ChaimuPlayer] Failed to setup seekable range streaming audio",d),this.rejectRangeReady?.(d),this.fallbackToBufferedAudio(d);});},{once:true}),c.addEventListener("error",()=>{const d=new Error("[ChaimuPlayer] MediaSource error");this.rejectRangeReady?.(d),this.fallbackToBufferedAudio(d);}),this.setMediaUrl(URL.createObjectURL(c)),true}isSeekableRangeStreamingMimeType(t){const e=t.toLowerCase();return e.includes("audio/mpeg")||e.includes("audio/mp3")||e.includes("audio/aac")||e.includes("audio/adts")}getVideoDurationSeconds(){const t=this.chaimu.video?.duration;if(t!=null&&!(!Number.isFinite(t)||t<=0))return t}timeToByteOffset(t){const e=this.rangeTotalSizeBytes,i=this.getVideoDurationSeconds();if(!e||!i)return 0;const o=dt(t,0,i);if(this.mp3SeekTable?.toc&&this.mp3SeekTable.toc.length===100){const l=o/i*100,c=dt(Math.floor(l),0,99),d=l-c,u=this.mp3SeekTable.toc[c],h=this.mp3SeekTable.toc[Math.min(99,c+1)],f=u+(h-u)*d,v=dt(this.mp3SeekTable.audioStart??0,0,e),b=Math.max(0,e-v),y=v+Math.floor(f/256*b);return dt(y,0,Math.max(0,e-1))}const r=dt(this.mp3SeekTable?.audioStart??0,0,e),s=Math.max(0,e-r),a=r+Math.floor(o/i*s);return dt(a,0,Math.max(0,e-1))}alignChunkForMimeType(t){const e=(this.rangeMimeType??"").toLowerCase();if(e.includes("audio/mpeg")||e.includes("audio/mp3")){const i=xr(t,0,Ne);return i>0?t.slice(i):t}if(e.includes("audio/aac")||e.includes("audio/adts")){const i=vc(t,0,Ne);return i>0?t.slice(i):t}return t}getPlayheadSeconds(){return this.chaimu.video?.currentTime??this.audioElement?.currentTime??0}async fetchRangeBytes(t,e,i,o){const r=new Headers(this.fetchOpts?.headers);r.set("Range",`bytes=${e}-${i}`);const s=await this.fetchFn(t,{...this.fetchOpts,signal:o,headers:r,timeout:Ie});if(!this.isFetchResponseOk(s)||s.status!==206)throw new Error(`[ChaimuPlayer] Range request failed: ${s.status} ${s.statusText}`.trim());const a=qi(s.headers.get("Content-Range"));return a&&a.start!==e&&F.log("[ChaimuPlayer] Content-Range mismatch",{expected:e,got:a.start}),new Uint8Array(await s.arrayBuffer())}async evictBufferBehindPlayhead(){const t=this.sourceBuffer;if(!t)return  false;const i=this.getPlayheadSeconds()-$i-Ui;if(i<=0)return  false;const o=t.buffered;if(o.length===0)return  false;const r=o.start(0),s=o.end(o.length-1),a=Math.min(i,s);if(a<=r)return  false;try{return await this.waitForUpdate(t),t.remove(r,a),await this.waitForUpdate(t),!0}catch(l){return F.log("[ChaimuPlayer] Failed to evict buffer",l),false}}async setupSeekableRangeStreamingAudio(){const t=this.mediaSource,e=this.rangeMimeType,i=this.rangeTotalSizeBytes,o=this._src;if(!t||!e||!i||!o)throw new Error("[ChaimuPlayer] Range streaming is not configured");let r;try{r=t.addSourceBuffer(e);}catch(l){const c=l instanceof Error?l.message:String(l);throw new Error(`[ChaimuPlayer] Failed to add SourceBuffer: ${c}`)}try{r.mode="sequence";}catch{}this.sourceBuffer=r;const s=this.getPlayheadSeconds(),a=++this.rangeSeekId;await this.seekRangeStreamingToTime(s,a,this.startToken),this.resolveRangeReady?.();}async ensureRangeStreamingForTime(t,e){const i=this.audioElement;if(!i||!this.mediaSource||!this.rangeTotalSizeBytes||!this.rangeMimeType)return;if(this.rangeReadyPromise)try{try{i.load();}catch{}await hc(this.rangeReadyPromise,cc,"[ChaimuPlayer] Timed out waiting for MediaSource to initialize");}catch(r){F.log("[ChaimuPlayer] Range streaming setup failed, falling back",r),await this.fallbackToBufferedAudio(r);return}if(e!==this.startToken||Be(i,t))return;const o=++this.rangeSeekId;await this.seekRangeStreamingToTime(t,o,e).catch(async r=>{F.log("[ChaimuPlayer] Range seek failed, falling back",r),await this.fallbackToBufferedAudio(r);});}async seekRangeStreamingToTime(t,e,i){const o=this.mediaSource,r=this.sourceBuffer,s=this.rangeTotalSizeBytes,a=this.rangeMimeType,l=this._src;if(!o||!r||!s||!a||!l||i!==this.startToken)return;const d=this.createStreamAbortController().signal,u=this.getVideoDurationSeconds()??Math.max(t+1,1),h=dt(t-rc,0,u),f=this.timeToByteOffset(h);if(F.log(`[ChaimuPlayer] Range-seek t=${t.toFixed(3)}s start=${h.toFixed(3)}s byte=${f}/${s}`),e!==this.rangeSeekId||(await this.waitForUpdate(r),e!==this.rangeSeekId||i!==this.startToken))return;try{r.abort();}catch{}try{if(r.buffered.length>0){const w=r.buffered.start(0),L=r.buffered.end(r.buffered.length-1);r.remove(w,L),await this.waitForUpdate(r);}}catch(w){F.log("[ChaimuPlayer] Failed to clear SourceBuffer",w);}if(e!==this.rangeSeekId||i!==this.startToken)return;try{r.timestampOffset=h;}catch(w){F.log("[ChaimuPlayer] Failed to set timestampOffset",w);}const v=Math.min(f+Hi-1,s-1),b=await this.fetchRangeBytes(l,f,v,d);if(d.aborted||e!==this.rangeSeekId||i!==this.startToken)return;const y=this.alignChunkForMimeType(b);if(await this.appendChunk(o,r,y),d.aborted||e!==this.rangeSeekId||i!==this.startToken)return;const x=v+1;this.streamingPromise=this.runRangeStreamingLoop(e,x,d).catch(w=>{d.aborted||(F.log("[ChaimuPlayer] Range streaming loop failed",w),this.fallbackToBufferedAudio(w));});}async runRangeStreamingLoop(t,e,i){const o=this.mediaSource,r=this.sourceBuffer,s=this.rangeTotalSizeBytes,a=this.audioElement,l=this._src;if(!o||!r||!s||!a||!l)return;let c=e;for(;c<s;){if(i.aborted||t!==this.rangeSeekId||o.readyState!=="open")return;const d=this.getPlayheadSeconds(),u=kc(a,d);if((u?u.end-d:0)>=sc){await uc(ac);continue}if(u){const y=d-$i-Ui;if(u.start<y)try{await this.waitForUpdate(r),r.remove(u.start,y),await this.waitForUpdate(r);}catch(x){F.log("[ChaimuPlayer] Buffer eviction failed",x);}}const f=Math.min(c+Hi-1,s-1),v=await this.fetchRangeBytes(l,c,f,i);if(i.aborted||t!==this.rangeSeekId)return;await this.appendChunk(o,r,v),c=f+1;}}async fallbackToBufferedAudio(t){if(F.log("[ChaimuPlayer] Falling back to fully-buffered audio",t),!this._src)return;await this.stopStreaming();const e=await this.fetchFn(this._src,{...this.fetchOpts,timeout:Ie});if(!this.isFetchResponseOk(e))throw new Error(`[ChaimuPlayer] Failed to fetch audio (fallback): ${e.status} ${e.statusText}`.trim());await this.loadBufferedAudio(e);}async appendChunk(t,e,i){if(await this.waitForUpdate(e),t.readyState!=="open")return;const o=this.toArrayBuffer(i);try{e.appendBuffer(o);}catch(r){if(fc(r))if(await this.evictBufferBehindPlayhead()&&t.readyState==="open")await this.waitForUpdate(e),e.appendBuffer(o);else throw r;else throw r}await this.waitForUpdate(e);}async waitForUpdate(t){t.updating&&await new Promise((e,i)=>{let o=false;const r=()=>{t.removeEventListener("error",s),t.removeEventListener("updateend",a);},s=()=>{o||(o=true,r(),i(new Error("SourceBuffer update failed")));},a=()=>{o||(o=true,r(),e());};t.addEventListener("error",s,{once:true}),t.addEventListener("updateend",a,{once:true}),t.updating||a();});}async stopStreaming(){this.streamAbortCleanup?.(),this.streamAbortCleanup=void 0,this.streamAbortController?.abort(),this.streamAbortController=void 0;const t=this.streamingPromise;if(this.streamingPromise=void 0,t)try{await t;}catch(e){F.log("[ChaimuPlayer] stopStreaming wait failed",e);}if(this.mediaSource){if(this.mediaSource.readyState==="open")try{this.mediaSource.endOfStream();}catch{}this.mediaSource=void 0;}this.sourceBuffer=void 0,this.rangeTotalSizeBytes=void 0,this.rangeMimeType=void 0,this.mp3SeekTable=void 0,this.rangeSeekId=0,this.rangeReadyPromise=void 0,this.resolveRangeReady=void 0,this.rejectRangeReady=void 0;}setMediaUrl(t){if(this.mediaUrl&&this.mediaUrl!==t)try{URL.revokeObjectURL(this.mediaUrl);}catch(e){F.log("[ChaimuPlayer] Failed to revoke object URL",e);}if(this.mediaUrl=t,this.audioElement)try{this.audioElement.src=t,this.audioElement.load();}catch(e){F.log("[ChaimuPlayer] Failed to update audio element src",e);}}toArrayBuffer(t){const e=t.buffer;return t.byteOffset===0&&t.byteLength===e.byteLength?e:e.slice(t.byteOffset,t.byteOffset+t.byteLength)}async waitUntilBuffered(t,e){const i=this.audioElement;i&&(Be(i,t)||await new Promise(o=>{if(!Zt()){o();return}let r=false,s,a;const l=()=>{s!==void 0&&window.clearInterval(s),a!==void 0&&window.clearTimeout(a),i.removeEventListener("progress",f),i.removeEventListener("canplay",f),i.removeEventListener("loadedmetadata",f),i.removeEventListener("durationchange",f),i.removeEventListener("error",v),u?.removeEventListener("updateend",f);},c=()=>{r||(r=true,l(),o());},d=()=>{if(e!==this.startToken||Be(i,t))return c()};s=window.setInterval(d,200),a=window.setTimeout(()=>{F.log("[ChaimuPlayer] Buffer wait timed out; continuing",{targetTimeSeconds:t}),c();},dc);const u=this.sourceBuffer,h=this.streamingPromise;h&&h.catch(()=>c());const f=()=>d(),v=()=>c();i.addEventListener("progress",f,{passive:true}),i.addEventListener("canplay",f,{passive:true}),i.addEventListener("loadedmetadata",f,{passive:true}),i.addEventListener("durationchange",f,{passive:true}),i.addEventListener("error",v,{once:true}),u?.addEventListener("updateend",f,{passive:true}),d();}));}}class Lc{_debug=false;audioContext;player;video;fetchFn;fetchOpts;constructor({url:t,video:e,debug:i=false,fetchFn:o=pe.fetchFn,fetchOpts:r={},preferAudio:s=false}){this.video=e,this._debug=pe.debug=i,this.fetchFn=o,this.fetchOpts=r,this.audioContext=Ar();const a=t instanceof URL?t.toString():t,l=!!this.audioContext&&!s&&typeof MediaSource<"u";this.player=l?new Ac(this,a):new Tc(this,a);}async init(){await this.player.init(),this.video.paused||this.player.lipSync("play"),this.player.addVideoEvents();}async destroy(){this.player.removeVideoEvents(),await this.player.clear();}set debug(t){this._debug=pe.debug=t;}get debug(){return this._debug}}const Dn=()=>{},Ic=Dn,Ec=Dn,Pc=Dn,A={log:Ic,warn:Ec,error:Pc};function Pr(n){if(!n)return "";if(typeof n=="string")return n;const t=n;return t?.data?.message||t?.error?.message||t?.message||(typeof t?.toString=="function"?t.toString():"")||String(t)}function Nt(n){const t=n;return typeof DOMException<"u"&&t instanceof DOMException&&t.name==="AbortError"||t instanceof Error&&t.name==="AbortError"||t?.message==="AbortError"}function Lt(n="Aborted"){try{return new DOMException(n,"AbortError")}catch{const t=new Error(n);return t.name="AbortError",t}}const Rn="vot_iframe",Fn=()=>globalThis.self!==globalThis.top,Cr=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?`main-world-bridge-${crypto.randomUUID()}`:`main-world-bridge-${Date.now()}-${Math.random().toString(36).slice(2)}`,Cc=15e3,Mr=n=>document.getElementById(n),Vr=n=>{if(!n||typeof n!="object")return  false;const t=n;return typeof t.messageType=="string"&&typeof t.messageDirection=="string"},Ki=n=>{try{return new URL(n,globalThis.location.href).href}catch{return null}},Mc=(n,t)=>{const e=Ki(t),i=Ki(n.src);return !e||!i?n.getAttribute("src")===t:i===e},Vc=(n,t)=>!n?.isConnected||!n.contentWindow?false:Mc(n,t);async function _c(n,t,e){document.body||await new Promise(s=>{document.readyState==="loading"?globalThis.addEventListener("DOMContentLoaded",()=>s(),{once:true}):s();});const i=document.createElement("iframe");i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.width="1px",i.style.height="1px",i.style.opacity="0",i.style.pointerEvents="none",i.style.border="0",i.style.zIndex="-1",i.setAttribute("allow","autoplay; encrypted-media"),i.id=t,i.src=`${n}#${Rn}`,document.body.appendChild(i);const o=i.contentWindow,r=`say-${e}-iframe-is-ready`;try{await new Promise((s,a)=>{const l=u=>{u.source===o&&Vr(u.data)&&(u.data.messageType!==r||u.data.messageDirection!=="response"||(d(),s()));},c=globalThis.setTimeout(()=>{d(),a(new Error("Service iframe did not have time to be ready"));},Cc),d=()=>{globalThis.clearTimeout(c),globalThis.removeEventListener("message",l);};globalThis.addEventListener("message",l);});}catch(s){throw i.remove(),s}return i}async function Oc(n,t,e,i){if(t.includes("#"))throw new Error("The src parameter should not contain a hash (#) character.");const o=`${t}#${Rn}`,r=Mr(e);return Vc(r,o)?r:(r&&r.remove(),_c(t,e,i))}function Bc(n,t){globalThis.addEventListener("message",t),globalThis.parent.postMessage({messageType:`say-${n}-iframe-is-ready`,messageDirection:"response"},"*");}function Dc(n,t,e){const i=Cr(),o=e?.signal,r=new Promise((s,a)=>{let l=false,c=null,d=null;const u=()=>{c&&globalThis.removeEventListener("message",c),o&&d&&o.removeEventListener("abort",d);},h=f=>{l||(l=true,u(),f());};if(d=()=>{h(()=>a(Lt()));},c=f=>{if(f.source!==globalThis.window||!Vr(f.data))return;const v=f.data;v?.messageId===i&&v.messageType===n&&v.messageDirection==="response"&&h(()=>v.error?a(v.error):s(v.payload));},o?.aborted){d();return}globalThis.addEventListener("message",c),o?.addEventListener("abort",d,{once:true}),globalThis.postMessage({messageId:i,messageType:n,messageDirection:"request",...t!==void 0&&{payload:t}},"*");});return {messageId:i,promise:r}}const Yi="vot_iframe_player",_r="service",Rc="www.youtube.com",Or=X.minChunkSize,Br=.9,nn=[6e4,8e4,15e4,33e4,46e4],Xi=15e3,Fc=.9,Dr=n=>typeof n=="string"?n:n.url;function Rr(n){const t=new Uint8Array([120,0]);if(typeof n=="string")return {body:t,cache:"no-store",credentials:"include",method:"POST"};const{headers:e,cache:i,credentials:o,integrity:r,keepalive:s,method:a,mode:l,redirect:c,referrer:d,referrerPolicy:u}=n,h=[...e.entries()];return {body:t,cache:i,credentials:o,headersEntries:h,integrity:r,keepalive:s,method:a,mode:l,redirect:c,referrer:d,referrerPolicy:u}}function Fr(n){const{headersEntries:t,body:e,...i}=n,o=new Headers(t),r={...i,headers:o};if(e&&e.byteLength>0){const s=new Uint8Array(e.byteLength);s.set(e),r.body=s.buffer;}return r}function Nc(n){const{ok:t,redirected:e,status:i,statusText:o,type:r,url:s}=n;return {ok:t,redirected:e,status:i,statusText:o,type:r,url:s}}const Hc=n=>new Promise(t=>setTimeout(t,n));function Nr(n,t="Operation timed out"){return new Promise((e,i)=>setTimeout(()=>i(new Error(t)),n))}async function $c(n,t,e=false){const i=Date.now()+t;for(;!n();){if(Date.now()>=i){if(e)throw new Error(`Wait for condition reached timeout of ${t}`);return}await Hc(100);}}let He="";const Uc=()=>_.getPlayerResponse()?.streamingData?.adaptiveFormats;async function zc(n,t){if(!n.includes("googlevideo.com/videoplayback")||typeof t=="string")return  false;try{const e=t.clone().body?.getReader();if(!e)return !1;let i=0;for(;;){const{done:o,value:r}=await e.read();if(o)break;if(i+=r.length,i>2)return !0}}catch{}return  false}function Wc(){const n=Uc();if(!n?.length){const i=n?"Empty adaptive formats":"Cannot get adaptive formats";throw new Error(`Audio downloader. WEB API. ${i}`)}const t=n.filter(({audioQuality:i,mimeType:o})=>i||o?.includes("audio"));if(!t.length)throw new Error("Audio downloader. WEB API. No audio adaptive formats");return t.filter(({itag:i})=>i===251).sort(({contentLength:i},{contentLength:o})=>i&&o?Number.parseInt(i,10)-Number.parseInt(o,10):-1).at(-1)??t[0]}const qc=async()=>(await $c(()=>!!_.getPlayer(),1e4),_.getPlayer()),Gc=async n=>{const t=await qc();if(n.messageId!==He)throw new Error("Audio downloader. Download started for another video while getting player");if(!t?.loadVideoById)throw new Error("Audio downloader. There is no player.loadVideoById in iframe");t.loadVideoById(n.payload.videoId),t.pauseVideo?.(),t.mute?.(),setTimeout(()=>{if(n.messageId!==He){console.error("Audio Downloader. Download started for another video while waiting to repause video");return}if(!t){console.error("[Critical] Audio Downloader. Player not found in iframe after timeout");return}t.pauseVideo?.();},1e3);};async function Kc(n){try{He=n.messageId,A.log("getDownloadAudioData",n);const t=unsafeWindow.fetch;unsafeWindow.fetch=async(e,i)=>{e instanceof URL&&(e=e.toString());const o=Dr(e);if(await zc(o,e))return globalThis.parent.postMessage({...n,messageDirection:"response",error:"Audio downloader. Detected encoded request."},"*"),unsafeWindow.fetch=t,t(e,i);const r=await t(e,i);return n.messageId!==He?(unsafeWindow.fetch=t,r):(o.includes("&itag=251&")&&(unsafeWindow.fetch=t,globalThis.parent.postMessage({...n,messageDirection:"response",payload:{requestInfo:o,requestInit:i||Rr(e),adaptiveFormat:Wc(),itag:251}},"*")),r)},await Gc(n);}catch(t){globalThis.parent.postMessage({...n,messageDirection:"response",error:t},"*");}}const Yc=async({data:n})=>{if(n?.messageDirection==="request")try{n.messageType==="get-download-audio-data-in-iframe"?await Kc(n.payload):A.log(`NOT IMPLEMENTED: ${n.messageType}`,n.payload);}catch(t){console.error("[VOT] Main world bridge",{error:t});}};function Xc(){return Bc(_r,Yc)}const Jc="__VOT_MAIN_BOOT_STATE__";function jc(n){return n==="idle"||n==="booting"||n==="booted"||n==="failed"}function Zc(n){return !n||typeof n!="object"?false:jc(n.status)}function Qc(n=Jc){const t=globalThis,e=t[n];if(Zc(e))return e;const i={status:"idle",promise:null,error:null};return t[n]=i,i}const td="api.browser.yandex.ru",ed="media-proxy.toil.cc/v1/proxy/m3u8",ge="vot-worker.toil.cc",nd="https://vot.toil.cc/v1",id="https://translate.toil.cc/v2",od="https://rust-server-531j.onrender.com/detect",Hr="https://t2mc.toil.cc",Ji="https://avatars.mds.yandex.net/get-yapic",$r="ilyhalight/voice-over-translation",ji=`https://raw.githubusercontent.com/${$r}`,rd=`https://github.com/${$r}`,Xe=15,Ur=900,sd=5,Je="yandexbrowser",Nn="rust-server",ad=["Tampermonkey","Violentmonkey"],zr=["UA","LV","LT"],Hn=1e3,me="2025-05-09",ld=["autoTranslate","autoSubtitles","dontTranslateLanguages","enabledDontTranslateLanguages","enabledAutoVolume","enabledSmartDucking","autoVolume","buttonPos","showVideoSlider","syncVolume","downloadWithName","sendNotifyOnComplete","subtitlesMaxLength","subtitlesSmartLayout","highlightWords","subtitlesFontSize","subtitlesOpacity","subtitlesDownloadFormat","responseLanguage","defaultVolume","onlyBypassMediaCSP","newAudioPlayer","showPiPButton","translateAPIErrors","translationService","detectService","translationHotkey","subtitlesHotkey","m3u8ProxyHost","proxyWorkerHost","translateProxyEnabled","translateProxyEnabledDefault","audioBooster","useLivelyVoice","autoHideButtonDelay","useAudioDownload","compatVersion","localePhrases","localeLang","localeHash","localeUpdatedAt","localeLangOverride","account"];function Zi(n){const t=n.throwIfAborted;if(typeof t=="function")try{t.call(n);return}catch(e){throw n.aborted||Nt(e)?Lt():e instanceof Error?e:new Error(String(e))}if(n.aborted)throw Lt()}function cd(n,t){const e=typeof AbortSignal<"u"&&"timeout"in AbortSignal,i=typeof AbortSignal<"u"&&"any"in AbortSignal;let o=false;if(!(Number.isFinite(n)&&n>0))return t?{signal:t,didTimeout:()=>false,cleanup:()=>{}}:{signal:new AbortController().signal,didTimeout:()=>false,cleanup:()=>{}};if(e&&i){const c=AbortSignal.timeout(n),d=AbortSignal.any(t?[t,c]:[c]),u=setTimeout(()=>{o=true;},n);return {signal:d,didTimeout:()=>o,cleanup:()=>clearTimeout(u)}}const s=new AbortController,a=()=>s.abort(t?.reason);t&&(t.aborted?s.abort(t.reason):t.addEventListener("abort",a,{once:true}));const l=setTimeout(()=>{o=true,s.abort(Lt("Timeout"));},n);return {signal:s.signal,didTimeout:()=>o,cleanup:()=>{clearTimeout(l),t?.removeEventListener("abort",a);}}}function dd(){return navigator.language?.substring(0,2).toLowerCase()||"en"}const ud=new Set(["uk","be","bg","mk","sr","bs","hr","sl","pl","sk","cs"]);function hd(n){return Vn.includes(n)?n:ud.has(n)?"ru":"en"}const $n=dd(),De=hd($n);function fd(n){const t=new WeakSet;return JSON.stringify(n,(e,i)=>{if(i&&typeof i=="object"){const o=i;if(t.has(o))return "[Circular]";if(t.add(o),Array.isArray(i))return i;const r={},s=Object.entries(i).sort(([a],[l])=>a.localeCompare(l));for(const[a,l]of s)r[a]=l;return r}return i})}function pd(n){let t=2166136261,e=0;for(;e<n.length;){const i=n.codePointAt(e)??0;t^=i,t=Math.imul(t,16777619),e+=i>65535?2:1;}return (t>>>0).toString(36)}const Wr=()=>"pictureInPictureEnabled"in document&&!!document.pictureInPictureEnabled;function qr(n,t){const e=URL.createObjectURL(n),i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),i.remove(),Gr(e);}const gd=3e4;function Gr(n,t=gd){globalThis.setTimeout(()=>URL.revokeObjectURL(n),t);}function Qi(n){const t=n.trim();return t?t.replace(/^https?:\/\//,"").replaceAll(/[\\/:*?"'<>|]/g,"-"):new Date().toISOString().slice(0,10)}const on=()=>Math.floor(Date.now()/1e3),md=n=>n?Object.fromEntries(new Headers(n).entries()):{},$=(n,t=0,e=100)=>Math.min(Math.max(n,t),e);function to(n){const t={},e=Object.entries(n);for(;e.length;){const i=e.pop();if(!i)continue;const[o,r]=i;if(r===void 0)continue;if(!(r!==null&&typeof r=="object"&&!Array.isArray(r))){t[o]=r;continue}for(const[a,l]of Object.entries(r))e.push([`${o}.${a}`,l]);}return t}async function vd(){const n=document;if(!(!n.fullscreenElement&&!n.webkitFullscreenElement))return n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen?.()}const Kr=!(typeof IS_EXTENSION<"u"&&IS_EXTENSION)&&!!GM_info?.scriptHandler&&!ad.includes(GM_info.scriptHandler),eo=typeof GM<"u",Yr=typeof unsafeWindow<"u",Bt=typeof GM_xmlhttpRequest<"u",bd=15e3,no="api.browser.yandex.ru",yd=3e4,wd=2,kd=new Set([408,425,429,500,502,503,504]);let io=0;const Sd=32,xd=12,kn=n=>typeof n=="string"?n:n instanceof URL?n.href:n.url;function Td(n){return !!n&&typeof n=="object"&&"__gmFetchNoFallback"in n}function Ad(n){!n||typeof n!="object"||(n.__gmFetchNoFallback=true);}function Ae(n){try{return new URL(n).hostname===no}catch{return n.includes(no)}}const Xr=n=>Ae(n);function Ld(n,t){return Ae(n)?Math.max(t,yd):t}function Id(){return io+=1,`gm_fetch_${Date.now()}_${io}`}function Ed(n,t){if(n?.__gmFetchNoFallback||t?.aborted)return  false;if(Nt(n))return  true;if(!(n instanceof Error))return  false;const e=n.message.toLowerCase();return e.includes("timeout")||e.includes("network")||e.includes("failed to fetch")||e.includes("load failed")||e.includes("bridge port disconnected")}function rn(n,t,e,i){return Ae(n)&&e<i&&kd.has(t)}function oo(n,t,e,i,o){return Ae(n)&&e<i&&Ed(t,o)}function Un(n){if(n==null)return {type:"none",size:0};if(typeof n=="string")return {type:"string",size:n.length,looksLikeObjectString:/^\[object [^\]]+\]$/.test(n.trim())};if(n instanceof URLSearchParams)return {type:"URLSearchParams",size:n.toString().length};if(n instanceof FormData)return {type:"FormData",size:-1};if(n instanceof Blob)return {type:"Blob",size:n.size};if(n instanceof ArrayBuffer)return {type:"ArrayBuffer",size:n.byteLength};if(ArrayBuffer.isView(n))return {type:n.constructor?.name??"TypedArray",size:n.byteLength};if(typeof ReadableStream<"u"&&n instanceof ReadableStream)return {type:"ReadableStream",size:-1};const t=(()=>{try{return Object.prototype.toString.call(n)}catch{return null}})(),e=(()=>{try{const o=n?.constructor?.name;return typeof o=="string"?o:null}catch{return null}})(),i=n&&typeof n=="object"?Object.keys(n).slice(0,xd):void 0;return {type:typeof n,size:-1,objectTag:t,ctor:e,keys:i}}function $e(n){if(!n)return {headerCount:0,headerNames:[],contentType:null};const t=[];let e=null;const i=(o,r)=>{const s=String(o||"").trim();s&&(t.push(s),s.toLowerCase()==="content-type"&&e===null&&(e=String(r)));};try{if(n instanceof Headers)for(const[o,r]of n.entries())i(o,r);else if(Array.isArray(n))for(const o of n)!Array.isArray(o)||o.length<2||i(String(o[0]),String(o[1]));else for(const[o,r]of Object.entries(n))i(o,String(r));}catch{return {headerCount:-1,headerNames:[],contentType:null}}return {headerCount:t.length,headerNames:t.slice(0,Sd),contentType:e}}function Pd(n=""){const t={};for(const e of n.split(/\r?\n/)){const i=/^([\w!#$%&'*+.^`|~-]+)\s*:\s*(.*)$/.exec(e);i&&(t[i[1].toLowerCase()]=i[2]);}return t}async function Cd(n,t,e,i){const{signal:o,didTimeout:r,cleanup:s}=cd(e,t.signal);try{return A.log("[VOT][GM_fetch][native] start",{url:kn(n),method:t.method??"GET",timeoutMs:e,requestId:i?.requestId,attempt:i?.attempt,effectiveTimeoutMs:i?.effectiveTimeoutMs,credentials:t.credentials??"same-origin",mode:t.mode??"cors",...$e(t.headers),...Un(t.body)}),await fetch(n,{...t,signal:o})}catch(a){throw A.error("[VOT][GM_fetch][native] error",{url:kn(n),message:a instanceof Error?a.message:String(a),requestId:i?.requestId,attempt:i?.attempt,effectiveTimeoutMs:i?.effectiveTimeoutMs,isAbortError:Nt(a),signalAborted:!!t.signal?.aborted,didTimeout:r()}),Nt(a)&&!r()&&t.signal?.aborted&&Ad(a),a}finally{s();}}function ro(n,t,e,i,o){const r=md(t.headers),s=t.method??"GET",l=typeof ReadableStream<"u"&&!Xr(n),c=t.credentials,d=c==="include"?true:void 0,u=c==="omit"?true:void 0;return new Promise((h,f)=>{let v=false,b,y,x=0;const w=()=>t.signal?.removeEventListener("abort",K),L=(M,Z,mt,Pt)=>{v||(v=true,A.log("[VOT][GM_fetch][xhr] resolve",{url:n,method:s,requestId:o?.requestId,attempt:o?.attempt,effectiveTimeoutMs:o?.effectiveTimeoutMs,status:Z,statusText:mt,hasBody:M!=null}),h(new Response(M,{status:Z,statusText:mt,headers:Pd(Pt)})));},D=M=>{if(v&&!l){w(),A.warn("[VOT][GM_fetch][xhr] late terminal event after resolve",{url:n,method:s,requestId:o?.requestId,attempt:o?.attempt,effectiveTimeoutMs:o?.effectiveTimeoutMs,message:M instanceof Error?M.message:String(M)});return}w(),A.error("[VOT][GM_fetch][xhr] fail",{url:n,method:s,requestId:o?.requestId,attempt:o?.attempt,effectiveTimeoutMs:o?.effectiveTimeoutMs,message:M instanceof Error?M.message:String(M)}),l&&y?.error(M),v||f(M);},K=()=>{b?.abort?.();const M=i&&Nt(i)?i:Lt();D(M);};if(t.signal){if(t.signal.aborted)return K();t.signal.addEventListener("abort",K,{once:true});}if(A.log("[VOT][GM_fetch][xhr] start",{url:n,method:s,timeoutMs:e,requestId:o?.requestId,attempt:o?.attempt,effectiveTimeoutMs:o?.effectiveTimeoutMs,responseType:"arraybuffer",withCredentials:d??false,anonymous:u??false,useProgressStream:l,...$e(r),...Un(t.body)}),typeof t.body=="string"&&/^\[object [^\]]+\]$/.test(t.body.trim())){const M=$e(r).contentType;A.warn("[VOT][GM_fetch][xhr] suspicious body string before request",{url:n,method:s,requestId:o?.requestId,attempt:o?.attempt,contentType:M,body:t.body});}const N=l?new ReadableStream({start(M){y=M;},cancel(){b?.abort?.();}}):null,ht=M=>{if(!l||!y)return;const Z=M?.chunk;if(Z&&typeof Z!="string"){const se=new Uint8Array(Z);se.byteLength&&(y.enqueue(se),x+=se.byteLength);return}const mt=M?.response??M;if(!mt||typeof mt=="string")return;const Pt=new Uint8Array(mt);Pt.byteLength<=x||(y.enqueue(Pt.slice(x)),x=Pt.byteLength);},lt=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:globalThis.GM_xmlhttpRequest;if(typeof lt!="function")throw new TypeError("GM_xmlhttpRequest is not available");b=lt({method:s,url:n,headers:r,data:t.body,withCredentials:d,anonymous:u,timeout:e,responseType:"arraybuffer",onprogress:l?M=>{const Z=M;A.log("[VOT][GM_fetch][xhr] progress",{url:n,method:s,requestId:o?.requestId,attempt:o?.attempt,loaded:Z.loaded??null,total:Z.total??null,status:Z.status??null}),N&&(v||L(N,Z.status,Z.statusText,Z.responseHeaders),ht(Z));}:void 0,onload:M=>{if(w(),A.log("[VOT][GM_fetch][xhr] onload",{url:n,method:s,requestId:o?.requestId,attempt:o?.attempt,effectiveTimeoutMs:o?.effectiveTimeoutMs,status:M.status,statusText:M.statusText,responseType:"arraybuffer",responseSize:M.response&&typeof M.response!="string"?M.response.byteLength??null:null}),l){if(!v){if(!N)return;L(N,M.status,M.statusText,M.responseHeaders);}ht(M),y?.close();return}L(M.response&&typeof M.response!="string"?M.response:null,M.status,M.statusText,M.responseHeaders);},onerror:D,ontimeout:()=>{A.error("[VOT][GM_fetch][xhr] timeout",{url:n,method:s,timeoutMs:e,requestId:o?.requestId,attempt:o?.attempt,effectiveTimeoutMs:o?.effectiveTimeoutMs}),D(new Error("GM_xmlhttpRequest timeout"));},onabort:()=>{A.warn("[VOT][GM_fetch][xhr] abort",{url:n,method:s,requestId:o?.requestId,attempt:o?.attempt,effectiveTimeoutMs:o?.effectiveTimeoutMs}),D(Lt());}});})}async function nt(n,t={}){const{timeout:e=bd,...i}=t,o=kn(n),r=Bt&&Xr(o),s=Ld(o,e),a=Id(),l=Ae(o)?wd:1,c={url:o,method:i.method??"GET",timeoutMs:e,effectiveTimeoutMs:s,requestId:a,shouldForceGmXhr:r,canUseGmXhr:Bt,...$e(i.headers),...Un(i.body)};let d;for(let u=1;u<=l;u+=1){const h={requestId:a,attempt:u,effectiveTimeoutMs:s};try{if(!r){const f=await Cd(n,i,s,h);if(A.log("[VOT][GM_fetch] native response",{...c,attempt:u,status:f.status,statusText:f.statusText,type:f.type,redirected:f.redirected}),Bt&&(f.type==="opaque"||f.type==="opaqueredirect"||f.status===0)){A.log("GM_fetch got an opaque/blocked response; retrying via GM_xmlhttpRequest",{...c,attempt:u});const v=await ro(o,i,s,void 0,h);if(rn(o,v.status,u,l)){A.warn("[VOT][GM_fetch] retrying after retryable XHR status",{...c,attempt:u,status:v.status});continue}return v}if(rn(o,f.status,u,l)){A.warn("[VOT][GM_fetch] retrying after retryable native status",{...c,attempt:u,status:f.status});continue}return f}throw new Error("Force GM_xmlhttpRequest")}catch(f){if(Td(f)&&f.__gmFetchNoFallback)throw f;if(!Bt){if(oo(o,f,u,l,i.signal)){A.warn("[VOT][GM_fetch] retrying after native error",{...c,attempt:u,reason:f instanceof Error?f.message:String(f)}),d=f;continue}throw f}A.warn("[VOT][GM_fetch] fallback to GM_xmlhttpRequest",{...c,attempt:u,reason:f instanceof Error?f.message:String(f)});try{const v=await ro(o,i,s,f,h);if(rn(o,v.status,u,l)){A.warn("[VOT][GM_fetch] retrying after retryable XHR status",{...c,attempt:u,status:v.status});continue}return v}catch(v){if(oo(o,v,u,l,i.signal)){A.warn("[VOT][GM_fetch] retrying after XHR error",{...c,attempt:u,reason:v instanceof Error?v.message:String(v)}),d=v;continue}throw v}}}throw d??new Error("GM_fetch failed")}const sn={numToBool:[["autoTranslate"],["dontTranslateYourLang","enabledDontTranslateLanguages"],["autoSetVolumeYandexStyle","enabledAutoVolume"],["showVideoSlider"],["syncVolume"],["downloadWithName"],["sendNotifyOnComplete"],["highlightWords"],["onlyBypassMediaCSP"],["newAudioPlayer"],["showPiPButton"],["translateAPIErrors"],["audioBooster"],["useNewModel","useLivelyVoice"]],number:[["autoVolume"]],array:[["dontTranslateLanguage","dontTranslateLanguages"]],string:[["hotkeyButton","translationHotkey"],["locale-lang-override","localeLangOverride"],["locale-lang","localeLang"]]};function Md(n,t,e){if(typeof t=="number")return e?.number.some(i=>i[0]===n)?"number":"numToBool";if(Array.isArray(t))return "array";if(typeof t=="string"||t===null)return "string"}function Vd(n,t){return ["string","array","number"].includes(n)?t:!!t}async function _d(n){if(n.compatVersion===me)return n;const t=Object.values(sn).flat().reduce((l,c)=>(c[1]&&(l[c[0]]=void 0),l),{}),e=await E.getValues(t),i=Object.fromEntries(Object.entries(e).filter(([l,c])=>c!==void 0)),o={...n,...i},r=Object.keys(o).reduce((l,c)=>(l[c]=void 0,l),{}),s=await E.getValues(r),a=n;for(const[l,c]of Object.entries(o)){const d=Md(l,c,sn);if(!d)continue;const u=sn[d].find(v=>v[0]===l);if(!u)continue;const h=u[1]??l;if(s[l]===void 0)continue;let f=Vd(d,c);l==="autoVolume"&&c<1&&(f=Math.round(c*100)),a[h]=f,i[l]!==void 0&&await E.delete(l),await E.set(h,f);}return {...a,compatVersion:me}}class so{supportGM=false;supportGMPromises=false;supportGMGetValues=false;supportResolved=false;resolveSupport(){this.supportResolved||(this.supportResolved=true,this.supportGM=typeof GM_getValue=="function",this.supportGMPromises=eo&&typeof GM?.getValue=="function",this.supportGMGetValues=eo&&typeof GM?.getValues=="function",A.log(`[VOT Storage] GM Promises: ${this.supportGMPromises} | GM: ${this.supportGM}`));}get isSupportOnlyLS(){return this.resolveSupport(),!this.supportGM&&!this.supportGMPromises}syncGet(t,e){if(this.resolveSupport(),this.supportGM)return GM_getValue(t,e);const i=globalThis.localStorage.getItem(t);if(!i)return e;try{return JSON.parse(i)}catch{return e}}async get(t,e){return this.resolveSupport(),this.supportGMPromises?await GM.getValue(t,e):this.syncGet(t,e)}async getValues(t){return this.resolveSupport(),this.supportGMGetValues?await GM.getValues(t):Object.fromEntries(await Promise.all(Object.entries(t).map(async([e,i])=>{const o=await this.get(e,i);return [e,o]})))}syncSet(t,e){return this.resolveSupport(),this.supportGM?GM_setValue(t,e):globalThis.localStorage.setItem(t,JSON.stringify(e))}async set(t,e){return this.resolveSupport(),this.supportGMPromises?await GM.setValue(t,e):this.syncSet(t,e)}syncDelete(t){return this.resolveSupport(),this.supportGM?GM_deleteValue(t):globalThis.localStorage.removeItem(t)}async delete(t){return this.resolveSupport(),this.supportGMPromises?await GM.deleteValue(t):this.syncDelete(t)}syncList(){return this.resolveSupport(),this.supportGM?GM_listValues():ld}async list(){return this.resolveSupport(),this.supportGMPromises?await GM.listValues():this.syncList()}}const ao="__VOT_STORAGE_SINGLETON__",E=(()=>{const n=globalThis,t=n[ao];if(t instanceof so)return t;const e=new so;return n[ao]=e,e})();async function Od(){const{access_token:n,expires_in:t}=Object.fromEntries(new URLSearchParams(globalThis.location.hash.slice(1)));if(!n||!t)throw new Error("[VOT] Invalid token response");const e=Number.parseInt(t,10);if(Number.isNaN(e))throw new TypeError("[VOT] Invalid expires_in value");await E.set("account",{token:n,expires:Date.now()+e*1e3,username:void 0,avatarId:void 0});}async function Bd(){const{avatar_id:n,username:t}=_userData;if(!n||!t)throw new Error("[VOT] Invalid user data");const e=await E.get("account");if(!e)throw new Error("[VOT] No account data found");await E.set("account",{...e,username:t,avatarId:n});}async function Dd(){if(globalThis.location.pathname==="/auth/callback")return await Od();if(globalThis.location.pathname==="/my/profile")return await Bd()}const Rd="recommended",Fd="Translate video",Nd="Turn off",Hd="Translation settings",$d="Subtitles settings",Ud="Smart subtitle layout",zd="Reset settings",Wd="The video is being translated",qd="Video language",Gd="Translation language",Kd="The translation will take",Yd="The translation will take more than an hour",Xd="The translation will take about a minute",Jd="The translation will take a few minutes",jd="The translation will take approximately {0} minutes",Zd="The translation will take approximately {0} minutes",Qd="Failed to request video translation",tu="Audio link not received",eu="Failed to download audio",nu="The audio format is not supported",iu="Translate on open",ou="Subtitles on open",ru="Don't translate from my language",su="Video volume:",au="Translation volume:",lu="Reduce video volume to",cu="Video volume slider",du="Link translation and video volume",uu="You have disabled the translation of the video in your language",hu="Video is too long",fu="No video ID found",pu="Subtitles",gu="Disabled",mu="Subtitles max length",vu="Highlight words",bu="translated from",yu="autogenerated",wu="VOT Settings",ku="Menu language",Su="Authors",xu="Version",Tu="Loader",Au="Browser",Lu="Show PiP button",Iu={auto:"Auto",af:"Afrikaans",ak:"Akan",sq:"Albanian",am:"Amharic",ar:"Arabic",hy:"Armenian",as:"Assamese",ay:"Aymara",az:"Azerbaijani",bn:"Bangla",eu:"Basque",be:"Belarusian",bho:"Bhojpuri",bs:"Bosnian",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ceb:"Cebuano",zh:"Chinese","zh-Hans":"Chinese (Simplified)","zh-Hant":"Chinese (Traditional)",co:"Corsican",hr:"Croatian",cs:"Czech",da:"Danish",dv:"Divehi",nl:"Dutch",en:"English",eo:"Esperanto",et:"Estonian",ee:"Ewe",fil:"Filipino",fi:"Finnish",fr:"French",gl:"Galician",lg:"Ganda",ka:"Georgian",de:"German",el:"Greek",gn:"Guarani",gu:"Gujarati",ht:"Haitian Creole",ha:"Hausa",haw:"Hawaiian",iw:"Hebrew",hi:"Hindi",hmn:"Hmong",hu:"Hungarian",is:"Icelandic",ig:"Igbo",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",jv:"Javanese",kn:"Kannada",kk:"Kazakh",km:"Khmer",rw:"Kinyarwanda",ko:"Korean",kri:"Krio",ku:"Kurdish",ky:"Kyrgyz",lo:"Lao",la:"Latin",lv:"Latvian",ln:"Lingala",lt:"Lithuanian",lb:"Luxembourgish",mk:"Macedonian",mg:"Malagasy",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Māori",mr:"Marathi",mn:"Mongolian",ne:"Nepali",nso:"Northern Sotho",no:"Norwegian",ny:"Nyanja",or:"Odia",om:"Oromo",ps:"Pashto",fa:"Persian",pl:"Polish",pt:"Portuguese",pa:"Punjabi",qu:"Quechua",ro:"Romanian",ru:"Russian",sm:"Samoan",sa:"Sanskrit",gd:"Scottish Gaelic",sr:"Serbian",sn:"Shona",sd:"Sindhi",si:"Sinhala",sk:"Slovak",sl:"Slovenian",so:"Somali",st:"Southern Sotho",es:"Spanish",su:"Sundanese",sw:"Swahili",sv:"Swedish",tg:"Tajik",ta:"Tamil",tt:"Tatar",te:"Telugu",th:"Thai",ti:"Tigrinya",ts:"Tsonga",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",ur:"Urdu",ug:"Uyghur",uz:"Uzbek",vi:"Vietnamese",cy:"Welsh",fy:"Western Frisian",xh:"Xhosa",yi:"Yiddish",yo:"Yoruba",zu:"Zulu"},Eu="There is no connection to the server",Pu="Search...",Cu="Translate errors from the API",Mu="Language detection service",Vu="Enter the proxy worker address",_u="Enter the address of the m3u8 proxy worker",Ou="Proxy Settings",Bu="The translation will take approximately {0} minutes",Du="Extended translation volume increase",Ru="Subtitles design",Fu="Font size of subtitles",Nu="Transparency of the subtitle background",Hu="The format for downloading subtitles",$u="Download files with the video name",Uu="Update localization files",zu="Locale hash",Wu="Updated at",qu="To enable this, you must have a Web Audio API",Gu="Media CSP is enabled on this site",Ku="Use it only for bypassing Media CSP",Yu="Use the new audio player",Xu="Use an experimental variation of Yandex voices for some videos",Ju="The translation is slightly delayed",ju="The translation on the {0} has been completed!",Zu="Send a notification that the video has been translated",Qu="Report a bug",th="Disabled",eh="Enabled",nh="Proxy everything",ih="Proxying mode",oh="Translated by {0}",rh="Translate stream isn't available",sh="Text translation service",ah="Doesn't affect the translation of text in voice over",lh="Don't translate from selected languages",ch="Display the video volume slider",dh="Hotkeys settings",uh="None",hh="Use lively voices. Speakers sound like native Russians.",fh="Misc settings",ph={yandexbrowser:"Yandex Browser",msedge:"Microsoft Edge","rust-server":"Rust Server"},gh="About extension",mh="Appearance",vh="Button position in the player",bh={left:"Left",right:"Right",top:"Top",default:"Default"},yh="secs",wh="Delay before hiding the translate button",kh="not found",Sh="The button position only changes in players larger than 600 pixels.",xh="Completely disabling proxying in your country may break the extension",Th="Press the key combination...",Ah="Use audio download",Lh="Disabling audio downloads may affect the functionality of the extension",Ih="You need to log in to use this feature",Eh="My account",Ph="Login",Ch="Logout",Mh="Refresh",Vh="Enter the Yandex OAuth Token",_h="You can manually set the account token in this field. Please note that we don't check its validity before sending a translate request",Oh="Login via token",Bh="Adaptive volume",Dh={recommended:Rd,translateVideo:Fd,disableTranslate:Nd,translationSettings:Hd,subtitlesSettings:$d,subtitlesSmartLayout:Ud,resetSettings:zd,videoBeingTranslated:Wd,videoLanguage:qd,translationLanguage:Gd,translationTake:Kd,translationTakeMoreThanHour:Yd,translationTakeAboutMinute:Xd,translationTakeFewMinutes:Jd,translationTakeApproximatelyMinutes:jd,translationTakeApproximatelyMinute:Zd,requestTranslationFailed:Qd,audioNotReceived:tu,VOTFailedDownloadAudio:eu,audioFormatNotSupported:nu,VOTAutoTranslate:iu,VOTAutoSubtitles:ou,VOTDontTranslateYourLang:ru,VOTVolume:su,VOTVolumeTranslation:au,VOTAutoSetVolume:lu,VOTShowVideoSlider:cu,VOTSyncVolume:du,VOTDisableFromYourLang:uu,VOTVideoIsTooLong:hu,VOTNoVideoIDFound:fu,VOTSubtitles:pu,VOTSubtitlesDisabled:gu,VOTSubtitlesMaxLength:mu,VOTHighlightWords:vu,VOTTranslatedFrom:bu,VOTAutogenerated:yu,VOTSettings:wu,VOTMenuLanguage:ku,VOTAuthors:Su,VOTVersion:xu,VOTLoader:Tu,VOTBrowser:Au,VOTShowPiPButton:Lu,langs:Iu,streamNoConnectionToServer:Eu,searchField:Pu,VOTTranslateAPIErrors:Cu,VOTDetectService:Mu,VOTProxyWorkerHost:Vu,VOTM3u8ProxyHost:_u,proxySettings:Ou,translationTakeApproximatelyMinute2:Bu,VOTAudioBooster:Du,VOTSubtitlesDesign:Ru,VOTSubtitlesFontSize:Fu,VOTSubtitlesOpacity:Nu,VOTSubtitlesDownloadFormat:Hu,VOTDownloadWithName:$u,VOTUpdateLocaleFiles:Uu,VOTLocaleHash:zu,VOTUpdatedAt:Wu,VOTNeedWebAudioAPI:qu,VOTMediaCSPEnabledOnSite:Gu,VOTOnlyBypassMediaCSP:Ku,VOTNewAudioPlayer:Yu,VOTUseNewModel:Xu,TranslationDelayed:Ju,VOTTranslationCompletedNotify:ju,VOTSendNotifyOnComplete:Zu,VOTBugReport:Qu,VOTTranslateProxyDisabled:th,VOTTranslateProxyEnabled:eh,VOTTranslateProxyEverything:nh,VOTTranslateProxyStatus:ih,VOTTranslatedBy:oh,VOTStreamNotAvailable:rh,VOTTranslationTextService:sh,VOTNotAffectToVoice:ah,DontTranslateSelectedLanguages:lh,showVideoVolumeSlider:ch,hotkeysSettings:dh,None:uh,VOTUseLivelyVoice:hh,miscSettings:fh,services:ph,aboutExtension:gh,appearance:mh,buttonPosition:vh,position:bh,secs:yh,autoHideButtonDelay:wh,notFound:kh,minButtonPositionContainer:Sh,VOTTranslateProxyStatusDefault:xh,PressTheKeyCombination:Th,VOTUseAudioDownload:Ah,VOTUseAudioDownloadWarning:Lh,VOTAccountRequired:Ih,VOTMyAccount:Eh,VOTLogin:Ph,VOTLogout:Ch,VOTRefresh:Mh,VOTYandexToken:Vh,VOTYandexTokenInfo:_h,VOTLoginViaToken:Oh,smartDucking:Bh};var an=["auto","en","ru","af","am","ar","az","bg","bn","bs","ca","cs","cy","da","de","el","es","et","eu","fa","fi","fr","gl","hi","hr","hu","hy","id","it","ja","jv","kk","km","kn","ko","lo","mk","ml","mn","ms","mt","my","ne","nl","pa","pl","pt","ro","si","sk","sl","sq","sr","su","sv","sw","tr","uk","ur","uz","vi","zh","zu"];class Rh{storageKeys=["localePhrases","localeLang","localeHash","localeUpdatedAt","localeLangOverride"];lang;locale;defaultLocale=to(Dh);cacheTTL=7200;localesUrl=`${ji}/master/src/localization/locales`;hashesUrl=`${ji}/master/src/localization/hashes.json`;_langOverride="auto";constructor(){this.lang=this.getLang(),this.locale={};}async init(){this._langOverride=await E.get("localeLangOverride","auto"),this.lang=this.getLang();const t=await E.get("localePhrases","");return this.setLocaleFromJsonString(t),this}get langOverride(){return this._langOverride}getLang(){return this.langOverride!=="auto"?this.langOverride:$n}getAvailableLangs(){return an.includes("auto")?an:["auto",...an]}async reset(){for(const t of this.storageKeys)await E.delete(t);return this}buildUrl(t,e,i=false){const o=i?`?timestamp=${on()}`:"";return `${t}${e}${o}`}async changeLang(t){return this.langOverride===t?false:(await E.set("localeLangOverride",t),this._langOverride=t,this.lang=this.getLang(),await this.update(true),true)}async checkUpdates(t=false){try{const e=await nt(this.buildUrl(this.hashesUrl,"",t));if(!e.ok)throw e.status;const i=await e.json();return await E.get("localeHash")!==i[this.lang]?i[this.lang]:!1}catch(e){return console.error("[VOT] [localizationProvider] Failed to get locales hash:",e),false}}async update(t=false){const e=await E.get("localeUpdatedAt",0);if(!t&&e+this.cacheTTL>on()&&await E.get("localeLang")===this.lang)return this;const i=await this.checkUpdates(t);if(await E.set("localeUpdatedAt",on()),!i)return this;try{const o=await nt(this.buildUrl(this.localesUrl,`/${this.lang}.json`,t));if(!o.ok)throw o.status;const r=await o.text();await E.set("localePhrases",r),await E.set("localeHash",i),await E.set("localeLang",this.lang),this.setLocaleFromJsonString(r);}catch(o){console.error("[VOT] [localizationProvider] Failed to get locale:",o),this.setLocaleFromJsonString(await E.get("localePhrases",""));}return this}setLocaleFromJsonString(t){try{const e=JSON.parse(t)||{};this.locale=to(e);}catch(e){console.error("[VOT] [localizationProvider]",e),this.locale={};}return this}getFromLocale(t,e){return t?.[e]??this.warnMissingKey(t,e)}warnMissingKey(t,e){console.warn("[VOT] [localizationProvider] locale",t,"doesn't contain key",e);}getDefault(t){return this.getFromLocale(this.defaultLocale,t)??t}get(t){return this.getFromLocale(this.locale,t)??this.getDefault(t)}getLangLabel(t){const e=`langs.${t}`;if(e in this.defaultLocale){const i=this.get(e);if(i)return i}return typeof t=="string"?t.toUpperCase():""}}const g=new Rh;let lo=null;function Fh(){return lo??=g.init(),lo}function Nh(){const t=Object.entries({"https://www.dailymotion.com":{targetOrigin:"https://geo.dailymotion.com",dataFilter:e=>typeof e=="object"&&e!==null&&"type"in e&&e.type==="getDailymotionVideoId",extractVideoId:e=>/\/video\/(\w+)/.exec(e.pathname)?.[1]??null,responseFormatter:e=>({type:"dailymotionVideoId",videoId:e})},"https://dev.epicgames.com":{targetOrigin:"https://dev.epicgames.com",dataFilter:e=>typeof e=="string"&&e.startsWith("getVideoId:"),extractVideoId:e=>e.pathname.split("/").at(-2)??null,responseFormatter:(e,i)=>`${typeof i=="string"?i:""}:${e}`}}).find(([e])=>globalThis.location.origin===e&&(e!=="https://dev.epicgames.com"||globalThis.location.pathname.includes("/community/learning/")))?.[1];t&&globalThis.addEventListener("message",e=>{try{if(e.origin!==t.targetOrigin||!t.dataFilter(e.data))return;const i=t.extractVideoId(new URL(globalThis.location.href));if(!i)return;const o=t.responseFormatter(i,e.data);e.source&&"postMessage"in e.source&&e.source.postMessage(o,t.targetOrigin);}catch(i){console.error("Iframe communication error:",i);}});}let ln=false,ae=null,co=false;async function uo(n,t){if(!ln){if(ae!==null){await ae;return}ae=(async()=>{if(t("Activating runtime",{reason:n}),globalThis.location.origin===Hr){await Dd(),ln=true;return}await Fh(),Fn()||await g.update(),A.log(`Selected menu language: ${g.lang}`),co||(co=true,Nh()),ln=true;})();try{await ae;}finally{ae=null;}}}let ho=false;function Hh(n){if(ho)return;ho=true;const{videoObserver:t,videosWrappers:e,ensureRuntimeActivated:i,getServicesCached:o,findContainer:r,createVideoHandler:s}=n,a=new WeakSet,l=new WeakMap,c=new WeakMap,d=new WeakMap,u=b=>{const y=c.get(b);return y&&l.get(y)===b&&l.delete(y),c.delete(b),y??void 0},h=b=>{b&&d.delete(b);},f=async b=>{if(!b)return;const y=d.get(b);y&&(d.delete(b),!(!y.isConnected||e.has(y)||a.has(y))&&await v(y));},v=async b=>{if(!(e.has(b)||a.has(b))){a.add(b);try{try{await i("video-detected");}catch(D){console.error("[VOT] Failed to activate runtime",D);return}let y=null;const x=o().find(D=>(y=r(D,b),!!y));if(!x||!y)return;const w=l.get(y);if(w&&w!==b){if(w.isConnected){d.set(y,b);return}try{await e.get(w)?.release();}catch(D){console.error("[VOT] Failed to release stale videoHandler",D);}e.delete(w),u(w);}["peertube","directlink"].includes(x.host)&&(x.url=globalThis.location.origin);const L=s(b,y,x);e.set(b,L),c.set(b,y),l.set(y,b);try{if(await L.init(),e.get(b)!==L)return;try{await L.setCanPlay();}catch(D){console.error("[VOT] Failed to get video data",D);}}catch(D){if(e.get(b)===L){e.delete(b);const K=u(b);h(K),await f(K);}throw D}}catch(y){console.error("[VOT] Failed to initialize videoHandler",y);}finally{a.delete(b);}}};t.onVideoAdded.addListener(v),t.onVideoRemoved.addListener(async b=>{const y=u(b);e.has(b)&&(await e.get(b)?.release(),e.delete(b)),a.delete(b),y&&d.get(y)===b&&h(y),await f(y);});}function $h(n){return !n.isIframe||n.hash.includes(n.iframeHash)?false:n.href==="about:blank"||n.href.startsWith("about:srcdoc")||n.origin==="null"}function Uh(n){return n.isIframe&&n.hash.includes(n.iframeHash)?"iframe-helper":$h(n)?"skip":n.isIframe?"iframe-lazy":"top-full"}const Sn=7200*1e3;class zh{cache=new Map;lastCleanupAt=0;clear(){this.cache.clear(),this.lastCleanupAt=0;}getTranslation(t){const e=this.cache.get(t);if(!e)return;const i=e.translationExpiresAt;if(i!==void 0&&i<=Date.now()){e.translation=void 0,e.translationExpiresAt=void 0,this.evictIfEmpty(t,e);return}return e.translation}setTranslation(t,e){this.maybeCleanup();const i=this.getOrCreateEntry(t);i.translation=e,i.translationExpiresAt=Date.now()+Sn;}getSubtitles(t){const e=this.cache.get(t);if(!e)return;const i=e.subtitlesExpiresAt;if(i!==void 0&&i<=Date.now()){e.subtitles=void 0,e.subtitlesExpiresAt=void 0,this.evictIfEmpty(t,e);return}return e.subtitles}setSubtitles(t,e){this.maybeCleanup();const i=this.getOrCreateEntry(t);i.subtitles=e,i.subtitlesExpiresAt=Date.now()+Sn;}deleteSubtitles(t){const e=this.cache.get(t);e&&(e.subtitles=void 0,e.subtitlesExpiresAt=void 0,this.evictIfEmpty(t,e));}evictIfEmpty(t,e){e.translation===void 0&&e.subtitles===void 0&&this.cache.delete(t);}maybeCleanup(){const t=Date.now();if(!(t-this.lastCleanupAt<6e4)){this.lastCleanupAt=t;for(const[e,i]of this.cache)i.translationExpiresAt!==void 0&&i.translationExpiresAt<=t&&(i.translation=void 0,i.translationExpiresAt=void 0),i.subtitlesExpiresAt!==void 0&&i.subtitlesExpiresAt<=t&&(i.subtitles=void 0,i.subtitlesExpiresAt=void 0),this.evictIfEmpty(e,i);}}getOrCreateEntry(t){const e=this.cache.get(t);if(e)return e;const i={};return this.cache.set(t,i),i}}function Jr(n){return n?typeof ShadowRoot<"u"&&n instanceof ShadowRoot?n.host:n.parentNode??null:null}function zn(n,t){let e=t;for(;e;){if(e===n)return  true;e=Jr(e);}return  false}function Wh(n,t){if(!n||!t)return null;const e=n instanceof Document?null:n,i=o=>{if(!o)return null;if(o instanceof Document){if(e){const a=o.querySelectorAll(t);return Array.from(a).find(l=>zn(l,e))??null}return o.querySelector(t)}const r=o.closest(t);if(r)return r;const s=o.getRootNode();if(s instanceof ShadowRoot)return i(s.host);if(s instanceof Document)return i(s);if(s!==o){const a=Jr(s);if(a&&a!==o&&a instanceof Element)return i(a)}return null};return i(n)}function qh(n,{maxPointerEventsHops:t=30,maxPositionedHops:e=10,preferPositioned:i=true}={}){let o=n,r=0;for(;o?.parentElement&&r<t;){const l=getComputedStyle(o).pointerEvents,c=getComputedStyle(o.parentElement).pointerEvents;if(l==="none"||c==="none"){o=o.parentElement,r++;continue}break}if(!i)return o??n;let s=o,a=0;for(;s?.parentElement&&a<e&&getComputedStyle(s).position==="static";)s=s.parentElement,a++;return s??o??n}function jr(n,t){if(!t)return null;const e=Wh(n,t);return e instanceof HTMLElement&&e.isConnected&&zn(e,n)?e:null}class R{listeners=new Set;get size(){return this.listeners.size}addListener(t){return this.listeners.add(t),this}removeListener(t){return this.listeners.delete(t),this}dispatch(...t){for(const e of this.listeners)try{e(...t);}catch(i){console.error("[VOT]",i);}}clear(){this.listeners.clear();}}const Gh=null;function Zr(n,t){const e=[];let i=0,o=0,r=Math.min(nn[i],n);for(;r<n;)e.push({start:o,end:r,mustExist:r<t}),i<nn.length-1&&i++,o=r+1,r+=nn[i];return e.push({start:o,end:n,mustExist:false}),e}function Kh(n){if(n<1)throw new Error("Audio downloader. WEB API. contentLength must be at least 1");const t=Math.round(n*Br),e=Zr(n,t),i=[];let o=[],r=0;for(const s of e)o.push(s),r+=s.end-s.start,(r>=Or||s.end===n)&&(i.push(o),o=[],r=0);return i}function Qr({contentLength:n}){if(typeof n!="string")throw new TypeError(`Audio downloader. WEB API. Content length (${n}) is not a string`);const t=Number.parseInt(n,10);if(!Number.isFinite(t))throw new TypeError(`Audio downloader. WEB API. Parsed content length is not finite (${t})`);return t}function fo(n){const t=Qr(n),e=Kh(t);if(!e.length)throw new Error("Audio downloader. WEB API. No chunk parts generated");return e}function Yh(n){if(n<1)throw new Error("Audio downloader. WEB API. contentLength cannot be less than 1");const t=Math.round(n*Br);return Zr(n,t)}function Xh(n){const t=Qr(n),e=Yh(t);if(!e.length)throw new Error("Audio downloader. WEB API. Empty chunk ranges");return e}function Jh(n){const t=n.reduce((o,r)=>o+r.byteLength,0),e=new Uint8Array(t);let i=0;for(const o of n)e.set(new Uint8Array(o),i),i+=o.byteLength;return e}async function jh(n,t){const{videoId:e}=t.payload,i=`https://${Rc}/embed/${e}?autoplay=0&mute=1`;try{const o=await Oc(Gh,i,Yi,_r);if(!Mr(Yi))throw new Error("Audio downloader. WEB API. Service iframe deleted");o.contentWindow?.postMessage({messageId:Cr(),messageType:n,messageDirection:"request",payload:t,error:t.error},"*");}catch(o){t.error=o,t.messageDirection="response",globalThis.postMessage(t,"*");}}function Zh(n,t,e){return JSON.stringify({downloadType:n,itag:t,minChunkSize:Or,fileSize:e})}const cn="Audio downloader. WEB API. Can not get getGeneratingAudioUrlsDataFromIframe due to timeout",dn="Audio downloader. WEB API. Incorrect response on fetch media url",po="Audio downloader. WEB API. Can not fetch media url",go="Audio downloader. WEB API. Can not get array buffer from media url",Qh=new TextDecoder("ascii");let tf=1;function ef(n,{start:t,end:e}){const i=new URL(n);return i.searchParams.set("range",`${t}-${e}`),i.searchParams.set("rn",String(tf++)),i.searchParams.delete("ump"),i.toString()}function mo(n,{start:t,end:e}){const i=e-t;return i>Xi&&n.byteLength<Xi?false:Math.min(i,n.byteLength)/Math.max(i,n.byteLength)>Fc}const nf=n=>/https:\/\/.*$/.exec(Qh.decode(n))?.[0],of=ne.WEB_API_GET_ALL_GENERATING_URLS_DATA_FROM_IFRAME;function rf(n){return !!n&&typeof n=="object"&&"headersEntries"in n}function sf(n,t){return n?rf(n)?Fr(n):n:t}const af=(n,t)=>Dc("get-download-audio-data-in-main-world",n,{signal:t}).promise;async function lf(n,t){try{return await Promise.race([af({videoId:n},t),Nr(2e4,cn)])}catch(e){const i=e instanceof Error&&e.message===cn;throw new Error(i?cn:"Audio downloader. WEB API. Failed to get audio data")}}async function ts({mediaUrl:n,chunkRange:t,requestInit:e,signal:i,isUrlChanged:o=false}){const r=ef(n,t);let s;try{if(s=await nt(r,{...e,signal:i}),!s.ok){const c=Nc(s);throw console.error(dn,c),new Error(dn)}}catch(c){throw c instanceof Error&&c.message===dn?c:(console.error(po,{mediaUrl:r,error:c}),new Error(po))}let a;try{a=await s.arrayBuffer();}catch(c){throw console.error(go,{mediaUrl:r,error:c}),new Error(go)}if(A.log("isChunkLengthAcceptable",mo(a,t),a.byteLength,t),mo(a,t))return {media:a,url:o?n:null,isAcceptableLast:false};const l=nf(a);if(l)return ts({mediaUrl:l,chunkRange:t,requestInit:e,signal:i,isUrlChanged:true});if(!t.mustExist)return {media:a,url:null,isAcceptableLast:true};throw new Error(`Audio downloader. WEB API. Can not get redirected media url ${r}`)}async function vo(n,t,e,i){let o=n;const r=[];let s=false;for(const a of e){const l=await ts({mediaUrl:o,chunkRange:a,requestInit:t,signal:i});if(l.url&&(o=l.url),r.push(l.media),s=l.isAcceptableLast,s)break}return {media:Jh(r),url:o,isAcceptableLast:s}}async function cf({videoId:n,returnByParts:t=false,signal:e}){const{requestInit:i,requestInfo:o,adaptiveFormat:r,itag:s}=await lf(n,e);if(!o)throw new Error("Audio downloader. WEB API. Can not get requestInfo");let a=Dr(o);const l=Rr(o),c=Fr(l),d=sf(i,c);return {fileId:Zh(of,s,r.contentLength),mediaPartsLength:t?fo(r).length:1,async*getMediaBuffers(){if(t){const u=fo(r);for(const h of u){const{media:f,url:v,isAcceptableLast:b}=await vo(a,d,h,e);if(v&&(a=v),yield f,b)break}}else {const u=Xh(r),{media:h}=await vo(a,d,u,e);yield h;}}}}const df={[ne.WEB_API_GET_ALL_GENERATING_URLS_DATA_FROM_IFRAME]:cf};async function uf({audioDownloader:n,translationId:t,videoId:e,signal:i}){const o=await df[n.strategy]({videoId:e,returnByParts:true,signal:i});if(!o)throw new Error("Audio downloader. Can not get audio data");A.log("Audio downloader. Url found",{audioDownloadType:n.strategy});const{getMediaBuffers:r,mediaPartsLength:s,fileId:a}=o;if(s<2){const{value:c}=await r().next();if(!c)throw new Error("Audio downloader. Empty audio");n.onDownloadedAudio.dispatch(t,{videoId:e,fileId:a,audioData:c});return}let l=0;for await(const c of r()){if(!c)throw new Error("Audio downloader. Empty audio");n.onDownloadedPartialAudio.dispatch(t,{videoId:e,fileId:a,audioData:c,version:1,index:l,amount:s}),l++;}}async function bo(n){const{data:t,source:e}=n;try{if(t?.messageType!=="get-download-audio-data-in-main-world")return;if(t.messageDirection==="response"){e!==globalThis.window&&globalThis.postMessage(t,"*");return}if(t.messageDirection!=="request")return;await jh("get-download-audio-data-in-iframe",t);}catch(i){console.error("[VOT] Main world bridge",{error:i});}}class hf{onDownloadedAudio=new R;onDownloadedPartialAudio=new R;onDownloadAudioError=new R;strategy;constructor(t=ne.WEB_API_GET_ALL_GENERATING_URLS_DATA_FROM_IFRAME){this.strategy=t;}async runAudioDownload(t,e,i){globalThis.addEventListener("message",bo);try{await uf({audioDownloader:this,translationId:e,videoId:t,signal:i}),A.log("Audio downloader. Audio download finished",{videoId:t});}catch(o){console.error("Audio downloader. Failed to download audio",o),this.onDownloadAudioError.dispatch(t);}globalThis.removeEventListener("message",bo);}addEventListener(t,e){switch(t){case "downloadedAudio":this.onDownloadedAudio.addListener(e);break;case "downloadedPartialAudio":this.onDownloadedPartialAudio.addListener(e);break;case "downloadAudioError":this.onDownloadAudioError.addListener(e);break}return this}removeEventListener(t,e){switch(t){case "downloadedAudio":this.onDownloadedAudio.removeListener(e);break;case "downloadedPartialAudio":this.onDownloadedPartialAudio.removeListener(e);break;case "downloadAudioError":this.onDownloadAudioError.removeListener(e);break}return this}}const ff=.66;function pf(n,t){let e=Math.floor(n/60);if(Math.floor(n%60)/60>=ff&&(e+=1),e>=60)return t("translationTakeMoreThanHour");if(e<=1)return t("translationTakeAboutMinute");const r=String(e);return e!==11&&e%10===1?t("translationTakeApproximatelyMinute2").replace("{0}",r):![12,13,14].includes(e)&&[2,3,4].includes(e%10)?t("translationTakeApproximatelyMinute").replace("{0}",r):t("translationTakeApproximatelyMinutes").replace("{0}",r)}class rt extends Error{name="VOTLocalizedError";unlocalizedMessage;localizedMessage;constructor(t){super(g.getDefault(t)),this.unlocalizedMessage=t,this.localizedMessage=g.get(t);}}function Wn(n){return n??null}async function es(n,t){const e=await n.translateVideoImpl(t.videoData,t.requestLang,t.responseLang,Wn(t.translationHelp),!t.useAudioDownload,t.signal);return e?.url?{url:e.url,usedLivelyVoice:!!e.usedLivelyVoice}:null}function gf(n){return {videoId:n.videoId,from:n.requestLang,to:n.responseLang,url:n.downloadTranslationUrl??n.fallbackUrl,useLivelyVoice:n.usedLivelyVoice}}async function ns(n){return n.isActionStale(n.actionContext)||(await n.updateTranslation(n.url,n.actionContext),n.isActionStale(n.actionContext))?false:(n.scheduleTranslationRefresh(),true)}async function mf(n){const t=await es(n.requester,{videoData:n.request.videoData,requestLang:n.request.requestLang,responseLang:n.request.responseLang,translationHelp:n.request.translationHelp,useAudioDownload:n.request.useAudioDownload,signal:n.request.signal});return !t||!await ns({url:t.url,actionContext:n.actionContext,isActionStale:n.isActionStale,updateTranslation:n.updateTranslation,scheduleTranslationRefresh:n.scheduleTranslationRefresh})||n.isActionStale(n.actionContext)?null:t}function vf(n){n.setTranslation(n.cacheKey,gf({videoId:n.videoId,requestLang:n.requestLang,responseLang:n.responseLang,fallbackUrl:n.fallbackUrl,downloadTranslationUrl:n.downloadTranslationUrl,usedLivelyVoice:n.usedLivelyVoice}));}function is(n){return n.aborted||!n.translateApiErrorsEnabled||!n.hadAsyncWait?n.hadAsyncWait:(n.notify({videoId:n.videoId,message:n.error}),false)}function os(n){if(!n||typeof n!="object")return null;const t=n,e=t.data&&typeof t.data=="object"?t.data:void 0;return {name:t.name,message:t.message,data:e}}function bf(n){const e=os(n)?.data?.message;return typeof e=="string"&&e.length>0?e:void 0}function yf(n){const t=os(n);if(!t||t.name!=="VOTJSError")return n;const e=typeof t.message=="string"?t.message:"",i=typeof t.data?.message=="string"&&t.data.message.length>0;return e==="Yandex couldn't translate video"&&!i?new rt("requestTranslationFailed"):e==="Failed to request video translation"?new rt("requestTranslationFailed"):e==="Audio link wasn't received"||e==="Audio link wasn't received from VOT response"?new rt("audioNotReceived"):n}class wf{videoHandler;audioDownloader;downloading;downloadWaiters=new Set;requestedFailAudio=new Set;constructor(t){this.videoHandler=t,this.audioDownloader=new hf,this.downloading=false,this.audioDownloader.addEventListener("downloadedAudio",this.onDownloadedAudio).addEventListener("downloadedPartialAudio",this.onDownloadedPartialAudio).addEventListener("downloadAudioError",this.onDownloadAudioError);}onDownloadedAudio=async(t,e)=>{if(!this.downloading)return;const{videoId:i,fileId:o,audioData:r}=e,s=this.getCanonicalUrl(i);try{await this.videoHandler.votClient.requestVtransAudio(s,t,{audioFile:r,fileId:o});}catch{}this.finishDownloadSuccess();};onDownloadedPartialAudio=async(t,e)=>{if(!this.downloading)return;const{audioData:i,fileId:o,videoId:r,amount:s,version:a,index:l}=e,c=this.getCanonicalUrl(r);try{await this.videoHandler.votClient.requestVtransAudio(c,t,{audioFile:i,chunkId:l},{audioPartsLength:s,fileId:o,version:a});}catch{this.finishDownloadFailure(new Error("Audio downloader failed while uploading chunk"));return}l===s-1&&this.finishDownloadSuccess();};onDownloadAudioError=async t=>{if(!this.downloading)return;const e=this.getCanonicalUrl(t);if(!(this.videoHandler.site.host==="youtube"&&!!this.videoHandler.data?.useAudioDownload)){this.finishDownloadFailure(new rt("VOTFailedDownloadAudio"));return}try{this.requestedFailAudio.has(e)?A.log("fail-audio-js request already sent for this video"):(A.log("Sending fail-audio-js request"),await this.videoHandler.votClient.requestVtransFailAudio(e),this.requestedFailAudio.add(e)),this.finishDownloadSuccess();}catch{this.finishDownloadFailure(new rt("VOTFailedDownloadAudio"));}};finishDownloadSuccess(){this.downloading=false,this.resolveDownloadWaiters();}finishDownloadFailure(t){this.downloading=false,this.rejectDownloadWaiters(t);}getCanonicalUrl(t){return `https://youtu.be/${t}`}isLivelyVoiceUnavailableError(t){const e=Pr(t);return !!e&&e.toLowerCase().includes("обычная озвучка")}scheduleRetry(t,e,i){return new Promise((o,r)=>{let s=null;const a=()=>{s!==null&&clearTimeout(s),i.removeEventListener("abort",l);},l=()=>{a(),r(Lt());};if(i.addEventListener("abort",l,{once:true}),i.aborted){l();return}s=setTimeout(()=>{if(i.aborted){l();return}a(),t().then(o,r);},e),s!==null&&(this.videoHandler.autoRetry=s);})}async translateVideoImpl(t,e,i,o=null,r=false,s=new AbortController().signal,a=false){clearTimeout(this.videoHandler.autoRetry),this.finishDownloadSuccess();const l=this.videoHandler.getRequestLangForTranslation(e,i);let c=a;try{Zi(s);const d=this.videoHandler.isLivelyVoiceAllowed(l,i);let u=!c&&d&&!!this.videoHandler.data?.useLivelyVoice,h;for(let v=0;v<2;v++){try{h=await this.videoHandler.votClient.translateVideo({videoData:t,requestLang:l,responseLang:i,translationHelp:o,extraOpts:{useLivelyVoice:u,videoTitle:this.videoHandler.videoData?.title},shouldSendFailedAudio:r});}catch(b){if(u&&this.isLivelyVoiceUnavailableError(b)){A.log("[translateVideoImpl] Lively voices are unavailable. Falling back to standard translation.",b),c=!0,u=!1;continue}throw b}if(u&&this.isLivelyVoiceUnavailableError(h)){A.log("[translateVideoImpl] Server responded that lively voices are unavailable. Falling back to standard translation.",h),c=!0,u=!1,h=void 0;continue}break}if(!h)throw new Error("Failed to get translation response");if(A.log("Translate video result",h),Zi(s),h.translated&&h.remainingTime<1)return A.log("Video translation finished with this data: ",h),{...h,usedLivelyVoice:u};const f=h.message??g.get("translationTakeFewMinutes");if(await this.videoHandler.updateTranslationErrorMsg(h.remainingTime>0?pf(h.remainingTime,v=>g.get(v)):f,s),h.status===ft.AUDIO_REQUESTED&&this.videoHandler.isYouTubeHosts())return this.videoHandler.hadAsyncWait=!0,A.log("Start audio download"),this.downloading=!0,await this.audioDownloader.runAudioDownload(t.videoId,h.translationId,s),A.log("waiting downloading finish"),await this.waitForAudioDownloadCompletion(s,15e3),await this.translateVideoImpl(t,e,i,o,!0,s,c)}catch(d){if(Nt(d))return null;const u=yf(d);return await this.videoHandler.updateTranslationErrorMsg(bf(u)??u,s),this.videoHandler.hadAsyncWait=is({aborted:!!this.videoHandler.actionsAbortController?.signal?.aborted,translateApiErrorsEnabled:!!this.videoHandler.data?.translateAPIErrors,hadAsyncWait:this.videoHandler.hadAsyncWait,videoId:t.videoId,error:d,notify:h=>this.videoHandler.notifier.translationFailed(h)}),console.error("[VOT]",d),null}return this.videoHandler.hadAsyncWait=true,this.scheduleRetry(()=>this.translateVideoImpl(t,e,i,o,r,s,c),2e4,s)}waitForAudioDownloadCompletion(t,e){return this.downloading?new Promise((i,o)=>{let r;const s=()=>{l(),o(Lt());},a=setTimeout(()=>{l(),i();},e),l=()=>{clearTimeout(a),t.removeEventListener("abort",s),this.downloadWaiters.delete(r);};if(r={resolve:()=>{l(),i();},reject:c=>{l(),o(c);}},this.downloadWaiters.add(r),t.aborted){s();return}t.addEventListener("abort",s,{once:true});}):Promise.resolve()}resolveDownloadWaiters(){this.forEachDownloadWaiter(t=>t.resolve());}rejectDownloadWaiters(t){this.forEachDownloadWaiter(e=>e.reject(t));}forEachDownloadWaiter(t){if(!this.downloadWaiters.size)return;const e=Array.from(this.downloadWaiters);this.downloadWaiters.clear();for(const i of e)t(i);}}class kf{state={status:"idle"};deps;constructor(t){this.deps=t;}get currentState(){return this.state}setState(t){this.state=t;}reset(){this.setState({status:"idle"});}async runAutoTranslationIfEligible(){if(this.state.status==="idle"&&this.deps.isFirstPlay()&&this.deps.isAutoTranslateEnabled()&&this.deps.getVideoId()){if(this.deps.isMobileYouTubeMuted?.()){this.setState({status:"deferred",reason:"muted"}),this.deps.setMuteWatcher?.(()=>{this.setState({status:"idle"}),this.runAutoTranslationIfEligible();});return}this.setState({status:"pending",reason:"auto"});try{this.deps.setFirstPlay(!1),await this.deps.scheduleAutoTranslate(),this.reset();}catch(t){throw this.setState({status:"error",message:t}),t}}}}function Sf(n,t={}){const{requireVideoData:e=false,clearVideoData:i=false}=t;e&&!n.videoData||(i&&(n.videoData=void 0),n.stopTranslation(),n.resetSubtitlesWidget());}function ce(n,t={}){const{hideMenu:e=false}=t;n?.votButton?.container&&(n.votButton.container.hidden=true),e&&n?.votMenu&&(n.votMenu.hidden=true);}function rs(n,t,e={}){const{requireVideoData:i,clearVideoData:o,hideMenu:r}=e;Sf(n,{requireVideoData:i,clearVideoData:o}),ce(t,{hideMenu:r});}class xf{host;lifecycleGeneration=0;lastSetCanPlaySourceKey="";setCanPlayRequested=false;setCanPlayLoopPromise;inFlightVideoDataRequest;constructor(t){this.host=t;}isStale(t){return t!==this.lifecycleGeneration}resetActions(t){if(typeof this.host.resetActionsAbortController=="function"){this.host.resetActionsAbortController(t);return}this.host.actionsAbortController?.abort(t);}invalidateActiveSession(t){this.lifecycleGeneration!==0&&(this.lifecycleGeneration+=1,this.resetActions(`[VideoLifecycle] ${t}`),A.log(`[VideoLifecycle] cancelled active session (active: ${this.lifecycleGeneration})`,{reason:t}));}startSession(t){this.lifecycleGeneration+=1;const e=this.lifecycleGeneration;return this.resetActions(`[VideoLifecycle][session:${e}] ${t}`),e}shouldAbortHandleSrcChanged(t,e){return this.isStale(t)?(A.log(`[VideoLifecycle][session:${t}] handleSrcChanged aborted at ${e} (active: ${this.lifecycleGeneration})`),true):false}teardown(){this.setCanPlayRequested=false,this.invalidateActiveSession("teardown"),this.inFlightVideoDataRequest=void 0;}getCurrentSourceKey(){const t=this.host.video.currentSrc||this.host.video.src||"",e=this.host.video.srcObject?"1":"0";return `${globalThis.location.href}||${t}||${e}`}resolveContainer(){const{site:t,video:e,container:i}=this.host;if(!t.selector)return e.parentElement??i;const o=jr(e,t.selector);return o||(i.isConnected&&zn(i,e)?i:e.parentElement??i)}async setCanPlay(){if(this.setCanPlayRequested=true,this.setCanPlayLoopPromise!==void 0)return this.invalidateActiveSession("setCanPlay superseded by a newer trigger"),await this.setCanPlayLoopPromise;const t=(async()=>{for(;this.setCanPlayRequested;)this.setCanPlayRequested=false,await this.runSetCanPlayOnce();})();this.setCanPlayLoopPromise=t;try{await t;}finally{this.setCanPlayLoopPromise===t&&(this.setCanPlayLoopPromise=void 0);}}async runSetCanPlayOnce(){const t=this.getCurrentSourceKey();if(this.host.videoData?.videoId&&t===this.lastSetCanPlaySourceKey)return;const e=this.startSession(`setCanPlay (source: ${t})`);if(this.lastSetCanPlaySourceKey=t,await this.handleSrcChanged(e,t),this.isStale(e)){A.log(`[VideoLifecycle][session:${e}] setCanPlay aborted after src change (active: ${this.lifecycleGeneration})`);return}const i=this.runAutoSubtitlesIfEnabled(e);await this.host.translationOrchestrator.runAutoTranslationIfEligible(),!this.isStale(e)&&(await i,this.isStale(e));}async runAutoSubtitlesIfEnabled(t){if(!(!this.host.data.autoSubtitles||!this.host.videoData?.videoId))try{await this.host.enableSubtitlesForCurrentLangPair();}catch{}}async getVideoDataSingleFlight(t){const e=this.inFlightVideoDataRequest;if(e?.sourceKey===t)return await e.promise;const i=this.host.getVideoData();this.inFlightVideoDataRequest={sourceKey:t,promise:i};try{return await i}finally{this.inFlightVideoDataRequest?.promise===i&&(this.inFlightVideoDataRequest=void 0);}}async handleSrcChanged(t,e){const i=typeof t=="number"?t:this.startSession("manual handleSrcChanged"),o=typeof e=="string"&&e.length>0?e:this.getCurrentSourceKey();if(typeof t!="number"&&(this.lastSetCanPlaySourceKey=o),this.shouldAbortHandleSrcChanged(i,"before start"))return;this.host.firstPlay=true;const r=this.host.uiManager.votOverlayView;rs(this.host,r,{requireVideoData:true}),!this.host.video.src&&!this.host.video.currentSrc&&!this.host.video.srcObject&&ce(r,{hideMenu:true});const a=this.resolveContainer();if(a!==this.host.container&&(this.host.container=a),this.shouldSkipYouTubeSource()){ce(r,{hideMenu:true});return}if(this.shouldAbortHandleSrcChanged(i,"before getVideoData"))return;r.votButton.container.hidden=false,r.votButton.opacity=1,this.host.queueOverlayAutoHide?.();let l;try{l=typeof o=="string"&&o?await this.getVideoDataSingleFlight(o):await this.host.getVideoData();}catch{if(this.shouldAbortHandleSrcChanged(i,"after getVideoData error"))return;this.host.videoData=void 0,ce(r,{hideMenu:true});return}if(this.shouldAbortHandleSrcChanged(i,"after getVideoData"))return;if(this.host.videoData=l,!this.host.videoData?.videoId){ce(r,{hideMenu:true});return}const c=this.host.getSubtitlesCacheKey(this.host.videoData.videoId,this.host.videoData.detectedLanguage,this.host.videoData.responseLanguage);this.host.subtitles=this.host.cacheManager.getSubtitles(c)??[],await this.host.updateSubtitlesLangSelect(),!this.shouldAbortHandleSrcChanged(i,"after subtitles update")&&(this.host.translateToLang=this.host.data.responseLanguage??"ru",this.host.setSelectMenuValues(this.host.videoData.detectedLanguage,this.host.videoData.responseLanguage),r.votButton.container.hidden=false,r.votButton.opacity=1,this.host.queueOverlayAutoHide?.());}shouldSkipYouTubeSource(){if(this.host.site.host!=="youtube")return  false;const t=/(^|\.)youtube(?:-nocookie|kids)?\.com$/.test(globalThis.location.hostname)||globalThis.location.hostname==="youtube.googleapis.com",e=globalThis.location.pathname,i=e==="/watch"||e.startsWith("/embed/")||e.startsWith("/shorts/");return t&&!i}}const Tf=/\b(?:https?:\/\/|www\.)\S+/gi,Af=/#[^\s#]+/g,Lf=/auto-generated\s+by\s+youtube|provided\s+to\s+youtube\s+by|released\s+on/gi,If=/paypal?/gi,Ef=/0x[\da-f]{40}/gi,Pf=/[13][1-9a-z]{25,34}/gi,Cf=/4[\dab][1-9a-z]{93}/gi,Mf=/t[1-9a-z]{33}/gi,Vf=[Tf,Af,Lf,If,Ef,Pf,Cf,Mf];function _f(n,t){const e=`${n??""} ${t??""}`.trim();if(!e)return "";let i=e;for(const o of Vf)i=i.replaceAll(o,"");return i.replaceAll(/[\p{P}\p{S}]+/gu," ").replaceAll(/\s+/g," ").trim().slice(0,450)}const ss=5e3;let Ee=null,yo=0,Pe=null,wo=0;async function Of(){const n=Date.now();if(Ee&&n-yo<ss)return Ee;const t=await E.get("translationService",Je);return Ee=String(t),yo=n,Ee}async function Bf(){const n=Date.now();if(Pe&&n-wo<ss)return Pe;const t=await E.get("detectService",Nn);return Pe=String(t),wo=n,Pe}const as=["yandexbrowser","msedge"],xn=new class{isFOSWLYError(n){return Object.hasOwn(n,"error")}async request(n,t={}){try{const i=await(await nt(`${id}${n}`,{timeout:3e3,...t})).json();if(this.isFOSWLYError(i))throw new Error(i.error);return i}catch(e){console.error(`[VOT] Failed to get data from FOSWLY Translate API, because ${e instanceof Error?e.message:String(e)}`);return}}async translateMultiple(n,t,e){const i=await this.request("/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,lang:t,service:e})});return i?i.translations:n}async translate(n,t,e){const i=await this.request(`/translate?${new URLSearchParams({text:n,lang:t,service:e})}`);return i?i.translations[0]:n}async detect(n,t){const e=await this.request(`/detect?${new URLSearchParams({text:n,service:t})}`);return e?e.lang:"en"}},Df={async detect(n){try{return await(await nt(od,{method:"POST",body:n,timeout:3e3})).text()}catch(t){return console.error(`[VOT] Error getting lang from text, because ${t.message}`),"en"}}};async function Tn(n,t="",e="ru"){const i=await Of();switch(i){case "yandexbrowser":case "msedge":{const o=t&&e?`${t}-${e}`:e;return Array.isArray(n)?await xn.translateMultiple(n,o,i):await xn.translate(n,o,i)}default:return n}}async function Rf(n){const t=await Bf();switch(t){case "yandexbrowser":case "msedge":return await xn.detect(n,t);case "rust-server":return await Df.detect(n);default:return "en"}}const Ff=[...as,"rust-server"],Nf=0,Hf=100,Ue=.01,ko=1e-6;function ie(n,t,e){return !Number.isFinite(n)||e<t?t:Math.max(t,Math.min(e,n))}function ls(n,t,e){return Math.trunc(ie(n,t,e))}function Ht(n,t=Nf,e=Hf){return Number.isFinite(n)?ls(Math.round(n),t,e):t}function cs(n){const t=ie(n,0,1);return Ht(t*100)}function $f(n){return Ht(n)/100}function Uf(n,t,e){if(!Number.isFinite(n)||!Number.isFinite(t)||t<=0)return n;const i=1/t,o=n*i;switch(e){case "down":return Math.floor(o+ko)/i;case "up":return Math.ceil(o-ko)/i;default:return Math.round(o)/i}}function Rt(n,t="nearest",e=Ue){const i=ie(n,0,1),o=Uf(i,e,t);return ie(o,0,1)}function zf(n,t,e,i=Ue){const o=ie(t,0,1),r=ie(e,0,1);if(r<o){const s=Rt(n,"down",i);return Math.max(r,s)}if(r>o){const s=Rt(n,"up",i);return Math.min(r,s)}return Rt(n,"nearest",i)}const ds=new Set(["youtube","googledrive"]),Wf=ds,qf=new Set(["rutube","ok"]),Gf=new Set(["youtube","invidious","piped"]);function Ce(n){return ds.has(n)}function us(n){return Wf.has(n)}function Kf(n){return qf.has(n)}function hs(n){return us(n.host)&&n.additionalData!=="mobile"}function Yf(n){return Gf.has(n)}const Xf={rutube:"ru","ok.ru":"ru",mail_ru:"ru",weverse:"ko",niconico:"ja",youku:"zh",bilibili:"zh",weibo:"zh",zdf:"de"},So=".ytp-volume-panel [aria-valuenow]";function fs(...n){for(const t of n){if(typeof t!="string")continue;const e=t.trim();if(e)return e}}function gt(n){if(typeof n!="string")return;const t=n.toLowerCase().split(/[-_]/)[0];return Ut.includes(t)?t:void 0}function Qt(n){return !!(n&&n!=="auto")}function Jf(n){if(!Array.isArray(n)||n.length===0)return;const t=n;for(const e of t){const i=gt(e?.translatedFromLanguage);if(Qt(i))return i}for(const e of t){if(e?.translatedFromLanguage)continue;const i=gt(e?.language);if(Qt(i))return i}for(const e of t){const i=gt(e?.language);if(Qt(i))return i}}function un(...n){for(const t of n)if(Qt(t))return t}function jf(n,t,e){const i=fs(n,t,document.title);return _f(i??"",typeof e=="string"?e:void 0)}function Zf(n){const t=Xf[n];if(t)return t;if(n==="vk"){const e=document.getElementsByTagName("track")?.[0]?.srclang,i=gt(e);if(Qt(i))return i}}function xo(n){const t=document.querySelector(n),e=t?.getAttribute("aria-valuenow"),i=t?.getAttribute("aria-valuemax"),o=e==null?Number.NaN:Number.parseFloat(e),r=i==null?Number.NaN:Number.parseFloat(i);return Number.isFinite(o)?Number.isFinite(r)&&r>0?Ht(o/r*100):Ht(o):null}function ps(n){if(n.pathname==="/attribution_link"){const e=n.searchParams.get("u");if(e)try{const i=decodeURIComponent(e),o=i.startsWith("http")?new URL(i):new URL(i,n.origin);return ps(o)}catch{}}if(n.hostname==="youtu.be")return n.pathname.replace(/^\/+/,"").split("/")[0]||void 0;const t=n.searchParams.get("v");return t||(/\/(?:shorts|embed|live|v|e)\/([^/?#]+)/.exec(n.pathname)?.[1]??void 0)}function Qf(n,t){return n&&n.videoId===t.videoId?{title:n.title,localizedTitle:n.localizedTitle,description:n.description}:{title:t.title,localizedTitle:t.localizedTitle,description:t.description}}class tp{videoHandler;detectInFlightByVideoId=new Map;constructor(t){this.videoHandler=t;}async detectLanguageSingleFlight(t,e){const i=this.detectInFlightByVideoId.get(t);if(i!==void 0)return await i;const o=(async()=>{const r=gt(await Rf(e));return un(r)})();this.detectInFlightByVideoId.set(t,o);try{return await o}finally{this.detectInFlightByVideoId.get(t)===o&&this.detectInFlightByVideoId.delete(t);}}scheduleLanguageDetection(t){if(t.detectedLanguage!=="auto")return;const e=Qf(this.videoHandler.videoData,t),i=jf(e.title,e.localizedTitle,e.description);i&&this.detectLanguageSingleFlight(t.videoId,i).then(o=>{if(!o)return;const r=this.videoHandler.videoData;!r||r.videoId!==t.videoId||r.detectedLanguage==="auto"&&(this.setSelectMenuValues(o,r.responseLanguage),A.log(`[VOT] Async detected language resolved: ${o} for video ${t.videoId}`));}).catch(o=>{});}getYouTubeVideoDataFast(){const t=_.getPlayerData(),e=_.getPlayerResponse(),i=fs(t?.video_id)??ps(new URL(globalThis.location.href));if(!i)throw new Error("[VOT] Failed to resolve YouTube videoId");const{title:o}=t??{},{shortDescription:r,isLive:s,title:a}=e?.videoDetails??{},l=_.getSubtitles(g.lang),c=_.getPlayer()?.getDuration?.()??void 0,d=gt(_.getLanguage());return {duration:c,url:`${this.videoHandler.site.url}${i}`,videoId:i,host:this.videoHandler.site.host,title:a,localizedTitle:o,description:r,detectedLanguage:d,subtitles:l,isStream:!!s}}async getVideoData(){let t;this.videoHandler.site.host==="youtube"?t=this.getYouTubeVideoDataFast():t=await nc(this.videoHandler.site,{fetchFn:nt,video:this.videoHandler.video,language:g.lang});const{duration:e,url:i,videoId:o,host:r,title:s,translationHelp:a,localizedTitle:l,description:c,detectedLanguage:d,subtitles:u,isStream:h=false}=t,f=gt(d),v=gt(this.videoHandler.translateFromLang),b=this.videoHandler.site.host!=="youtube"||Qt(f);let y=un(f,b?v:void 0,b?Jf(u):void 0);y=un(Zf(this.videoHandler.site.host),y);const x=y??"auto",w={translationHelp:a??null,isStream:h,duration:e||this.videoHandler.video?.duration||X.defaultDuration,videoId:o,url:i,host:r,detectedLanguage:x,responseLanguage:this.videoHandler.translateToLang,subtitles:u,title:s,localizedTitle:l,description:c,downloadTitle:l??s??o};return console.log("[VOT] Detected language:",x),this.scheduleLanguageDetection(w),w}videoValidator(){if(!this.videoHandler.videoData||!this.videoHandler.data)throw new rt("VOTNoVideoIDFound");if(console.log("[VOT] Video Data: ",this.videoHandler.videoData),this.videoHandler.data.enabledDontTranslateLanguages&&this.videoHandler.data.dontTranslateLanguages?.includes(this.videoHandler.videoData.detectedLanguage))throw new rt("VOTDisableFromYourLang");if(this.videoHandler.videoData.isStream)throw new rt("VOTStreamNotAvailable");if(this.videoHandler.videoData.duration>14400)throw new rt("VOTVideoIsTooLong");return  true}getVideoVolume(){const t=this.videoHandler.video;if(t){if(Ce(this.videoHandler.site.host)){const e=xo(So);if(e!=null)return $f(e);const i=_.getVolume();if(typeof i=="number"&&Number.isFinite(i))return Rt(i)}return Rt(t.volume)}}setVideoVolume(t){const e=Rt(t);if(!Ce(this.videoHandler.site.host))return this.videoHandler.video.volume=e,this;try{const i=_.setVolume(e);if(typeof i=="boolean"&&i||typeof i=="number"&&Number.isFinite(i))return this}catch{}return this.videoHandler.video.volume=e,this}isMuted(){return Ce(this.videoHandler.site.host)?_.isMuted():this.videoHandler.video?.muted}syncVideoVolumeSlider(){const t=this.videoHandler.uiManager.votOverlayView;if(!t?.isInitialized())return this;const e=Ce(this.videoHandler.site.host)?xo(So):null,i=this.isMuted()?0:e??cs(this.getVideoVolume()??0);return t.videoVolumeSlider.value=i,this.videoHandler.onVideoVolumeSliderSynced?.(i),this}setSelectMenuValues(t,e){if(!this.videoHandler.uiManager.votOverlayView?.isInitialized()||!this.videoHandler.videoData)return this;const i=gt(t)??"auto";console.log(`[VOT] Set translation from ${i} to ${e}`),this.videoHandler.uiManager.votOverlayView.languagePairSelect.fromSelect.selectTitle=g.getLangLabel(i),this.videoHandler.uiManager.votOverlayView.languagePairSelect.toSelect.selectTitle=g.getLangLabel(e),this.videoHandler.uiManager.votOverlayView.languagePairSelect.fromSelect.setSelectedValue(i),this.videoHandler.uiManager.votOverlayView.languagePairSelect.toSelect.setSelectedValue(e),this.videoHandler.videoData.detectedLanguage=i,this.videoHandler.videoData.responseLanguage=e;}}const qn=globalThis,To=n=>n,ze=qn.trustedTypes,Ao=ze?ze.createPolicy("lit-html",{createHTML:n=>n}):void 0,gs="$lit$",xt=`lit$${Math.random().toFixed(9).slice(2)}$`,ms="?"+xt,ep=`<${ms}>`,$t=document,ve=()=>$t.createComment(""),be=n=>n===null||typeof n!="object"&&typeof n!="function",Gn=Array.isArray,np=n=>Gn(n)||typeof n?.[Symbol.iterator]=="function",hn=`[ 	
\f\r]`,le=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Lo=/-->/g,Io=/>/g,Ct=RegExp(`>|${hn}(?:([^\\s"'>=/]+)(${hn}*=${hn}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Eo=/'/g,Po=/"/g,vs=/^(?:script|style|textarea|title)$/i,bs=n=>(t,...e)=>({_$litType$:n,strings:t,values:e}),de=bs(1),st=bs(2),ye=Symbol.for("lit-noChange"),G=Symbol.for("lit-nothing"),Co=new WeakMap,Dt=$t.createTreeWalker($t,129);function ys(n,t){if(!Gn(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ao!==void 0?Ao.createHTML(t):t}const ip=(n,t)=>{const e=n.length-1,i=[];let o,r=t===2?"<svg>":t===3?"<math>":"",s=le;for(let a=0;a<e;a++){const l=n[a];let c,d,u=-1,h=0;for(;h<l.length&&(s.lastIndex=h,d=s.exec(l),d!==null);)h=s.lastIndex,s===le?d[1]==="!--"?s=Lo:d[1]!==void 0?s=Io:d[2]!==void 0?(vs.test(d[2])&&(o=RegExp("</"+d[2],"g")),s=Ct):d[3]!==void 0&&(s=Ct):s===Ct?d[0]===">"?(s=o??le,u=-1):d[1]===void 0?u=-2:(u=s.lastIndex-d[2].length,c=d[1],s=d[3]===void 0?Ct:d[3]==='"'?Po:Eo):s===Po||s===Eo?s=Ct:s===Lo||s===Io?s=le:(s=Ct,o=void 0);const f=s===Ct&&n[a+1].startsWith("/>")?" ":"";r+=s===le?l+ep:u>=0?(i.push(c),l.slice(0,u)+gs+l.slice(u)+xt+f):l+xt+(u===-2?a:f);}return [ys(n,r+(n[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};class we{constructor({strings:t,_$litType$:e},i){let o;this.parts=[];let r=0,s=0;const a=t.length-1,l=this.parts,[c,d]=ip(t,e);if(this.el=we.createElement(c,i),Dt.currentNode=this.el.content,e===2||e===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes);}for(;(o=Dt.nextNode())!==null&&l.length<a;){if(o.nodeType===1){if(o.hasAttributes())for(const u of o.getAttributeNames())if(u.endsWith(gs)){const h=d[s++],f=o.getAttribute(u).split(xt),v=/([.?@])?(.*)/.exec(h);l.push({type:1,index:r,name:v[2],strings:f,ctor:v[1]==="."?rp:v[1]==="?"?sp:v[1]==="@"?ap:je}),o.removeAttribute(u);}else u.startsWith(xt)&&(l.push({type:6,index:r}),o.removeAttribute(u));if(vs.test(o.tagName)){const u=o.textContent.split(xt),h=u.length-1;if(h>0){o.textContent=ze?ze.emptyScript:"";for(let f=0;f<h;f++)o.append(u[f],ve()),Dt.nextNode(),l.push({type:2,index:++r});o.append(u[h],ve());}}}else if(o.nodeType===8)if(o.data===ms)l.push({type:2,index:r});else {let u=-1;for(;(u=o.data.indexOf(xt,u+1))!==-1;)l.push({type:7,index:r}),u+=xt.length-1;}r++;}}static createElement(t,e){const i=$t.createElement("template");return i.innerHTML=t,i}}function oe(n,t,e=n,i){if(t===ye)return t;let o=i!==void 0?e._$Co?.[i]:e._$Cl;const r=be(t)?void 0:t._$litDirective$;return o?.constructor!==r&&(o?._$AO?.(false),r===void 0?o=void 0:(o=new r(n),o._$AT(n,e,i)),i!==void 0?(e._$Co??=[])[i]=o:e._$Cl=o),o!==void 0&&(t=oe(n,o._$AS(n,t.values),o,i)),t}class op{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e;}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,o=(t?.creationScope??$t).importNode(e,true);Dt.currentNode=o;let r=Dt.nextNode(),s=0,a=0,l=i[0];for(;l!==void 0;){if(s===l.index){let c;l.type===2?c=new Le(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new lp(r,this,t)),this._$AV.push(c),l=i[++a];}s!==l?.index&&(r=Dt.nextNode(),s++);}return Dt.currentNode=$t,o}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++;}}class Le{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,i,o){this.type=2,this._$AH=G,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=o,this._$Cv=o?.isConnected??true;}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&t?.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=oe(this,t,e),be(t)?t===G||t==null||t===""?(this._$AH!==G&&this._$AR(),this._$AH=G):t!==this._$AH&&t!==ye&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):np(t)?this.k(t):this._(t);}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t));}_(t){this._$AH!==G&&be(this._$AH)?this._$AA.nextSibling.data=t:this.T($t.createTextNode(t)),this._$AH=t;}$(t){const{values:e,_$litType$:i}=t,o=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=we.createElement(ys(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===o)this._$AH.p(e);else {const r=new op(o,this),s=r.u(this.options);r.p(e),this.T(s),this._$AH=r;}}_$AC(t){let e=Co.get(t.strings);return e===void 0&&Co.set(t.strings,e=new we(t)),e}k(t){Gn(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,o=0;for(const r of t)o===e.length?e.push(i=new Le(this.O(ve()),this.O(ve()),this,this.options)):i=e[o],i._$AI(r),o++;o<e.length&&(this._$AR(i&&i._$AB.nextSibling,o),e.length=o);}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(false,true,e);t!==this._$AB;){const i=To(t).nextSibling;To(t).remove(),t=i;}}setConnected(t){this._$AM===void 0&&(this._$Cv=t,this._$AP?.(t));}}class je{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,o,r){this.type=1,this._$AH=G,this._$AN=void 0,this.element=t,this.name=e,this._$AM=o,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=G;}_$AI(t,e=this,i,o){const r=this.strings;let s=false;if(r===void 0)t=oe(this,t,e,0),s=!be(t)||t!==this._$AH&&t!==ye,s&&(this._$AH=t);else {const a=t;let l,c;for(t=r[0],l=0;l<r.length-1;l++)c=oe(this,a[i+l],e,l),c===ye&&(c=this._$AH[l]),s||=!be(c)||c!==this._$AH[l],c===G?t=G:t!==G&&(t+=(c??"")+r[l+1]),this._$AH[l]=c;}s&&!o&&this.j(t);}j(t){t===G?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"");}}class rp extends je{constructor(){super(...arguments),this.type=3;}j(t){this.element[this.name]=t===G?void 0:t;}}class sp extends je{constructor(){super(...arguments),this.type=4;}j(t){this.element.toggleAttribute(this.name,!!t&&t!==G);}}class ap extends je{constructor(t,e,i,o,r){super(t,e,i,o,r),this.type=5;}_$AI(t,e=this){if((t=oe(this,t,e,0)??G)===ye)return;const i=this._$AH,o=t===G&&i!==G||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,r=t!==G&&(i===G||o);o&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,t),this._$AH=t;}handleEvent(t){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t);}}class lp{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i;}get _$AU(){return this._$AM._$AU}_$AI(t){oe(this,t);}}const cp=qn.litHtmlPolyfillSupport;cp?.(we,Le),(qn.litHtmlVersions??=[]).push("3.3.2");const et=(n,t,e)=>{const i=t;let o=i._$litPart$;return o===void 0&&(i._$litPart$=o=new Le(t.insertBefore(ve(),null),null,void 0,{})),o._$AI(n),o},dp='.vot-button{--vot-helper-theme:var(--vot-theme-rgb,var(--vot-primary-rgb,33, 150, 243));--vot-helper-ontheme:var(--vot-ontheme-rgb,var(--vot-onprimary-rgb,255, 255, 255));box-sizing:border-box;vertical-align:middle;text-align:center;text-overflow:ellipsis;cursor:pointer;min-width:64px;height:36px;color:rgb(var(--vot-helper-ontheme));background-color:rgb(var(--vot-helper-theme));box-shadow:var(--vot-shadow-1);transition:box-shadow var(--vot-duration-medium) var(--vot-easing-standard);outline:none;font-size:14px;font-weight:500;line-height:36px;display:inline-block;position:relative;border-radius:var(--vot-radius-s)!important;padding:0 var(--vot-space-4)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;border:none!important}.vot-button:before,.vot-button:after{content:"";opacity:0;position:absolute;inset:0;border-radius:inherit!important}.vot-button:before{background-color:rgb(var(--vot-helper-ontheme));transition:opacity var(--vot-duration-medium) var(--vot-easing-standard)}.vot-button:after{transition:opacity var(--vot-duration-slow) var(--vot-easing-standard),background-size var(--vot-duration-slow) var(--vot-easing-standard);background:radial-gradient(circle,currentColor 1%,#0000 1%) 50%/10000% 10000% no-repeat}.vot-button:hover:before{opacity:.08}.vot-button:active:after{opacity:.32;background-size:100% 100%;transition:background-size}.vot-button:hover,.vot-button:active{box-shadow:var(--vot-shadow-2)}.vot-button[disabled=true]{background-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.12);color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);box-shadow:none;cursor:initial}.vot-button[disabled=true]:before,.vot-button[disabled=true]:after{opacity:0}.vot-outlined-button{--vot-helper-theme:var(--vot-theme-rgb,var(--vot-primary-rgb,33, 150, 243));box-sizing:border-box;vertical-align:middle;text-align:center;text-overflow:ellipsis;cursor:pointer;min-width:64px;height:36px;color:rgb(var(--vot-helper-theme));background-color:#0000;outline:none;font-size:14px;font-weight:500;line-height:34px;display:inline-block;position:relative;border-radius:var(--vot-radius-s)!important;padding:0 var(--vot-space-4)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;border:solid 1px var(--vot-border-color)!important;margin:0!important}.vot-outlined-button:before,.vot-outlined-button:after{content:"";opacity:0;position:absolute;inset:0;border-radius:inherit!important}.vot-outlined-button:before{background-color:rgb(var(--vot-helper-theme));transition:opacity var(--vot-duration-medium) var(--vot-easing-standard)}.vot-outlined-button:after{transition:opacity var(--vot-duration-slow) var(--vot-easing-standard),background-size var(--vot-duration-slow) var(--vot-easing-standard);background:radial-gradient(circle,currentColor 1%,#0000 1%) 50%/10000% 10000% no-repeat}.vot-outlined-button:hover:before{opacity:.04}.vot-outlined-button:active:after{opacity:.16;background-size:100% 100%;transition:background-size}.vot-outlined-button[disabled=true]{color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);cursor:initial;background-color:#0000}.vot-outlined-button[disabled=true]:before,.vot-outlined-button[disabled=true]:after{opacity:0}.vot-text-button{--vot-helper-theme:var(--vot-theme-rgb,var(--vot-primary-rgb,33, 150, 243));box-sizing:border-box;vertical-align:middle;text-align:center;text-overflow:ellipsis;cursor:pointer;min-width:64px;height:36px;color:rgb(var(--vot-helper-theme));background-color:#0000;outline:none;font-size:14px;font-weight:500;line-height:36px;display:inline-block;position:relative;border-radius:var(--vot-radius-s)!important;padding:0 var(--vot-space-2)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;border:none!important;margin:0!important}.vot-text-button:before,.vot-text-button:after{content:"";opacity:0;position:absolute;inset:0;border-radius:inherit!important}.vot-text-button:before{background-color:rgb(var(--vot-helper-theme));transition:opacity var(--vot-duration-medium) var(--vot-easing-standard)}.vot-text-button:after{transition:opacity var(--vot-duration-slow) var(--vot-easing-standard),background-size var(--vot-duration-slow) var(--vot-easing-standard);background:radial-gradient(circle,currentColor 1%,#0000 1%) 50%/10000% 10000% no-repeat}.vot-text-button:hover:before{opacity:.04}.vot-text-button:active:after{opacity:.16;background-size:100% 100%;transition:background-size}.vot-text-button[disabled=true]{color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);cursor:initial;background-color:#0000}.vot-text-button[disabled=true]:before,.vot-text-button[disabled=true]:after{opacity:0}.vot-icon-button{--vot-helper-onsurface:rgba(var(--vot-onsurface-rgb,0, 0, 0), .87);box-sizing:border-box;vertical-align:middle;text-align:center;text-overflow:ellipsis;cursor:pointer;width:36px;min-width:36px;height:36px;fill:var(--vot-helper-onsurface);color:var(--vot-helper-onsurface);background-color:#0000;outline:none;font-size:14px;font-weight:500;line-height:36px;display:inline-block;position:relative;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;border:none!important;border-radius:50%!important;margin:0!important;padding:0!important}.vot-icon-button:before,.vot-icon-button:after{content:"";opacity:0;position:absolute;inset:0;border-radius:inherit!important}.vot-icon-button:before{background-color:var(--vot-helper-onsurface);transition:opacity var(--vot-duration-medium) var(--vot-easing-standard)}.vot-icon-button:after{transition:opacity var(--vot-duration-slow) var(--vot-easing-standard),background-size var(--vot-duration-slow) var(--vot-easing-standard);background:radial-gradient(circle,currentColor 1%,#0000 1%) 50%/10000% 10000% no-repeat}.vot-icon-button:hover:before{opacity:.04}.vot-icon-button:active:after{opacity:.32;background-size:100% 100%;transition:background-size}.vot-icon-button[disabled=true]{color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);fill:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);cursor:initial;background-color:#0000}.vot-icon-button[disabled=true]:before,.vot-icon-button[disabled=true]:after{opacity:0}.vot-icon-button svg{fill:inherit;stroke:inherit;width:24px;height:36px}.vot-hotkey{justify-content:flex-start;align-items:center;gap:var(--vot-space-3,12px);flex-wrap:wrap;display:flex}.vot-hotkey-label{word-break:break-word;max-width:80%}.vot-hotkey-button{--vot-helper-theme:var(--vot-theme-rgb,var(--vot-primary-rgb,33, 150, 243));box-sizing:border-box;vertical-align:middle;text-align:center;text-overflow:ellipsis;cursor:pointer;background-color:#0000;outline:none;width:fit-content;min-width:32px;height:fit-content;font-size:15px;font-weight:400;line-height:1.5;display:inline-block;position:relative;border-radius:var(--vot-radius-s)!important;padding:0 var(--vot-space-2)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;border:solid 1px var(--vot-border-color)!important;margin:0!important}.vot-hotkey-button:before,.vot-hotkey-button:after{content:"";opacity:0;position:absolute;inset:0;border-radius:inherit!important}.vot-hotkey-button:before{background-color:rgb(var(--vot-helper-theme));transition:opacity var(--vot-duration-medium) var(--vot-easing-standard)}.vot-hotkey-button:after{transition:opacity var(--vot-duration-slow) var(--vot-easing-standard),background-size var(--vot-duration-slow) var(--vot-easing-standard);background:radial-gradient(circle,currentColor 1%,#0000 1%) 50%/10000% 10000% no-repeat}.vot-hotkey-button:hover:before{opacity:.04}.vot-hotkey-button:active:after{opacity:.16;background-size:100% 100%;transition:background-size}.vot-hotkey-button[data-status=active]{color:rgb(var(--vot-helper-theme))}.vot-hotkey-button[data-status=active]:before{opacity:.04}.vot-hotkey-button[disabled=true]{color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);cursor:initial;background-color:#0000}.vot-hotkey-button[disabled=true]:before,.vot-hotkey-button[disabled=true]:after{opacity:0}.vot-textfield{display:inline-block;--vot-helper-theme:rgb(var(--vot-theme-rgb,var(--vot-primary-rgb,33, 150, 243)))!important;--vot-helper-safari1:rgba(var(--vot-onsurface-rgb,0, 0, 0), .38)!important;--vot-helper-safari2:rgba(var(--vot-onsurface-rgb,0, 0, 0), .6)!important;--vot-helper-safari3:rgba(var(--vot-onsurface-rgb,0, 0, 0), .87)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;text-align:start!important;padding-top:6px!important;font-size:16px!important;line-height:1.5!important;position:relative!important}.vot-textfield>:is(input,textarea){box-sizing:border-box!important;border-style:solid!important;border-width:1px!important;border-color:transparent var(--vot-helper-safari2) var(--vot-helper-safari2)!important;width:100%!important;height:inherit!important;color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.87)!important;-webkit-text-fill-color:currentColor!important;font-family:inherit!important;font-size:inherit!important;line-height:inherit!important;caret-color:var(--vot-helper-theme)!important;background-color:#0000!important;border-radius:4px!important;margin:0!important;padding:15px 13px!important;transition:border .2s,box-shadow .2s!important;box-shadow:inset 1px 0 #0000,inset -1px 0 #0000,inset 0 -1px #0000!important}.vot-textfield>:is(input,textarea):not(:focus):not(:is(.vot-show-placeholder,.vot-show-placeholer))::placeholder{color:#0000!important}.vot-textfield>:is(input,textarea):not(:focus):placeholder-shown{border-top-color:var(--vot-helper-safari2)!important}.vot-textfield>:is(input,textarea)+span{font-family:inherit;width:100%!important;max-height:100%!important;color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.6)!important;cursor:text!important;pointer-events:none!important;font-size:75%!important;line-height:15px!important;transition:color .2s,font-size .2s,line-height .2s!important;display:flex!important;position:absolute!important;top:0!important;left:0!important}.vot-textfield>:is(input,textarea):not(:focus):placeholder-shown+span{font-size:inherit!important;line-height:68px!important}.vot-textfield>input+span:before,.vot-textfield>input+span:after,.vot-textfield>textarea+span:before,.vot-textfield>textarea+span:after{content:""!important;box-sizing:border-box!important;border-top:solid 1px var(--vot-helper-safari2)!important;pointer-events:none!important;min-width:10px!important;height:8px!important;margin-top:6px!important;transition:border .2s,box-shadow .2s!important;display:block!important;box-shadow:inset 0 1px #0000!important}.vot-textfield>input+span:before,.vot-textfield>textarea+span:before{border-left:1px solid #0000!important;border-radius:4px 0!important;margin-right:4px!important}.vot-textfield>input+span:after,.vot-textfield>textarea+span:after{border-right:1px solid #0000!important;border-radius:0 4px!important;flex-grow:1!important;margin-left:4px!important}.vot-textfield>input:is(.vot-show-placeholder,.vot-show-placeholer)+span:before,.vot-textfield>textarea:is(.vot-show-placeholder,.vot-show-placeholer)+span:before{margin-right:0!important}.vot-textfield>input:is(.vot-show-placeholder,.vot-show-placeholer)+span:after,.vot-textfield>textarea:is(.vot-show-placeholder,.vot-show-placeholer)+span:after{margin-left:0!important}.vot-textfield>input:not(:focus):placeholder-shown+span:before,.vot-textfield>input:not(:focus):placeholder-shown+span:after,.vot-textfield>textarea:not(:focus):placeholder-shown+span:before,.vot-textfield>textarea:not(:focus):placeholder-shown+span:after{border-top-color:#0000!important}.vot-textfield:hover>input:not(:disabled),.vot-textfield:hover>textarea:not(:disabled){border-color:transparent var(--vot-helper-safari3) var(--vot-helper-safari3)!important}.vot-textfield:hover>input:not(:disabled)+span:before,.vot-textfield:hover>input:not(:disabled)+span:after,.vot-textfield:hover>textarea:not(:disabled)+span:before,.vot-textfield:hover>textarea:not(:disabled)+span:after{border-top-color:var(--vot-helper-safari3)!important}.vot-textfield:hover>input:not(:disabled):not(:focus):placeholder-shown,.vot-textfield:hover>textarea:not(:disabled):not(:focus):placeholder-shown{border-color:var(--vot-helper-safari3)!important}.vot-textfield>input:focus,.vot-textfield>textarea:focus{border-color:transparent var(--vot-helper-theme) var(--vot-helper-theme)!important;box-shadow:inset 1px 0 var(--vot-helper-theme),inset -1px 0 var(--vot-helper-theme),inset 0 -1px var(--vot-helper-theme)!important;outline:none!important}.vot-textfield>input:focus+span,.vot-textfield>textarea:focus+span{color:var(--vot-helper-theme)!important}.vot-textfield>input:focus+span:before,.vot-textfield>input:focus+span:after,.vot-textfield>textarea:focus+span:before,.vot-textfield>textarea:focus+span:after{border-top-color:var(--vot-helper-theme)!important;box-shadow:inset 0 1px var(--vot-helper-theme)!important}.vot-textfield>input:disabled,.vot-textfield>input:disabled+span,.vot-textfield>textarea:disabled,.vot-textfield>textarea:disabled+span{border-color:transparent var(--vot-helper-safari1) var(--vot-helper-safari1)!important;color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38)!important;pointer-events:none!important}.vot-textfield>input:disabled+span:before,.vot-textfield>input:disabled+span:after,.vot-textfield>textarea:disabled+span:before,.vot-textfield>textarea:disabled+span:after,.vot-textfield>input:disabled:placeholder-shown,.vot-textfield>input:disabled:placeholder-shown+span,.vot-textfield>textarea:disabled:placeholder-shown,.vot-textfield>textarea:disabled:placeholder-shown+span{border-top-color:var(--vot-helper-safari1)!important}.vot-textfield>input:disabled:placeholder-shown+span:before,.vot-textfield>input:disabled:placeholder-shown+span:after,.vot-textfield>textarea:disabled:placeholder-shown+span:before,.vot-textfield>textarea:disabled:placeholder-shown+span:after{border-top-color:#0000!important}@media not all and (min-resolution:.001dpcm){@supports ((-webkit-appearance:none)){.vot-textfield>input,.vot-textfield>input+span,.vot-textfield>textarea,.vot-textfield>textarea+span,.vot-textfield>input+span:before,.vot-textfield>input+span:after,.vot-textfield>textarea+span:before,.vot-textfield>textarea+span:after{transition-duration:.1s!important}}}.vot-checkbox{--vot-checkbox-label-offset:30px;--vot-helper-theme:var(--vot-theme-rgb,var(--vot-primary-rgb,33, 150, 243));--vot-helper-ontheme:var(--vot-ontheme-rgb,var(--vot-onprimary-rgb,255, 255, 255));z-index:0;color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.87);text-align:start;font-size:16px;line-height:1.5;display:inline-block;position:relative;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;text-transform:none!important}.vot-checkbox-sub{padding-left:var(--vot-checkbox-label-offset)!important}.vot-checkbox>input{appearance:none;z-index:10000;box-sizing:border-box;opacity:1;cursor:pointer;background:0 0;outline:none;width:18px;height:18px;transition:border-color .2s,background-color .2s;display:block;position:absolute;border:2px solid!important;border-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.6)!important;border-radius:2px!important;margin:3px 1px!important;padding:0!important}.vot-checkbox>input+span{box-sizing:border-box;width:inherit;cursor:pointer;font-family:inherit;font-weight:400;display:inline-block;position:relative;padding-left:var(--vot-checkbox-label-offset)!important}.vot-checkbox>input+span:before{content:"";background-color:rgb(var(--vot-onsurface-rgb,0, 0, 0));opacity:0;pointer-events:none;width:40px;height:40px;transition:opacity .3s,transform .2s;display:block;position:absolute;top:-8px;left:-10px;transform:scale(1);border-radius:50%!important}.vot-checkbox>input+span:after{content:"";z-index:10000;pointer-events:none;width:10px;height:5px;transition:border-color .2s;display:block;position:absolute;top:3px;left:1px;transform:translate(3px,4px)rotate(-45deg);box-sizing:content-box!important;border:0 solid #0000!important;border-width:0 0 2px 2px!important}.vot-checkbox>input:checked,.vot-checkbox>input:indeterminate{background-color:rgb(var(--vot-helper-theme));border-color:rgb(var(--vot-helper-theme))!important}.vot-checkbox>input:checked+span:before,.vot-checkbox>input:indeterminate+span:before{background-color:rgb(var(--vot-helper-theme))}.vot-checkbox>input:checked+span:after,.vot-checkbox>input:indeterminate+span:after{border-color:rgb(var(--vot-helper-ontheme,255, 255, 255))!important}.vot-checkbox>input:hover{box-shadow:none!important}.vot-checkbox>input:indeterminate+span:after{transform:translate(4px,3px);border-left-width:0!important}.vot-checkbox:hover>input+span:before{opacity:.04}.vot-checkbox:active>input,.vot-checkbox:active:hover>input:not(:disabled){border-color:rgb(var(--vot-helper-theme))!important}.vot-checkbox:active>input:checked{background-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.6);border-color:#0000!important}.vot-checkbox:active>input+span:before{opacity:1;transition:transform,opacity;transform:scale(0)}.vot-checkbox>input:disabled{cursor:initial;border-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38)!important}.vot-checkbox>input:disabled:checked,.vot-checkbox>input:disabled:indeterminate{background-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);border-color:#0000!important}.vot-checkbox>input:disabled+span{color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38);cursor:initial}.vot-checkbox>input:disabled+span:before{opacity:0;transform:scale(0)}html.vot-keyboard-nav .vot-checkbox>input:focus-visible{box-shadow:var(--vot-focus-ring),var(--vot-focus-ring-offset)!important}@supports not selector(:focus-visible){html.vot-keyboard-nav .vot-checkbox>input:focus{box-shadow:var(--vot-focus-ring),var(--vot-focus-ring-offset)!important}}.vot-slider{flex-direction:column;gap:6px;display:flex;width:100%!important;color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.87)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", BlinkMacSystemFont, system-ui, -apple-system)!important;text-align:start!important;font-size:16px!important;line-height:1.5!important}.vot-slider>span{order:1;margin:0!important;display:block!important}.vot-slider .vot-slider-label{flex-wrap:wrap;align-items:baseline;gap:6px;width:100%;display:inline-flex}.vot-slider-label-value{font-variant-numeric:tabular-nums;font-weight:500;margin-left:0!important}.vot-slider .vot-slider-label-text{min-width:0}.vot-slider>input{order:2;appearance:none!important;cursor:pointer!important;background-color:#0000!important;border:none!important;width:100%!important;height:32px!important;margin:0!important;padding:0!important;display:block!important;position:relative!important;top:0!important}.vot-slider>input:hover{box-shadow:none!important}.vot-slider>input:before{content:""!important;width:calc(100% * var(--vot-progress,0))!important;background:rgb(var(--vot-primary-rgb,33, 150, 243))!important;height:2px!important;display:block!important;position:absolute!important;top:calc(50% - 1px)!important}.vot-slider>input:disabled{cursor:default!important;opacity:.38!important}.vot-slider>input:disabled+span{color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38)!important}.vot-slider>input:disabled::-webkit-slider-runnable-track{background-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38)!important}.vot-slider>input:disabled::-moz-range-track{background-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38)!important}.vot-slider>input:disabled::-webkit-slider-thumb{background-color:rgb(var(--vot-onsurface-rgb,0, 0, 0))!important;box-shadow:0 0 0 1px rgb(var(--vot-surface-rgb,255, 255, 255))!important;transform:scale(4)!important}.vot-slider>input:disabled::-moz-range-thumb{background-color:rgb(var(--vot-onsurface-rgb,0, 0, 0))!important;box-shadow:0 0 0 1px rgb(var(--vot-surface-rgb,255, 255, 255))!important;transform:scale(4)!important}.vot-slider>input:disabled::-moz-range-progress{background-color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.87)!important}.vot-slider>input:focus{outline:none!important}.vot-slider>input::-webkit-slider-runnable-track{background-color:rgba(var(--vot-primary-rgb,33, 150, 243),.24)!important;border-radius:1px!important;width:100%!important;height:2px!important;margin:15px 0!important}.vot-slider>input::-moz-range-track{background-color:rgba(var(--vot-primary-rgb,33, 150, 243),.24)!important;border-radius:1px!important;width:100%!important;height:2px!important;margin:15px 0!important}.vot-slider>input::-webkit-slider-thumb{appearance:none!important;background-color:rgb(var(--vot-primary-rgb,33, 150, 243))!important;width:2px!important;height:2px!important;box-shadow:none!important;border:none!important;border-radius:50%!important;transition:box-shadow .2s!important;transform:scale(6)!important}.vot-slider>input::-moz-range-thumb{appearance:none!important;background-color:rgb(var(--vot-primary-rgb,33, 150, 243))!important;width:2px!important;height:2px!important;box-shadow:none!important;border:none!important;border-radius:50%!important;transition:box-shadow .2s!important;transform:scale(6)!important}.vot-slider>input::-webkit-slider-thumb{-webkit-appearance:none!important;margin:0!important}.vot-slider>input::-moz-range-progress{background-color:rgb(var(--vot-primary-rgb,33, 150, 243))!important;border-radius:1px!important;height:2px!important}.vot-slider>input:focus:not(:focus-visible)::-webkit-slider-thumb{box-shadow:none!important}.vot-slider>input:focus:not(:focus-visible)::-moz-range-thumb{box-shadow:none!important}html.vot-keyboard-nav .vot-slider>input:focus-visible::-webkit-slider-thumb{box-shadow:0 0 0 2px rgba(var(--vot-primary-rgb,33, 150, 243),.24)!important}html.vot-keyboard-nav .vot-slider>input:focus-visible::-moz-range-thumb{box-shadow:0 0 0 2px rgba(var(--vot-primary-rgb,33, 150, 243),.24)!important}@supports not selector(:focus-visible){html.vot-keyboard-nav .vot-slider>input:focus::-webkit-slider-thumb{box-shadow:0 0 0 2px rgba(var(--vot-primary-rgb,33, 150, 243),.24)!important}html.vot-keyboard-nav .vot-slider>input:focus::-moz-range-thumb{box-shadow:0 0 0 2px rgba(var(--vot-primary-rgb,33, 150, 243),.24)!important}}.vot-select{--vot-helper-theme-rgb:var(--vot-onsurface-rgb,0, 0, 0);--vot-helper-theme:rgba(var(--vot-helper-theme-rgb), .87);--vot-helper-safari1:rgba(var(--vot-onsurface-rgb,0, 0, 0), .6);--vot-helper-safari2:rgba(var(--vot-onsurface-rgb,0, 0, 0), .87);font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif);text-align:start;color:var(--vot-helper-theme);fill:var(--vot-helper-theme);justify-content:space-between;align-items:center;font-size:14px;font-weight:400;line-height:1.5;display:flex}.vot-select-outer{cursor:pointer;justify-content:space-between;align-items:center;width:120px;max-width:120px;display:flex;border:1px solid var(--vot-helper-safari1)!important;border-radius:4px!important;padding:0 5px!important;transition:border .2s!important}.vot-select-outer:hover{border-color:var(--vot-helper-safari2)!important}.vot-select-outer[disabled=true]{opacity:.5;cursor:default}.vot-select-outer[disabled=true]:hover{border-color:var(--vot-helper-safari1)!important}.vot-select-title{text-overflow:ellipsis;white-space:nowrap;font-family:inherit;overflow:hidden}.vot-select-arrow-icon{justify-content:center;align-items:center;width:20px;height:32px;display:flex}.vot-select-arrow-icon svg{fill:inherit;stroke:inherit}.vot-select-content-list{flex-direction:column;display:flex}.vot-select-content-list .vot-select-content-item{cursor:pointer;border-radius:8px!important;padding:5px 10px!important}.vot-select-content-list .vot-select-content-item:not([inert]):hover{background-color:#2a2c31}.vot-select-content-list .vot-select-content-item[data-vot-selected=true]{color:rgb(var(--vot-primary-rgb,33, 150, 243));background-color:rgba(var(--vot-primary-rgb,33, 150, 243),.2)}.vot-select-content-list .vot-select-content-item[data-vot-selected=true]:hover{background-color:rgba(var(--vot-primary-rgb,33, 150, 243),.1)!important}.vot-select-content-list .vot-select-content-item[inert]{cursor:default;color:rgba(var(--vot-onsurface-rgb,0, 0, 0),.38)}.vot-header{color:rgba(var(--vot-helper-onsurface-rgb),.87);font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif);text-align:start;font-weight:700;line-height:1.5}.vot-header:not(:first-child){padding-top:8px}.vot-header-level-1{font-size:2em}.vot-header-level-2{font-size:1.5em}.vot-header-level-3{font-size:1.17em}.vot-header-level-4{font-size:1em}.vot-header-level-5{font-size:.83em}.vot-header-level-6{font-size:.67em}.vot-info{color:rgba(var(--vot-helper-onsurface-rgb),.87);font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif);text-align:start;-webkit-user-select:text;user-select:text;font-size:16px;line-height:1.5;display:flex}.vot-info>:not(:first-child){color:rgba(var(--vot-helper-onsurface-rgb),.5);flex:1;margin-left:8px!important}.vot-details{color:rgba(var(--vot-helper-onsurface-rgb),.87);font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif);text-align:start;cursor:pointer;transition:background var(--vot-duration-medium) var(--vot-easing-standard);justify-content:space-between;align-items:center;font-size:16px;line-height:1.5;display:flex;border-radius:.5em!important;margin:-.5em!important;padding:.5em!important}.vot-details-arrow-icon{width:20px;height:32px;fill:rgba(var(--vot-helper-onsurface-rgb),.87);justify-content:center;align-items:center;display:flex;transform:scale(1.25)rotate(-90deg)}.vot-details:hover{background:rgba(var(--vot-onsurface-rgb,0, 0, 0),.06)}.vot-settings-section{border:1px solid var(--vot-border-color);border-radius:var(--vot-radius-l);padding:var(--vot-space-2);background:rgba(var(--vot-helper-onsurface-rgb),.03);flex-direction:column;display:flex}.vot-settings-section>*{margin:0!important}.vot-settings-section>*+*{margin-top:var(--vot-space-2)!important}.vot-settings-section-header{border-radius:var(--vot-radius-m);margin:0!important;padding:.45em .5em!important}.vot-settings-section-header .vot-details-arrow-icon{transition:transform var(--vot-duration-medium) var(--vot-easing-standard)}.vot-settings-section-header[data-open=true] .vot-details-arrow-icon{transform:scale(1.25)rotate(0)}.vot-settings-section-content{--vot-settings-control-width:200px;--vot-settings-row-gap:var(--vot-space-2);padding:0 var(--vot-space-1) var(--vot-space-1);flex-direction:column;display:flex}.vot-settings-section-content>*{margin:0!important}.vot-settings-section-content>*+*{margin-top:var(--vot-settings-row-gap)!important}.vot-settings-section-content>.vot-checkbox,.vot-settings-section-content>.vot-hotkey,.vot-settings-section-content>.vot-textfield,.vot-settings-section-content>.vot-select,.vot-settings-section-content>.vot-slider{padding:var(--vot-space-1);box-sizing:border-box;width:100%!important}.vot-settings-section-content>.vot-textfield{gap:var(--vot-space-1);flex-direction:column;padding-top:0!important;display:flex!important}.vot-settings-section-content>.vot-textfield>span{order:0;width:auto!important;max-height:none!important;color:rgba(var(--vot-helper-onsurface-rgb),.72)!important;cursor:default!important;pointer-events:none!important;font-size:13px!important;line-height:1.2!important;display:block!important;position:static!important}.vot-settings-section-content>.vot-textfield>span:before,.vot-settings-section-content>.vot-textfield>span:after{content:none!important;display:none!important}.vot-settings-section-content>.vot-textfield>input,.vot-settings-section-content>.vot-textfield>textarea{transition:border-color var(--vot-duration-fast) var(--vot-easing-standard),background-color var(--vot-duration-fast) var(--vot-easing-standard);order:1;width:100%!important;height:36px!important;padding:0 var(--vot-space-3)!important;border:1px solid var(--vot-border-color)!important;border-radius:var(--vot-radius-s)!important;background:rgba(var(--vot-helper-onsurface-rgb),.04)!important;color:rgba(var(--vot-helper-onsurface-rgb),.9)!important;-webkit-text-fill-color:currentColor!important;box-shadow:none!important}.vot-settings-section-content>.vot-textfield>textarea{resize:vertical;height:auto!important;min-height:84px!important;padding:var(--vot-space-2) var(--vot-space-3)!important}.vot-settings-section-content>.vot-textfield>input::placeholder,.vot-settings-section-content>.vot-textfield>textarea::placeholder{color:rgba(var(--vot-helper-onsurface-rgb),.55)!important}.vot-settings-section-content>.vot-textfield:hover>input,.vot-settings-section-content>.vot-textfield:hover>textarea{border-color:var(--vot-border-color-hover)!important}.vot-settings-section-content>.vot-textfield>input:not(:focus):placeholder-shown,.vot-settings-section-content>.vot-textfield>textarea:not(:focus):placeholder-shown{border-color:var(--vot-border-color)!important}.vot-settings-section-content>.vot-textfield>input:focus,.vot-settings-section-content>.vot-textfield>textarea:focus{border-color:rgba(var(--vot-primary-rgb),.7)!important}.vot-lang-select{--vot-helper-theme-rgb:var(--vot-onsurface-rgb,0, 0, 0);--vot-helper-theme:rgba(var(--vot-helper-theme-rgb), .87);color:var(--vot-helper-theme);fill:var(--vot-helper-theme);justify-content:space-between;align-items:center;display:flex}.vot-lang-select-icon{justify-content:center;align-items:center;width:32px;height:32px;display:flex}.vot-lang-select-icon svg{fill:inherit;stroke:inherit}.vot-segmented-button{--vot-helper-theme-rgb:var(--vot-onsurface-rgb,0, 0, 0);--vot-helper-theme:rgba(var(--vot-helper-theme-rgb), .87);-webkit-user-select:none;user-select:none;background:rgb(var(--vot-surface-rgb,255, 255, 255));max-width:100vw;height:36px;color:var(--vot-helper-theme);fill:var(--vot-helper-theme);cursor:default;transition:opacity var(--vot-duration-slow) var(--vot-easing-standard);z-index:2147483647;align-items:center;font-size:16px;line-height:1.5;display:flex;position:absolute;top:5rem;left:50%;overflow:hidden;transform:translate(-50%);opacity:1!important;pointer-events:auto!important;touch-action:none!important;border:1px solid var(--vot-border-color)!important;border-radius:var(--vot-radius-s)!important;box-shadow:var(--vot-shadow-1)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important}.vot-segmented-button.vot-segmented-button--hidden{opacity:0!important;pointer-events:none!important}.vot-segmented-button *{box-sizing:border-box!important}.vot-segmented-button .vot-separator{background:rgba(var(--vot-helper-theme-rgb),.1);width:1px;height:50%}.vot-segmented-button .vot-segment,.vot-segmented-button .vot-segment-only-icon{height:100%;color:inherit;transition:background-color var(--vot-duration-fast) var(--vot-easing-standard);-webkit-tap-highlight-color:transparent;background-color:#0000;outline:none;justify-content:center;align-items:center;display:flex;position:relative;overflow:hidden;padding:0 var(--vot-space-2)!important;border:none!important}.vot-segmented-button .vot-segment:focus,.vot-segmented-button .vot-segment-only-icon:focus{box-shadow:inset 0 0 0 2px var(--vot-focus-ring-color);outline:none}.vot-segmented-button .vot-segment:focus:not(:focus-visible),.vot-segmented-button .vot-segment-only-icon:focus:not(:focus-visible){box-shadow:none}.vot-segmented-button .vot-segment:before,.vot-segmented-button .vot-segment-only-icon:before,.vot-segmented-button .vot-segment:after,.vot-segmented-button .vot-segment-only-icon:after{content:"";opacity:0;position:absolute;inset:0;border-radius:inherit!important}.vot-segmented-button .vot-segment:before,.vot-segmented-button .vot-segment-only-icon:before{background-color:rgb(var(--vot-helper-theme-rgb));transition:opacity var(--vot-duration-medium) var(--vot-easing-standard)}.vot-segmented-button .vot-segment:after,.vot-segmented-button .vot-segment-only-icon:after{transition:opacity var(--vot-duration-slow) var(--vot-easing-standard),background-size var(--vot-duration-slow) var(--vot-easing-standard);background:radial-gradient(circle,currentColor 1%,#0000 1%) 50%/10000% 10000% no-repeat}.vot-segmented-button .vot-segment:hover:before,.vot-segmented-button .vot-segment-only-icon:hover:before{opacity:.04}.vot-segmented-button .vot-segment:active:after,.vot-segmented-button .vot-segment-only-icon:active:after{opacity:.16;background-size:100% 100%;transition:background-size}.vot-segmented-button .vot-segment-only-icon{min-width:36px;padding:0!important}.vot-segmented-button .vot-segment-label{white-space:nowrap;color:inherit;font-weight:400;margin-left:var(--vot-space-2)!important}.vot-segmented-button[data-status=success] .vot-translate-button{color:rgb(var(--vot-primary-rgb,33, 150, 243));fill:rgb(var(--vot-primary-rgb,33, 150, 243))}.vot-segmented-button[data-status=error] .vot-translate-button{color:#f28b82;fill:#f28b82}.vot-segmented-button[data-loading=true] #vot-loading-icon{display:block!important}.vot-segmented-button[data-loading=true] #vot-translate-icon{display:none!important}.vot-segmented-button[data-direction=column]{flex-direction:column;height:fit-content}.vot-segmented-button[data-direction=column] .vot-segment-label{display:none}.vot-segmented-button[data-direction=column]>.vot-segment-only-icon,.vot-segmented-button[data-direction=column]>.vot-segment{padding:8px!important}.vot-segmented-button[data-direction=column] .vot-separator{width:50%;height:1px}.vot-segmented-button[data-position=left]{top:12.5vh;left:50px}.vot-segmented-button[data-position=right]{top:12.5vh;left:auto;right:0}.vot-segmented-button svg{width:24px;fill:inherit;stroke:inherit}.vot-tooltip{--vot-helper-theme-rgb:var(--vot-onsurface-rgb,0, 0, 0);--vot-helper-theme:rgba(var(--vot-helper-theme-rgb), .87);--vot-helper-ondialog:rgb(var(--vot-ondialog-rgb,37, 38, 40));--vot-helper-border:rgb(var(--vot-tooltip-border,69, 69, 69));-webkit-user-select:none;user-select:none;background:rgb(var(--vot-surface-rgb,255, 255, 255));color:var(--vot-helper-theme);fill:var(--vot-helper-theme);font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif);cursor:default;z-index:2147483647;opacity:0;align-items:center;width:max-content;max-width:calc(100vw - 10px);height:max-content;font-size:14px;line-height:1.5;transition:opacity .5s;display:flex;position:absolute;inset:0;overflow:hidden;box-shadow:0 1px 3px #0000001f;border-radius:4px!important;padding:4px 8px!important}.vot-tooltip[data-trigger=click]{-webkit-user-select:text;user-select:text}.vot-tooltip.vot-tooltip-bordered{border:1px solid var(--vot-helper-border)}.vot-tooltip *{box-sizing:border-box!important}.vot-menu{--vot-helper-surface-rgb:var(--vot-surface-rgb,255, 255, 255);--vot-helper-surface:rgb(var(--vot-helper-surface-rgb));--vot-helper-onsurface-rgb:var(--vot-onsurface-rgb,0, 0, 0);--vot-helper-onsurface:rgba(var(--vot-helper-onsurface-rgb), .87);--vot-settings-control-width:clamp(120px, 45%, 200px);-webkit-user-select:none;user-select:none;background-color:var(--vot-helper-surface);color:var(--vot-helper-onsurface);cursor:default;z-index:2147483646;visibility:visible;opacity:1;transform-origin:top;width:fit-content;min-width:320px;max-width:min(90vw,560px);transition:opacity var(--vot-duration-medium) var(--vot-easing-standard),transform var(--vot-duration-medium) var(--vot-easing-standard);font-size:16px;line-height:1.5;position:absolute;top:calc(5rem + 48px);left:50%;overflow:hidden;transform:translate(-50%)scale(1);border:1px solid var(--vot-border-color)!important;border-radius:var(--vot-radius-m)!important;box-shadow:var(--vot-shadow-2)!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important}.vot-menu *{box-sizing:border-box!important}.vot-menu[hidden]{pointer-events:none;visibility:hidden;opacity:0;transform:translate(-50%,-4px)scale(.98);display:block!important}.vot-menu-content-wrapper{min-width:320px;min-height:100px;max-height:calc(var(--vot-container-height,75vh) - (5rem + 32px + 16px) * 2);flex-direction:column;display:flex;overflow:auto}.vot-menu-header-container{flex-shrink:0;align-items:center;min-height:31px;display:flex;padding-inline-end:var(--vot-space-2)!important}.vot-menu-header-container:empty{padding:0 0 16px!important}.vot-menu-header-container>.vot-icon-button{margin-inline-end:var(--vot-space-1)!important;margin-top:var(--vot-space-1)!important}.vot-menu-title-container{font-size:inherit;font-weight:inherit;text-align:start;outline:0;flex:1;display:flex;margin:0!important}.vot-menu-title{flex:1;font-size:16px;font-weight:500;line-height:1;padding:var(--vot-space-4)!important}.vot-menu-body-container{box-sizing:border-box;gap:var(--vot-space-2);overscroll-behavior:contain;flex-direction:column;min-height:1.375rem;display:flex;overflow:auto;padding:0 var(--vot-space-4)!important;scrollbar-color:rgba(var(--vot-helper-onsurface-rgb),.1) var(--vot-helper-surface)!important}.vot-menu-body-container::-webkit-scrollbar{background:var(--vot-helper-surface)!important;width:12px!important;height:12px!important}.vot-menu-body-container::-webkit-scrollbar-track{background:var(--vot-helper-surface)!important;width:12px!important;height:12px!important}.vot-menu-body-container::-webkit-scrollbar-thumb{border-radius:1ex;background:rgba(var(--vot-helper-onsurface-rgb),.1)!important;border:5px solid var(--vot-helper-surface)!important}.vot-menu-body-container::-webkit-scrollbar-thumb:hover{border-width:3px!important}.vot-menu-body-container::-webkit-scrollbar-corner{background:var(--vot-helper-surface)!important}.vot-menu-footer-container{flex-shrink:0;justify-content:flex-end;display:flex;padding:var(--vot-space-4)!important}.vot-menu-footer-container:empty{padding:var(--vot-space-4) 0 0 0!important}.vot-menu .vot-select--labeled>.vot-select-outer{margin-left:auto}.vot-menu[data-position=left]{transform-origin:0;top:12.5vh;left:240px}.vot-menu[data-position=right]{transform-origin:100%;top:12.5vh;left:auto;right:-80px}.vot-dialog{--vot-helper-surface-rgb:var(--vot-surface-rgb,255, 255, 255);--vot-helper-surface:rgb(var(--vot-helper-surface-rgb));--vot-helper-onsurface-rgb:var(--vot-onsurface-rgb,0, 0, 0);--vot-helper-onsurface:rgba(var(--vot-helper-onsurface-rgb), .87);--vot-dialog-viewport-margin:16px;--vot-dialog-max-height:75vh;max-width:initial;max-height:initial;width:min(var(--vot-dialog-width,512px),100%);border:1px solid var(--vot-border-color);border-radius:var(--vot-radius-l);background-color:var(--vot-helper-surface);height:fit-content;color:var(--vot-helper-onsurface);box-shadow:var(--vot-shadow-2);-webkit-user-select:none;user-select:none;visibility:visible;opacity:1;transform-origin:50%;transition:opacity var(--vot-duration-medium) var(--vot-easing-standard),transform var(--vot-duration-medium) var(--vot-easing-standard);font-size:16px;line-height:1.5;display:block;position:fixed;inset-block:0;inset-inline:0;overflow:auto hidden;transform:scale(1);font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;margin:auto!important;padding:0!important}[hidden]>.vot-dialog{pointer-events:none;opacity:0;transition:opacity var(--vot-duration-fast) var(--vot-easing-standard),transform var(--vot-duration-medium) var(--vot-easing-standard);transform:translateY(-4px)scale(.98)}.vot-dialog[data-vertical-align=top]{inset-block-start:var(--vot-dialog-viewport-margin);inset-block-end:auto;margin:0 auto!important}.vot-dialog-container{visibility:visible;z-index:2147483647;position:absolute}.vot-dialog-container[hidden]{pointer-events:none;visibility:hidden;display:block!important}.vot-dialog-container *{box-sizing:border-box!important}.vot-dialog-backdrop{opacity:1;background-color:#0009;transition:opacity .3s;position:fixed;inset:0}[hidden]>.vot-dialog-backdrop{pointer-events:none;opacity:0}.vot-dialog-content-wrapper{max-height:var(--vot-dialog-max-height,75vh);flex-direction:column;display:flex;overflow:auto}.vot-dialog-header-container{flex-shrink:0;align-items:flex-start;min-height:31px;display:flex}.vot-dialog-header-container:empty{padding:0 0 20px}.vot-dialog-header-container>.vot-icon-button{margin-inline-end:var(--vot-space-1)!important;margin-top:var(--vot-space-1)!important}.vot-dialog-title-container{font-size:inherit;font-weight:inherit;outline:0;flex:1;display:flex;margin:0!important}.vot-dialog-title{flex:1;font-size:115.385%;font-weight:700;line-height:1;padding:var(--vot-space-5) var(--vot-space-5) var(--vot-space-4)!important}.vot-dialog-body-container{box-sizing:border-box;gap:var(--vot-space-4);overscroll-behavior:contain;flex-direction:column;min-height:1.375rem;display:flex;overflow:auto;padding:0 var(--vot-space-5)!important;scrollbar-color:rgba(var(--vot-helper-onsurface-rgb),.1) var(--vot-helper-surface)!important}.vot-dialog-body-container::-webkit-scrollbar{background:var(--vot-helper-surface)!important;width:12px!important;height:12px!important}.vot-dialog-body-container::-webkit-scrollbar-track{background:var(--vot-helper-surface)!important;width:12px!important;height:12px!important}.vot-dialog-body-container::-webkit-scrollbar-thumb{border-radius:1ex;background:rgba(var(--vot-helper-onsurface-rgb),.1)!important;border:5px solid var(--vot-helper-surface)!important}.vot-dialog-body-container::-webkit-scrollbar-thumb:hover{border-width:3px!important}.vot-dialog-body-container::-webkit-scrollbar-corner{background:var(--vot-helper-surface)!important}.vot-dialog-footer-container{justify-content:flex-end;gap:var(--vot-space-2);flex-wrap:wrap;flex-shrink:0;display:flex;padding:var(--vot-space-4)!important}.vot-dialog-footer-container:empty{padding:var(--vot-space-5) 0 0 0!important}@media(max-width:480px){.vot-dialog-footer-container{flex-direction:column;align-items:stretch}.vot-dialog-footer-container>:is(.vot-button,.vot-outlined-button,.vot-text-button){white-space:normal;text-overflow:clip;text-align:center;justify-content:center;align-items:center;width:100%;height:auto;min-height:36px;padding:8px 16px;line-height:1.2;display:flex;overflow:visible}}.vot-inline-loader{aspect-ratio:5;--vot-loader-bg:no-repeat radial-gradient(farthest-side, rgba(var(--vot-onsurface-rgb,0, 0, 0), .38) 94%, transparent);background:var(--vot-loader-bg),var(--vot-loader-bg),var(--vot-loader-bg),var(--vot-loader-bg);background-size:20% 100%;height:8px;animation:.75s infinite alternate dotsSlide,1.5s infinite alternate dotsFlip}.vot-loader-progress{--vot-helper-theme:var(--vot-theme-rgb,var(--vot-primary-rgb,33, 150, 243));fill:none;stroke:rgb(var(--vot-helper-theme));stroke-width:2px;stroke-linecap:round;transform-origin:50%;transform:rotate(-90deg)}@keyframes dotsSlide{0%,10%{background-position:0 0,0 0,0 0,0 0}33%{background-position:0 0,33.3333% 0,33.3333% 0,33.3333% 0}66%{background-position:0 0,33.3333% 0,66.6667% 0,66.6667% 0}90%,to{background-position:0 0,33.3333% 0,66.6667% 0,100% 0}}@keyframes dotsFlip{0%,49.99%{transform:scale(1)}50%,to{transform:scale(-1)}}.vot-label{font-family:inherit;font-size:16px;line-height:1.5;display:block}.vot-label-text{display:inline}.vot-label-icon{vertical-align:text-bottom;cursor:help;justify-content:center;align-items:center;width:20px;height:20px;margin-left:4px;display:inline-flex}.vot-label-icon>svg{width:20px;height:20px;display:block}.vot-account{justify-content:space-between;align-items:center;gap:1rem;display:flex}.vot-account-container,.vot-account-wrapper,.vot-account-buttons{align-items:center;gap:1rem;display:flex}.vot-account-avatar{min-width:36px;max-width:36px;min-height:36px;max-height:36px;overflow:hidden}.vot-account-avatar-img{object-fit:cover;border-radius:50%;width:36px;height:36px}.vot-subtitles{--vot-subtitles-background:rgba(var(--vot-surface-rgb,46, 47, 52), var(--vot-subtitles-opacity,.8));max-width:var(--vot-subtitles-max-width,70vw);background:var(--vot-subtitles-background,#2e2f34cc);width:max-content;color:var(--vot-subtitles-color,#e3e3e3);pointer-events:all;touch-action:none;font-size:calc(var(--vot-subtitles-font-size,clamp(18px, 2.2vw, 36px)) * var(--vot-subtitles-scale-compensation,1));text-shadow:var(--vot-subtitles-text-shadow,0 1px 2px #0009, 0 2px 8px #00000059);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-synthesis:none;position:relative;--vot-subtitles-font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;font-family:var(--vot-subtitles-font-family)!important;font-style:normal!important;font-weight:var(--vot-subtitles-font-weight,500)!important;text-transform:none!important;letter-spacing:normal!important;border-radius:.5em!important;padding:.5em .75em!important;line-height:1.25!important}.vot-subtitles,.vot-subtitles *{font-family:var(--vot-subtitles-font-family)!important}.vot-subtitles{box-sizing:border-box;-webkit-user-select:none;user-select:none;contain:layout paint;isolation:isolate;text-align:center;margin:0 auto;display:block}.vot-subtitles.vot-subtitles--multiline{text-align:center}.vot-subtitles{text-wrap:wrap;white-space:normal;overflow-wrap:break-word}.vot-subtitles-widget{box-sizing:border-box;z-index:2147483647;--vot-subtitles-fallback-bottom-inset: calc(env(safe-area-inset-bottom,0px) + clamp(56px, 10vh, 220px) + 10px) ;left:50%;top:calc(100% - var(--vot-subtitles-fallback-bottom-inset));width:max-content;max-width:var(--vot-subtitles-max-width,70vw);pointer-events:none;will-change:left,top,transform;max-height:100%;display:block;position:absolute;transform:translate(-50%,-100%)}.vot-subtitles-info{flex-direction:column;gap:2px;display:flex;padding:6px!important}.vot-subtitles-info-service{color:var(--vot-subtitles-context-color,#86919b);margin-bottom:8px!important;font-size:10px!important;line-height:1!important}.vot-subtitles-info-header{color:var(--vot-subtitles-header-color,#fff);margin-bottom:6px!important;font-size:20px!important;font-weight:500!important;line-height:1!important}.vot-subtitles-info-context{color:var(--vot-subtitles-context-color,#86919b);font-size:12px!important;line-height:1.2!important}.vot-subtitles span{cursor:pointer;white-space:normal;overflow-wrap:inherit;word-break:normal;position:relative;font-size:inherit!important;font-family:inherit!important;font-style:inherit!important;font-weight:inherit!important;line-height:inherit!important;text-transform:inherit!important;text-decoration:none!important}.vot-subtitles span.passed{color:var(--vot-subtitles-passed-color,#2196f3)}.vot-subtitles span:before{content:"";z-index:-1;width:100%;height:100%;position:absolute;inset:2px -2px;border-radius:4px!important;padding:0 2px!important}.vot-subtitles span:hover:before{background:var(--vot-subtitles-hover-color,#ffffff8c)}.vot-subtitles span.selected:before{background:var(--vot-subtitles-passed-color,#2196f3)}:-webkit-any(:-webkit-full-screen .vot-subtitles,:-webkit-full-screen .vot-subtitles){max-width:var(--vot-subtitles-max-width,80vw);font-size:calc(var(--vot-subtitles-font-size,clamp(18px, 2vw, 34px)) * var(--vot-subtitles-fullscreen-scale,1) * .95 * var(--vot-subtitles-scale-compensation,1))}:is(:fullscreen .vot-subtitles){max-width:var(--vot-subtitles-max-width,80vw);font-size:calc(var(--vot-subtitles-font-size,clamp(18px, 2vw, 34px)) * var(--vot-subtitles-fullscreen-scale,1) * .95 * var(--vot-subtitles-scale-compensation,1))}#vot-subtitles-info.vot-subtitles-info *{-webkit-user-select:text!important;user-select:text!important}:root{--vot-font-family:"Roboto", "Segoe UI", system-ui, sans-serif;--vot-primary-rgb:139, 180, 245;--vot-onprimary-rgb:32, 33, 36;--vot-surface-rgb:32, 33, 36;--vot-onsurface-rgb:227, 227, 227;--vot-subtitles-color:rgb(var(--vot-onsurface-rgb,227, 227, 227));--vot-subtitles-passed-color:rgb(var(--vot-primary-rgb,33, 150, 243));--vot-space-1:4px;--vot-space-2:8px;--vot-space-3:12px;--vot-space-4:16px;--vot-space-5:20px;--vot-space-6:24px;--vot-radius-xs:6px;--vot-radius-s:10px;--vot-radius-m:14px;--vot-radius-l:18px;--vot-border-color:rgba(var(--vot-onsurface-rgb,227, 227, 227), .14);--vot-border-color-hover:rgba(var(--vot-onsurface-rgb,227, 227, 227), .22);--vot-shadow-1:0 1px 2px #0000002e, 0 8px 24px #00000024;--vot-shadow-2:0 2px 4px #00000038, 0 12px 32px #00000038;--vot-duration-fast:.12s;--vot-duration-medium:.2s;--vot-duration-slow:.32s;--vot-easing-standard:cubic-bezier(.4, 0, .2, 1);--vot-focus-ring-color:rgba(var(--vot-primary-rgb,139, 180, 245), .9);--vot-focus-ring:0 0 0 2px var(--vot-focus-ring-color);--vot-focus-ring-offset:0 0 0 4px rgba(var(--vot-surface-rgb,32, 33, 36), .9)}vot-block,vot-block *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}vot-block[hidden]:not(.vot-menu):not(.vot-dialog-container),vot-block [hidden]:not(.vot-menu):not(.vot-dialog-container){display:none!important}vot-block{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizelegibility;-moz-text-size-adjust:100%;text-size-adjust:100%;display:block;--vot-font-family:"Roboto", "Segoe UI", system-ui, sans-serif!important;font-family:var(--vot-font-family,"Roboto", "Segoe UI", system-ui, sans-serif)!important;visibility:visible!important}.vot-portal-local,.vot-subtitles-widget{isolation:isolate}vot-block:focus,vot-block :focus{box-shadow:none!important;outline:none!important}html.vot-keyboard-nav vot-block:focus-visible,html.vot-keyboard-nav vot-block :focus-visible{box-shadow:var(--vot-focus-ring),var(--vot-focus-ring-offset)!important}@supports not selector(:focus-visible){html.vot-keyboard-nav vot-block:focus,html.vot-keyboard-nav vot-block :focus{box-shadow:var(--vot-focus-ring),var(--vot-focus-ring-offset)!important}}@media(prefers-reduced-motion:reduce){.vot-portal-local *,.vot-portal *,.vot-subtitles-widget *{scroll-behavior:auto!important;transition-duration:.001ms!important;animation-duration:.001ms!important;animation-iteration-count:1!important}}.vot-portal{display:inline}.vot-portal-local{z-index:2147483647;position:fixed;top:0;left:0}';Ks(dp);function up(){if(globalThis.__votKeyboardNavInitialized)return;globalThis.__votKeyboardNavInitialized=true;const n=document.documentElement,t="vot-keyboard-nav",e=()=>n.classList.add(t),i=()=>n.classList.remove(t);globalThis.addEventListener("keydown",o=>{o.key==="Tab"&&e();},true);for(const o of ["pointerdown","mousedown","touchstart"])globalThis.addEventListener(o,i,{capture:true,passive:true});}up();const k={makeButtonLike(n,{ariaLabel:t}={}){n.setAttribute("role","button"),n.hasAttribute("tabindex")||(n.tabIndex=0);const e=n.tabIndex,i=()=>{n.getAttribute("disabled")==="true"?(n.setAttribute("aria-disabled","true"),n.tabIndex=-1):(n.removeAttribute("aria-disabled"),n.tabIndex=e);};return i(),new MutationObserver(()=>i()).observe(n,{attributes:true,attributeFilter:["disabled"]}),t&&n.setAttribute("aria-label",t),n.addEventListener("keydown",o=>{n.getAttribute("disabled")==="true"||n.getAttribute("aria-disabled")==="true"||(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),n.click());}),n},createEl(n,t=[],e=null){const i=document.createElement(n);return t.length&&i.classList.add(...t),e!==null&&i.append(e),i},createHeader(n,t=4){return k.createEl("vot-block",["vot-header",`vot-header-level-${t}`],n)},createInformation(n,t){const e=k.createEl("vot-block",["vot-info"]),i=k.createEl("vot-block");et(n,i);const o=k.createEl("vot-block");return et(t,o),e.append(i,o),{container:e,header:i,value:o}},createButton(n){const t=k.createEl("vot-block",["vot-button"],n);return k.makeButtonLike(t)},createTextButton(n){const t=k.createEl("vot-block",["vot-text-button"],n);return k.makeButtonLike(t)},createOutlinedButton(n){const t=k.createEl("vot-block",["vot-outlined-button"],n);return k.makeButtonLike(t)},createIconButton(n,t={}){const e=k.createEl("vot-block",["vot-icon-button"]);return et(n,e),k.makeButtonLike(e,t)},createInlineLoader(){return k.createEl("vot-block",["vot-inline-loader"])},createPortal(n=false){return k.createEl("vot-block",[`vot-portal${n?"-local":""}`])},createSubtitleInfo(n,t,e){const i=k.createEl("vot-block",["vot-subtitles-info"]);i.id="vot-subtitles-info";const o=k.createEl("vot-block",["vot-subtitles-info-service"],g.get("VOTTranslatedBy").replace("{0}",e)),r=k.createEl("vot-block",["vot-subtitles-info-header"],n),s=k.createEl("vot-block",["vot-subtitles-info-context"],t);return i.append(o,r,s),{container:i,translatedWith:o,header:r,context:s}}},hp=["left","top","right","bottom"],fp=["hover","click"];function It(n,t,e){n[t].addListener(e);}function Et(n,t,e){n[t].removeListener(e);}function it(n,t){n.hidden=t;}function at(n){return n.hidden}class Y{showed=false;target;anchor;content;position;preferredPosition;trigger;parentElement;layoutRoot;offsetX;offsetY;_hidden;autoLayout;pageWidth;pageHeight;globalOffsetX;globalOffsetY;maxWidth;backgroundColor;borderRadius;_bordered;container;onResizeObserver;intersectionObserver;scrollListening=false;positionRafId=null;destroyFallbackTimerId;static DESTROY_FALLBACK_MS=700;tooltipId=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`vot-tooltip-${Math.random().toString(36).slice(2)}`;prevAriaDescribedBy=null;constructor({target:t,anchor:e=void 0,content:i="",position:o="top",trigger:r="hover",offset:s=4,maxWidth:a=void 0,hidden:l=false,autoLayout:c=true,backgroundColor:d=void 0,borderRadius:u=void 0,bordered:h=true,parentElement:f=document.body,layoutRoot:v=document.documentElement}){if(!(t instanceof HTMLElement))throw new TypeError("target must be a valid HTMLElement");this.target=t,this.anchor=e instanceof HTMLElement?e:t,this.content=i,typeof s=="number"?this.offsetY=this.offsetX=s:(this.offsetX=s.x,this.offsetY=s.y),this._hidden=l,this.autoLayout=c,this.trigger=Y.validateTrigger(r)?r:"hover",this.position=Y.validatePos(o)?o:"top",this.preferredPosition=this.position,this.parentElement=f,this.layoutRoot=v,this.borderRadius=u,this._bordered=h,this.maxWidth=a,this.backgroundColor=d,this.updatePageSize(),this.init();}static validatePos(t){return hp.includes(t)}static validateTrigger(t){return fp.includes(t)}setPosition(t){return this.preferredPosition=Y.validatePos(t)?t:"top",this.position=this.preferredPosition,this.schedulePositionUpdate(),this}setContent(t){return this.content=t,this.container?(this.container.replaceChildren(),typeof t=="string"?this.container.textContent=t:this.container.append(t),this.schedulePositionUpdate(),this):this}updateMount({parentElement:t,layoutRoot:e}){return t&&this.parentElement!==t&&(this.parentElement=t,this.container?.isConnected&&t.appendChild(this.container)),e&&this.layoutRoot!==e&&(this.layoutRoot=e),this.schedulePositionUpdate(),this}onResize=()=>{this.schedulePositionUpdate();};onClick=()=>{this.showed?this.destroy():this.create();};onScroll=()=>{this.schedulePositionUpdate();};onHoverPointerDown=t=>{t.pointerType!=="mouse"&&this.create();};onHoverPointerUp=t=>{t.pointerType!=="mouse"&&this.destroy();};onMouseEnter=()=>{this.create();};onMouseLeave=()=>{this.destroy();};updatePageSize(){if(this.layoutRoot===document.documentElement)this.globalOffsetX=0,this.globalOffsetY=0;else {const{left:t,top:e}=this.parentElement.getBoundingClientRect();this.globalOffsetX=t,this.globalOffsetY=e;}return this.pageWidth=(this.layoutRoot.clientWidth||document.documentElement.clientWidth)+(globalThis.scrollX??globalThis.pageXOffset??0),this.pageHeight=(this.layoutRoot.clientHeight||document.documentElement.clientHeight)+(globalThis.scrollY??globalThis.pageYOffset??0),this}onIntersect=([t])=>{if(!t.isIntersecting)return this.destroy(true)};init(){return this.onResizeObserver=new ResizeObserver(this.onResize),this.intersectionObserver=new IntersectionObserver(this.onIntersect),this.trigger==="click"?(this.target.addEventListener("pointerdown",this.onClick),this):(this.target.addEventListener("mouseenter",this.onMouseEnter),this.target.addEventListener("mouseleave",this.onMouseLeave),this.target.addEventListener("focusin",this.onMouseEnter),this.target.addEventListener("focusout",this.onMouseLeave),this.target.addEventListener("pointerdown",this.onHoverPointerDown),this.target.addEventListener("pointerup",this.onHoverPointerUp),this)}release(){return this.destroy(),this.detachScrollListener(),this.trigger==="click"?(this.target.removeEventListener("pointerdown",this.onClick),this):(this.target.removeEventListener("mouseenter",this.onMouseEnter),this.target.removeEventListener("mouseleave",this.onMouseLeave),this.target.removeEventListener("focusin",this.onMouseEnter),this.target.removeEventListener("focusout",this.onMouseLeave),this.target.removeEventListener("pointerdown",this.onHoverPointerDown),this.target.removeEventListener("pointerup",this.onHoverPointerUp),this)}schedulePositionUpdate(){this.positionRafId===null&&(this.positionRafId=requestAnimationFrame(()=>{this.positionRafId=null,this.updatePageSize(),this.updatePos();}));}cancelPositionUpdate(){this.positionRafId!==null&&(cancelAnimationFrame(this.positionRafId),this.positionRafId=null);}clearDestroyFallbackTimer(){this.destroyFallbackTimerId!==void 0&&(globalThis.clearTimeout(this.destroyFallbackTimerId),this.destroyFallbackTimerId=void 0);}create(){return this.destroy(true),this.showed=true,this.clearDestroyFallbackTimer(),this.container=k.createEl("vot-block",["vot-tooltip"],this.content),this.bordered&&this.container.classList.add("vot-tooltip-bordered"),this.container.setAttribute("role","tooltip"),this.container.id=this.tooltipId,this.container.dataset.trigger=this.trigger,this.container.dataset.position=this.position,this.parentElement.appendChild(this.container),this.schedulePositionUpdate(),this.backgroundColor!==void 0&&(this.container.style.backgroundColor=this.backgroundColor),this.borderRadius!==void 0&&(this.container.style.borderRadius=`${this.borderRadius}px`),this.hidden?this.container.hidden=true:this.syncAriaDescribedBy(true),this.container.style.opacity="1",this.attachScrollListener(),this.onResizeObserver?.observe(this.layoutRoot),this.onResizeObserver?.observe(this.anchor),this.intersectionObserver?.observe(this.target),this}updatePos(){if(!this.container)return this;const{top:t,left:e}=this.calcPos(this.autoLayout,this.preferredPosition),i=this.pageWidth-this.offsetX*2,o=this.maxWidth??Math.min(i,this.pageWidth-Math.min(e,this.pageWidth-i));return this.container.style.transform=`translate(${e}px, ${t}px)`,this.container.dataset.position=this.position,this.container.style.maxWidth=`${o}px`,this}calcPos(t=true,e=this.preferredPosition){if(!this.container)return {top:0,left:0};const{left:i,right:o,top:r,bottom:s,width:a,height:l}=this.anchor.getBoundingClientRect(),{width:c,height:d}=this.container.getBoundingClientRect(),u=$(c,0,this.pageWidth),h=$(d,0,this.pageHeight),f=i-this.globalOffsetX,v=o-this.globalOffsetX,b=r-this.globalOffsetY,y=s-this.globalOffsetY;let x;switch(e){case "top":{const w=$(b-h-this.offsetY,0,this.pageHeight);if(t&&w+this.offsetY<h)return this.calcPos(false,"bottom");x={top:w,left:$(f-u/2+a/2,this.offsetX,this.pageWidth-u-this.offsetX)};break}case "right":{const w=$(v+this.offsetX,0,this.pageWidth-u);if(t&&w+u>this.pageWidth-this.offsetX)return this.calcPos(false,"left");x={top:$(b+(l-h)/2,this.offsetY,this.pageHeight-h-this.offsetY),left:w};break}case "bottom":{const w=$(y+this.offsetY,0,this.pageHeight-h);if(t&&w+h>this.pageHeight-this.offsetY)return this.calcPos(false,"top");x={top:w,left:$(f-u/2+a/2,this.offsetX,this.pageWidth-u-this.offsetX)};break}case "left":{const w=Math.max(0,f-u-this.offsetX);if(t&&w+u>f-this.offsetX)return this.calcPos(false,"right");x={top:$(b+(l-h)/2,this.offsetY,this.pageHeight-h-this.offsetY),left:w};break}default:x={top:0,left:0};break}return this.position=e,x}destroy(t=false){if(!this.container)return this;if(this.cancelPositionUpdate(),this.clearDestroyFallbackTimer(),this.showed=false,this.syncAriaDescribedBy(false),this.onResizeObserver?.disconnect(),this.intersectionObserver?.disconnect(),this.detachScrollListener(),t)return this.container.remove(),this.container=void 0,this;const e=this.container;e.style.pointerEvents="none",e.style.opacity="0";const i=()=>{this.clearDestroyFallbackTimer(),e?.remove(),this.container===e&&(this.container=void 0);};return e.addEventListener("transitionend",i,{once:true}),e.addEventListener("transitioncancel",i,{once:true}),this.destroyFallbackTimerId=globalThis.setTimeout(i,Y.DESTROY_FALLBACK_MS),this}syncAriaDescribedBy(t){const e=this.target.getAttribute("aria-describedby");if(this.prevAriaDescribedBy??=e,!t){this.prevAriaDescribedBy===null?this.target.removeAttribute("aria-describedby"):this.target.setAttribute("aria-describedby",this.prevAriaDescribedBy),this.prevAriaDescribedBy=null;return}const i=new Set((e??"").split(/\s+/).filter(Boolean));i.add(this.tooltipId),this.target.setAttribute("aria-describedby",Array.from(i).join(" "));}set bordered(t){this._bordered=t,this.container?.classList.toggle("vot-tooltip-bordered",t);}get bordered(){return this._bordered}set hidden(t){this._hidden=t,this.container&&it(this.container,t),this.showed&&this.syncAriaDescribedBy(!t);}get hidden(){return this._hidden}attachScrollListener(){this.scrollListening||(this.scrollListening=true,document.addEventListener("scroll",this.onScroll,{passive:true,capture:true}));}detachScrollListener(){this.scrollListening&&(this.scrollListening=false,document.removeEventListener("scroll",this.onScroll,{capture:true}));}}function pp(n,t){return n>=t.startMs&&n<t.startMs+t.durationMs}function gp(n,t){let e=0,i=t.length-1;for(;e<=i;){const o=e+i>>1,r=t[o];if(n<r.startMs)i=o-1;else if(n>=r.startMs+r.durationMs)e=o+1;else return o}return  -1}function mp(n,t,e=0){return `${n}:${t}:${e}`}function Vt(n,t,e){return Math.max(t,Math.min(n,e))}function vp(n,t,e,i,o){const r=e-n,s=i-t;return r*r+s*s>=o*o}function bp({anchorX:n,anchorY:t,elementWidth:e,elementHeight:i,boxWidth:o,boxHeight:r,bottomInset:s}){let a=n,l=t;const c=Math.max(0,r-s),d=i||0;if(e){let u=a-e/2;const h=o-e;h>=0?u=Vt(u,0,h):u=h/2,a=u+e/2;}return l=Vt(l,d,c),{anchorX:a,anchorY:l}}const ws=.55;function An(n,t,e){return Number.isNaN(n)?t:Math.min(e,Math.max(t,n))}function ks(n){return n<1?28:n<1.4?32:42}function Ss(n){return !Number.isFinite(n)||n<=0?.9:n>=1.4?.68:n>=1.2?.9:.92}function yp(n){const t=Math.max(1,n.w),e=Math.max(1,n.h),i=t/e,o=Ss(i),r=t*o,s=ks(i),l=36/1080,d=i<1?l*.89:l,u=18,h=50,f=1080,v=f*d,y=e<=f?e*d:v*(e/f)**.35,x=r/(s*ws),w=Math.round(Math.min(y,x));return An(w,u,h)}function wp(n){const t=Math.max(1,n.w),e=Math.max(1,n.h),i=t/e,o=yp(n),r=Ss(i),s=t*r,a=ks(i),l=o*ws,c=a*l,d=t*(i<1?.8:.55),u=An(c,d,s),h=u/l,f=An(Math.round(h*2),50,180);return {fontSizePx:o,maxWidthPx:u,maxLength:f}}const xs=n=>!!(n?.isWordLike&&n.text?.trim()),ke=(n,t,e)=>Math.min(e,Math.max(t,n)),Mo=n=>{const t=new Array(n.length+1).fill(0);for(let e=0;e<n.length;e+=1)t[e+1]=t[e]+n[e];return t},Ts=(n,t,e)=>e<t?0:n[e+1]-n[t],kp=/[.!?\u2026]+(?:["'`)\]}\u00BB\u201D\u2019]+)?$/u;function Sp(n,t){let e=t,i=t+1,o=false;for(;i<n.length;){const r=n[i];if(!r||xs(r))break;if(!r.text.trim()){if(o)break;i+=1;continue}e=i,o=true,i+=1;}return e}function xp(n){const t=[];for(let r=0;r<n.length;r+=1)xs(n[r])&&t.push(r);const e=[];for(let r=0;r<t.length;r+=1){const s=t[r],a=r+1<t.length?t[r+1]:n.length,l=Sp(n,s),c=ke(l,s,a-1);let d="";for(let h=s;h<a;h+=1)d+=n[h]?.text??"";let u="";for(let h=c+1;h<a;h+=1)u+=n[h]?.text??"";e.push({tokenIndex:s,breakAfterTokenIndex:c,textToNextWord:d,trailingGapAfterBreakText:u});}const i=[];for(const r of e)i.push(`${r.textToNextWord}${r.trailingGapAfterBreakText}${r.breakAfterTokenIndex}`);const o=i.join("");return {slices:e,key:o}}function Tp(n,t){const e=n.map(s=>t(s.textToNextWord)),i=n.map(s=>s.textToNextWord.length),o=n.map(s=>t(s.trailingGapAfterBreakText)),r=n.map(s=>s.trailingGapAfterBreakText.length);return {widths:e,chars:i,trailingGapWidths:o,trailingGapChars:r,prefixWidths:Mo(e),prefixChars:Mo(i)}}function At(n,t,e){if(e<t||!n.widths.length)return 0;const i=ke(t,0,n.widths.length-1),o=ke(e,0,n.widths.length-1);return o<i?0:Ts(n.prefixWidths,i,o)-(n.trailingGapWidths[o]??0)}function Ap(n,t,e){if(e<t||!n.chars.length)return 0;const i=ke(t,0,n.chars.length-1),o=ke(e,0,n.chars.length-1);return o<i?0:Ts(n.prefixChars,i,o)-(n.trailingGapChars[o]??0)}function As(n,t,e,i){if(e<t)return  true;if(i<=0)return  false;if(At(n,t,e)<=i)return  true;for(let o=t;o<e;o+=1){const r=At(n,t,o),s=At(n,o+1,e);if(r<=i&&s<=i)return  true}return  false}const Lp=(n,t,e,i,o,r)=>{const a=[n,t],l=(n+t)/2;let c=0;for(const y of a){const x=e-y;if(x>=0)c+=x*x;else {const w=-x;c+=w*w*1e4;}}let d=0;for(const y of a){const x=y-l;d+=x*x;}const h=r>=4&&(i<=1||o<=1)?1e9:0,v=r>=6&&(i<=2||o<=2)?2e7:0;let b=c+d+h+v;return n>t&&(b+=(n-t)/Math.max(1,e)*.15),b};function Ls(n,t,e,i){if(i<=0||e<=t)return null;let o=null,r=Number.POSITIVE_INFINITY;const s=e-t+1;for(let a=t;a<e;a+=1){const l=At(n,t,a),c=At(n,a+1,e);if(l>i||c>i)continue;const d=a-t+1,u=e-a,h=Lp(l,c,i,d,u,s);h<r&&(r=h,o=a);}return o}function Is(n,t){const e=n.widths.length;if(e<=1)return [];if(At(n,0,e-1)<=t)return [];const i=Ls(n,0,e-1,t);return i===null?[]:[i]}function Ip(n,t){const e=n.widths.length;if(e<=0)return null;for(let i=e-1;i>=0;i-=1)if(As(n,0,i,t))return i;return null}function Ep(n,t){if(t<=0)return {breakAfterWordIndices:[],truncateAfterWordIndex:null};const e=n.widths.length;if(e<=1)return {breakAfterWordIndices:[],truncateAfterWordIndex:null};if(At(n,0,e-1)<=t)return {breakAfterWordIndices:[],truncateAfterWordIndex:null};const o=Is(n,t);if(o.length)return {breakAfterWordIndices:o,truncateAfterWordIndex:null};const s=Ip(n,t)??0;if(s>=e-1)return {breakAfterWordIndices:[],truncateAfterWordIndex:null};const a=Ls(n,0,s,t);return {breakAfterWordIndices:a===null?[]:[a],truncateAfterWordIndex:s}}const Kn=n=>n.endWord-n.startWord+1,Pp=(n,t)=>{const e=[];let i=0;for(;i<n;){let o=i;for(;o+1<n&&t(i,o+1);)o+=1;e.push({startWord:i,endWord:o}),i=o+1;}return e},Cp=(n,t,e)=>{if(t<=0)return  false;const i=n[t],o=n[t-1];if(!i||!o||Kn(o)<3)return  false;const r=o.endWord,s={startWord:o.startWord,endWord:r-1},a={startWord:r,endWord:i.endWord};return !e(s.startWord,s.endWord)||!e(a.startWord,a.endWord)?false:(o.endWord=s.endWord,i.startWord=a.startWord,true)},Mp=(n,t,e)=>{if(t>=n.length-1)return  false;const i=n[t],o=n[t+1];if(!i||!o||Kn(o)<3)return  false;const r=o.startWord,s={startWord:i.startWord,endWord:r},a={startWord:r+1,endWord:o.endWord};return !e(s.startWord,s.endWord)||!e(a.startWord,a.endWord)?false:(i.endWord=s.endWord,o.startWord=a.startWord,true)},Vp=(n,t)=>{for(let e=n.length-1;e>=0;e-=1)Kn(n[e])===1&&(Cp(n,e,t)||Mp(n,e,t));},_p=(n,t,e)=>{const i=t[e];if(!i)return "";let o="";for(let r=i.tokenIndex;r<=i.breakAfterTokenIndex;r+=1)o+=n[r]?.text??"";return o.trimEnd()},Op=(n,t,e,i)=>{for(let o=0;o<n.length-1;o+=1){const r=n[o],s=n[o+1];if(!r||!s)continue;let a=-1;const l=Math.max(r.startWord,r.endWord-2);for(let v=r.endWord-1;v>=l;v-=1)if(kp.test(_p(t,e,v))){a=v;break}if(a<r.startWord)continue;const c=r.startWord,d=a;if(d-c+1<3)continue;const h=a+1,f=s.endWord;!i(c,d)||!i(h,f)||(r.endWord=d,s.startWord=h);}},Bp=(n,t,e)=>{const i=[];for(const o of n){const r=t[o.startWord],s=t[o.endWord];if(!r||!s)continue;const a=r.tokenIndex,l=s.breakAfterTokenIndex+1,c=e[a]?.startMs??0,d=e[s.tokenIndex]?.startMs??c,u=e[s.tokenIndex]?.durationMs??0,h=t[o.endWord+1],v=(h?e[h.tokenIndex]?.startMs:void 0)??d+u;i.push({startToken:a,endToken:l,startMs:c,endMs:v});}return i};function Dp(n,t,e,i,o){const r=t.length;if(r===0)return [];const s=Number.isFinite(o)&&o>0?o:null,a=(c,d)=>d<c||s!==null&&Ap(e,c,d)>s?false:As(e,c,d,i),l=Pp(r,a);return Vp(l,a),Op(l,n,t,a),Bp(l,t,n)}function Rp(n,t,e){return !n||typeof t!="number"?false:t>=0&&t<e-1}const Fp=8,Np=.97,Hp=24;function Vo(n){if(!Number.isFinite(n)||n<=0)return 0;const t=n-Fp,e=n*Np,i=Math.min(t,e);return Math.max(Hp,i)}class $p{video;container;portal;tooltipLayoutRoot;subtitlesContainer=null;subtitlesBlock=null;renderedTokenEls=[];subtitles=null;subtitleLang;lastRenderKey=null;lastActiveLineIndex=null;highlightWords=false;fontSize=20;fontSizeOverridden=false;manualMaxLength=300;smartLayoutEnabled=true;smartFontSizePx=0;smartMaxWidthPx=0;smartMaxLength=0;lastSmartLayoutKey=null;lastSmartLayoutCheckTs=0;opacity="0.2";maxLength=300;repositionPending=false;positionRefreshPending=false;updatePending=false;lastUpdateRequestTs=0;updateMinIntervalMs=100;updateMinIntervalHighlightMs=33;useVideoFrameCallbacks;videoFrameRequestId=null;dragDocListenersAttached=false;lastPositionRefreshTs=0;positionRefreshIntervalMs=250;subtitleMaxWidthPx=0;breakAfterTokenIndices=[];breakAfterTokenIndexSet=null;smartTruncateAfterTokenIndex=null;wrapPending=false;lastWrapKey=null;lastWrapTokens=null;measureCanvas=null;measureCtx=null;lastMultilineMeasureSignature=null;lastLayoutAffectingKey=null;tokenProcessingMemo=null;tokenPrecomputeMemo=null;lineMeasureMemo=null;lastSegmentIndex=0;position={left:50,top:100};dragging={pointerId:null,candidate:false,active:false,moved:false,startClientX:0,startClientY:0,offset:{x:0,y:0}};dragStartThresholdPx=4;suppressTokenClicksUntil=0;abortController=new AbortController;resizeObserver;tokenTooltip;tooltipTranslationRequestId=0;intervalIdleChecker;checkerUnsubscribe=null;edgePunctuationTrimRe=/(?:^[\p{P}\p{S}]+|[\p{P}\p{S}]+$)/gu;strTokens="";strTranslatedTokens="";normalizeTokenTextForTranslation(t){return t.trim().replace(this.edgePunctuationTrimRe,"")}bottomInsetCachedPx=0;bottomInsetByMode={normal:{ratio:.1,minPx:56,maxPx:220,gapPx:10},fullscreen:{ratio:.07,minPx:44,maxPx:140,gapPx:9}};safeAreaProbeEl=null;onPointerDownBound;onPointerUpBound;onPointerMoveBound;onTimeUpdateBound;onPlaybackStateChangeBound;onVisualViewportChangeBound;constructor(t,e,i,o,r=void 0){this.video=t,this.container=e,this.portal=i,this.intervalIdleChecker=o,this.tooltipLayoutRoot=r,this.useVideoFrameCallbacks=!!this.video&&typeof this.video.requestVideoFrameCallback=="function",this.onPointerDownBound=s=>this.onPointerDown(s),this.onPointerUpBound=s=>this.onPointerUp(s),this.onPointerMoveBound=s=>this.onPointerMove(s),this.onTimeUpdateBound=()=>this.requestUpdate(),this.onPlaybackStateChangeBound=()=>this.handlePlaybackStateChange(),this.onVisualViewportChangeBound=()=>this.scheduleReposition(),this.checkerUnsubscribe=this.intervalIdleChecker.subscribe(()=>{this.onCheckerTick();}),this.bindEvents();}setPortal(t){this.portal=t;}resetTranslationContext(t=false){this.strTranslatedTokens="",t&&this.releaseTooltip();}resetSegmentationMemo(){this.tokenProcessingMemo=null,this.tokenPrecomputeMemo=null,this.lineMeasureMemo=null,this.lastSegmentIndex=0;}resetWrapMemo(){this.setBreakAfterTokenIndices([]),this.smartTruncateAfterTokenIndex=null,this.lastWrapKey=null;}resetRenderMemo(){this.lastRenderKey=null,this.lastMultilineMeasureSignature=null,this.lastLayoutAffectingKey=null;}computeAnchorBoxLayout(t){const e={left:0,top:0,w:t.w,h:t.h},i=this.video;if(!i)return e;const o=i.getBoundingClientRect();if(!(o.width>0&&o.height>0))return e;const r=t.rect;if(!(o.right>r.left&&o.left<r.right&&o.bottom>r.top&&o.top<r.bottom))return e;const a=o.width/t.scaleX,l=o.height/t.scaleY;if(!(a>0&&l>0))return e;const c=(o.left-r.left)/t.scaleX,d=(o.top-r.top)/t.scaleY,u=t.w-a,h=t.h-l,f=u>=0?Vt(c,0,u):(t.w-a)/2,v=h>=0?Vt(d,0,h):(t.h-l)/2;return {left:f,top:v,w:a,h:l}}ensureSmartLayout(t){if(!this.smartLayoutEnabled)return this.maxLength=this.manualMaxLength,null;const e=wp(t),i=`${Math.round(e.fontSizePx)}|${Math.round(e.maxWidthPx)}|${e.maxLength}`,o=e.fontSizePx!==this.smartFontSizePx,r=Math.abs(e.maxWidthPx-this.smartMaxWidthPx)>.5,s=e.maxLength!==this.smartMaxLength;return i!==this.lastSmartLayoutKey&&(this.lastSmartLayoutKey=i,this.smartFontSizePx=e.fontSizePx,this.smartMaxWidthPx=e.maxWidthPx,this.smartMaxLength=e.maxLength),s&&(this.maxLength=e.maxLength,this.resetRenderMemo(),this.resetSegmentationMemo()),o&&this.subtitlesBlock&&this.subtitlesBlock.style.setProperty("--vot-subtitles-font-size",`${e.fontSizePx}px`),(o||r)&&this.lastWrapTokens&&(this.lastWrapKey=null,this.scheduleWrapRecompute(),this.resetSegmentationMemo()),e}scheduleReposition(){this.abortController.signal.aborted||this.subtitles&&(this.repositionPending=true,this.intervalIdleChecker.markActivity("subtitles-reposition"),this.intervalIdleChecker.requestImmediateTick());}createSubtitlesContainer(){if(this.subtitlesContainer)return this.subtitlesContainer;getComputedStyle(this.container).position==="static"&&(this.container.style.position="relative");const t=document.createElement("vot-block");return t.classList.add("vot-subtitles-widget"),this.container.appendChild(t),this.subtitlesContainer=t,t.addEventListener("pointerdown",this.onPointerDownBound,{signal:this.abortController.signal,passive:true}),t.style.transform="translate(-50%, -100%)",this.updateContainerRect(),t}bindEvents(){const{signal:t}=this.abortController,e={signal:t};this.video?.addEventListener("play",this.onPlaybackStateChangeBound,e),this.video?.addEventListener("pause",this.onPlaybackStateChangeBound,e),this.video?.addEventListener("seeking",this.onPlaybackStateChangeBound,e),this.video?.addEventListener("seeked",this.onPlaybackStateChangeBound,e),this.video?.addEventListener("ended",this.onPlaybackStateChangeBound,e),this.resizeObserver=new ResizeObserver(()=>this.onResize()),this.resizeObserver.observe(this.container),this.video&&this.resizeObserver.observe(this.video),globalThis.visualViewport?.addEventListener("resize",this.onVisualViewportChangeBound,e),globalThis.visualViewport?.addEventListener("scroll",this.onVisualViewportChangeBound,e);}getUpdateMinIntervalMs(){return this.highlightWords?this.updateMinIntervalHighlightMs:this.updateMinIntervalMs}requestUpdate(t=performance.now()){if(this.abortController.signal.aborted||!this.subtitles)return;const e=this.getUpdateMinIntervalMs();t-this.lastUpdateRequestTs<e||(this.lastUpdateRequestTs=t,this.updatePending=true,this.intervalIdleChecker.requestImmediateTick());}handlePlaybackStateChange(){if(!this.subtitles){this.stopVideoFrameLoop();return}this.scheduleReposition(),this.requestUpdate(),this.syncVideoFrameLoop();}syncVideoFrameLoop(){if(!this.useVideoFrameCallbacks)return;const t=this.video;if(t){if(!this.subtitles||t.paused||t.ended){this.stopVideoFrameLoop();return}this.startVideoFrameLoop();}}startVideoFrameLoop(){if(!this.useVideoFrameCallbacks)return;const t=this.video;t&&this.videoFrameRequestId===null&&(this.videoFrameRequestId=t.requestVideoFrameCallback(this.onVideoFrame));}stopVideoFrameLoop(){if(!this.useVideoFrameCallbacks)return;const t=this.video;if(t&&this.videoFrameRequestId!==null){try{t.cancelVideoFrameCallback(this.videoFrameRequestId);}catch{}this.videoFrameRequestId=null;}}onVideoFrame=(t,e)=>{if(this.videoFrameRequestId=null,this.abortController.signal.aborted)return;const i=this.video;!i||i.paused||i.ended||this.subtitles&&(this.requestUpdate(t),this.startVideoFrameLoop());};onCheckerTick(){this.abortController.signal.aborted||(this.repositionPending&&(this.repositionPending=false,this.updateContainerRect(),this.updatePending=true),this.wrapPending&&(this.wrapPending=false,this.recomputeWrapNow()),this.positionRefreshPending&&(this.positionRefreshPending=false,this.applySubtitlePosition()),this.updatePending&&(this.updatePending=false,this.update()));}attachDragDocumentListeners(){this.dragDocListenersAttached||(this.dragDocListenersAttached=true,document.addEventListener("pointermove",this.onPointerMoveBound,{passive:false}),document.addEventListener("pointerup",this.onPointerUpBound),document.addEventListener("pointercancel",this.onPointerUpBound));}detachDragDocumentListeners(){this.dragDocListenersAttached&&(this.dragDocListenersAttached=false,document.removeEventListener("pointermove",this.onPointerMoveBound),document.removeEventListener("pointerup",this.onPointerUpBound),document.removeEventListener("pointercancel",this.onPointerUpBound));}onResize(){this.scheduleReposition();}updateContainerRect(){const t=this.getLayoutSize();if(!t.w||!t.h)return;const e=this.computeAnchorBoxLayout(t);!e.w||!e.h||(this.refreshBottomInsetNow(t,e),this.applySubtitlePositionWithLayout(t,e));}getLayoutSize(){const t=this.container.getBoundingClientRect(),e=this.container.clientWidth||t.width,i=this.container.clientHeight||t.height,o=t.width&&e?t.width/e:1,r=t.height&&i?t.height/i:1;return {w:e,h:i,rect:t,scaleX:o,scaleY:r}}ensureSafeAreaProbe(){if(this.safeAreaProbeEl)return;const t=document.createElement("div");t.style.position="fixed",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.height="env(safe-area-inset-bottom, 0px)",t.style.pointerEvents="none",t.style.opacity="0",t.style.zIndex="-1",document.documentElement.appendChild(t),this.safeAreaProbeEl=t;}getSafeAreaBottomInsetPx(){return this.ensureSafeAreaProbe(),this.safeAreaProbeEl&&this.safeAreaProbeEl.offsetHeight||0}getBottomInsetPreset(){const t=document,e=t.fullscreenElement??t.webkitFullscreenElement;if(!(e instanceof Element))return this.bottomInsetByMode.normal;const{container:i,video:o}=this;return e===i||e.contains(i)||i.contains(e)?this.bottomInsetByMode.fullscreen:o&&(e===o||e.contains(o)||o.contains(e))?this.bottomInsetByMode.fullscreen:this.bottomInsetByMode.normal}computeReservedBottomInsetPx(t,e=this.getBottomInsetPreset()){const i=t*e.ratio;return Vt(i,e.minPx,e.maxPx)}refreshBottomInsetNow(t,e){const i=e?.h??this.computeAnchorBoxLayout(t??this.getLayoutSize()).h;if(!i){this.bottomInsetCachedPx=0;return}const o=this.getBottomInsetPreset();this.bottomInsetCachedPx=this.computeReservedBottomInsetPx(i,o);}getBottomInsetPx(t,e){const i=this.getBottomInsetPreset(),o=this.getSafeAreaBottomInsetPx(),r=Number.parseFloat(getComputedStyle(this.container).paddingBottom||"0")||0,s=e?.h??this.computeAnchorBoxLayout(t??this.getLayoutSize()).h,a=s?this.computeReservedBottomInsetPx(s,i):i.minPx,l=Math.max(this.bottomInsetCachedPx,a);return Math.max(r,o,l)+i.gapPx}onPointerDown(t){const e=this.subtitlesContainer;if(!e)return;const i=t.target;if(!(i instanceof Node)||!e.contains(i)||!t.isPrimary||t.pointerType==="mouse"&&t.button!==0)return;const o=this.getLayoutSize(),{rect:r,w:s,h:a,scaleX:l,scaleY:c}=o;if(!s||!a)return;const d=this.computeAnchorBoxLayout(o);if(!d.w||!d.h)return;this.lastPositionRefreshTs=performance.now();const u=e.getBoundingClientRect(),h=(t.clientX-r.left)/l-d.left,f=(t.clientY-r.top)/c-d.top,v=(u.left-r.left+u.width/2)/l-d.left,b=(u.top-r.top+u.height)/c-d.top;this.dragging.pointerId=t.pointerId,this.dragging.candidate=true,this.dragging.active=false,this.dragging.moved=false,this.dragging.startClientX=t.clientX,this.dragging.startClientY=t.clientY,this.dragging.offset.x=v-h,this.dragging.offset.y=b-f,this.attachDragDocumentListeners();const y=this.subtitlesBlock??(i instanceof Element?i:null);try{y?.setPointerCapture(t.pointerId);}catch{}}onPointerUp(t){this.dragging.pointerId!==null&&t.pointerId===this.dragging.pointerId&&(this.dragging.moved&&(this.suppressTokenClicksUntil=performance.now()+450),this.dragging.pointerId=null,this.dragging.candidate=false,this.dragging.active=false,this.dragging.moved=false,this.detachDragDocumentListeners());}onPointerMove(t){if(!this.dragging.candidate||this.dragging.pointerId===null||t.pointerId!==this.dragging.pointerId)return;if(this.dragging.active)this.dragging.moved=true;else {if(!vp(this.dragging.startClientX,this.dragging.startClientY,t.clientX,t.clientY,this.dragStartThresholdPx))return;this.dragging.active=true,this.dragging.moved=true,this.suppressTokenClicksUntil=performance.now()+450,this.releaseTooltip();}t.preventDefault(),t.stopPropagation();const e=this.getLayoutSize(),{rect:i,w:o,h:r,scaleX:s,scaleY:a}=e;if(!o||!r)return;const l=this.computeAnchorBoxLayout(e);if(!l.w||!l.h)return;const c=(t.clientX-i.left)/s-l.left,d=(t.clientY-i.top)/a-l.top;let u=c+this.dragging.offset.x,h=d+this.dragging.offset.y;const f=this.subtitlesContainer?.offsetWidth??0,v=this.subtitlesContainer?.offsetHeight??0,b=this.getBottomInsetPx(e,l);(({anchorX:u,anchorY:h}=bp({anchorX:u,anchorY:h,elementWidth:f,elementHeight:v,boxWidth:l.w,boxHeight:l.h,bottomInset:b}))),this.position.left=u/l.w*100,this.position.top=h/l.h*100,this.applySubtitlePositionWithLayout(e,l);}applySubtitlePosition(){if(!this.subtitlesContainer)return;const e=this.getLayoutSize();if(!e.w||!e.h)return;const i=this.computeAnchorBoxLayout(e);!i.w||!i.h||this.applySubtitlePositionWithLayout(e,i);}applySubtitlePositionWithLayout(t,e){const i=this.subtitlesContainer;if(!i)return;const o=Math.min(t.scaleX||1,t.scaleY||1),r=o>0&&o<.999?Math.min(1/o,3):1;Math.abs(r-1)<.001?i.style.removeProperty("--vot-subtitles-scale-compensation"):i.style.setProperty("--vot-subtitles-scale-compensation",r.toFixed(3));let s=0;if(this.smartLayoutEnabled){const D=this.ensureSmartLayout(e);s=D?Math.max(0,D.maxWidthPx):Math.max(0,e.w*.7);}else s=Math.max(0,e.w*.7);Math.abs(s-this.subtitleMaxWidthPx)>.5&&(this.subtitleMaxWidthPx=s,i.style.setProperty("--vot-subtitles-max-width",`${Math.round(s)}px`),this.resetSegmentationMemo(),this.scheduleWrapRecompute());const a=i.offsetWidth,l=i.offsetHeight,c=this.getBottomInsetPx(t,e);let d=this.position.left/100*e.w,u=this.position.top/100*e.h,h=d-a/2,f=u-l;const v=e.w-a,b=e.h-c-l;v>=0?h=Vt(h,0,v):h=v/2,b>=0?f=Vt(f,0,b):f=0,d=h+a/2,u=f+l;const y=e.left+d,x=e.top+u,w=y/t.w*100,L=x/t.h*100;i.style.left=`${w}%`,i.style.top=`${L}%`,i.style.transform="translate(-50%, -100%)",this.tokenTooltip?.updatePos();}applyPositionAfterContentRender(){const t=this.getLayoutSize();if(t.w&&t.h){const e=this.computeAnchorBoxLayout(t);if(e.w&&e.h){this.refreshBottomInsetNow(t,e),this.applySubtitlePositionWithLayout(t,e);return}this.refreshBottomInsetNow(t),this.applySubtitlePosition();return}this.refreshBottomInsetNow(),this.applySubtitlePosition();}trimEdgeWhitespaceTokens(t){if(!t.length)return t;let e=0,i=t.length;for(;e<i&&!t[e]?.text.trim();)e+=1;for(;i>e&&!t[i-1]?.text.trim();)i-=1;return e===0&&i===t.length?t:e>=i?[]:t.slice(e,i)}splitRangesByMaxLength(t){const e=[];let i=0,o=0;for(const[r,s]of t.entries())o+=s.text.length,o>this.maxLength&&r>i&&(e.push([i,r]),i=r,o=s.text.length);return i<t.length&&e.push([i,t.length]),e}pickRangeByTime(t,e,i){let o=e[0]??[0,t.length];for(const r of e){const s=t[r[0]],a=t[r[1]-1];if(!s||!a)continue;const c=(r[1]<t.length?t[r[1]].startMs:void 0)??a.startMs+(a.durationMs??0);if(s.startMs<=i&&i<c){o=r;break}}return o}selectTokensByMaxLength(t,e){if(!t.length)return t;let i=0;for(const s of t)i+=s?.text.length??0;if(i<=this.maxLength)return this.trimEdgeWhitespaceTokens(t);const o=this.splitRangesByMaxLength(t),r=this.pickRangeByTime(t,o,e);return this.trimEdgeWhitespaceTokens(t.slice(r[0],r[1]))}computeTwoLineSegments(t,e,i,o,r){return Dp(t,e,i,o,r)}buildTokenPrecomputeInput(t){const e=this.tokenPrecomputeMemo;if(e?.tokens===t)return e.value;const{slices:i,key:o}=xp(t),s={words:i.map(a=>({tokenIndex:a.tokenIndex,breakAfterTokenIndex:a.breakAfterTokenIndex})),wordSlices:i,normalizedWordsKey:o};return this.tokenPrecomputeMemo={tokens:t,value:s},s}getTokenLayoutInputs(t){const e=this.subtitlesBlock;if(e){const c=getComputedStyle(e),d=`${c.fontStyle} ${c.fontVariant} ${c.fontWeight} ${c.fontSize} ${c.fontFamily}`;t.font=d;const u=Number.parseFloat(c.maxWidth),h=Number.parseFloat(c.paddingLeft)||0,f=Number.parseFloat(c.paddingRight)||0,v=Number.isFinite(u)?u:this.subtitleMaxWidthPx||globalThis.innerWidth*.8;return {fontKey:d,maxWidthPx:Math.max(0,v-h-f)}}const i=Number.parseFloat(getComputedStyle(document.documentElement).fontSize)||16,s=Math.min(i*52,this.subtitleMaxWidthPx||globalThis.innerWidth*.8),a=this.fontSizeOverridden?this.fontSize:Math.min(24,Math.max(14,globalThis.innerWidth*.016)),l=`normal normal 500 ${a}px Roboto, "Segoe UI", system-ui, sans-serif`;return t.font=l,{fontKey:l,maxWidthPx:Math.max(0,s-a)}}getActiveLineKey(t){return this.lastActiveLineIndex!==null?`${this.lastActiveLineIndex}`:`${t[0]?.startMs??0}:${t[0]?.durationMs??0}:${t.length}`}getLineMeasureMemo(t,e){const{words:i,wordSlices:o,normalizedWordsKey:r}=this.buildTokenPrecomputeInput(t);if(!i.length)return null;const s=this.getMeasureContext();if(!s)return null;const{fontKey:a,maxWidthPx:l}=this.getTokenLayoutInputs(s);if(!Number.isFinite(l)||l<24)return null;const c=`${e}|${a}|${Math.round(l)}|${r}`;if(this.lineMeasureMemo?.key===c)return this.lineMeasureMemo;const d=Tp(o,h=>s.measureText(h).width),u={key:c,words:i,metrics:d,maxWidthPx:l};return this.lineMeasureMemo=u,u}buildTokenProcessingMemo(t,e){const i=this.getLineMeasureMemo(t,e);if(!i)return null;const o=`${i.key}|${this.maxLength}`;if(this.tokenProcessingMemo?.key===o)return this.tokenProcessingMemo;const r=Vo(i.maxWidthPx),s=this.computeTwoLineSegments(t,i.words,i.metrics,r,this.maxLength),a={key:o,segmentRanges:s};return this.tokenProcessingMemo=a,this.lastSegmentIndex=0,a}selectSegmentIndexFromRanges(t,e){if(!t.length)return  -1;let i=this.lastSegmentIndex;for(i>=t.length&&(i=0);i<t.length-1&&e>=t[i].endMs;)i+=1;for(;i>0&&e<t[i].startMs;)i-=1;if(!(e>=t[i].startMs&&e<t[i].endMs)){const o=t.findIndex(r=>e>=r.startMs&&e<r.endMs);o>=0?i=o:i=e<t[0].startMs?0:t.length-1;}return this.lastSegmentIndex=i,i}processTokens(t,e){if(!t.length)return t;const i=this.getActiveLineKey(t),o=this.buildTokenProcessingMemo(t,i);if(!o)return this.selectTokensByMaxLength(t,e);const{segmentRanges:r}=o;if(!r.length)return this.trimEdgeWhitespaceTokens(t);const s=this.selectSegmentIndexFromRanges(r,e);if(s<0)return this.trimEdgeWhitespaceTokens(t);const a=r[s];return this.trimEdgeWhitespaceTokens(t.slice(a.startToken,a.endToken))}async translateStrTokens(t){const e=this.subtitleLang??"",i=g.lang;if(this.strTranslatedTokens){const l=await Tn(t,e,i);return [this.strTranslatedTokens,typeof l=="string"?l:""]}const o=await Tn([this.strTokens,t],e,i),r=Array.isArray(o)?o:[o,o],s=typeof r[0]=="string"?r[0]:"",a=typeof r[1]=="string"?r[1]:"";return this.strTranslatedTokens=s,[s,a]}isTokenSpanElement(t){return t instanceof HTMLSpanElement&&t.dataset.votToken==="1"}findTokenSpanInPath(t,e){for(const i of t)if(this.isTokenSpanElement(i)&&e.contains(i))return i;return null}findTokenSpanByPoint(t,e,i){const o=document.elementFromPoint(t,e);if(this.isTokenSpanElement(o)&&i.contains(o))return o;if(!(o instanceof Element))return null;const r=o.closest('span[data-vot-token="1"]');return r instanceof HTMLSpanElement&&i.contains(r)?r:null}resolveTokenSpanFromClick(t){const e=this.subtitlesBlock??this.subtitlesContainer;if(!e)return null;if(this.isTokenSpanElement(t.target)&&e.contains(t.target))return t.target;const i=typeof t.composedPath=="function"?t.composedPath():[],o=this.findTokenSpanInPath(i,e);if(o)return o;const r=t.clientX,s=t.clientY;return Number.isFinite(r)&&Number.isFinite(s)?this.findTokenSpanByPoint(r,s,e):null}releaseTooltip(){return this.tooltipTranslationRequestId+=1,this.tokenTooltip?.target&&this.tokenTooltip.target.classList.remove("selected"),this.tokenTooltip?.release(),this.tokenTooltip=void 0,this}clearPendingSchedulerState(){this.repositionPending=false,this.updatePending=false,this.wrapPending=false,this.positionRefreshPending=false;}clearRenderedContent({releaseTooltip:t=false}={}){t&&this.releaseTooltip(),this.resetRenderMemo(),this.lastActiveLineIndex=null,this.strTokens="",this.resetTranslationContext(),this.subtitlesBlock=null,this.renderedTokenEls=[],this.resetWrapMemo(),this.lastWrapTokens=null,this.subtitleMaxWidthPx=0,this.resetSegmentationMemo(),this.clearPendingSchedulerState(),this.subtitlesContainer&&et(null,this.subtitlesContainer);}onClick=async t=>{if(performance.now()<this.suppressTokenClicksUntil){t.preventDefault(),t.stopPropagation();return}const e=this.resolveTokenSpanFromClick(t);if(!e)return;if(this.tokenTooltip?.target===e&&this.tokenTooltip?.container){this.tokenTooltip.showed?e.classList.add("selected"):e.classList.remove("selected");return}this.releaseTooltip();const i=this.tooltipTranslationRequestId,o=this.normalizeTokenTextForTranslation(e.textContent??"");if(!o)return;const r=await E.get("translationService",Je);if(i!==this.tooltipTranslationRequestId)return;e.classList.add("selected");const s=k.createSubtitleInfo(o,this.strTranslatedTokens||this.strTokens,r),a=new Y({target:e,anchor:this.subtitlesBlock??e,layoutRoot:this.tooltipLayoutRoot,content:s.container,parentElement:this.portal,maxWidth:this.subtitlesBlock?.offsetWidth??this.subtitlesContainer?.offsetWidth,borderRadius:12,bordered:false,position:"top",trigger:"click"});this.tokenTooltip=a,a.onClick();const l=this.strTokens,c=await this.translateStrTokens(o);i===this.tooltipTranslationRequestId&&(l!==this.strTokens||this.tokenTooltip!==a||a.target!==e||!a.showed||(s.header.textContent=c[1],s.context.textContent=c[0],a.setContent(s.container)));};buildPassedState(t,e){const i=[];for(const o of t){if(!o.isWordLike)continue;const r=o.startMs+o.durationMs/2,s=e>r||e>o.startMs-100&&r-e<275;i.push(s);}return i}renderTokens(t){const e=this.breakAfterTokenIndexSet,i=typeof this.smartTruncateAfterTokenIndex=="number"?Math.max(0,Math.min(this.smartTruncateAfterTokenIndex,t.length-1)):null,o=Rp(this.smartLayoutEnabled,i,t.length),r=o?i??t.length-1:t.length-1,s=[];for(let a=0;a<=r;){const l=t[a];if(!l.text){a+=1;continue}if(l.isWordLike){let c=l.text,d=a,h=!!e?.has(a)?a:null;for(;h===null&&d+1<=r;){const f=t[d+1];if(!f||f.isWordLike)break;if(c+=f.text,d+=1,e?.has(d)){h=d;break}}if(s.push(de`<span
            data-vot-token="1"
            >${c}</span
          >`),h!==null){for(s.push(de`<br class="vot-subtitles-br" />`),a=h+1;a<=r&&!t[a]?.isWordLike&&!t[a]?.text.trim();)a+=1;continue}a=d+1;}else s.push(l.text),e?.has(a)&&s.push(de`<br class="vot-subtitles-br" />`),a+=1;}if(o){const a=s.at(-1);if(typeof a=="string"){const l=a.replace(/\s+$/u,"");l?s[s.length-1]=l:s.pop();}s.push("…");}return s}updatePassedClasses(t){const e=this.renderedTokenEls,i=Math.min(e.length,t.length);for(let o=0;o<i;o+=1)e[o].classList.toggle("passed",t[o]);for(let o=i;o<e.length;o+=1)e[o].classList.remove("passed");}clearPassedClasses(){for(const t of this.renderedTokenEls)t.classList.remove("passed");}setBreakAfterTokenIndices(t){this.breakAfterTokenIndices=t,this.breakAfterTokenIndexSet=t.length?new Set(t):null;}enqueueWrapRecompute(t=null){t&&(this.lastWrapTokens=t),this.wrapPending=true,this.intervalIdleChecker.requestImmediateTick();}scheduleWrapRecompute(t=null){this.enqueueWrapRecompute(t);}scheduleWrapRecomputeBeforePaint(t=null){this.enqueueWrapRecompute(t),this.intervalIdleChecker.requestImmediateTick();}maybeRefreshPosition(t=false){if(this.abortController.signal.aborted||!this.subtitlesContainer)return;const e=performance.now();!t&&e-this.lastPositionRefreshTs<this.positionRefreshIntervalMs||(this.lastPositionRefreshTs=e,this.positionRefreshPending=true,this.intervalIdleChecker.requestImmediateTick());}getMeasureContext(t){return this.measureCanvas||(this.measureCanvas=document.createElement("canvas"),this.measureCanvas.width=1,this.measureCanvas.height=1),this.measureCtx||(this.measureCtx=this.measureCanvas.getContext("2d",{alpha:false})??this.measureCanvas.getContext("2d")),this.measureCtx?(typeof t=="string"&&t&&(this.measureCtx.font=t),this.measureCtx):null}arraysEqual(t,e){if(t===e)return  true;if(t.length!==e.length)return  false;for(let i=0;i<t.length;i+=1)if(t[i]!==e[i])return  false;return  true}recomputeWrapNow(){const t=this.lastWrapTokens,e=this.subtitlesBlock;if(!t||!e)return;const i=this.getLineMeasureMemo(t,this.getActiveLineKey(t));if(!i||i.maxWidthPx<50)return;const{words:o,metrics:r,maxWidthPx:s}=i,a=Vo(s);if(o.length<=1){(this.breakAfterTokenIndices.length||this.smartTruncateAfterTokenIndex!==null)&&(this.resetWrapMemo(),this.resetRenderMemo(),this.update());return}const l=i.key;if(l===this.lastWrapKey)return;this.lastWrapKey=l;let c=[],d=null;if(!(At(r,0,o.length-1)<=a)){const v=Is(r,a);if(v.length)c=v.map(b=>o[b].breakAfterTokenIndex);else if(this.smartLayoutEnabled){const b=Ep(r,a);c=b.breakAfterWordIndices.map(y=>o[y].breakAfterTokenIndex),b.truncateAfterWordIndex!==null&&(d=o[b.truncateAfterWordIndex]?.breakAfterTokenIndex??null);}}const h=!this.arraysEqual(c,this.breakAfterTokenIndices),f=d!==this.smartTruncateAfterTokenIndex;(h||f)&&(this.setBreakAfterTokenIndices(c),this.smartTruncateAfterTokenIndex=d,this.resetRenderMemo(),this.update());}setContent(t,e=void 0){if(this.releaseTooltip(),this.subtitleLang=e,!t||!this.video){this.clearRenderedContent(),this.subtitles=null,this.clearPendingSchedulerState(),this.video?.removeEventListener("timeupdate",this.onTimeUpdateBound),this.stopVideoFrameLoop(),this.detachDragDocumentListeners();return}this.createSubtitlesContainer(),this.subtitles=t,this.lastActiveLineIndex=null,this.useVideoFrameCallbacks||this.video.addEventListener("timeupdate",this.onTimeUpdateBound,{signal:this.abortController.signal}),this.syncVideoFrameLoop(),this.updateContainerRect(),this.update(),this.intervalIdleChecker.requestImmediateTick();}setMaxLength(t){typeof t=="number"&&t>0&&(this.manualMaxLength=t,this.smartLayoutEnabled||(this.maxLength=t,this.resetSegmentationMemo(),this.update(),this.scheduleReposition()));}setHighlightWords(t){const e=this.highlightWords;this.highlightWords=!!t,e&&!this.highlightWords&&this.clearPassedClasses(),this.update();}applyManualFontSizeStyle(){if(this.subtitlesBlock){if(this.fontSizeOverridden){this.subtitlesBlock.style.setProperty("--vot-subtitles-font-size",`${this.fontSize}px`);return}this.subtitlesBlock.style.removeProperty("--vot-subtitles-font-size");}}setSmartLayout(t){const e=t!==false;e!==this.smartLayoutEnabled&&(this.smartLayoutEnabled=e,this.lastSmartLayoutKey=null,this.resetWrapMemo(),this.resetRenderMemo(),this.resetSegmentationMemo(),this.smartLayoutEnabled||(this.maxLength=this.manualMaxLength,this.applyManualFontSizeStyle()),this.update(),this.scheduleWrapRecompute(),this.scheduleReposition());}setFontSize(t){this.fontSize=t,this.fontSizeOverridden=true,this.smartLayoutEnabled||(this.applyManualFontSizeStyle(),this.lastWrapKey=null,this.resetSegmentationMemo(),this.scheduleWrapRecompute(),this.scheduleReposition());}setOpacity(t){this.opacity=((100-Number(t))/100).toFixed(2),this.subtitlesBlock&&this.subtitlesBlock.style.setProperty("--vot-subtitles-opacity",this.opacity);}stringifyTokens(t){return t.map(e=>e.text).join("")}updateMultilineAlignmentIfNeeded(t){const e=this.subtitlesBlock;if(!e||t===this.lastLayoutAffectingKey)return;const i=getComputedStyle(e),o=`${t}|${i.fontSize}|${Math.round(e.clientWidth)}`;this.updateMultilineAlignmentClass(o),this.lastLayoutAffectingKey=t;}updateMultilineAlignmentClass(t){const e=this.subtitlesBlock;if(!e||t===this.lastMultilineMeasureSignature)return;this.lastMultilineMeasureSignature=t;const i=getComputedStyle(e),o=Number.parseFloat(i.lineHeight);if(!Number.isFinite(o)||o<=0){e.classList.remove("vot-subtitles--multiline");return}const r=Number.parseFloat(i.paddingTop)||0,s=Number.parseFloat(i.paddingBottom)||0,a=Math.max(0,e.clientHeight-r-s);Math.max(1,Math.round(a/o))>1?e.classList.add("vot-subtitles--multiline"):e.classList.remove("vot-subtitles--multiline");}update(){if(!this.video||!this.subtitles)return;const t=this.video.currentTime*1e3,e=this.subtitles.subtitles;let i,o=-1;const r=this.lastActiveLineIndex;if(typeof r=="number"&&r>=0&&r<e.length){const y=e[r];pp(t,y)&&(i=y,o=r);}if(!i){const y=gp(t,e);y!==-1&&(i=e[y],o=y);}if(!i){this.lastActiveLineIndex=null,this.subtitlesBlock||this.lastRenderKey!==null||this.strTokens?this.clearRenderedContent({releaseTooltip:true}):this.releaseTooltip();return}if(this.lastActiveLineIndex=o,this.smartLayoutEnabled){const y=performance.now();if(this.lastSmartLayoutKey===null||y-this.lastSmartLayoutCheckTs>500){this.lastSmartLayoutCheckTs=y;const x=this.getLayoutSize();if(x.w&&x.h){const w=this.computeAnchorBoxLayout(x);w.w&&w.h&&this.ensureSmartLayout(w);}}}else this.maxLength=this.manualMaxLength;const s=this.processTokens(i.tokens,t);this.lastWrapTokens=s;const a=this.stringifyTokens(s),l=a!==this.strTokens;l&&(this.releaseTooltip(),this.strTokens=a,this.resetTranslationContext(),this.resetWrapMemo());const c=this.highlightWords?this.buildPassedState(s,t):null,d=`${this.breakAfterTokenIndices.join(",")}|${this.smartTruncateAfterTokenIndex??""}`;let u=0;this.smartLayoutEnabled?u=Math.round(this.smartFontSizePx):this.fontSizeOverridden&&(u=this.fontSize);const h=mp(a,d,u),f=`${o}:${a}:${d}`;if(f===this.lastRenderKey){this.highlightWords&&!l&&c&&this.updatePassedClasses(c),this.updateMultilineAlignmentIfNeeded(h),this.maybeRefreshPosition();return}this.lastRenderKey=f,this.subtitlesContainer=this.subtitlesContainer??this.createSubtitlesContainer();const v=[`--vot-subtitles-opacity: ${this.opacity}`];this.smartLayoutEnabled?this.smartFontSizePx>0&&v.push(`--vot-subtitles-font-size: ${this.smartFontSizePx}px`):this.fontSizeOverridden&&v.push(`--vot-subtitles-font-size: ${this.fontSize}px`),et(de`<vot-block
        class="vot-subtitles"
        style="${v.join("; ")}"
        @click=${this.onClick}
      >
        ${this.renderTokens(s)}
      </vot-block>`,this.subtitlesContainer);const b=this.subtitlesContainer.firstElementChild;this.subtitlesBlock=b instanceof HTMLElement&&b.classList.contains("vot-subtitles")?b:null,this.renderedTokenEls=this.subtitlesBlock?Array.from(this.subtitlesBlock.querySelectorAll('span[data-vot-token="1"]')):[],this.highlightWords&&c&&this.updatePassedClasses(c),this.updateMultilineAlignmentIfNeeded(h),l?(this.applyPositionAfterContentRender(),this.scheduleWrapRecomputeBeforePaint(s),this.scheduleReposition()):this.maybeRefreshPosition();}release(){this.detachDragDocumentListeners(),this.stopVideoFrameLoop(),this.abortController.abort(),this.resizeObserver?.disconnect(),this.clearPendingSchedulerState(),this.checkerUnsubscribe?.(),this.checkerUnsubscribe=null,this.releaseTooltip(),this.subtitlesContainer&&(this.subtitlesContainer.remove(),this.subtitlesContainer=null),this.safeAreaProbeEl&&(this.safeAreaProbeEl.remove(),this.safeAreaProbeEl=null),this.measureCtx=null,this.measureCanvas=null;}}function Up(n){return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,n&255])}function zp(n){return new Uint8Array([n>>>21&127,n>>>14&127,n>>>7&127,n&127])}function Wp(n,t){const e=new TextEncoder().encode(t),i=new Uint8Array(e.length+1);i[0]=3,i.set(e,1);const o=new Uint8Array(10+i.length);o.set([84,73,84,50],0),o.set(Up(i.length),4),o.set(i,10);const r=new Uint8Array(10);r.set([73,68,51,3,0,0],0),r.set(zp(o.length),6);const s=new Uint8Array(n),a=new Uint8Array(r.length+o.length+s.length);return a.set(r,0),a.set(o,r.length),a.set(s,r.length+o.length),new Blob([a],{type:"audio/mpeg"})}async function qp(n,t){const e=Number(n.headers.get("Content-Length")??0);if(!n.body)return n.arrayBuffer();const i=n.body.getReader();let o=0,r=e>0?new Uint8Array(e):null;const s=[];for(;;){const{done:c,value:d}=await i.read();if(c)break;if(!(!d||d.byteLength===0)){if(r){const u=o+d.byteLength;if(u>r.length){const h=new Uint8Array(Math.max(u,r.length*2));h.set(r.subarray(0,o)),r=h;}r.set(d,o),o=u;}else s.push(d),o+=d.byteLength;e>0&&t($(Math.round(o/e*100)));}}if(r)return r.buffer.slice(0,o);const a=new Uint8Array(o);let l=0;for(const c of s)a.set(c,l),l+=c.byteLength;return a.buffer}async function Gp(n,t,e=()=>{}){const i=await Es(n,t,e);return qr(i,`${t}.mp3`),true}async function Es(n,t,e=()=>{}){const i=await qp(n,e);return e(100),Wp(i,t)}const Kp=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
  <path
    id="vot-translate-icon"
    fill-rule="evenodd"
    d="M15.778 18.95L14.903 21.375C14.8364 21.5583 14.7197 21.7083 14.553 21.825C14.3864 21.9417 14.203 22 14.003 22C13.6697 22 13.3989 21.8625 13.1905 21.5875C12.9822 21.3125 12.9447 21.0083 13.078 20.675L16.878 10.625C16.9614 10.4417 17.0864 10.2917 17.253 10.175C17.4197 10.0583 17.603 10 17.803 10H18.553C18.753 10 18.9364 10.0583 19.103 10.175C19.2697 10.2917 19.3947 10.4417 19.478 10.625L23.278 20.7C23.4114 21.0167 23.378 21.3125 23.178 21.5875C22.978 21.8625 22.7114 22 22.378 22C22.1614 22 21.9739 21.9375 21.8155 21.8125C21.6572 21.6875 21.5364 21.525 21.453 21.325L20.628 18.95H15.778ZM19.978 17.2H16.378L18.228 12.25L19.978 17.2Z"
  ></path>
  <path
    d="M9 14L4.7 18.3C4.51667 18.4833 4.28333 18.575 4 18.575C3.71667 18.575 3.48333 18.4833 3.3 18.3C3.11667 18.1167 3.025 17.8833 3.025 17.6C3.025 17.3167 3.11667 17.0833 3.3 16.9L7.65 12.55C7.01667 11.85 6.4625 11.125 5.9875 10.375C5.5125 9.625 5.1 8.83333 4.75 8H6.85C7.15 8.6 7.47083 9.14167 7.8125 9.625C8.15417 10.1083 8.56667 10.6167 9.05 11.15C9.78333 10.35 10.3917 9.52917 10.875 8.6875C11.3583 7.84583 11.7667 6.95 12.1 6H2C1.71667 6 1.47917 5.90417 1.2875 5.7125C1.09583 5.52083 1 5.28333 1 5C1 4.71667 1.09583 4.47917 1.2875 4.2875C1.47917 4.09583 1.71667 4 2 4H8V3C8 2.71667 8.09583 2.47917 8.2875 2.2875C8.47917 2.09583 8.71667 2 9 2C9.28333 2 9.52083 2.09583 9.7125 2.2875C9.90417 2.47917 10 2.71667 10 3V4H16C16.2833 4 16.5208 4.09583 16.7125 4.2875C16.9042 4.47917 17 4.71667 17 5C17 5.28333 16.9042 5.52083 16.7125 5.7125C16.5208 5.90417 16.2833 6 16 6H14.1C13.75 7.18333 13.275 8.33333 12.675 9.45C12.075 10.5667 11.3333 11.6167 10.45 12.6L12.85 15.05L12.1 17.1L9 14Z"
  ></path>
  <path
    id="vot-loading-icon"
    style="display:none"
    d="M19.8081 16.3697L18.5842 15.6633V13.0832C18.5842 12.9285 18.5228 12.7801 18.4134 12.6707C18.304 12.5613 18.1556 12.4998 18.0009 12.4998C17.8462 12.4998 17.6978 12.5613 17.5884 12.6707C17.479 12.7801 17.4176 12.9285 17.4176 13.0832V15.9998C17.4176 16.1022 17.4445 16.2028 17.4957 16.2915C17.5469 16.3802 17.6205 16.4538 17.7092 16.505L19.2247 17.38C19.2911 17.4189 19.3645 17.4443 19.4407 17.4547C19.5169 17.4652 19.5945 17.4604 19.6688 17.4407C19.7432 17.4211 19.813 17.3869 19.8741 17.3402C19.9352 17.2934 19.9864 17.2351 20.0249 17.1684C20.0634 17.1018 20.0883 17.0282 20.0982 16.952C20.1081 16.8757 20.1028 16.7982 20.0827 16.7239C20.0625 16.6497 20.0279 16.5802 19.9808 16.5194C19.9336 16.4586 19.8749 16.4077 19.8081 16.3697ZM18.0015 10C16.8478 10 15.6603 10.359 14.7011 11C13.7418 11.641 12.9415 12.4341 12.5 13.5C12.0585 14.5659 11.8852 16.0369 12.1103 17.1684C12.3353 18.3 12.8736 19.4942 13.6894 20.31C14.5053 21.1258 15.8684 21.7749 17 22C18.1316 22.2251 19.4341 21.9415 20.5 21.5C21.5659 21.0585 22.359 20.2573 23 19.298C23.641 18.3387 24.0015 17.1537 24.0015 16C23.9998 14.4534 23.5951 13.0936 22.5015 12C21.4079 10.9064 19.5481 10.0017 18.0015 10ZM18.0009 20.6665C17.0779 20.6665 16.1757 20.3928 15.4082 19.88C14.6408 19.3672 14.0427 18.6384 13.6894 17.7857C13.3362 16.933 13.2438 15.9947 13.4239 15.0894C13.604 14.1842 14.0484 13.3527 14.7011 12.7C15.3537 12.0474 16.1852 11.6029 17.0905 11.4228C17.9957 11.2428 18.934 11.3352 19.7867 11.6884C20.6395 12.0416 21.3683 12.6397 21.8811 13.4072C22.3939 14.1746 22.6676 15.0769 22.6676 15.9998C22.666 17.237 22.1738 18.4231 21.299 19.298C20.4242 20.1728 19.2381 20.665 18.0009 20.6665Z"
  ></path>
</svg>`,Yp=st`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
  <path
    d="M120-520q-17 0-28.5-11.5T80-560q0-17 11.5-28.5T120-600h104L80-743q-12-12-12-28.5T80-800q12-12 28.5-12t28.5 12l143 144v-104q0-17 11.5-28.5T320-800q17 0 28.5 11.5T360-760v200q0 17-11.5 28.5T320-520H120Zm40 360q-33 0-56.5-23.5T80-240v-160q0-17 11.5-28.5T120-440q17 0 28.5 11.5T160-400v160h280q17 0 28.5 11.5T480-200q0 17-11.5 28.5T440-160H160Zm680-280q-17 0-28.5-11.5T800-480v-240H480q-17 0-28.5-11.5T440-760q0-17 11.5-28.5T480-800h320q33 0 56.5 23.5T880-720v240q0 17-11.5 28.5T840-440ZM600-160q-17 0-28.5-11.5T560-200v-120q0-17 11.5-28.5T600-360h240q17 0 28.5 11.5T880-320v120q0 17-11.5 28.5T840-160H600Z"
  />
</svg>`,Xp=st`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
  <path
    d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"
  />
</svg>`,Jp=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="100%" viewBox="0 0 24 24" class="vot-loader" id="vot-loader-download">
  <path class="vot-loader-main" d="M12 15.575C11.8667 15.575 11.7417 15.5542 11.625 15.5125C11.5083 15.4708 11.4 15.4 11.3 15.3L7.7 11.7C7.5 11.5 7.40417 11.2667 7.4125 11C7.42083 10.7333 7.51667 10.5 7.7 10.3C7.9 10.1 8.1375 9.99583 8.4125 9.9875C8.6875 9.97917 8.925 10.075 9.125 10.275L11 12.15V5C11 4.71667 11.0958 4.47917 11.2875 4.2875C11.4792 4.09583 11.7167 4 12 4C12.2833 4 12.5208 4.09583 12.7125 4.2875C12.9042 4.47917 13 4.71667 13 5V12.15L14.875 10.275C15.075 10.075 15.3125 9.97917 15.5875 9.9875C15.8625 9.99583 16.1 10.1 16.3 10.3C16.4833 10.5 16.5792 10.7333 16.5875 11C16.5958 11.2667 16.5 11.5 16.3 11.7L12.7 15.3C12.6 15.4 12.4917 15.4708 12.375 15.5125C12.2583 15.5542 12.1333 15.575 12 15.575ZM6 20C5.45 20 4.97917 19.8042 4.5875 19.4125C4.19583 19.0208 4 18.55 4 18V16C4 15.7167 4.09583 15.4792 4.2875 15.2875C4.47917 15.0958 4.71667 15 5 15C5.28333 15 5.52083 15.0958 5.7125 15.2875C5.90417 15.4792 6 15.7167 6 16V18H18V16C18 15.7167 18.0958 15.4792 18.2875 15.2875C18.4792 15.0958 18.7167 15 19 15C19.2833 15 19.5208 15.0958 19.7125 15.2875C19.9042 15.4792 20 15.7167 20 16V18C20 18.55 19.8042 19.0208 19.4125 19.4125C19.0208 19.8042 18.55 20 18 20H6Z"/>
  <circle class="vot-loader-progress" cx="12" cy="12" r="9"></circle>
</svg>`,jp=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="100%" viewBox="0 0 24 24">
  <path d="M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h16q.825 0 1.413.588T22 6v12q0 .825-.588 1.413T20 20H4Zm2-4h8v-2H6v2Zm10 0h2v-2h-2v2ZM6 12h2v-2H6v2Zm4 0h8v-2h-8v2Z"/>
</svg>`,Zp=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="100%" viewBox="0 -960 960 960">
  <path d="M555-80H405q-15 0-26-10t-13-25l-12-93q-13-5-24.5-12T307-235l-87 36q-14 5-28 1t-22-17L96-344q-8-13-5-28t15-24l75-57q-1-7-1-13.5v-27q0-6.5 1-13.5l-75-57q-12-9-15-24t5-28l74-129q7-14 21.5-17.5T220-761l87 36q11-8 23-15t24-12l12-93q2-15 13-25t26-10h150q15 0 26 10t13 25l12 93q13 5 24.5 12t22.5 15l87-36q14-5 28-1t22 17l74 129q8 13 5 28t-15 24l-75 57q1 7 1 13.5v27q0 6.5-2 13.5l75 57q12 9 15 24t-5 28l-74 128q-8 13-22.5 17.5T738-199l-85-36q-11 8-23 15t-24 12l-12 93q-2 15-13 25t-26 10Zm-73-260q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm0-80q-25 0-42.5-17.5T422-480q0-25 17.5-42.5T482-540q25 0 42.5 17.5T542-480q0 25-17.5 42.5T482-420Zm-2-60Zm-40 320h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Z"/>
</svg>`,Ps=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" >
  <path
    d="M12 14.975q-.2 0-.375-.062T11.3 14.7l-4.6-4.6q-.275-.275-.275-.7t.275-.7q.275-.275.7-.275t.7.275l3.9 3.9l3.9-3.9q.275-.275.7-.275t.7.275q.275.275.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062Z"
  />
</svg>`,Qp=st`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
  <path
    d="M647-440H200q-17 0-28.5-11.5T160-480q0-17 11.5-28.5T200-520h447L451-716q-12-12-11.5-28t12.5-28q12-11 28-11.5t28 11.5l264 264q6 6 8.5 13t2.5 15q0 8-2.5 15t-8.5 13L508-188q-11 11-27.5 11T452-188q-12-12-12-28.5t12-28.5l195-195Z"
  />
</svg>`,tg=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="100%" viewBox="0 -960 960 960">
  <path d="M480-424 284-228q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536-480l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480-424Z"/>
</svg>`,_o=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
  <g fill="none">
    <path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2m0 2a8 8 0 1 0 0 16a8 8 0 0 0 0-16m0 11a1 1 0 1 1 0 2a1 1 0 0 1 0-2m0-9a1 1 0 0 1 1 1v6a1 1 0 1 1-2 0V7a1 1 0 0 1 1-1"/>
  </g>
</svg>`,Oo=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
  <g fill="none">
    <path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2m0 2a8 8 0 1 0 0 16a8 8 0 0 0 0-16m0 12a1 1 0 1 1 0 2a1 1 0 0 1 0-2m0-9.5a3.625 3.625 0 0 1 1.348 6.99a.8.8 0 0 0-.305.201c-.044.05-.051.114-.05.18L13 14a1 1 0 0 1-1.993.117L11 14v-.25c0-1.153.93-1.845 1.604-2.116a1.626 1.626 0 1 0-2.229-1.509a1 1 0 1 1-2 0A3.625 3.625 0 0 1 12 6.5"/>
  </g>
</svg>`,eg=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
  <g fill="none">
    <path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/>
    <path fill="currentColor" d="M20 9a1 1 0 0 1 1 1v1a8 8 0 0 1-8 8H9.414l.793.793a1 1 0 0 1-1.414 1.414l-2.496-2.496a1 1 0 0 1-.287-.567L6 17.991a1 1 0 0 1 .237-.638l.056-.06l2.5-2.5a1 1 0 0 1 1.414 1.414L9.414 17H13a6 6 0 0 0 6-6v-1a1 1 0 0 1 1-1m-4.793-6.207l2.5 2.5a1 1 0 0 1 0 1.414l-2.5 2.5a1 1 0 1 1-1.414-1.414L14.586 7H11a6 6 0 0 0-6 6v1a1 1 0 1 1-2 0v-1a8 8 0 0 1 8-8h3.586l-.793-.793a1 1 0 0 1 1.414-1.414"/>
  </g>
</svg>`,ng=st`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
  <path fill="currentColor" d="M7 15q1.25 0 2.125-.875T10 12t-.875-2.125T7 9t-2.125.875T4 12t.875 2.125T7 15m0 3q-2.5 0-4.25-1.75T1 12t1.75-4.25T7 6q2.025 0 3.538 1.15T12.65 10h8.375L23 11.975l-3.5 4L17 14l-2 2l-2-2h-.35q-.625 1.8-2.175 2.9T7 18"/>
  </svg>`;class Re{container;translateButton;separator;pipButton;separator2;menuButton;label;_opacity=1;_position;_direction;_status;_labelText;constructor({position:t="default",direction:e="default",status:i="none",labelHtml:o=""}){this._position=t,this._direction=e,this._status=i,this._labelText=o;const r=this.createElements();this.container=r.container,this.translateButton=r.translateButton,this.separator=r.separator,this.pipButton=r.pipButton,this.separator2=r.separator2,this.menuButton=r.menuButton,this.label=r.label;}static calcPosition(t,e){return e?t<=44?"left":t>=66?"right":"default":"default"}static calcDirection(t){return ["default","top"].includes(t)?"row":"column"}createElements(){const t=k.createEl("vot-block",["vot-segmented-button"]);t.dataset.position=this._position,t.dataset.direction=this._direction,t.dataset.status=this._status;const e=k.createEl("vot-block",["vot-segment","vot-translate-button"]);e.setAttribute("role","button"),e.tabIndex=0,e.setAttribute("aria-label",this._labelText||"Translate"),et(Kp,e);const i=k.createEl("span",["vot-segment-label"]);i.textContent=this._labelText,e.appendChild(i);const o=k.createEl("vot-block",["vot-separator"]),r=k.createEl("vot-block",["vot-segment-only-icon"]);r.setAttribute("role","button"),r.tabIndex=0,r.setAttribute("aria-label","Picture in picture"),et(Yp,r);const s=k.createEl("vot-block",["vot-separator"]),a=k.createEl("vot-block",["vot-segment-only-icon"]);return a.setAttribute("role","button"),a.tabIndex=0,a.setAttribute("aria-label","Menu"),a.setAttribute("aria-haspopup","dialog"),a.setAttribute("aria-expanded","false"),et(Xp,a),t.append(e,o,r,s,a),{container:t,translateButton:e,separator:o,pipButton:r,separator2:s,menuButton:a,label:i}}showPiPButton(t){return this.separator2.hidden=this.pipButton.hidden=!t,this}setText(t){return this._labelText=t,this.label.textContent=t,this.translateButton.setAttribute("aria-label",t||"Translate"),this}remove(){return this.container.remove(),this}get tooltipPos(){switch(this.position){case "left":return "right";case "right":return "left";default:return "bottom"}}set status(t){this._status=this.container.dataset.status=t;}get status(){return this._status}set loading(t){this.container.dataset.loading=t.toString();}get loading(){return this.container.dataset.loading==="true"}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}get position(){return this._position}set position(t){this._position=this.container.dataset.position=t;}get direction(){return this._direction}set direction(t){this._direction=this.container.dataset.direction=t;}set opacity(t){const e=Number.isFinite(t)?t:1;this._opacity=e;const i=e<=.01;this.container.classList.toggle("vot-segmented-button--hidden",i);}get opacity(){return this._opacity}}class ig{button;loaderMain;loaderCircle;onClick=new R;events={click:this.onClick};_progress=0;constructor(){const t=this.createElements();this.button=t.button,this.loaderMain=t.loaderMain,this.loaderCircle=t.loaderCircle,this.progress=0;}createElements(){const t=k.createIconButton(Jp,{ariaLabel:"Download translation"}),e=t.querySelector(".vot-loader-main");if(!e)throw new Error("[VOT] DownloadButton loader main element not found");const i=t.querySelector(".vot-loader-progress");if(!i)throw new Error("[VOT] DownloadButton loader circle element not found");return t.addEventListener("click",()=>{this.onClick.dispatch();}),{button:t,loaderMain:e,loaderCircle:i}}addEventListener(t,e){return It(this.events,"click",e),this}removeEventListener(t,e){return Et(this.events,"click",e),this}get progress(){return this._progress}set progress(t){const e=og(t);this._progress=e;const i=this.getCircleCircumference();this.loaderCircle.style.strokeDasharray=`${i}`;const o=i*(1-e/100);this.loaderCircle.style.strokeDashoffset=`${o}`,this.loaderMain.style.opacity=e===0?"1":"0",this.loaderCircle.style.opacity=e===0?"0":"1";}getCircleCircumference(){const t=this.loaderCircle.r?.baseVal?.value??0;return 2*Math.PI*t}set hidden(t){it(this.button,t);}get hidden(){return at(this.button)}}function og(n){if(!Number.isFinite(n))return 0;const t=n<1?n*100:n;return Math.max(0,Math.min(100,Math.round(t)))}class wt{container;icon;text;_labelText;_icon;constructor({labelText:t,icon:e}){this._labelText=t,this._icon=e;const i=this.createElements();this.container=i.container,this.icon=i.icon,this.text=i.text;}createElements(){const t=k.createEl("vot-block",["vot-label"]),e=k.createEl("span",["vot-label-text"]);e.textContent=this._labelText;const i=k.createEl("span",["vot-label-icon"]);return this._icon?et(this._icon,i):i.hidden=true,t.append(e,i),{container:t,icon:i,text:e}}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}}class Ln{container;backdrop;box;contentWrapper;headerContainer;titleContainer;title;closeButton;bodyContainer;footerContainer;onClose=new R;events={close:this.onClose};previouslyFocused=null;keydownListener;adaptiveAlignObserver;adaptiveAlignRaf=null;handleViewportChange=()=>{this.scheduleAdaptiveVerticalAlign();};titleId=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`vot-dialog-title-${Math.random().toString(36).slice(2)}`;_titleHtml;_isTemp;constructor({titleHtml:t,isTemp:e=false}){this._titleHtml=t,this._isTemp=e;const i=this.createElements();this.container=i.container,this.backdrop=i.backdrop,this.box=i.box,this.contentWrapper=i.contentWrapper,this.headerContainer=i.headerContainer,this.titleContainer=i.titleContainer,this.title=i.title,this.closeButton=i.closeButton,this.bodyContainer=i.bodyContainer,this.footerContainer=i.footerContainer;}createElements(){const t=k.createEl("vot-block",["vot-dialog-container"]);this._isTemp&&t.classList.add("vot-dialog-temp"),t.hidden=!this._isTemp,t.setAttribute("aria-hidden",t.hidden?"true":"false"),t.toggleAttribute("inert",t.hidden);const e=k.createEl("vot-block",["vot-dialog-backdrop"]),i=k.createEl("vot-block",["vot-dialog"]);i.dataset.verticalAlign="center",i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true"),i.tabIndex=-1;const o=k.createEl("vot-block",["vot-dialog-content-wrapper"]),r=k.createEl("vot-block",["vot-dialog-header-container"]),s=k.createEl("vot-block",["vot-dialog-title-container"]),a=k.createEl("vot-block",["vot-dialog-title"]);a.id=this.titleId,a.append(this._titleHtml),s.appendChild(a),i.setAttribute("aria-labelledby",this.titleId);const l=k.createIconButton(tg,{ariaLabel:"Close"});l.classList.add("vot-dialog-close-button"),e.addEventListener("click",()=>{this.close();}),l.addEventListener("click",()=>{this.close();}),r.append(s,l);const c=k.createEl("vot-block",["vot-dialog-body-container"]),d=k.createEl("vot-block",["vot-dialog-footer-container"]);return o.append(r,c,d),i.appendChild(o),t.append(e,i),i.addEventListener("click",u=>{u.stopPropagation();}),{container:t,backdrop:e,box:i,contentWrapper:o,headerContainer:r,titleContainer:s,title:a,closeButton:l,bodyContainer:c,footerContainer:d}}addEventListener(t,e){return It(this.events,"close",e),this}removeEventListener(t,e){return Et(this.events,"close",e),this}open(){return this.previouslyFocused??=document.activeElement,this.hidden=false,this.attachKeydownTrap(),this.attachAdaptiveVerticalAlign(),queueMicrotask(()=>this.focusFirst()),this}remove(){return this.detachAdaptiveVerticalAlign(),this.detachKeydownTrap(),this.container.remove(),this.restoreFocus(),this.onClose.dispatch(),this}close(){return this._isTemp?this.remove():(this.detachAdaptiveVerticalAlign(),this.detachKeydownTrap(),this.hidden=true,this.restoreFocus(),this.onClose.dispatch(),this)}attachAdaptiveVerticalAlign(){if(this.adaptiveAlignObserver){this.scheduleAdaptiveVerticalAlign();return}typeof ResizeObserver<"u"&&(this.adaptiveAlignObserver=new ResizeObserver(()=>{this.scheduleAdaptiveVerticalAlign();}),this.adaptiveAlignObserver.observe(this.contentWrapper)),globalThis.addEventListener("resize",this.handleViewportChange,{passive:true}),globalThis.visualViewport&&(globalThis.visualViewport.addEventListener("resize",this.handleViewportChange,{passive:true}),globalThis.visualViewport.addEventListener("scroll",this.handleViewportChange,{passive:true})),this.scheduleAdaptiveVerticalAlign();}detachAdaptiveVerticalAlign(){this.adaptiveAlignObserver&&(this.adaptiveAlignObserver.disconnect(),this.adaptiveAlignObserver=void 0),globalThis.removeEventListener("resize",this.handleViewportChange),globalThis.visualViewport?.removeEventListener("resize",this.handleViewportChange),globalThis.visualViewport?.removeEventListener("scroll",this.handleViewportChange),this.adaptiveAlignRaf!==null&&(cancelAnimationFrame(this.adaptiveAlignRaf),this.adaptiveAlignRaf=null);}scheduleAdaptiveVerticalAlign(){this.adaptiveAlignRaf!==null&&cancelAnimationFrame(this.adaptiveAlignRaf),this.adaptiveAlignRaf=requestAnimationFrame(()=>{this.adaptiveAlignRaf=null,this.updateAdaptiveVerticalAlign();});}updateAdaptiveVerticalAlign(){const t=globalThis.visualViewport?.height??globalThis.innerHeight;if(!t||t<=0)return;const e=16,i=Math.max(160,Math.round(t*.75)),o=Math.max(160,Math.round(t-e*2)),r=this.contentWrapper.scrollHeight,s=this.box.dataset.verticalAlign==="top",a=i-8,l=Math.round(t*.6);(s?r>l:r>=a)?(this.box.dataset.verticalAlign="top",this.box.style.setProperty("--vot-dialog-max-height",`${o}px`)):(this.box.dataset.verticalAlign="center",this.box.style.setProperty("--vot-dialog-max-height",`${i}px`));}restoreFocus(){const t=this.previouslyFocused;this.previouslyFocused=null,t&&t instanceof HTMLElement&&document.contains(t)&&t.focus();}getFocusableElements(){const t=["button:not([disabled])","[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","[tabindex]:not([tabindex='-1'])","[role='button']:not([aria-disabled='true'])"];return Array.from(this.container.querySelectorAll(t.join(","))).filter(e=>!e.hidden&&e.getClientRects().length>0)}focusFirst(){(this.getFocusableElements()[0]??this.closeButton??this.box).focus?.();}attachKeydownTrap(){this.keydownListener||(this.keydownListener=t=>{if(t.key==="Escape"){t.preventDefault(),this.close();return}if(t.key!=="Tab")return;const e=this.getFocusableElements();if(!e.length){t.preventDefault(),this.box.focus();return}const i=e[0],o=e.at(-1)??i,r=document.activeElement;t.shiftKey?(r===i||r===this.box)&&(t.preventDefault(),o.focus()):r===o&&(t.preventDefault(),i.focus());},this.container.addEventListener("keydown",this.keydownListener));}detachKeydownTrap(){this.keydownListener&&(this.container.removeEventListener("keydown",this.keydownListener),this.keydownListener=void 0);}set hidden(t){it(this.container,t),this.container.setAttribute("aria-hidden",t?"true":"false"),this.container.toggleAttribute("inert",t);}get hidden(){return at(this.container)}get isDialogOpen(){return !this.container.hidden}}class In{container;input;label;onInput=new R;onChange=new R;events={input:this.onInput,change:this.onChange};_labelHtml;_multiline;_placeholder;_value;constructor({labelHtml:t="",placeholder:e="",value:i="",multiline:o=false}){this._labelHtml=t,this._multiline=o,this._placeholder=e,this._value=i;const r=this.createElements();this.container=r.container,this.input=r.input,this.label=r.label;}createElements(){const t=k.createEl("vot-block",["vot-textfield"]),e=document.createElement(this._multiline?"textarea":"input");this._labelHtml||e.classList.add("vot-show-placeholer","vot-show-placeholder"),e.placeholder=this._placeholder,e.value=this._value;const i=k.createEl("span");return i.append(this._labelHtml),t.append(e,i),e.addEventListener("input",()=>{this._value=this.input.value,this.onInput.dispatch(this._value);}),e.addEventListener("change",()=>{this._value=this.input.value,this.onChange.dispatch(this._value);}),{container:t,label:i,input:e}}addEventListener(t,e){return It(this.events,t,e),this}removeEventListener(t,e){return Et(this.events,t,e),this}get value(){return this._value}set value(t){this._value!==t&&(this.input.value=this._value=t,this.onChange.dispatch(this._value));}get placeholder(){return this._placeholder}set placeholder(t){this.input.placeholder=this._placeholder=t;}get disabled(){return this.input.disabled}set disabled(t){this.input.disabled=t;}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}}class Q{container;outer;arrowIcon;title;dialogParent;labelElement;_selectTitle;_dialogTitle;multiSelect;_items;isLoading=false;isDialogOpen=false;onSelectItem=new R;onBeforeOpen=new R;events={selectItem:this.onSelectItem,beforeOpen:this.onBeforeOpen};contentList;selectedItems=[];selectedValues;constructor({selectTitle:t,dialogTitle:e,items:i,labelElement:o,dialogParent:r=document.documentElement,multiSelect:s}){this._selectTitle=t,this._dialogTitle=e,this._items=i,this.multiSelect=s??false,this.labelElement=o,this.dialogParent=r,this.selectedValues=this.calcSelectedValues();const a=this.createElements();this.container=a.container,this.outer=a.outer,this.arrowIcon=a.arrowIcon,this.title=a.title;}static genLanguageItems(t,e){return t.map(i=>{const o=`langs.${i}`,r=g.get(o);return {label:r===o?i.toUpperCase():r,value:i,selected:e===i}})}multiSelectItemHandle=(t,e)=>{const i=e.value;this.selectedValues.has(i)&&this.selectedValues.size>1?(this.selectedValues.delete(i),e.selected=false):(this.selectedValues.add(i),e.selected=true),t.dataset.votSelected=this.selectedValues.has(i).toString(),this.updateSelectedState(),this.onSelectItem.dispatch(Array.from(this.selectedValues));};singleSelectItemHandle=t=>{const e=t.value;this.selectedValues=new Set([e]);for(const i of this.selectedItems)i.dataset.votSelected=(i.dataset.votValue===e).toString();for(const i of this._items)i.selected=i.value===e;this.updateTitle(),this.onSelectItem.dispatch(e);};createDialogContentList(){const t=k.createEl("vot-block",["vot-select-content-list"]);for(const e of this._items){const i=k.createEl("vot-block",["vot-select-content-item"]);i.textContent=e.label,i.dataset.votSelected=e.selected===true?"true":"false",i.dataset.votValue=e.value,e.disabled&&(i.inert=true),i.addEventListener("click",o=>{if(!o.target.inert)return this.multiSelect?this.multiSelectItemHandle(i,e):this.singleSelectItemHandle(e)}),t.appendChild(i);}return this.selectedItems=Array.from(t.children),t}createElements(){const t=k.createEl("vot-block",["vot-select"]);this.labelElement?(t.classList.add("vot-select--labeled"),t.append(this.labelElement)):t.classList.add("vot-select--control-only");const e=k.createEl("vot-block",["vot-select-outer"]);k.makeButtonLike(e),e.setAttribute("aria-haspopup","dialog"),e.setAttribute("aria-expanded","false");const i=k.createEl("vot-block",["vot-select-title"]);i.textContent=this.visibleText;const o=k.createEl("vot-block",["vot-select-arrow-icon"]);return et(Ps,o),e.append(i,o),e.addEventListener("click",()=>{if(!(e.getAttribute("disabled")==="true"||e.getAttribute("aria-disabled")==="true")&&!(this.isLoading||this.isDialogOpen))try{this.isLoading=!0;const s=new Ln({titleHtml:this._dialogTitle,isTemp:!0});this.onBeforeOpen.dispatch(s),this.dialogParent.appendChild(s.container),this.isDialogOpen=!0,e.setAttribute("aria-expanded","true");const a=new In({labelHtml:g.get("searchField")});a.addEventListener("input",l=>{const c=l.toLowerCase();for(const d of this.selectedItems)d.hidden=!d.textContent?.toLowerCase().includes(c);}),this.contentList=this.createDialogContentList(),s.bodyContainer.append(a.container,this.contentList),s.addEventListener("close",()=>{this.isDialogOpen=!1,this.selectedItems=[],this.contentList=void 0,e.setAttribute("aria-expanded","false");}),s.open();}finally{this.isLoading=false;}}),t.appendChild(e),{container:t,outer:e,arrowIcon:o,title:i}}calcSelectedValues(){return new Set(this._items.filter(t=>t.selected).map(t=>t.value))}addEventListener(t,e){return It(this.events,t,e),this}removeEventListener(t,e){return Et(this.events,t,e),this}updateTitle(){return this.title.textContent=this.visibleText,this}updateSelectedState(){if(this.selectedItems.length>0)for(const t of this.selectedItems){const e=t.dataset.votValue;e&&(t.dataset.votSelected=this.selectedValues.has(e).toString());}return this.updateTitle(),this}setSelectedValue(t){this.multiSelect?this.selectedValues=new Set(Array.isArray(t)?t.map(String):[String(t)]):this.selectedValues=new Set([String(t)]);for(const e of this._items)e.selected=this.selectedValues.has(String(e.value));return this.updateSelectedState(),this}updateItems(t){this._items=t,this.selectedValues=this.calcSelectedValues(),this.updateSelectedState();const e=this.contentList?.parentElement;if(!this.contentList||!e)return this;const i=this.contentList;return this.contentList=this.createDialogContentList(),e.replaceChild(this.contentList,i),this}get visibleText(){return this.multiSelect?this._items.filter(t=>this.selectedValues.has(t.value)).map(t=>t.label).join(", ")||this._selectTitle:this._items.find(t=>t.selected)?.label??this._selectTitle}set selectTitle(t){this._selectTitle=t,this.updateTitle();}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}get disabled(){return this.outer.getAttribute("disabled")==="true"}set disabled(t){this.outer.toggleAttribute("disabled",t);}}class rg{container;fromSelect;directionIcon;toSelect;dialogParent;_fromSelectTitle;_fromDialogTitle;_fromItems;_toSelectTitle;_toDialogTitle;_toItems;constructor({from:{selectTitle:t=g.get("videoLanguage"),dialogTitle:e=g.get("videoLanguage"),items:i},to:{selectTitle:o=g.get("translationLanguage"),dialogTitle:r=g.get("translationLanguage"),items:s},dialogParent:a=document.documentElement}){this._fromSelectTitle=t,this._fromDialogTitle=e,this._fromItems=i,this._toSelectTitle=o,this._toDialogTitle=r,this._toItems=s,this.dialogParent=a;const l=this.createElements();this.container=l.container,this.fromSelect=l.fromSelect,this.directionIcon=l.directionIcon,this.toSelect=l.toSelect;}createElements(){const t=k.createEl("vot-block",["vot-lang-select"]),e=new Q({selectTitle:this._fromSelectTitle,dialogTitle:this._fromDialogTitle,items:this._fromItems,dialogParent:this.dialogParent}),i=k.createEl("vot-block",["vot-lang-select-icon"]);et(Qp,i);const o=new Q({selectTitle:this._toSelectTitle,dialogTitle:this._toDialogTitle,items:this._toItems,dialogParent:this.dialogParent});return t.append(e.container,i,o.container),{container:t,fromSelect:e,directionIcon:i,toSelect:o}}setSelectedValues(t,e){return this.fromSelect.setSelectedValue(t),this.toSelect.setSelectedValue(e),this}updateItems(t,e){return this._fromItems=t,this._toItems=e,this.fromSelect=this.fromSelect.updateItems(t),this.toSelect=this.toSelect.updateItems(e),this}}class _t{container;input;label;onInput=new R;_labelHtml;_value;_min;_max;_step;constructor({labelHtml:t,value:e=50,min:i=0,max:o=100,step:r=1}){this._labelHtml=t,this._value=e,this._min=i,this._max=o,this._step=r;const s=this.createElements();this.container=s.container,this.input=s.input,this.label=s.label,this.update();}updateProgress(){const t=this._max-this._min,e=t<=0?0:(this._value-this._min)/t,i=Math.max(0,Math.min(1,e));return this.container.style.setProperty("--vot-progress",i.toString()),this}update(){return this._value=this.input.valueAsNumber,this._min=+this.input.min,this._max=+this.input.max,this.updateProgress(),this}createElements(){const t=k.createEl("vot-block",["vot-slider"]),e=document.createElement("input");e.type="range",e.min=this._min.toString(),e.max=this._max.toString(),e.step=this._step.toString(),e.value=this._value.toString();const i=k.createEl("span");return et(this._labelHtml,i),t.append(e,i),e.addEventListener("input",()=>{this.update(),this.onInput.dispatch(this._value,false);}),{container:t,label:i,input:e}}addEventListener(t,e){return this.onInput.addListener(e),this}removeEventListener(t,e){return this.onInput.removeListener(e),this}get value(){return this._value}set value(t){this._value=fn(t,this._min,this._max),this.input.value=this._value.toString(),this.updateProgress(),this.onInput.dispatch(this._value,true);}get min(){return this._min}set min(t){this._min=t,this.input.min=this._min.toString(),this._value=fn(this._value,this._min,this._max),this.input.value=this._value.toString(),this.updateProgress();}get max(){return this._max}set max(t){this._max=t,this.input.max=this._max.toString(),this._value=fn(this._value,this._min,this._max),this.input.value=this._value.toString(),this.updateProgress();}get step(){return this._step}set step(t){this._step=t,this.input.step=this._step.toString();}get disabled(){return this.input.disabled}set disabled(t){this.input.disabled=t;}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}}function fn(n,t,e){return !Number.isFinite(n)||e<t?t:Math.max(t,Math.min(e,n))}class Ot{container;strong;text;_labelText;_labelEOL;_value;_symbol;constructor({labelText:t,labelEOL:e="",value:i=50,symbol:o="%"}){this._labelText=t,this._labelEOL=e,this._value=i,this._symbol=o;const r=this.createElements();this.container=r.container,this.strong=r.strong,this.text=r.text;}createElements(){const t=k.createEl("vot-block",["vot-slider-label"]),e=k.createEl("span",["vot-slider-label-text"]);e.textContent=this.labelText;const i=k.createEl("span",["vot-slider-label-value"]);return i.textContent=this.valueText,t.append(e,i),{container:t,strong:i,text:e}}get labelText(){return `${this._labelText}${this._labelEOL}`}get valueText(){return `${this._value}${this._symbol}`}get value(){return this._value}set value(t){this._value=t,this.strong.textContent=this.valueText;}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}}class sg{container;contentWrapper;headerContainer;bodyContainer;footerContainer;titleContainer;title;_position;_titleHtml;menuId=typeof crypto<"u"&&"randomUUID"in crypto?`vot-menu-${crypto.randomUUID()}`:`vot-menu-${Math.random().toString(36).slice(2)}`;titleId=typeof crypto<"u"&&"randomUUID"in crypto?`vot-menu-title-${crypto.randomUUID()}`:`vot-menu-title-${Math.random().toString(36).slice(2)}`;constructor({position:t="default",titleHtml:e=""}){this._position=t,this._titleHtml=e;const i=this.createElements();this.container=i.container,this.contentWrapper=i.contentWrapper,this.headerContainer=i.headerContainer,this.bodyContainer=i.bodyContainer,this.footerContainer=i.footerContainer,this.titleContainer=i.titleContainer,this.title=i.title;}createElements(){const t=k.createEl("vot-block",["vot-menu"]);t.hidden=true,t.id=this.menuId,t.dataset.position=this._position,t.setAttribute("role","dialog"),t.setAttribute("aria-modal","false"),t.setAttribute("aria-hidden","true"),t.toggleAttribute("inert",true);const e=k.createEl("vot-block",["vot-menu-content-wrapper"]);t.appendChild(e);const i=k.createEl("vot-block",["vot-menu-header-container"]),o=k.createEl("vot-block",["vot-menu-title-container"]);i.appendChild(o);const r=k.createEl("vot-block",["vot-menu-title"]);r.id=this.titleId,r.append(this._titleHtml),o.appendChild(r),t.setAttribute("aria-labelledby",this.titleId);const s=k.createEl("vot-block",["vot-menu-body-container"]),a=k.createEl("vot-block",["vot-menu-footer-container"]);return e.append(i,s,a),{container:t,contentWrapper:e,headerContainer:i,bodyContainer:s,footerContainer:a,titleContainer:o,title:r}}setText(t){return this._titleHtml=this.title.textContent=t,this}remove(){return this.container.remove(),this}set hidden(t){it(this.container,t),this.container.setAttribute("aria-hidden",t?"true":"false"),this.container.toggleAttribute("inert",t);}get hidden(){return at(this.container)}get position(){return this._position}set position(t){this._position=this.container.dataset.position=t;}}class ag{mount;globalPortal;abortController=null;defaultVolumePersistTimer;defaultVolumePersistDelayMs=250;dragging=false;dragCandidate=false;dragDirty=false;dragStartX=0;dragStartY=0;currentClientX=0;dragThresholdPx=6;containerRect=null;dragIsBigContainer=null;checkerUnsubscribe=null;initialized=false;data;videoHandler;intervalIdleChecker;events={"click:settings":new R,"click:pip":new R,"click:downloadTranslation":new R,"click:downloadSubtitles":new R,"click:translate":new R,"input:videoVolume":new R,"input:translationVolume":new R,"select:fromLanguage":new R,"select:toLanguage":new R,"select:subtitles":new R};votOverlayPortal;votButton;votButtonTooltip;votMenu;downloadTranslationButton;downloadSubtitlesButton;openSettingsButton;languagePairSelect;subtitlesSelectLabel;subtitlesSelect;videoVolumeSliderLabel;videoVolumeSlider;translationVolumeSliderLabel;translationVolumeSlider;constructor({mount:t,globalPortal:e,data:i={},videoHandler:o,intervalIdleChecker:r}){this.mount=t,this.globalPortal=e,this.data=i,this.videoHandler=o,this.intervalIdleChecker=r;}get root(){return this.mount.root}get portalContainer(){return this.mount.portalContainer}get tooltipLayoutRoot(){return this.mount.tooltipLayoutRoot}updateMount(t){const e=this.mount.root,i=t.root,o=this.mount.portalContainer,r=t.portalContainer,s=this.mount.tooltipLayoutRoot,a=t.tooltipLayoutRoot;return this.mount=t,this.isInitialized()?(this.votOverlayPortal&&o!==r&&r.appendChild(this.votOverlayPortal),e!==i&&(this.votButton&&i.appendChild(this.votButton.container),this.votMenu&&i.appendChild(this.votMenu.container)),this.votButtonTooltip&&s!==a&&this.votButtonTooltip.updateMount({layoutRoot:a??document.documentElement}),this):this}isInitialized(){return this.initialized}calcButtonLayout(t){return this.isBigContainer&&["left","right"].includes(t)?{direction:"column",position:t}:{direction:"row",position:"default"}}addEventListener(t,e){return this.events[t].addListener(e),this}removeEventListener(t,e){return this.events[t].removeListener(e),this}scheduleDefaultVolumePersist(){this.defaultVolumePersistTimer!==void 0&&globalThis.clearTimeout(this.defaultVolumePersistTimer),this.defaultVolumePersistTimer=globalThis.setTimeout(()=>{this.defaultVolumePersistTimer=void 0,this.flushDefaultVolumePersist();},this.defaultVolumePersistDelayMs);}flushDefaultVolumePersist(){this.defaultVolumePersistTimer!==void 0&&(globalThis.clearTimeout(this.defaultVolumePersistTimer),this.defaultVolumePersistTimer=void 0),typeof this.data.defaultVolume=="number"&&E.set("defaultVolume",this.data.defaultVolume);}initUI(t="default"){if(this.isInitialized())throw new Error("[VOT] OverlayView is already initialized");this.initialized=true;const{position:e,direction:i}=this.calcButtonLayout(t);this.votOverlayPortal=k.createPortal(true),this.portalContainer.appendChild(this.votOverlayPortal),this.votButton=new Re({position:e,direction:i,status:"none",labelHtml:g.get("translateVideo")}),this.votButton.opacity=0,this.pipButtonVisible||this.votButton.showPiPButton(false),this.root.appendChild(this.votButton.container),this.votButtonTooltip=new Y({target:this.votButton.translateButton,content:g.get("translateVideo"),position:this.votButton.tooltipPos,hidden:i==="row",bordered:false,parentElement:this.votOverlayPortal,layoutRoot:this.tooltipLayoutRoot}),this.votMenu=new sg({titleHtml:g.get("VOTSettings"),position:e}),this.root.appendChild(this.votMenu.container),this.votButton.menuButton.setAttribute("aria-controls",this.votMenu.container.id),this.downloadTranslationButton=new ig,this.downloadTranslationButton.hidden=true,this.downloadSubtitlesButton=k.createIconButton(jp,{ariaLabel:"Download subtitles"}),this.downloadSubtitlesButton.hidden=true,this.openSettingsButton=k.createIconButton(Zp,{ariaLabel:g.get("VOTSettings")}),this.votMenu.headerContainer.append(this.downloadTranslationButton.button,this.downloadSubtitlesButton,this.openSettingsButton);const o=this.videoHandler?.videoData?.detectedLanguage??"en",r=this.data.responseLanguage??"ru";this.languagePairSelect=new rg({from:{selectTitle:g.get(`langs.${o}`),items:Q.genLanguageItems(Ut,o)},to:{selectTitle:g.get(`langs.${r}`),items:Q.genLanguageItems(Vn,r)}}),this.subtitlesSelectLabel=new wt({labelText:g.get("VOTSubtitles")}),this.subtitlesSelect=new Q({selectTitle:g.get("VOTSubtitlesDisabled"),dialogTitle:g.get("VOTSubtitles"),labelElement:this.subtitlesSelectLabel.container,dialogParent:this.globalPortal,items:[{label:g.get("VOTSubtitlesDisabled"),value:"disabled",selected:true}]});const s=this.videoHandler?this.videoHandler.getVideoVolume()*100:100;this.videoVolumeSliderLabel=new Ot({labelText:g.get("VOTVolume"),value:s}),this.videoVolumeSlider=new _t({labelHtml:this.videoVolumeSliderLabel.container,value:s}),this.videoVolumeSlider.hidden=!this.data.showVideoSlider||this.votButton.status!=="success";const a=this.data.defaultVolume??100;return this.translationVolumeSliderLabel=new Ot({labelText:g.get("VOTVolumeTranslation"),value:a}),this.translationVolumeSlider=new _t({labelHtml:this.translationVolumeSliderLabel.container,value:a,max:this.data.audioBooster?Ur:100}),this.translationVolumeSlider.hidden=this.votButton.status!=="success",this.votMenu.bodyContainer.append(this.languagePairSelect.container,this.subtitlesSelect.container,this.videoVolumeSlider.container,this.translationVolumeSlider.container),this}initUIEvents(){if(!this.isInitialized())throw new Error("[VOT] OverlayView isn't initialized");this.abortController=new AbortController;const t=this.abortController.signal;this.checkerUnsubscribe?.(),this.checkerUnsubscribe=this.intervalIdleChecker.subscribe(()=>{this.onCheckerTick();}),this.votButton.container.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();},{signal:t});const e=a=>l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),a());},i=(a,{returnFocusToToggle:l=false}={})=>{this.isInitialized()&&(this.votMenu.hidden=!a,this.votButton.menuButton.setAttribute("aria-expanded",a.toString()),this.votButtonTooltip&&(this.votButtonTooltip.hidden=a||this.votButton.direction==="row"),a?queueMicrotask(()=>this.openSettingsButton?.focus?.()):l?queueMicrotask(()=>this.votButton.menuButton.focus?.()):this.votButton.menuButton.blur());},o=()=>i(this.votMenu.hidden),r=(a=false)=>i(false,{returnFocusToToggle:a});this.votButton.translateButton.addEventListener("pointerdown",()=>{r(),this.events["click:translate"].dispatch();},{signal:t}),this.votButton.translateButton.addEventListener("keydown",e(()=>{r(),this.events["click:translate"].dispatch();}),{signal:t}),this.votButton.pipButton.addEventListener("pointerdown",()=>{r(),this.events["click:pip"].dispatch();},{signal:t}),this.votButton.pipButton.addEventListener("keydown",e(()=>{r(),this.events["click:pip"].dispatch();}),{signal:t}),this.votButton.menuButton.addEventListener("pointerdown",a=>{a.preventDefault(),o();},{signal:t}),this.votButton.menuButton.addEventListener("keydown",e(o),{signal:t});const s="none";this.votButton.container.style.touchAction=s,this.votButton.translateButton.style.touchAction=s,this.votButton.pipButton.style.touchAction=s,this.votButton.menuButton.style.touchAction=s,this.votButton.container.addEventListener("pointerdown",this.onDragStart,{signal:t}),this.votButton.container.addEventListener("touchstart",this.onTouchDragStart,{signal:t,passive:false}),this.votMenu.container.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();},{signal:t});for(const a of ["pointerdown","mousedown"])this.votMenu.container.addEventListener(a,l=>{l.stopImmediatePropagation();},{signal:t});return document.addEventListener("pointerdown",a=>{if(this.votMenu.hidden)return;const l=a.target,c=typeof a.composedPath=="function"?a.composedPath():[],d=l&&this.votMenu.container.contains(l)||c.includes(this.votMenu.container),u=l&&this.votButton.menuButton.contains(l)||c.includes(this.votButton.menuButton),h=l&&this.votButton.container.contains(l)||c.includes(this.votButton.container),f=l instanceof HTMLElement&&!!l.closest(".vot-dialog-container");d||u||h||f||r(false);},{signal:t,capture:true,passive:true}),this.votMenu.container.addEventListener("keydown",a=>{if(a.key!=="Escape")return;const l=document.documentElement.classList.contains("vot-keyboard-nav");a.preventDefault(),a.stopPropagation(),r(l),this.votButton.container.matches(":hover")||this.votMenu.container.matches(":hover")||this.videoHandler?.overlayVisibility?.queueAutoHide?.();},{signal:t}),this.downloadTranslationButton.addEventListener("click",()=>{this.events["click:downloadTranslation"].dispatch();}),this.downloadSubtitlesButton.addEventListener("click",()=>{this.events["click:downloadSubtitles"].dispatch();},{signal:t}),this.openSettingsButton.addEventListener("click",()=>{r(),this.events["click:settings"].dispatch();},{signal:t}),this.languagePairSelect.fromSelect.addEventListener("selectItem",a=>{this.videoHandler?.videoData&&(this.videoHandler.videoData.detectedLanguage=a),this.events["select:fromLanguage"].dispatch(a);}),this.languagePairSelect.toSelect.addEventListener("selectItem",async a=>{this.videoHandler?.videoData&&(this.videoHandler.translateToLang=this.videoHandler.videoData.responseLanguage=a);const l=this.data.responseLanguage;this.data.responseLanguage=a,await E.set("responseLanguage",this.data.responseLanguage),this.data.enabledDontTranslateLanguages&&Array.isArray(this.data.dontTranslateLanguages)&&this.data.dontTranslateLanguages.length===1&&typeof l=="string"&&this.data.dontTranslateLanguages[0]===l&&(this.data.dontTranslateLanguages=[a],await E.set("dontTranslateLanguages",this.data.dontTranslateLanguages)),this.events["select:toLanguage"].dispatch(a);}),this.subtitlesSelect.addEventListener("beforeOpen",async a=>{if(!this.videoHandler?.videoData)return;const l=this.videoHandler.getSubtitlesCacheKey(this.videoHandler.videoData.videoId,this.videoHandler.videoData.detectedLanguage,this.videoHandler.videoData.responseLanguage);if(this.videoHandler.cacheManager.getSubtitles(l))return;this.votButton&&(this.votButton.loading=true);const c=k.createInlineLoader();c.style.margin="0 auto",a.footerContainer.appendChild(c),await this.videoHandler.loadSubtitles(),c.remove(),this.votButton&&(this.votButton.loading=false);}),this.subtitlesSelect.addEventListener("selectItem",a=>{this.events["select:subtitles"].dispatch(a);}),this.videoVolumeSlider.addEventListener("input",(a,l)=>{this.videoVolumeSliderLabel&&(this.videoVolumeSliderLabel.value=a),!l&&this.events["input:videoVolume"].dispatch(a);}),this.translationVolumeSlider.addEventListener("input",(a,l)=>{this.translationVolumeSliderLabel&&(this.translationVolumeSliderLabel.value=a),this.data.defaultVolume=a,this.scheduleDefaultVolumePersist(),!l&&this.events["input:translationVolume"].dispatch(a);}),this}updateButtonLayout(t,e){return this.isInitialized()?(this.votMenu.position=t,this.votButton.position=t,this.votButton.direction=e,this.votButtonTooltip.hidden=e==="row",this.votButtonTooltip.setPosition(this.votButton.tooltipPos),this):this}moveButton(t){if(!this.isInitialized())return this;const e=this.dragIsBigContainer??this.isBigContainer,i=Re.calcPosition(t,e);if(i===this.votButton.position)return this;const o=Re.calcDirection(i);return this.data.buttonPos=i,this.updateButtonLayout(i,o),this}onDragStart=t=>{!t.isPrimary||t.button!==0||t.pointerType!=="touch"&&(t.preventDefault(),this.dragCandidate=true,this.dragging=false,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.currentClientX=t.clientX,this.containerRect=this.root.getBoundingClientRect(),this.dragIsBigContainer=this.isBigContainer,this.dragDirty=false,this.intervalIdleChecker.markActivity("overlay-pointer-down"),this.intervalIdleChecker.requestImmediateTick(),document.addEventListener("pointermove",this.onGlobalPointerMove),document.addEventListener("pointerup",this.onDragEnd),document.addEventListener("pointercancel",this.onDragEnd));};onTouchDragStart=t=>{if(!t.touches||t.touches.length===0)return;this.dragCandidate=true,this.dragging=false;const e=t.touches[0];this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.currentClientX=e.clientX,this.containerRect=this.root.getBoundingClientRect(),this.dragIsBigContainer=this.isBigContainer,this.dragDirty=false,this.intervalIdleChecker.markActivity("overlay-touch-start"),this.intervalIdleChecker.requestImmediateTick(),document.addEventListener("touchmove",this.onGlobalTouchMove,{passive:false}),document.addEventListener("touchend",this.onDragEnd),document.addEventListener("touchcancel",this.onDragEnd);};onGlobalTouchMove=t=>{if(!t.touches||t.touches.length===0)return;const e=t.touches[0];this.currentClientX=e.clientX;const i=e.clientY;if(this.dragCandidate){if(!this.dragging){const o=Math.abs(this.currentClientX-this.dragStartX),r=Math.abs(i-this.dragStartY);o+r>=this.dragThresholdPx&&(this.dragging=true);}this.dragging&&t.preventDefault(),this.dragging&&(this.dragDirty=true,this.intervalIdleChecker.markActivity("overlay-touch-move"),this.intervalIdleChecker.requestImmediateTick());}};onGlobalPointerMove=t=>{this.currentClientX=t.clientX;const e=t.clientY;if(this.dragCandidate){if(!this.dragging){const i=Math.abs(this.currentClientX-this.dragStartX),o=Math.abs(e-this.dragStartY);i+o>=this.dragThresholdPx&&(this.dragging=true);}this.dragging&&(this.dragDirty=true,this.intervalIdleChecker.markActivity("overlay-pointer-move"),this.intervalIdleChecker.requestImmediateTick());}};applyDragFromState=()=>{if(!this.dragging||!this.dragDirty||!this.containerRect)return;this.dragDirty=false;const t=this.currentClientX-this.containerRect.left,i=Math.max(0,Math.min(t,this.containerRect.width))/this.containerRect.width*100;this.moveButton(i);};onCheckerTick=()=>{this.applyDragFromState();};onDragEnd=()=>{document.removeEventListener("pointermove",this.onGlobalPointerMove),document.removeEventListener("pointerup",this.onDragEnd),document.removeEventListener("pointercancel",this.onDragEnd),document.removeEventListener("touchmove",this.onGlobalTouchMove),document.removeEventListener("touchend",this.onDragEnd),document.removeEventListener("touchcancel",this.onDragEnd),this.applyDragFromState();const t=this.dragIsBigContainer??this.isBigContainer;this.dragging&&t&&this.data.buttonPos&&E.set("buttonPos",this.data.buttonPos),this.dragging=false,this.dragCandidate=false,this.dragDirty=false,this.containerRect=null,this.dragIsBigContainer=null;};updateButtonOpacity(t){return !this.isInitialized()||!this.votMenu.hidden?this:(Math.abs(this.votButton.opacity-t)>.01&&(this.votButton.opacity=t),this)}doReleaseUI(){this.votButton?.remove(),this.votMenu?.remove(),this.votButtonTooltip?.release(),this.votOverlayPortal?.remove();}doReleaseUIEvents(){this.abortController?.abort(),this.abortController=null,this.checkerUnsubscribe?.(),this.checkerUnsubscribe=null,this.onDragEnd(),this.flushDefaultVolumePersist();for(const t of Object.values(this.events))t.clear();}releaseUI(t=false){if(!this.isInitialized())throw new Error("[VOT] OverlayView isn't initialized");return this.doReleaseUI(),this.initialized=t,this}releaseUIEvents(t=false){if(!this.isInitialized())throw new Error("[VOT] OverlayView isn't initialized");return this.doReleaseUIEvents(),this.initialized=t,this}release(){return this.isInitialized()?(this.doReleaseUIEvents(),this.doReleaseUI(),this.initialized=false,this):this}get isBigContainer(){const t=this.videoHandler?.video?.getBoundingClientRect?.().width;if(typeof t=="number"&&Number.isFinite(t))return t>550;const e=this.videoHandler?.container?.getBoundingClientRect?.().width;return typeof e=="number"&&Number.isFinite(e)?e>550:this.root.clientWidth>550}get pipButtonVisible(){return Wr()&&!!this.data.showPiPButton}}const lg=["default","top","left","right"],cg={AmazonBot:"amazonbot","Amazon Silk":"amazon_silk","Android Browser":"android",BaiduSpider:"baiduspider",Bada:"bada",BingCrawler:"bingcrawler",Brave:"brave",BlackBerry:"blackberry","ChatGPT-User":"chatgpt_user",Chrome:"chrome",ClaudeBot:"claudebot",Chromium:"chromium",Diffbot:"diffbot",DuckDuckBot:"duckduckbot",DuckDuckGo:"duckduckgo",Electron:"electron",Epiphany:"epiphany",FacebookExternalHit:"facebookexternalhit",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot",GPTBot:"gptbot","Internet Explorer":"ie",InternetArchiveCrawler:"internetarchivecrawler","K-Meleon":"k_meleon",LibreWolf:"librewolf",Linespider:"linespider",Maxthon:"maxthon","Meta-ExternalAds":"meta_externalads","Meta-ExternalAgent":"meta_externalagent","Meta-ExternalFetcher":"meta_externalfetcher","Meta-WebIndexer":"meta_webindexer","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver","OAI-SearchBot":"oai_searchbot",Omgilibot:"omgilibot",Opera:"opera","Opera Coast":"opera_coast","Pale Moon":"pale_moon",PerplexityBot:"perplexitybot","Perplexity-User":"perplexity_user",PhantomJS:"phantomjs",PingdomBot:"pingdombot",Puffin:"puffin",QQ:"qq",QQLite:"qqlite",QupZilla:"qupzilla",Roku:"roku",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SlackBot:"slackbot",SeaMonkey:"seamonkey",Sleipnir:"sleipnir","Sogou Browser":"sogou",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat",YahooSlurp:"yahooslurp","Yandex Browser":"yandex",YandexBot:"yandexbot",YouBot:"youbot"},Cs={amazonbot:"AmazonBot",amazon_silk:"Amazon Silk",android:"Android Browser",baiduspider:"BaiduSpider",bada:"Bada",bingcrawler:"BingCrawler",blackberry:"BlackBerry",brave:"Brave",chatgpt_user:"ChatGPT-User",chrome:"Chrome",claudebot:"ClaudeBot",chromium:"Chromium",diffbot:"Diffbot",duckduckbot:"DuckDuckBot",duckduckgo:"DuckDuckGo",edge:"Microsoft Edge",electron:"Electron",epiphany:"Epiphany",facebookexternalhit:"FacebookExternalHit",firefox:"Firefox",focus:"Focus",generic:"Generic",google_search:"Google Search",googlebot:"Googlebot",gptbot:"GPTBot",ie:"Internet Explorer",internetarchivecrawler:"InternetArchiveCrawler",k_meleon:"K-Meleon",librewolf:"LibreWolf",linespider:"Linespider",maxthon:"Maxthon",meta_externalads:"Meta-ExternalAds",meta_externalagent:"Meta-ExternalAgent",meta_externalfetcher:"Meta-ExternalFetcher",meta_webindexer:"Meta-WebIndexer",mz:"MZ Browser",naver:"NAVER Whale Browser",oai_searchbot:"OAI-SearchBot",omgilibot:"Omgilibot",opera:"Opera",opera_coast:"Opera Coast",pale_moon:"Pale Moon",perplexitybot:"PerplexityBot",perplexity_user:"Perplexity-User",phantomjs:"PhantomJS",pingdombot:"PingdomBot",puffin:"Puffin",qq:"QQ Browser",qqlite:"QQ Browser Lite",qupzilla:"QupZilla",roku:"Roku",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",slackbot:"SlackBot",sleipnir:"Sleipnir",sogou:"Sogou Browser",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yahooslurp:"YahooSlurp",yandex:"Yandex Browser",yandexbot:"YandexBot",youbot:"YouBot"},I={bot:"bot",desktop:"desktop",mobile:"mobile",tablet:"tablet",tv:"tv"},j={Android:"Android",Bada:"Bada",BlackBerry:"BlackBerry",ChromeOS:"Chrome OS",HarmonyOS:"HarmonyOS",iOS:"iOS",Linux:"Linux",MacOS:"macOS",PlayStation4:"PlayStation 4",Roku:"Roku",Tizen:"Tizen",WebOS:"WebOS",Windows:"Windows",WindowsPhone:"Windows Phone"},kt={Blink:"Blink",EdgeHTML:"EdgeHTML",Gecko:"Gecko",Presto:"Presto",Trident:"Trident",WebKit:"WebKit"};class p{static getFirstMatch(t,e){const i=e.match(t);return i&&i.length>0&&i[1]||""}static getSecondMatch(t,e){const i=e.match(t);return i&&i.length>1&&i[2]||""}static matchAndReturnConst(t,e,i){if(t.test(e))return i}static getWindowsVersionName(t){switch(t){case "NT":return "NT";case "XP":return "XP";case "NT 5.0":return "2000";case "NT 5.1":return "XP";case "NT 5.2":return "2003";case "NT 6.0":return "Vista";case "NT 6.1":return "7";case "NT 6.2":return "8";case "NT 6.3":return "8.1";case "NT 10.0":return "10";default:return}}static getMacOSVersionName(t){const e=t.split(".").splice(0,2).map(r=>parseInt(r,10)||0);e.push(0);const i=e[0],o=e[1];if(i===10)switch(o){case 5:return "Leopard";case 6:return "Snow Leopard";case 7:return "Lion";case 8:return "Mountain Lion";case 9:return "Mavericks";case 10:return "Yosemite";case 11:return "El Capitan";case 12:return "Sierra";case 13:return "High Sierra";case 14:return "Mojave";case 15:return "Catalina";default:return}switch(i){case 11:return "Big Sur";case 12:return "Monterey";case 13:return "Ventura";case 14:return "Sonoma";case 15:return "Sequoia";default:return}}static getAndroidVersionName(t){const e=t.split(".").splice(0,2).map(i=>parseInt(i,10)||0);if(e.push(0),!(e[0]===1&&e[1]<5)){if(e[0]===1&&e[1]<6)return "Cupcake";if(e[0]===1&&e[1]>=6)return "Donut";if(e[0]===2&&e[1]<2)return "Eclair";if(e[0]===2&&e[1]===2)return "Froyo";if(e[0]===2&&e[1]>2)return "Gingerbread";if(e[0]===3)return "Honeycomb";if(e[0]===4&&e[1]<1)return "Ice Cream Sandwich";if(e[0]===4&&e[1]<4)return "Jelly Bean";if(e[0]===4&&e[1]>=4)return "KitKat";if(e[0]===5)return "Lollipop";if(e[0]===6)return "Marshmallow";if(e[0]===7)return "Nougat";if(e[0]===8)return "Oreo";if(e[0]===9)return "Pie"}}static getVersionPrecision(t){return t.split(".").length}static compareVersions(t,e,i=false){const o=p.getVersionPrecision(t),r=p.getVersionPrecision(e);let s=Math.max(o,r),a=0;const l=p.map([t,e],c=>{const d=s-p.getVersionPrecision(c),u=c+new Array(d+1).join(".0");return p.map(u.split("."),h=>new Array(20-h.length).join("0")+h).reverse()});for(i&&(a=s-Math.min(o,r)),s-=1;s>=a;){if(l[0][s]>l[1][s])return 1;if(l[0][s]===l[1][s]){if(s===a)return 0;s-=1;}else if(l[0][s]<l[1][s])return  -1}}static map(t,e){const i=[];let o;if(Array.prototype.map)return Array.prototype.map.call(t,e);for(o=0;o<t.length;o+=1)i.push(e(t[o]));return i}static find(t,e){let i,o;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(i=0,o=t.length;i<o;i+=1){const r=t[i];if(e(r,i))return r}}static assign(t,...e){const i=t;let o,r;if(Object.assign)return Object.assign(t,...e);for(o=0,r=e.length;o<r;o+=1){const s=e[o];typeof s=="object"&&s!==null&&Object.keys(s).forEach(l=>{i[l]=s[l];});}return t}static getBrowserAlias(t){return cg[t]}static getBrowserTypeByAlias(t){return Cs[t]||""}}const P=/version\/(\d+(\.?_?\d+)+)/i,dg=[{test:[/gptbot/i],describe(n){const t={name:"GPTBot"},e=p.getFirstMatch(/gptbot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/chatgpt-user/i],describe(n){const t={name:"ChatGPT-User"},e=p.getFirstMatch(/chatgpt-user\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/oai-searchbot/i],describe(n){const t={name:"OAI-SearchBot"},e=p.getFirstMatch(/oai-searchbot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/claudebot/i,/claude-web/i,/claude-user/i,/claude-searchbot/i],describe(n){const t={name:"ClaudeBot"},e=p.getFirstMatch(/(?:claudebot|claude-web|claude-user|claude-searchbot)\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/omgilibot/i,/webzio-extended/i],describe(n){const t={name:"Omgilibot"},e=p.getFirstMatch(/(?:omgilibot|webzio-extended)\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/diffbot/i],describe(n){const t={name:"Diffbot"},e=p.getFirstMatch(/diffbot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/perplexitybot/i],describe(n){const t={name:"PerplexityBot"},e=p.getFirstMatch(/perplexitybot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/perplexity-user/i],describe(n){const t={name:"Perplexity-User"},e=p.getFirstMatch(/perplexity-user\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/youbot/i],describe(n){const t={name:"YouBot"},e=p.getFirstMatch(/youbot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/meta-webindexer/i],describe(n){const t={name:"Meta-WebIndexer"},e=p.getFirstMatch(/meta-webindexer\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/meta-externalads/i],describe(n){const t={name:"Meta-ExternalAds"},e=p.getFirstMatch(/meta-externalads\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/meta-externalagent/i],describe(n){const t={name:"Meta-ExternalAgent"},e=p.getFirstMatch(/meta-externalagent\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/meta-externalfetcher/i],describe(n){const t={name:"Meta-ExternalFetcher"},e=p.getFirstMatch(/meta-externalfetcher\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/googlebot/i],describe(n){const t={name:"Googlebot"},e=p.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/linespider/i],describe(n){const t={name:"Linespider"},e=p.getFirstMatch(/(?:linespider)(?:-[-\w]+)?[\s/](\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/amazonbot/i],describe(n){const t={name:"AmazonBot"},e=p.getFirstMatch(/amazonbot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/bingbot/i],describe(n){const t={name:"BingCrawler"},e=p.getFirstMatch(/bingbot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/baiduspider/i],describe(n){const t={name:"BaiduSpider"},e=p.getFirstMatch(/baiduspider\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/duckduckbot/i],describe(n){const t={name:"DuckDuckBot"},e=p.getFirstMatch(/duckduckbot\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/ia_archiver/i],describe(n){const t={name:"InternetArchiveCrawler"},e=p.getFirstMatch(/ia_archiver\/(\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/facebookexternalhit/i,/facebookcatalog/i],describe(){return {name:"FacebookExternalHit"}}},{test:[/slackbot/i,/slack-imgProxy/i],describe(n){const t={name:"SlackBot"},e=p.getFirstMatch(/(?:slackbot|slack-imgproxy)(?:-[-\w]+)?[\s/](\d+(\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/yahoo!?[\s/]*slurp/i],describe(){return {name:"YahooSlurp"}}},{test:[/yandexbot/i,/yandexmobilebot/i],describe(){return {name:"YandexBot"}}},{test:[/pingdom/i],describe(){return {name:"PingdomBot"}}},{test:[/opera/i],describe(n){const t={name:"Opera"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/opr\/|opios/i],describe(n){const t={name:"Opera"},e=p.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/SamsungBrowser/i],describe(n){const t={name:"Samsung Internet for Android"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/Whale/i],describe(n){const t={name:"NAVER Whale Browser"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/PaleMoon/i],describe(n){const t={name:"Pale Moon"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:PaleMoon)[\s/](\d+(?:\.\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/MZBrowser/i],describe(n){const t={name:"MZ Browser"},e=p.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/focus/i],describe(n){const t={name:"Focus"},e=p.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/swing/i],describe(n){const t={name:"Swing"},e=p.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/coast/i],describe(n){const t={name:"Opera Coast"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(n){const t={name:"Opera Touch"},e=p.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/yabrowser/i],describe(n){const t={name:"Yandex Browser"},e=p.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/ucbrowser/i],describe(n){const t={name:"UC Browser"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/Maxthon|mxios/i],describe(n){const t={name:"Maxthon"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/epiphany/i],describe(n){const t={name:"Epiphany"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/puffin/i],describe(n){const t={name:"Puffin"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/sleipnir/i],describe(n){const t={name:"Sleipnir"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/k-meleon/i],describe(n){const t={name:"K-Meleon"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/micromessenger/i],describe(n){const t={name:"WeChat"},e=p.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/qqbrowser/i],describe(n){const t={name:/qqbrowserlite/i.test(n)?"QQ Browser Lite":"QQ Browser"},e=p.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/msie|trident/i],describe(n){const t={name:"Internet Explorer"},e=p.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/\sedg\//i],describe(n){const t={name:"Microsoft Edge"},e=p.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/edg([ea]|ios)/i],describe(n){const t={name:"Microsoft Edge"},e=p.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/vivaldi/i],describe(n){const t={name:"Vivaldi"},e=p.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/seamonkey/i],describe(n){const t={name:"SeaMonkey"},e=p.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/sailfish/i],describe(n){const t={name:"Sailfish"},e=p.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,n);return e&&(t.version=e),t}},{test:[/silk/i],describe(n){const t={name:"Amazon Silk"},e=p.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/phantom/i],describe(n){const t={name:"PhantomJS"},e=p.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/slimerjs/i],describe(n){const t={name:"SlimerJS"},e=p.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const t={name:"BlackBerry"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/(web|hpw)[o0]s/i],describe(n){const t={name:"WebOS Browser"},e=p.getFirstMatch(P,n)||p.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/bada/i],describe(n){const t={name:"Bada"},e=p.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/tizen/i],describe(n){const t={name:"Tizen"},e=p.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/qupzilla/i],describe(n){const t={name:"QupZilla"},e=p.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/librewolf/i],describe(n){const t={name:"LibreWolf"},e=p.getFirstMatch(/(?:librewolf)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/firefox|iceweasel|fxios/i],describe(n){const t={name:"Firefox"},e=p.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/electron/i],describe(n){const t={name:"Electron"},e=p.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/sogoumobilebrowser/i,/metasr/i,/se 2\.[x]/i],describe(n){const t={name:"Sogou Browser"},e=p.getFirstMatch(/(?:sogoumobilebrowser)[\s/](\d+(\.?_?\d+)+)/i,n),i=p.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),o=p.getFirstMatch(/se ([\d.]+)x/i,n),r=e||i||o;return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe(n){const t={name:"Miui"},e=p.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test(n){return n.hasBrand("DuckDuckGo")?true:n.test(/\sDdg\/[\d.]+$/i)},describe(n,t){const e={name:"DuckDuckGo"};if(t){const o=t.getBrandVersion("DuckDuckGo");if(o)return e.version=o,e}const i=p.getFirstMatch(/\sDdg\/([\d.]+)$/i,n);return i&&(e.version=i),e}},{test(n){return n.hasBrand("Brave")},describe(n,t){const e={name:"Brave"};if(t){const i=t.getBrandVersion("Brave");if(i)return e.version=i,e}return e}},{test:[/chromium/i],describe(n){const t={name:"Chromium"},e=p.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,n)||p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/chrome|crios|crmo/i],describe(n){const t={name:"Chrome"},e=p.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/GSA/i],describe(n){const t={name:"Google Search"},e=p.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test(n){const t=!n.test(/like android/i),e=n.test(/android/i);return t&&e},describe(n){const t={name:"Android Browser"},e=p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/playstation 4/i],describe(n){const t={name:"PlayStation 4"},e=p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/safari|applewebkit/i],describe(n){const t={name:"Safari"},e=p.getFirstMatch(P,n);return e&&(t.version=e),t}},{test:[/.*/i],describe(n){const t=/^(.*)\/(.*) /,e=/^(.*)\/(.*)[ \t]\((.*)/,o=n.search("\\(")!==-1?e:t;return {name:p.getFirstMatch(o,n),version:p.getSecondMatch(o,n)}}}],ug=[{test:[/Roku\/DVP/],describe(n){const t=p.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,n);return {name:j.Roku,version:t}}},{test:[/windows phone/i],describe(n){const t=p.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,n);return {name:j.WindowsPhone,version:t}}},{test:[/windows /i],describe(n){const t=p.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,n),e=p.getWindowsVersionName(t);return {name:j.Windows,version:t,versionName:e}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(n){const t={name:j.iOS},e=p.getSecondMatch(/(Version\/)(\d[\d.]+)/,n);return e&&(t.version=e),t}},{test:[/macintosh/i],describe(n){const t=p.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,n).replace(/[_\s]/g,"."),e=p.getMacOSVersionName(t),i={name:j.MacOS,version:t};return e&&(i.versionName=e),i}},{test:[/(ipod|iphone|ipad)/i],describe(n){const t=p.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,n).replace(/[_\s]/g,".");return {name:j.iOS,version:t}}},{test:[/OpenHarmony/i],describe(n){const t=p.getFirstMatch(/OpenHarmony\s+(\d+(\.\d+)*)/i,n);return {name:j.HarmonyOS,version:t}}},{test(n){const t=!n.test(/like android/i),e=n.test(/android/i);return t&&e},describe(n){const t=p.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,n),e=p.getAndroidVersionName(t),i={name:j.Android,version:t};return e&&(i.versionName=e),i}},{test:[/(web|hpw)[o0]s/i],describe(n){const t=p.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,n),e={name:j.WebOS};return t&&t.length&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const t=p.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,n)||p.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,n)||p.getFirstMatch(/\bbb(\d+)/i,n);return {name:j.BlackBerry,version:t}}},{test:[/bada/i],describe(n){const t=p.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,n);return {name:j.Bada,version:t}}},{test:[/tizen/i],describe(n){const t=p.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,n);return {name:j.Tizen,version:t}}},{test:[/linux/i],describe(){return {name:j.Linux}}},{test:[/CrOS/],describe(){return {name:j.ChromeOS}}},{test:[/PlayStation 4/],describe(n){const t=p.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,n);return {name:j.PlayStation4,version:t}}}],hg=[{test:[/googlebot/i],describe(){return {type:I.bot,vendor:"Google"}}},{test:[/linespider/i],describe(){return {type:I.bot,vendor:"Line"}}},{test:[/amazonbot/i],describe(){return {type:I.bot,vendor:"Amazon"}}},{test:[/gptbot/i],describe(){return {type:I.bot,vendor:"OpenAI"}}},{test:[/chatgpt-user/i],describe(){return {type:I.bot,vendor:"OpenAI"}}},{test:[/oai-searchbot/i],describe(){return {type:I.bot,vendor:"OpenAI"}}},{test:[/baiduspider/i],describe(){return {type:I.bot,vendor:"Baidu"}}},{test:[/bingbot/i],describe(){return {type:I.bot,vendor:"Bing"}}},{test:[/duckduckbot/i],describe(){return {type:I.bot,vendor:"DuckDuckGo"}}},{test:[/claudebot/i,/claude-web/i,/claude-user/i,/claude-searchbot/i],describe(){return {type:I.bot,vendor:"Anthropic"}}},{test:[/omgilibot/i,/webzio-extended/i],describe(){return {type:I.bot,vendor:"Webz.io"}}},{test:[/diffbot/i],describe(){return {type:I.bot,vendor:"Diffbot"}}},{test:[/perplexitybot/i],describe(){return {type:I.bot,vendor:"Perplexity AI"}}},{test:[/perplexity-user/i],describe(){return {type:I.bot,vendor:"Perplexity AI"}}},{test:[/youbot/i],describe(){return {type:I.bot,vendor:"You.com"}}},{test:[/ia_archiver/i],describe(){return {type:I.bot,vendor:"Internet Archive"}}},{test:[/meta-webindexer/i],describe(){return {type:I.bot,vendor:"Meta"}}},{test:[/meta-externalads/i],describe(){return {type:I.bot,vendor:"Meta"}}},{test:[/meta-externalagent/i],describe(){return {type:I.bot,vendor:"Meta"}}},{test:[/meta-externalfetcher/i],describe(){return {type:I.bot,vendor:"Meta"}}},{test:[/facebookexternalhit/i,/facebookcatalog/i],describe(){return {type:I.bot,vendor:"Meta"}}},{test:[/slackbot/i,/slack-imgProxy/i],describe(){return {type:I.bot,vendor:"Slack"}}},{test:[/yahoo/i],describe(){return {type:I.bot,vendor:"Yahoo"}}},{test:[/yandexbot/i,/yandexmobilebot/i],describe(){return {type:I.bot,vendor:"Yandex"}}},{test:[/pingdom/i],describe(){return {type:I.bot,vendor:"Pingdom"}}},{test:[/huawei/i],describe(n){const t=p.getFirstMatch(/(can-l01)/i,n)&&"Nova",e={type:I.mobile,vendor:"Huawei"};return t&&(e.model=t),e}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return {type:I.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return {type:I.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return {type:I.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return {type:I.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return {type:I.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return {type:I.tablet}}},{test(n){const t=n.test(/ipod|iphone/i),e=n.test(/like (ipod|iphone)/i);return t&&!e},describe(n){const t=p.getFirstMatch(/(ipod|iphone)/i,n);return {type:I.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return {type:I.mobile,vendor:"Nexus"}}},{test:[/Nokia/i],describe(n){const t=p.getFirstMatch(/Nokia\s+([0-9]+(\.[0-9]+)?)/i,n),e={type:I.mobile,vendor:"Nokia"};return t&&(e.model=t),e}},{test:[/[^-]mobi/i],describe(){return {type:I.mobile}}},{test(n){return n.getBrowserName(true)==="blackberry"},describe(){return {type:I.mobile,vendor:"BlackBerry"}}},{test(n){return n.getBrowserName(true)==="bada"},describe(){return {type:I.mobile}}},{test(n){return n.getBrowserName()==="windows phone"},describe(){return {type:I.mobile,vendor:"Microsoft"}}},{test(n){const t=Number(String(n.getOSVersion()).split(".")[0]);return n.getOSName(true)==="android"&&t>=3},describe(){return {type:I.tablet}}},{test(n){return n.getOSName(true)==="android"},describe(){return {type:I.mobile}}},{test:[/smart-?tv|smarttv/i],describe(){return {type:I.tv}}},{test:[/netcast/i],describe(){return {type:I.tv}}},{test(n){return n.getOSName(true)==="macos"},describe(){return {type:I.desktop,vendor:"Apple"}}},{test(n){return n.getOSName(true)==="windows"},describe(){return {type:I.desktop}}},{test(n){return n.getOSName(true)==="linux"},describe(){return {type:I.desktop}}},{test(n){return n.getOSName(true)==="playstation 4"},describe(){return {type:I.tv}}},{test(n){return n.getOSName(true)==="roku"},describe(){return {type:I.tv}}}],fg=[{test(n){return n.getBrowserName(true)==="microsoft edge"},describe(n){if(/\sedg\//i.test(n))return {name:kt.Blink};const e=p.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,n);return {name:kt.EdgeHTML,version:e}}},{test:[/trident/i],describe(n){const t={name:kt.Trident},e=p.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test(n){return n.test(/presto/i)},describe(n){const t={name:kt.Presto},e=p.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test(n){const t=n.test(/gecko/i),e=n.test(/like gecko/i);return t&&!e},describe(n){const t={name:kt.Gecko},e=p.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}},{test:[/(apple)?webkit\/537\.36/i],describe(){return {name:kt.Blink}}},{test:[/(apple)?webkit/i],describe(n){const t={name:kt.WebKit},e=p.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,n);return e&&(t.version=e),t}}];class Bo{constructor(t,e=false,i=null){if(t==null||t==="")throw new Error("UserAgent parameter can't be empty");this._ua=t;let o=false;typeof e=="boolean"?(o=e,this._hints=i):e!=null&&typeof e=="object"?this._hints=e:this._hints=null,this.parsedResult={},o!==true&&this.parse();}getHints(){return this._hints}hasBrand(t){if(!this._hints||!Array.isArray(this._hints.brands))return  false;const e=t.toLowerCase();return this._hints.brands.some(i=>i.brand&&i.brand.toLowerCase()===e)}getBrandVersion(t){if(!this._hints||!Array.isArray(this._hints.brands))return;const e=t.toLowerCase(),i=this._hints.brands.find(o=>o.brand&&o.brand.toLowerCase()===e);return i?i.version:void 0}getUA(){return this._ua}test(t){return t.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const t=p.find(dg,e=>{if(typeof e.test=="function")return e.test(this);if(Array.isArray(e.test))return e.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA(),this)),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const t=p.find(ug,e=>{if(typeof e.test=="function")return e.test(this);if(Array.isArray(e.test))return e.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os}getOSName(t){const{name:e}=this.getOS();return t?String(e).toLowerCase()||"":e||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(t=false){const{type:e}=this.getPlatform();return t?String(e).toLowerCase()||"":e||""}parsePlatform(){this.parsedResult.platform={};const t=p.find(hg,e=>{if(typeof e.test=="function")return e.test(this);if(Array.isArray(e.test))return e.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const t=p.find(fg,e=>{if(typeof e.test=="function")return e.test(this);if(Array.isArray(e.test))return e.test.some(i=>this.test(i));throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return p.assign({},this.parsedResult)}satisfies(t){const e={};let i=0;const o={};let r=0;if(Object.keys(t).forEach(a=>{const l=t[a];typeof l=="string"?(o[a]=l,r+=1):typeof l=="object"&&(e[a]=l,i+=1);}),i>0){const a=Object.keys(e),l=p.find(a,d=>this.isOS(d));if(l){const d=this.satisfies(e[l]);if(d!==void 0)return d}const c=p.find(a,d=>this.isPlatform(d));if(c){const d=this.satisfies(e[c]);if(d!==void 0)return d}}if(r>0){const a=Object.keys(o),l=p.find(a,c=>this.isBrowser(c,true));if(l!==void 0)return this.compareVersion(o[l])}}isBrowser(t,e=false){const i=this.getBrowserName().toLowerCase();let o=t.toLowerCase();const r=p.getBrowserTypeByAlias(o);return e&&r&&(o=r.toLowerCase()),o===i}compareVersion(t){let e=[0],i=t,o=false;const r=this.getBrowserVersion();if(typeof r=="string")return t[0]===">"||t[0]==="<"?(i=t.substr(1),t[1]==="="?(o=true,i=t.substr(2)):e=[],t[0]===">"?e.push(1):e.push(-1)):t[0]==="="?i=t.substr(1):t[0]==="~"&&(o=true,i=t.substr(1)),e.indexOf(p.compareVersions(r,i,o))>-1}isOS(t){return this.getOSName(true)===String(t).toLowerCase()}isPlatform(t){return this.getPlatformType(true)===String(t).toLowerCase()}isEngine(t){return this.getEngineName(true)===String(t).toLowerCase()}is(t,e=false){return this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)}some(t=[]){return t.some(e=>this.is(e))}}class pg{static getParser(t,e=false,i=null){if(typeof t!="string")throw new Error("UserAgent should be a string");return new Bo(t,e,i)}static parse(t,e=null){return new Bo(t,e).getResult()}static get BROWSER_MAP(){return Cs}static get ENGINE_MAP(){return kt}static get OS_MAP(){return j}static get PLATFORMS_MAP(){return I}}const Me=pg.getParser(globalThis.navigator.userAgent).getResult(),ue="unknown",Do=(...n)=>n.filter(Boolean).join(" ").trim()||ue;function Ms(){const n=Do(Me.os?.name,Me.os?.version),t=Do(Me.browser?.name,Me.browser?.version),e=(()=>{const s=GM_info?.scriptHandler,a=GM_info?.version;return s&&a?`${s} v${a}`:s||a||ue})(),i=GM_info?.script?.version??ue,o=GM_info?.script?.name??ue,r=globalThis?.location?.href??ue;return {os:n,browser:t,loader:e,scriptVersion:i,scriptName:o,url:r}}class gg{container;accountWrapper;buttons;usernameEl;avatarEl;avatarImg;actionButton;refreshButton;tokenButton;onClick=new R;onRefresh=new R;onClickSecret=new R;events={click:this.onClick,"click:secret":this.onClickSecret,refresh:this.onRefresh};_loggedIn;_username;_avatarId;constructor({loggedIn:t=false,username:e="unnamed",avatarId:i="0/0-0"}={}){this._loggedIn=t,this._username=e,this._avatarId=i;const o=this.createElements();this.container=o.container,this.accountWrapper=o.accountWrapper,this.buttons=o.buttons,this.usernameEl=o.usernameEl,this.avatarEl=o.avatarEl,this.avatarImg=o.avatarImg,this.actionButton=o.actionButton,this.refreshButton=o.refreshButton,this.tokenButton=o.tokenButton;}createElements(){const t=k.createEl("vot-block",["vot-account"]),e=k.createEl("vot-block",["vot-account-wrapper"]);e.hidden=!this._loggedIn;const i=k.createEl("img",["vot-account-avatar-img"]);i.src=`${Ji}/${this._avatarId}/islands-retina-middle`,i.loading="lazy",i.alt="user avatar";const o=k.createEl("vot-block",["vot-account-avatar"],i),r=k.createEl("vot-block",["vot-account-username"]);r.textContent=this._username,e.append(o,r);const s=k.createEl("vot-block",["vot-account-buttons"]),a=k.createOutlinedButton(this.buttonText);a.addEventListener("click",()=>{this.onClick.dispatch();});const l=k.createIconButton(ng,{ariaLabel:g.get("VOTLoginViaToken")});l.hidden=this._loggedIn,l.addEventListener("click",()=>{this.onClickSecret.dispatch();});const c=k.createIconButton(eg,{ariaLabel:g.get("VOTRefresh")});return c.addEventListener("click",()=>{this.onRefresh.dispatch();}),s.append(a,l,c),t.append(e,s),{container:t,accountWrapper:e,buttons:s,usernameEl:r,avatarImg:i,avatarEl:o,actionButton:a,refreshButton:c,tokenButton:l}}addEventListener(t,e){return It(this.events,t,e),this}removeEventListener(t,e){return Et(this.events,t,e),this}get buttonText(){return this._loggedIn?g.get("VOTLogout"):g.get("VOTLogin")}get loggedIn(){return this._loggedIn}set loggedIn(t){this._loggedIn=t,this.accountWrapper.hidden=!this._loggedIn,this.actionButton.textContent=this.buttonText,this.tokenButton.hidden=this._loggedIn;}get avatarId(){return this._avatarId}set avatarId(t){this._avatarId=t??"0/0-0",this.avatarImg.src=`${Ji}/${this._avatarId}/islands-retina-middle`;}get username(){return this._username}set username(t){this._username=t??"unnamed",this.usernameEl.textContent=this._username;}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}}class q{container;input;label;onChange=new R;events={change:this.onChange};_labelHtml;_checked;_isSubCheckbox;constructor({labelHtml:t,checked:e=false,isSubCheckbox:i=false}){this._labelHtml=t,this._checked=e,this._isSubCheckbox=i;const o=this.createElements();this.container=o.container,this.input=o.input,this.label=o.label;}createElements(){const t=k.createEl("label",["vot-checkbox"]);this._isSubCheckbox&&t.classList.add("vot-checkbox-sub");const e=document.createElement("input");e.type="checkbox",e.checked=this._checked,e.addEventListener("change",()=>{this._checked=e.checked,this.onChange.dispatch(this._checked);});const i=k.createEl("span");return et(this._labelHtml,i),t.append(e,i),{container:t,input:e,label:i}}addEventListener(t,e){return It(this.events,"change",e),this}removeEventListener(t,e){return Et(this.events,"change",e),this}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}get disabled(){return this.input.disabled}set disabled(t){this.input.disabled=t;}get checked(){return this._checked}set checked(t){this._checked!==t&&(this._checked=this.input.checked=t,this.onChange.dispatch(this._checked));}}class mg{container;header;arrowIcon;onClick=new R;events={click:this.onClick};_titleHtml;constructor({titleHtml:t}){this._titleHtml=t;const e=this.createElements();this.container=e.container,this.header=e.header,this.arrowIcon=e.arrowIcon;}createElements(){const t=k.createEl("vot-block",["vot-details"]);k.makeButtonLike(t);const e=k.createEl("vot-block");e.append(this._titleHtml);const i=k.createEl("vot-block",["vot-details-arrow-icon"]);return et(Ps,i),t.append(e,i),t.addEventListener("click",()=>{this.onClick.dispatch();}),{container:t,header:e,arrowIcon:i}}addEventListener(t,e){return It(this.events,"click",e),this}removeEventListener(t,e){return Et(this.events,"click",e),this}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}}class Ro{container;button;onChange=new R;events={change:this.onChange};_labelHtml;_key;pressedKeys;comboKeys;recording=false;constructor({labelHtml:t,key:e=null}){this._labelHtml=t,this._key=e,this.pressedKeys=new Set,this.comboKeys=new Set;const i=this.createElements();this.container=i.container,this.button=i.button;}stopRecordingKeys(){this.recording=false,document.removeEventListener("keydown",this.keydownHandle),document.removeEventListener("keyup",this.keyupOrBlurHandle),globalThis.removeEventListener("blur",this.blurHandle),delete this.button.dataset.status,this.pressedKeys.clear(),this.comboKeys.clear();}keydownHandle=t=>{if(!(!this.recording||t.repeat)){if(t.preventDefault(),t.code==="Escape"){this.key=null,this.button.textContent=this.keyText,this.stopRecordingKeys();return}this.pressedKeys.add(t.code),this.comboKeys.add(t.code),this.button.textContent=Ve(this.pressedKeys);}};keyupOrBlurHandle=t=>{this.recording&&(t&&(this.pressedKeys.delete(t.code),this.button.textContent=this.pressedKeys.size?Ve(this.pressedKeys):Ve(this.comboKeys),this.pressedKeys.size)||(this.key=this.comboKeys.size?Vs(this.comboKeys):null,this.stopRecordingKeys()));};blurHandle=()=>{this.keyupOrBlurHandle();};createElements(){const t=k.createEl("vot-block",["vot-hotkey"]),e=k.createEl("vot-block",["vot-hotkey-label"]);e.textContent=this._labelHtml;const i=k.createEl("vot-block",["vot-hotkey-button"]);return k.makeButtonLike(i),i.textContent=this.keyText,i.addEventListener("click",()=>{if(this.recording){this.stopRecordingKeys(),this.button.textContent=this.keyText;return}i.dataset.status="active",this.recording=true,this.pressedKeys.clear(),this.comboKeys.clear(),this.button.textContent=g.get("PressTheKeyCombination"),document.addEventListener("keydown",this.keydownHandle),document.addEventListener("keyup",this.keyupOrBlurHandle),globalThis.addEventListener("blur",this.blurHandle);}),t.append(e,i),{container:t,button:i,label:e}}addEventListener(t,e){return It(this.events,"change",e),this}removeEventListener(t,e){return Et(this.events,"change",e),this}set hidden(t){it(this.container,t);}get hidden(){return at(this.container)}get key(){return this._key}get keyText(){return this._key?Ve(this._key):g.get("None")}set key(t){this._key!==t&&(this._key=t,this.button.textContent=this.keyText,this.onChange.dispatch(this._key));}}function Vs(n){return (Array.isArray(n)?n:Array.from(n)).map(e=>e.replace("Key","").replace("Digit","")).join("+")}function Ve(n){let t;typeof n=="string"?t=n.split("+").filter(Boolean):Array.isArray(n)?t=n:t=Array.from(n);const e=o=>{switch(o){case "ControlLeft":case "ControlRight":case "Control":return "Ctrl";case "ShiftLeft":case "ShiftRight":case "Shift":return "Shift";case "AltLeft":case "AltRight":case "Alt":return "Alt";case "MetaLeft":case "MetaRight":case "Meta":return "Meta";case "Space":return "Space";case "ArrowUp":return "↑";case "ArrowDown":return "↓";case "ArrowLeft":return "←";case "ArrowRight":return "→";default:return o.replace("Key","").replace("Digit","")}},i=o=>{const r=e(o);return r==="Ctrl"?0:r==="Alt"?1:r==="Shift"?2:r==="Meta"?3:10};return t.slice().sort((o,r)=>i(o)-i(r)).map(e).join("+")}const vg=["click:bugReport","click:resetSettings","update:account","change:autoTranslate","change:autoSubtitles","change:showVideoVolume","change:audioBooster","change:useLivelyVoice","change:subtitlesHighlightWords","change:subtitlesSmartLayout","change:proxyWorkerHost","change:useNewAudioPlayer","change:onlyBypassMediaCSP","change:showPiPButton","input:subtitlesMaxLength","input:subtitlesFontSize","input:subtitlesBackgroundOpacity","input:autoHideButtonDelay","select:proxyTranslationStatus","select:translationTextService","select:buttonPosition","select:menuLanguage"];function bg(){const n={};for(const t of vg)n[t]=new R;return n}class Yn{static PERSIST_DELAY_MS=250;globalPortal;initialized=false;data;videoHandler;suppressSubtitlesSmartLayoutCheckboxChange=false;events=bg();persistTimerIds={};dialog;accountButton;accountButtonRefreshTooltip;accountButtonTokenTooltip;autoTranslateCheckbox;autoSubtitlesCheckbox;dontTranslateLanguagesCheckbox;dontTranslateLanguagesSelect;autoSetVolumeSliderLabel;autoSetVolumeCheckbox;smartDuckingCheckbox;autoSetVolumeSlider;showVideoVolumeSliderCheckbox;audioBoosterCheckbox;audioBoosterTooltip;syncVolumeCheckbox;downloadWithNameCheckbox;sendNotifyOnCompleteCheckbox;useLivelyVoiceCheckbox;useLivelyVoiceTooltip;useAudioDownloadCheckbox;useAudioDownloadCheckboxLabel;useAudioDownloadCheckboxTooltip;subtitlesDownloadFormatSelectLabel;subtitlesDownloadFormatSelect;subtitlesHighlightWordsCheckbox;subtitlesSmartLayoutCheckbox;subtitlesMaxLengthSliderLabel;subtitlesMaxLengthSlider;subtitlesFontSizeSliderLabel;subtitlesFontSizeSlider;subtitlesBackgroundOpacitySliderLabel;subtitlesBackgroundOpacitySlider;translateHotkeyButton;subtitlesHotkeyButton;proxyWorkerHostTextfield;proxyTranslationStatusSelectLabel;proxyTranslationStatusSelectTooltip;proxyTranslationStatusSelect;translateAPIErrorsCheckbox;useNewAudioPlayerCheckbox;useNewAudioPlayerTooltip;onlyBypassMediaCSPCheckbox;onlyBypassMediaCSPTooltip;translationTextServiceLabel;translationTextServiceSelect;translationTextServiceTooltip;detectServiceLabel;detectServiceSelect;showPiPButtonCheckbox;autoHideButtonDelaySliderLabel;autoHideButtonDelaySlider;buttonPositionSelectLabel;buttonPositionSelect;buttonPositionTooltip;menuLanguageSelectLabel;menuLanguageSelect;bugReportButton;resetSettingsButton;constructor({globalPortal:t,data:e={},videoHandler:i}){this.globalPortal=t,this.data=e,this.videoHandler=i;}isInitialized(){return this.initialized}createAccordionSection(t,e={}){const i=k.createEl("vot-block",["vot-settings-section"]),o=new mg({titleHtml:t});o.container.classList.add("vot-settings-section-header");const r=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,s=`vot-settings-section-header-${r}`,a=`vot-settings-section-content-${r}`;o.container.id=s;const l=k.createEl("vot-block",["vot-settings-section-content"]);l.id=a,l.setAttribute("role","region"),l.setAttribute("aria-labelledby",s),o.container.setAttribute("aria-controls",a);const c=u=>{o.container.dataset.open=u?"true":"false",o.container.setAttribute("aria-expanded",u?"true":"false"),l.hidden=!u;},d=()=>o.container.dataset.open==="true";return c(!!e.open),o.addEventListener("click",()=>{const u=o.container.dataset.open==="true";c(!u);}),i.append(o.container,l),{title:t,container:i,header:o.container,content:l,setOpen:c,getOpen:d}}setSubtitlesSmartLayout(t){this.data.subtitlesSmartLayout=t,E.set("subtitlesSmartLayout",t),this.subtitlesSmartLayoutCheckbox?.checked!==t&&(this.suppressSubtitlesSmartLayoutCheckboxChange=true,this.subtitlesSmartLayoutCheckbox.checked=t,this.suppressSubtitlesSmartLayoutCheckboxChange=false),this.events["change:subtitlesSmartLayout"].dispatch(t);}scheduleStoragePersist(t,e){const i=this.persistTimerIds[t];i!==void 0&&globalThis.clearTimeout(i),this.persistTimerIds[t]=globalThis.setTimeout(()=>{this.persistTimerIds[t]=void 0,E.set(t,e);},Yn.PERSIST_DELAY_MS);}flushStoragePersists(){for(const t of Object.keys(this.persistTimerIds)){const e=this.persistTimerIds[t];if(e===void 0)continue;globalThis.clearTimeout(e),this.persistTimerIds[t]=void 0;const i=this.data[t];typeof i=="number"&&E.set(t,i);}}bindPersistedSetting({control:t,event:e,apply:i,storageKey:o,readPersistedValue:r,logLabel:s,dispatch:a,afterPersist:l}){t.addEventListener(e,async c=>{i(c),await E.set(o,r()),l&&await l(c),a?.(c);});}initUI(){if(this.isInitialized())throw new Error("[VOT] SettingsView is already initialized");this.dialog=new Ln({titleHtml:g.get("VOTSettings")}),this.globalPortal.appendChild(this.dialog.container);const t=this.createAccordionSection(g.get("VOTMyAccount"),{open:true}),e=this.createAccordionSection(g.get("translationSettings"),{open:true}),i=this.createAccordionSection(g.get("subtitlesSettings")),o=this.createAccordionSection(g.get("hotkeysSettings")),r=this.createAccordionSection(g.get("proxySettings")),s=this.createAccordionSection(g.get("miscSettings")),a=this.createAccordionSection(g.get("appearance")),l=this.createAccordionSection(g.get("aboutExtension")),c=[t,e,i,o,r,s,a,l];this.dialog.bodyContainer.append(...c.map(H=>H.container)),this.accountButton=new gg({avatarId:this.data.account?.avatarId,username:this.data.account?.username,loggedIn:!!this.data.account?.token}),E.isSupportOnlyLS?(this.accountButton.refreshButton.setAttribute("disabled","true"),this.accountButton.actionButton.setAttribute("disabled","true")):this.accountButtonRefreshTooltip=new Y({target:this.accountButton.refreshButton,content:g.get("VOTRefresh"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal}),this.accountButtonTokenTooltip=new Y({target:this.accountButton.tokenButton,content:g.get("VOTLoginViaToken"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal}),this.autoTranslateCheckbox=new q({labelHtml:g.get("VOTAutoTranslate"),checked:this.data.autoTranslate}),this.autoSubtitlesCheckbox=new q({labelHtml:g.get("VOTAutoSubtitles"),checked:this.data.autoSubtitles});const d=this.data.dontTranslateLanguages??[];this.dontTranslateLanguagesCheckbox=new q({labelHtml:g.get("DontTranslateSelectedLanguages"),checked:this.data.enabledDontTranslateLanguages}),this.dontTranslateLanguagesSelect=new Q({dialogParent:this.globalPortal,dialogTitle:g.get("DontTranslateSelectedLanguages"),selectTitle:d.map(H=>g.get(`langs.${H}`)).join(", ")||g.get("DontTranslateSelectedLanguages"),items:Q.genLanguageItems(Ut).map(H=>({...H,selected:d.includes(H.value)})),multiSelect:true,labelElement:this.dontTranslateLanguagesCheckbox.container}),this.dontTranslateLanguagesSelect.disabled=!this.dontTranslateLanguagesCheckbox.checked;const u=this.data.autoVolume??Xe;this.autoSetVolumeSliderLabel=new Ot({labelText:g.get("VOTAutoSetVolume"),value:u}),this.autoSetVolumeCheckbox=new q({labelHtml:this.autoSetVolumeSliderLabel.container,checked:this.data.enabledAutoVolume??true}),this.autoSetVolumeSlider=new _t({labelHtml:this.autoSetVolumeCheckbox.container,value:u}),this.autoSetVolumeSlider.disabled=!this.autoSetVolumeCheckbox.checked,this.smartDuckingCheckbox=new q({labelHtml:g.get("smartDucking"),checked:this.data.enabledSmartDucking??true}),this.smartDuckingCheckbox.disabled=!this.autoSetVolumeCheckbox.checked,this.showVideoVolumeSliderCheckbox=new q({labelHtml:g.get("showVideoVolumeSlider"),checked:this.data.showVideoSlider}),this.audioBoosterCheckbox=new q({labelHtml:g.get("VOTAudioBooster"),checked:this.data.audioBooster}),this.videoHandler?.isAudioContextSupported||(this.audioBoosterCheckbox.disabled=true,this.audioBoosterTooltip=new Y({target:this.audioBoosterCheckbox.container,content:g.get("VOTNeedWebAudioAPI"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal})),this.syncVolumeCheckbox=new q({labelHtml:g.get("VOTSyncVolume"),checked:this.data.syncVolume}),this.downloadWithNameCheckbox=new q({labelHtml:g.get("VOTDownloadWithName"),checked:this.data.downloadWithName}),this.downloadWithNameCheckbox.disabled=!Bt,this.sendNotifyOnCompleteCheckbox=new q({labelHtml:g.get("VOTSendNotifyOnComplete"),checked:this.data.sendNotifyOnComplete}),this.useLivelyVoiceCheckbox=new q({labelHtml:g.get("VOTUseLivelyVoice"),checked:this.data.useLivelyVoice}),this.useLivelyVoiceTooltip=new Y({target:this.useLivelyVoiceCheckbox.container,content:g.get("VOTAccountRequired"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal,hidden:!!this.data.account?.token}),this.data.account?.token||(this.useLivelyVoiceCheckbox.disabled=true),this.useAudioDownloadCheckboxLabel=new wt({labelText:g.get("VOTUseAudioDownload"),icon:_o}),this.useAudioDownloadCheckbox=new q({labelHtml:this.useAudioDownloadCheckboxLabel.container,checked:this.data.useAudioDownload}),!Yr&&!(typeof IS_EXTENSION<"u"&&IS_EXTENSION)&&(this.useAudioDownloadCheckbox.disabled=true),this.useAudioDownloadCheckboxTooltip=new Y({target:this.useAudioDownloadCheckboxLabel.container,content:g.get("VOTUseAudioDownloadWarning"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal}),t.content.append(this.accountButton.container),e.content.append(this.autoTranslateCheckbox.container,this.autoSubtitlesCheckbox.container,this.dontTranslateLanguagesSelect.container,this.autoSetVolumeSlider.container,this.smartDuckingCheckbox.container,this.showVideoVolumeSliderCheckbox.container,this.audioBoosterCheckbox.container,this.syncVolumeCheckbox.container,this.downloadWithNameCheckbox.container,this.sendNotifyOnCompleteCheckbox.container,this.useLivelyVoiceCheckbox.container,this.useAudioDownloadCheckbox.container),this.subtitlesDownloadFormatSelectLabel=new wt({labelText:g.get("VOTSubtitlesDownloadFormat")}),this.subtitlesDownloadFormatSelect=new Q({selectTitle:this.data.subtitlesDownloadFormat??g.get("VOTSubtitlesDownloadFormat"),dialogTitle:g.get("VOTSubtitlesDownloadFormat"),dialogParent:this.globalPortal,labelElement:this.subtitlesDownloadFormatSelectLabel.container,items:Qa.map(H=>({label:H.toUpperCase(),value:H,selected:H===this.data.subtitlesDownloadFormat}))}),this.subtitlesHighlightWordsCheckbox=new q({labelHtml:g.get("VOTHighlightWords"),checked:this.data.highlightWords});const h=this.data.subtitlesSmartLayout??true;this.subtitlesSmartLayoutCheckbox=new q({labelHtml:g.get("subtitlesSmartLayout"),checked:h});const f=this.data.subtitlesMaxLength??300;this.subtitlesMaxLengthSliderLabel=new Ot({labelText:g.get("VOTSubtitlesMaxLength"),labelEOL:":",value:f,symbol:""}),this.subtitlesMaxLengthSlider=new _t({labelHtml:this.subtitlesMaxLengthSliderLabel.container,value:f,min:50,max:300});const v=this.data.subtitlesFontSize??20;this.subtitlesFontSizeSliderLabel=new Ot({labelText:g.get("VOTSubtitlesFontSize"),labelEOL:":",value:v,symbol:"px"}),this.subtitlesFontSizeSlider=new _t({labelHtml:this.subtitlesFontSizeSliderLabel.container,value:v,min:8,max:50});const b=this.data.subtitlesOpacity??20;this.subtitlesBackgroundOpacitySliderLabel=new Ot({labelText:g.get("VOTSubtitlesOpacity"),labelEOL:":",value:b,symbol:"%"}),this.subtitlesBackgroundOpacitySlider=new _t({labelHtml:this.subtitlesBackgroundOpacitySliderLabel.container,value:b,min:0,max:100}),i.content.append(this.subtitlesDownloadFormatSelect.container,this.subtitlesHighlightWordsCheckbox.container,this.subtitlesSmartLayoutCheckbox.container,this.subtitlesMaxLengthSlider.container,this.subtitlesFontSizeSlider.container,this.subtitlesBackgroundOpacitySlider.container),this.translateHotkeyButton=new Ro({labelHtml:g.get("translateVideo"),key:this.data.translationHotkey}),this.subtitlesHotkeyButton=new Ro({labelHtml:g.get("VOTSubtitles"),key:this.data.subtitlesHotkey}),o.content.append(this.translateHotkeyButton.container,this.subtitlesHotkeyButton.container),this.proxyWorkerHostTextfield=new In({labelHtml:g.get("VOTProxyWorkerHost"),value:this.data.proxyWorkerHost,placeholder:ge});const y=[g.get("VOTTranslateProxyDisabled"),g.get("VOTTranslateProxyEnabled"),g.get("VOTTranslateProxyEverything")],x=this.data.translateProxyEnabled??0,w=re&&zr.includes(re);this.proxyTranslationStatusSelectLabel=new wt({icon:w?_o:void 0,labelText:g.get("VOTTranslateProxyStatus")}),w&&(this.proxyTranslationStatusSelectTooltip=new Y({target:this.proxyTranslationStatusSelectLabel.icon,content:g.get("VOTTranslateProxyStatusDefault"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal})),this.proxyTranslationStatusSelect=new Q({selectTitle:y[x],dialogTitle:g.get("VOTTranslateProxyStatus"),dialogParent:this.globalPortal,labelElement:this.proxyTranslationStatusSelectLabel.container,items:y.map((H,Ze)=>({label:H,value:Ze.toString(),selected:Ze===x,disabled:Ze===0&&Kr}))}),r.content.append(this.proxyWorkerHostTextfield.container,this.proxyTranslationStatusSelect.container),this.translateAPIErrorsCheckbox=new q({labelHtml:g.get("VOTTranslateAPIErrors"),checked:this.data.translateAPIErrors??true}),this.translateAPIErrorsCheckbox.hidden=g.lang==="ru",this.useNewAudioPlayerCheckbox=new q({labelHtml:g.get("VOTNewAudioPlayer"),checked:this.data.newAudioPlayer}),this.videoHandler?.isAudioContextSupported||(this.useNewAudioPlayerCheckbox.disabled=true,this.useNewAudioPlayerTooltip=new Y({target:this.useNewAudioPlayerCheckbox.container,content:g.get("VOTNeedWebAudioAPI"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal}));const L=this.videoHandler?.site.needBypassCSP?`${g.get("VOTOnlyBypassMediaCSP")} (${g.get("VOTMediaCSPEnabledOnSite")})`:g.get("VOTOnlyBypassMediaCSP");this.onlyBypassMediaCSPCheckbox=new q({labelHtml:L,checked:this.data.onlyBypassMediaCSP,isSubCheckbox:true}),this.videoHandler?.isAudioContextSupported||(this.onlyBypassMediaCSPTooltip=new Y({target:this.onlyBypassMediaCSPCheckbox.container,content:g.get("VOTNeedWebAudioAPI"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal})),this.onlyBypassMediaCSPCheckbox.disabled=!this.data.newAudioPlayer&&!!this.videoHandler?.isAudioContextSupported,this.data.newAudioPlayer||(this.onlyBypassMediaCSPCheckbox.hidden=true),this.translationTextServiceLabel=new wt({labelText:g.get("VOTTranslationTextService"),icon:Oo});const D=this.data.translationService??Je;this.translationTextServiceSelect=new Q({selectTitle:g.get(`services.${D}`),dialogTitle:g.get("VOTTranslationTextService"),dialogParent:this.globalPortal,labelElement:this.translationTextServiceLabel.container,items:as.map(H=>({label:g.get(`services.${H}`),value:H,selected:H===D}))}),this.translationTextServiceTooltip=new Y({target:this.translationTextServiceLabel.icon,content:g.get("VOTNotAffectToVoice"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal}),this.detectServiceLabel=new wt({labelText:g.get("VOTDetectService")});const K=this.data.detectService??Nn;this.detectServiceSelect=new Q({selectTitle:g.get(`services.${K}`),dialogTitle:g.get("VOTDetectService"),dialogParent:this.globalPortal,labelElement:this.detectServiceLabel.container,items:Ff.map(H=>({label:g.get(`services.${H}`),value:H,selected:H===K}))}),this.showPiPButtonCheckbox=new q({labelHtml:g.get("VOTShowPiPButton"),checked:this.data.showPiPButton}),this.showPiPButtonCheckbox.hidden=!Wr();const N=Math.round((this.data.autoHideButtonDelay??Hn)/1e3*10)/10;this.autoHideButtonDelaySliderLabel=new Ot({labelText:g.get("autoHideButtonDelay"),labelEOL:":",value:N,symbol:` ${g.get("secs")}`}),this.autoHideButtonDelaySlider=new _t({labelHtml:this.autoHideButtonDelaySliderLabel.container,value:N,min:.1,max:3,step:.1}),this.buttonPositionSelectLabel=new wt({labelText:g.get("buttonPosition"),icon:Oo});const ht=this.data.buttonPos??"default";this.buttonPositionSelect=new Q({selectTitle:g.get(`position.${ht}`),dialogTitle:g.get("buttonPosition"),labelElement:this.buttonPositionSelectLabel.container,dialogParent:this.globalPortal,items:lg.map(H=>({label:g.get(`position.${H}`),value:H,selected:H===ht}))}),this.buttonPositionTooltip=new Y({target:this.buttonPositionSelectLabel.icon,content:g.get("minButtonPositionContainer"),position:"bottom",backgroundColor:"var(--vot-helper-ondialog)",parentElement:this.globalPortal}),this.menuLanguageSelectLabel=new wt({labelText:g.get("VOTMenuLanguage")}),this.menuLanguageSelect=new Q({selectTitle:g.get(`langs.${g.langOverride}`),dialogTitle:g.get("VOTMenuLanguage"),labelElement:this.menuLanguageSelectLabel.container,dialogParent:this.globalPortal,items:Q.genLanguageItems(g.getAvailableLangs(),g.langOverride)}),this.bugReportButton=k.createOutlinedButton(g.get("VOTBugReport")),this.resetSettingsButton=k.createButton(g.get("resetSettings")),s.content.append(this.translateAPIErrorsCheckbox.container,this.useNewAudioPlayerCheckbox.container,this.onlyBypassMediaCSPCheckbox.container),e.content.append(this.translationTextServiceSelect.container,this.detectServiceSelect.container),a.content.append(this.showPiPButtonCheckbox.container,this.autoHideButtonDelaySlider.container,this.buttonPositionSelect.container,this.menuLanguageSelect.container);const lt=Ms(),M=k.createInformation(`${g.get("VOTVersion")}:`,lt.scriptVersion||GM_info.script.version||g.get("notFound")),mt=k.createInformation(`${g.get("VOTAuthors")}:`,GM_info.script.author||"Toil, SashaXser, MrSoczekXD, mynovelhost, sodapng"),Pt=k.createInformation(`${g.get("VOTLoader")}:`,lt.loader),se=k.createInformation(`${g.get("VOTBrowser")}:`,`${lt.browser} (${lt.os})`),zs=new Date((this.data.localeUpdatedAt??0)*1e3).toLocaleString(),Ws=this.data.localeHash??g.get("notFound"),qs=de`${Ws}<br />(${g.get("VOTUpdatedAt")}
      ${zs})`,Gs=k.createInformation(`${g.get("VOTLocaleHash")}:`,qs),ti=k.createOutlinedButton(g.get("VOTUpdateLocaleFiles"));return ti.addEventListener("click",async()=>{await E.set("localeHash",""),await g.update(true),globalThis.location.reload();}),l.content.append(M.container,mt.container,Pt.container,se.container,Gs.container,ti),this.dialog.footerContainer.append(this.bugReportButton,this.resetSettingsButton),this.initialized=true,this}initUIEvents(){if(!this.isInitialized())throw new Error("[VOT] SettingsView isn't initialized");return this.accountButton.addEventListener("click",async()=>{if(!E.isSupportOnlyLS){if(this.accountButton.loggedIn)return await E.delete("account"),this.data.account={},this.updateAccountInfo();globalThis.open(Hr,"_blank")?.focus();}}),this.accountButton.addEventListener("click:secret",async()=>{const t=new Ln({titleHtml:g.get("VOTLoginViaToken"),isTemp:true});this.globalPortal.appendChild(t.container);const e=k.createEl("vot-block",void 0,g.get("VOTYandexTokenInfo")),i=new In({labelHtml:g.get("VOTYandexToken"),value:this.data.account?.token});i.addEventListener("change",async o=>{this.data.account=o?{expires:Date.now()+3153418e4,token:o}:{},await E.set("account",this.data.account),this.updateAccountInfo();}),t.bodyContainer.append(e,i.container),t.open();}),this.accountButton.addEventListener("refresh",async()=>{E.isSupportOnlyLS||(this.data.account=await E.get("account",{}),this.updateAccountInfo());}),this.bindPersistedSetting({control:this.autoTranslateCheckbox,event:"change",apply:t=>{this.data.autoTranslate=t;},storageKey:"autoTranslate",readPersistedValue:()=>this.data.autoTranslate,logLabel:"autoTranslate",dispatch:t=>this.events["change:autoTranslate"].dispatch(t)}),this.bindPersistedSetting({control:this.autoSubtitlesCheckbox,event:"change",apply:t=>{this.data.autoSubtitles=t;},storageKey:"autoSubtitles",readPersistedValue:()=>this.data.autoSubtitles,logLabel:"autoSubtitles",dispatch:t=>this.events["change:autoSubtitles"].dispatch(t)}),this.dontTranslateLanguagesCheckbox.addEventListener("change",async t=>{this.data.enabledDontTranslateLanguages=t,this.dontTranslateLanguagesSelect.disabled=!t,await E.set("enabledDontTranslateLanguages",this.data.enabledDontTranslateLanguages);}),this.dontTranslateLanguagesSelect.addEventListener("selectItem",async t=>{this.data.dontTranslateLanguages=t,await E.set("dontTranslateLanguages",this.data.dontTranslateLanguages);}),this.bindPersistedSetting({control:this.autoSetVolumeCheckbox,event:"change",apply:t=>{this.data.enabledAutoVolume=t,this.autoSetVolumeSlider.disabled=!t,this.smartDuckingCheckbox.disabled=!t;},storageKey:"enabledAutoVolume",readPersistedValue:()=>this.data.enabledAutoVolume,logLabel:"enabledAutoVolume",afterPersist:async()=>this.videoHandler?.setupAudioSettings?.()}),this.bindPersistedSetting({control:this.smartDuckingCheckbox,event:"change",apply:t=>{this.data.enabledSmartDucking=t;},storageKey:"enabledSmartDucking",readPersistedValue:()=>this.data.enabledSmartDucking,logLabel:"enabledSmartDucking"}),this.bindPersistedSetting({control:this.autoSetVolumeSlider,event:"input",apply:t=>{this.data.autoVolume=this.autoSetVolumeSliderLabel.value=t;},storageKey:"autoVolume",readPersistedValue:()=>this.data.autoVolume,logLabel:"autoVolume"}),this.bindPersistedSetting({control:this.showVideoVolumeSliderCheckbox,event:"change",apply:t=>{this.data.showVideoSlider=t;},storageKey:"showVideoSlider",readPersistedValue:()=>this.data.showVideoSlider,logLabel:"showVideoVolumeSlider",dispatch:t=>this.events["change:showVideoVolume"].dispatch(t)}),this.bindPersistedSetting({control:this.audioBoosterCheckbox,event:"change",apply:t=>{this.data.audioBooster=t;},storageKey:"audioBooster",readPersistedValue:()=>this.data.audioBooster,logLabel:"audioBooster",dispatch:t=>this.events["change:audioBooster"].dispatch(t)}),this.bindPersistedSetting({control:this.syncVolumeCheckbox,event:"change",apply:t=>{this.data.syncVolume=t;},storageKey:"syncVolume",readPersistedValue:()=>this.data.syncVolume,logLabel:"syncVolume"}),this.bindPersistedSetting({control:this.downloadWithNameCheckbox,event:"change",apply:t=>{this.data.downloadWithName=t;},storageKey:"downloadWithName",readPersistedValue:()=>this.data.downloadWithName,logLabel:"downloadWithName"}),this.bindPersistedSetting({control:this.sendNotifyOnCompleteCheckbox,event:"change",apply:t=>{this.data.sendNotifyOnComplete=t;},storageKey:"sendNotifyOnComplete",readPersistedValue:()=>this.data.sendNotifyOnComplete,logLabel:"sendNotifyOnComplete"}),this.bindPersistedSetting({control:this.useLivelyVoiceCheckbox,event:"change",apply:t=>{this.data.useLivelyVoice=t;},storageKey:"useLivelyVoice",readPersistedValue:()=>this.data.useLivelyVoice,logLabel:"useLivelyVoice",dispatch:t=>this.events["change:useLivelyVoice"].dispatch(t)}),this.bindPersistedSetting({control:this.useAudioDownloadCheckbox,event:"change",apply:t=>{this.data.useAudioDownload=t;},storageKey:"useAudioDownload",readPersistedValue:()=>this.data.useAudioDownload,logLabel:"useAudioDownload"}),this.bindPersistedSetting({control:this.subtitlesDownloadFormatSelect,event:"selectItem",apply:t=>{this.data.subtitlesDownloadFormat=t;},storageKey:"subtitlesDownloadFormat",readPersistedValue:()=>this.data.subtitlesDownloadFormat,logLabel:"subtitlesDownloadFormat"}),this.bindPersistedSetting({control:this.subtitlesHighlightWordsCheckbox,event:"change",apply:t=>{this.data.highlightWords=t;},storageKey:"highlightWords",readPersistedValue:()=>this.data.highlightWords,logLabel:"highlightWords",dispatch:t=>this.events["change:subtitlesHighlightWords"].dispatch(t)}),this.subtitlesSmartLayoutCheckbox?.addEventListener("change",t=>{this.suppressSubtitlesSmartLayoutCheckboxChange||this.setSubtitlesSmartLayout(t);}),this.subtitlesMaxLengthSlider.addEventListener("input",t=>{this.subtitlesMaxLengthSliderLabel.value=t,(this.data.subtitlesSmartLayout??true)===true&&this.setSubtitlesSmartLayout(false),this.data.subtitlesMaxLength=t,this.scheduleStoragePersist("subtitlesMaxLength",this.data.subtitlesMaxLength),this.events["input:subtitlesMaxLength"].dispatch(t);}),this.subtitlesFontSizeSlider.addEventListener("input",t=>{this.subtitlesFontSizeSliderLabel.value=t,(this.data.subtitlesSmartLayout??true)===true&&this.setSubtitlesSmartLayout(false),this.data.subtitlesFontSize=t,this.scheduleStoragePersist("subtitlesFontSize",this.data.subtitlesFontSize),this.events["input:subtitlesFontSize"].dispatch(t);}),this.subtitlesBackgroundOpacitySlider.addEventListener("input",t=>{this.subtitlesBackgroundOpacitySliderLabel.value=t,this.data.subtitlesOpacity=t,this.scheduleStoragePersist("subtitlesOpacity",this.data.subtitlesOpacity),this.events["input:subtitlesBackgroundOpacity"].dispatch(t);}),this.bindPersistedSetting({control:this.translateHotkeyButton,event:"change",apply:t=>{this.data.translationHotkey=t;},storageKey:"translationHotkey",readPersistedValue:()=>this.data.translationHotkey,logLabel:"translationHotkey"}),this.bindPersistedSetting({control:this.subtitlesHotkeyButton,event:"change",apply:t=>{this.data.subtitlesHotkey=t;},storageKey:"subtitlesHotkey",readPersistedValue:()=>this.data.subtitlesHotkey,logLabel:"subtitlesHotkey"}),this.proxyWorkerHostTextfield.addEventListener("change",async t=>{this.data.proxyWorkerHost=t||ge,await E.set("proxyWorkerHost",this.data.proxyWorkerHost),A.log("proxyWorkerHost value changed. New value:",this.data.proxyWorkerHost),this.events["change:proxyWorkerHost"].dispatch(t);}),this.proxyTranslationStatusSelect.addEventListener("selectItem",async t=>{this.data.translateProxyEnabled=Number.parseInt(t,10),await E.set("translateProxyEnabled",this.data.translateProxyEnabled),await E.set("translateProxyEnabledDefault",false),A.log("translateProxyEnabled value changed. New value:",this.data.translateProxyEnabled),this.events["select:proxyTranslationStatus"].dispatch(t);}),this.bindPersistedSetting({control:this.translateAPIErrorsCheckbox,event:"change",apply:t=>{this.data.translateAPIErrors=t;},storageKey:"translateAPIErrors",readPersistedValue:()=>this.data.translateAPIErrors,logLabel:"translateAPIErrors"}),this.bindPersistedSetting({control:this.useNewAudioPlayerCheckbox,event:"change",apply:t=>{this.data.newAudioPlayer=t,this.onlyBypassMediaCSPCheckbox.disabled=this.onlyBypassMediaCSPCheckbox.hidden=!t;},storageKey:"newAudioPlayer",readPersistedValue:()=>this.data.newAudioPlayer,logLabel:"newAudioPlayer",dispatch:t=>this.events["change:useNewAudioPlayer"].dispatch(t)}),this.bindPersistedSetting({control:this.onlyBypassMediaCSPCheckbox,event:"change",apply:t=>{this.data.onlyBypassMediaCSP=t;},storageKey:"onlyBypassMediaCSP",readPersistedValue:()=>this.data.onlyBypassMediaCSP,logLabel:"onlyBypassMediaCSP",dispatch:t=>this.events["change:onlyBypassMediaCSP"].dispatch(t)}),this.bindPersistedSetting({control:this.translationTextServiceSelect,event:"selectItem",apply:t=>{this.data.translationService=t;},storageKey:"translationService",readPersistedValue:()=>this.data.translationService,logLabel:"translationService",dispatch:t=>this.events["select:translationTextService"].dispatch(t)}),this.bindPersistedSetting({control:this.detectServiceSelect,event:"selectItem",apply:t=>{this.data.detectService=t;},storageKey:"detectService",readPersistedValue:()=>this.data.detectService,logLabel:"detectService"}),this.bindPersistedSetting({control:this.showPiPButtonCheckbox,event:"change",apply:t=>{this.data.showPiPButton=t;},storageKey:"showPiPButton",readPersistedValue:()=>this.data.showPiPButton,logLabel:"showPiPButton",dispatch:t=>this.events["change:showPiPButton"].dispatch(t)}),this.autoHideButtonDelaySlider.addEventListener("input",t=>{this.autoHideButtonDelaySliderLabel.value=t;const e=Math.round(t*1e3);this.data.autoHideButtonDelay=e,this.scheduleStoragePersist("autoHideButtonDelay",this.data.autoHideButtonDelay),this.events["input:autoHideButtonDelay"].dispatch(t);}),this.bindPersistedSetting({control:this.buttonPositionSelect,event:"selectItem",apply:t=>{this.data.buttonPos=t;},storageKey:"buttonPos",readPersistedValue:()=>this.data.buttonPos,logLabel:"buttonPos",dispatch:t=>this.events["select:buttonPosition"].dispatch(t)}),this.menuLanguageSelect.addEventListener("selectItem",async t=>{await g.changeLang(t)&&(this.data.localeUpdatedAt=await E.get("localeUpdatedAt",0),this.events["select:menuLanguage"].dispatch(t));}),this.bugReportButton.addEventListener("click",()=>this.events["click:bugReport"].dispatch()),this.resetSettingsButton.addEventListener("click",()=>this.events["click:resetSettings"].dispatch()),this}addEventListener(t,e){return this.events[t].addListener(e),this}removeEventListener(t,e){return this.events[t].removeListener(e),this}doReleaseUI(){this.dialog?.remove();for(const t of [this.accountButtonRefreshTooltip,this.accountButtonTokenTooltip,this.audioBoosterTooltip,this.useLivelyVoiceTooltip,this.useAudioDownloadCheckboxTooltip,this.useNewAudioPlayerTooltip,this.onlyBypassMediaCSPTooltip,this.translationTextServiceTooltip,this.proxyTranslationStatusSelectTooltip,this.buttonPositionTooltip])t?.release();}doReleaseUIEvents(){this.flushStoragePersists();for(const t of Object.values(this.events))t.clear();}releaseUI(t=false){if(!this.isInitialized())throw new Error("[VOT] SettingsView isn't initialized");return this.doReleaseUI(),this.initialized=t,this}releaseUIEvents(t=false){if(!this.isInitialized())throw new Error("[VOT] SettingsView isn't initialized");return this.doReleaseUIEvents(),this.initialized=t,this}release(){return this.isInitialized()?(this.doReleaseUIEvents(),this.doReleaseUI(),this.initialized=false,this):this}updateAccountInfo(){if(!this.isInitialized())throw new Error("[VOT] SettingsView isn't initialized");const t=!!this.data.account?.token;return this.accountButton.avatarId=this.data.account?.avatarId,this.useLivelyVoiceTooltip.hidden=this.accountButton.loggedIn=t,this.accountButton.username=this.data.account?.username,this.useLivelyVoiceCheckbox.disabled=!t,this.events["update:account"].dispatch(this.data.account),this}open(){if(!this.isInitialized())throw new Error("[VOT] SettingsView isn't initialized");return this.dialog.open()}close(){if(!this.isInitialized())throw new Error("[VOT] SettingsView isn't initialized");return this.dialog.close()}}const yg=n=>{const t=n.subtitles.map(e=>({text:e.text,startMs:e.startMs,durationMs:e.durationMs,speakerId:e.speakerId,tokens:e.tokens.map(i=>({text:i.text,startMs:i.startMs,durationMs:i.durationMs}))}));return {containsTokens:t.some(e=>e.tokens.length>0),subtitles:t}};class wg{mount;initialized=false;videoHandler;intervalIdleChecker;data;votGlobalPortal;votOverlayView;votSettingsView;constructor({mount:t,data:e={},videoHandler:i,intervalIdleChecker:o}){this.mount=t,this.videoHandler=i,this.data=e,this.intervalIdleChecker=o;}get root(){return this.mount.root}get portalContainer(){return this.mount.portalContainer}get tooltipLayoutRoot(){return this.mount.tooltipLayoutRoot}isInitialized(){return this.initialized}initUI(){if(this.isInitialized())throw new Error("[VOT] UIManager is already initialized");return this.initialized=true,this.votGlobalPortal=k.createPortal(),document.documentElement.appendChild(this.votGlobalPortal),this.votOverlayView=new ag({mount:this.mount,globalPortal:this.votGlobalPortal,data:this.data,videoHandler:this.videoHandler,intervalIdleChecker:this.intervalIdleChecker}),this.votOverlayView.initUI(this.data.buttonPos??"default"),this.votSettingsView=new Yn({globalPortal:this.votGlobalPortal,data:this.data,videoHandler:this.videoHandler}),this.votSettingsView.initUI(),this}updateMount(t){return this.mount=t,this.votOverlayView?.updateMount?.(t),this}initUIEvents(){if(!this.isInitialized())throw new Error("[VOT] UIManager isn't initialized");this.votOverlayView.initUIEvents(),this.votOverlayView.addEventListener("click:translate",async()=>{await this.handleTranslationBtnClick();}).addEventListener("click:pip",async()=>{if(!this.videoHandler)return;await(this.videoHandler.video===document.pictureInPictureElement?document.exitPictureInPicture():this.videoHandler.video.requestPictureInPicture());}).addEventListener("click:settings",async()=>{this.videoHandler?.subtitlesWidget?.releaseTooltip(),this.videoHandler?.overlayVisibility?.cancel(),this.videoHandler?.overlayVisibility?.show(),this.votSettingsView.open(),await vd();}).addEventListener("click:downloadTranslation",async()=>{if(!this.votOverlayView.isInitialized()||!this.videoHandler?.downloadTranslationUrl||!this.videoHandler.videoData)return;const t=this.votOverlayView.downloadTranslationButton,e=this.videoHandler.downloadTranslationUrl,i=Qi(this.videoHandler.videoData.downloadTitle),o=this.videoHandler.site.additionalData==="mobile";t&&(t.progress=0);try{if(o){const s=await nt(e,{timeout:0});if(!s.ok)throw new Error(`HTTP ${s.status}`);const a=await Es(s,i,u=>{t&&(t.progress=u);}),l=new File([a],`${i}.mp3`,{type:a.type||"audio/mpeg"}),c=typeof navigator<"u"&&typeof navigator.canShare=="function"&&navigator.canShare({files:[l]});if(navigator?.share&&c){await navigator.share({files:[l],title:i});return}const d=URL.createObjectURL(a);globalThis.open(d,"_blank")?.focus(),Gr(d);return}if(!this.data.downloadWithName||!Bt){globalThis.open(e,"_blank")?.focus();return}if(!t)throw new Error("[VOT] Download translation button is not initialized");t.progress=0;const r=await nt(e,{timeout:0});if(!r.ok)throw new Error(`HTTP ${r.status}`);await Gp(r,i,s=>{t.progress=s;});}catch(r){console.error("[VOT] Download translation failed:",r),globalThis.open(e,"_blank")?.focus();}finally{t&&(t.progress=0);}}).addEventListener("click:downloadSubtitles",async()=>{const t=this.videoHandler;if(!t?.yandexSubtitles||!t.videoData)return;const e=this.data.subtitlesDownloadFormat??"json",i=vr(yg(t.yandexSubtitles),e),o=new Blob([e==="json"?JSON.stringify(i):i],{type:"text/plain"}),r=this.data.downloadWithName?Qi(t.videoData.downloadTitle):`subtitles_${t.videoData.videoId}`;qr(o,`${r}.${e}`);}).addEventListener("input:videoVolume",t=>{this.videoHandler&&(this.videoHandler.setVideoVolume(t/100),this.data.syncVolume&&this.videoHandler.syncVolumeWrapper("video",t));}).addEventListener("input:translationVolume",t=>{if(!this.videoHandler)return;const e=t??this.data.defaultVolume??100;this.videoHandler.audioPlayer.player.volume=e/100,this.data.syncVolume&&this.videoHandler.syncVolumeWrapper("translation",e);}).addEventListener("select:subtitles",async t=>{await this.videoHandler?.changeSubtitlesLang(t);}),this.votSettingsView.initUIEvents(),this.votSettingsView.addEventListener("update:account",async t=>{this.videoHandler&&(this.videoHandler.votClient.apiToken=t?.token);}).addEventListener("change:autoTranslate",async t=>{t&&this.videoHandler&&!this.videoHandler?.hasActiveSource()&&await this.handleTranslationBtnClick();}).addEventListener("change:autoSubtitles",async t=>{!t||!this.videoHandler?.videoData?.videoId||await this.videoHandler.enableSubtitlesForCurrentLangPair();}).addEventListener("change:showVideoVolume",()=>{this.withInitializedOverlayView(t=>{!t.videoVolumeSlider||!t.votButton||(t.videoVolumeSlider.container.hidden=!this.data.showVideoSlider||t.votButton.status!=="success");});}).addEventListener("change:audioBooster",async()=>{this.withInitializedOverlayView(t=>{if(!t.translationVolumeSlider)return;const e=t.translationVolumeSlider.value,i=this.data.audioBooster?Ur:100;t.translationVolumeSlider.max=i,t.translationVolumeSlider.value=$(e,0,i);});}).addEventListener("change:useLivelyVoice",()=>{this.videoHandler?.stopTranslate();}).addEventListener("change:subtitlesHighlightWords",t=>{this.withSubtitlesWidget(e=>{e.setHighlightWords(this.data.highlightWords??t);});}).addEventListener("change:subtitlesSmartLayout",t=>{this.withSubtitlesWidget(e=>{e.setSmartLayout(this.data.subtitlesSmartLayout??t);});}).addEventListener("input:subtitlesMaxLength",t=>{this.withSubtitlesWidget(e=>{e.setMaxLength(this.data.subtitlesMaxLength??t);});}).addEventListener("input:subtitlesFontSize",t=>{this.withSubtitlesWidget(e=>{e.setFontSize(this.data.subtitlesFontSize??t);});}).addEventListener("input:subtitlesBackgroundOpacity",t=>{this.withSubtitlesWidget(e=>{e.setOpacity(this.data.subtitlesOpacity??t);});}).addEventListener("change:proxyWorkerHost",t=>{this.videoHandler&&this.videoHandler.handleProxySettingsChanged("proxyWorkerHost");}).addEventListener("select:proxyTranslationStatus",()=>{this.videoHandler?.handleProxySettingsChanged("proxyTranslationStatus");}).addEventListener("change:useNewAudioPlayer",()=>{this.restartAudioPlayer();}).addEventListener("change:onlyBypassMediaCSP",()=>{this.restartAudioPlayer();}).addEventListener("select:translationTextService",()=>{this.withSubtitlesWidget(t=>{t.resetTranslationContext(true);});}).addEventListener("change:showPiPButton",()=>{this.withInitializedOverlayView(t=>{t.votButton&&(t.votButton.pipButton.hidden=t.votButton.separator2.hidden=!t.pipButtonVisible);});}).addEventListener("select:buttonPosition",t=>{this.withInitializedOverlayView(e=>{const i=this.data.buttonPos??t;e.updateButtonLayout(i,Re.calcDirection(i));});}).addEventListener("select:menuLanguage",async()=>{await this.reloadMenu();}).addEventListener("click:bugReport",()=>{if(!this.videoHandler)return;const t=new URLSearchParams(this.videoHandler.collectReportInfo()).toString();globalThis.open(`${rd}/issues/new?${t}`,"_blank")?.focus();}).addEventListener("click:resetSettings",async()=>{const t=await E.list();await Promise.all(t.map(async e=>await E.delete(e))),await E.set("compatVersion",me),globalThis.location.reload();});}async reloadMenu(){if(!this.votOverlayView?.isInitialized())throw new Error("[VOT] OverlayView isn't initialized");const t=this.votOverlayView.votButton.opacity,e=this.votOverlayView.votButton.container.hidden,i=this.votOverlayView.votMenu.hidden,o=this.data.buttonPos??"default",r=this.votSettingsView?.dialog?.container?.hidden===false;if(this.videoHandler?.stopTranslation(),this.release(),this.initUI(),this.initUIEvents(),!this.videoHandler)return this;try{const{position:a,direction:l}=this.votOverlayView.calcButtonLayout(o);this.votOverlayView.updateButtonLayout(a,l),this.votOverlayView.votMenu.hidden=i,this.votOverlayView.votButton.container.hidden=e,this.votOverlayView.votButton.opacity=t;}catch{}try{this.videoHandler.rebindOverlayVisibilityTargets();}catch{}if(r)try{this.votSettingsView?.open();}catch{}await this.videoHandler.updateSubtitlesLangSelect();const s=this.videoHandler.subtitlesWidget;return s&&(s.setPortal(this.votOverlayView.votOverlayPortal),s.resetTranslationContext(true)),this}async handleTranslationBtnClick(){if(!this.votOverlayView?.isInitialized())throw new Error("[VOT] OverlayView isn't initialized");if(!this.videoHandler)return this;if(this.videoHandler.hasActiveSource())return this.videoHandler.stopTranslation(),this;if(this.votOverlayView.votButton.status==="error"&&!this.votOverlayView.votButton.loading&&this.transformBtn("none",g.get("translateVideo")),this.votOverlayView.votButton.status!=="none"||this.votOverlayView.votButton.loading)return this.videoHandler.actionsAbortController.abort(),this.videoHandler.stopTranslation(),this;try{if(A.log("[handleTranslationBtnClick] trying execute translation"),!this.videoHandler.videoData?.videoId)throw new rt("VOTNoVideoIDFound");(this.videoHandler.site.host==="vk"&&this.videoHandler.site.additionalData==="clips"||this.videoHandler.site.host==="douyin")&&(this.videoHandler.videoData=await this.videoHandler.getVideoData()),A.log("[handleTranslationBtnClick] Run translateFunc",this.videoHandler.videoData.videoId),await this.videoHandler.translateFunc(this.videoHandler.videoData.videoId,this.videoHandler.videoData.isStream,this.videoHandler.videoData.detectedLanguage,this.videoHandler.videoData.responseLanguage,this.videoHandler.videoData.translationHelp);}catch(t){if(t instanceof Error&&t.name==="AbortError")return this.transformBtn("none",g.get("translateVideo")),this;if(console.error("[VOT]",t),!(t instanceof Error))return this.transformBtn("error",String(t)),this;const e=t.name==="VOTLocalizedError"?t.localizedMessage:t.message;this.transformBtn("error",e);}return this}isLoadingText(t){const e=g.get("TranslationDelayed");return typeof t=="string"&&(t.includes(g.get("translationTake"))||(e?t.includes(e):false))}transformBtn(t,e){if(!this.votOverlayView?.isInitialized())throw new Error("[VOT] OverlayView isn't initialized");return this.votOverlayView.votButton.status=t,this.votOverlayView.votButton.loading=t==="error"&&this.isLoadingText(e),this.votOverlayView.votButton.setText(e),this.votOverlayView.votButtonTooltip.setContent(e),this}releaseUI(t=false){if(!this.isInitialized())throw new Error("[VOT] UIManager isn't initialized");return this.votOverlayView.releaseUI(true),this.votSettingsView.releaseUI(true),this.votGlobalPortal.remove(),this.initialized=t,this}releaseUIEvents(t=false){if(!this.isInitialized())throw new Error("[VOT] UIManager isn't initialized");return this.votOverlayView.releaseUIEvents(false),this.votSettingsView.releaseUIEvents(false),this.initialized=t,this}release(){return this.isInitialized()?(this.votOverlayView.release(),this.votSettingsView.release(),this.votGlobalPortal.remove(),this.initialized=false,this):this}withInitializedOverlayView(t){this.votOverlayView?.isInitialized()&&t(this.votOverlayView);}withSubtitlesWidget(t){const e=this.videoHandler?.subtitlesWidget;e&&t(e);}restartAudioPlayer(){this.videoHandler&&(this.videoHandler.stopTranslate(),this.videoHandler.createPlayer());}}class kg{deps;hideDeadlineMs=0;hideArmed=false;unsubscribeChecker;constructor(t){this.deps=t,this.unsubscribeChecker=this.deps.checker.subscribe(()=>{this.onCheckerTick();});}show(){const t=this.getView();return t?(t.updateButtonOpacity(1),t):null}cancel(){this.hideDeadlineMs=0,this.hideArmed=false;}release(){this.cancel(),this.unsubscribeChecker();}queueAutoHide(){if(!this.show())return;const t=this.deps.getAutoHideDelay();this.hideDeadlineMs=this.nowMs()+Math.max(0,t),this.hideArmed=true,this.deps.checker.markActivity("overlay-queue-hide"),this.deps.checker.requestImmediateTick();}handleOverlayInteraction(t){const e=t?.type;if(e){if(e==="focusin"){this.handleFocusIn();return}if(e.startsWith("pointer")){this.cancel(),this.show(),this.deps.checker.markActivity("overlay-interaction"),t.stopPropagation?.();return}this.handleHostInteraction(t);}}handleHostInteraction(t){const e=t?.type;if(e){if(e==="focusin"){this.handleFocusIn();return}if(e.startsWith("pointer")){const i=t.target;this.deps.isInteractiveNode(i)&&t.stopPropagation?.(),this.deps.checker.markActivity("overlay-host-pointer");}this.queueAutoHide();}}scheduleHide(t){if(!this.getView())return;const e=t?.currentTarget;let i=t?.relatedTarget??null;!i&&typeof t?.composedPath=="function"&&(i=t.composedPath()[1]??null);const o=i instanceof Node?i:null,r=e instanceof Node?e:null;o&&(r?.contains(o)||this.deps.isInteractiveNode(o))||this.queueAutoHide();}onCheckerTick(){if(!this.hideArmed||this.hideDeadlineMs<=0||this.nowMs()+2<this.hideDeadlineMs)return;this.hideArmed=false;let e=null;if(typeof document<"u"&&typeof document.hasFocus=="function"&&document.hasFocus()&&(e=document.activeElement),e&&this.deps.isInteractiveNode(e))return;this.getView()?.updateButtonOpacity(0);}handleFocusIn(){this.cancel(),this.show(),this.deps.checker.markActivity("overlay-focus-in");}getView(){const t=this.deps.getOverlayView();return t?.isInitialized()?t:null}nowMs(){return this.deps.nowMs?this.deps.nowMs():typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}}const Sg={activeIntervalMs:16,idleIntervalMs:120,hiddenIntervalMs:250,idleAfterMs:180};function xg(){return {nowMs:()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),setInterval:globalThis.setInterval.bind(globalThis),clearInterval:globalThis.clearInterval.bind(globalThis),queueMicrotask:n=>{if(typeof queueMicrotask=="function"){queueMicrotask(n);return}Promise.resolve().then(n);},isDocumentHidden:()=>typeof document<"u"&&typeof document.hidden=="boolean"?document.hidden:false}}class Tg{profile;runtime;subscribers=new Set;timerId=null;running=false;destroyed=false;immediateQueued=false;currentMode="active";lastActivityAt;constructor(t={}){this.profile={...Sg,...t.profile},this.runtime={...xg(),...t.runtime},this.lastActivityAt=this.runtime.nowMs();}start(){this.destroyed||this.running||(this.running=true,this.lastActivityAt=this.runtime.nowMs(),this.runTick("start"));}stop(){this.running&&(this.running=false,this.clearTimer(),this.immediateQueued=false);}destroy(){this.destroyed||(this.stop(),this.subscribers.clear(),this.destroyed=true);}subscribe(t){return this.destroyed?()=>{}:(this.subscribers.add(t),()=>{this.subscribers.delete(t);})}markActivity(t){if(this.destroyed||(this.lastActivityAt=this.runtime.nowMs(),!this.running))return;const e=this.resolveMode(this.lastActivityAt);e!==this.currentMode&&(this.currentMode=e,this.restartTimer(e));}requestImmediateTick(){this.destroyed||!this.running||this.immediateQueued||(this.immediateQueued=true,this.runtime.queueMicrotask(()=>{this.immediateQueued=false,!(this.destroyed||!this.running)&&this.runTick("immediate");}));}resolveMode(t){return this.runtime.isDocumentHidden()?"hidden":t-this.lastActivityAt>=this.profile.idleAfterMs?"idle":"active"}intervalForMode(t){return t==="hidden"?this.profile.hiddenIntervalMs:t==="idle"?this.profile.idleIntervalMs:this.profile.activeIntervalMs}clearTimer(){this.timerId!==null&&(this.runtime.clearInterval(this.timerId),this.timerId=null);}restartTimer(t){this.clearTimer();const e=Math.max(1,this.intervalForMode(t));this.timerId=this.runtime.setInterval(()=>{this.runTick("interval");},e);}runTick(t){const e=this.runtime.nowMs(),i=this.resolveMode(e);(i!==this.currentMode||this.timerId===null)&&(this.currentMode=i,this.restartTimer(i));const o={nowMs:e,mode:i,source:t};for(const r of this.subscribers)try{r(o);}catch{}}}function Xn(n){return new Tg({profile:n})}const _s=()=>Date.now();function pn(){return GM_info?.script?.name||"VOT"}function Ag(n,t){try{return g?.get?.(n)||t}catch{return t}}function Lg(n,t,e){if(!e)return  true;const i=n.get(t)??0;return _s()-i>=e}function Ig(n,t){n.set(t,_s());}function Eg(n){try{if(typeof GM_notification=="function")return GM_notification(n),!0;const t=globalThis.GM;if(t!==void 0&&typeof t.notification=="function"){const e={text:n.text,title:n.title,image:n.image,onclick:n.onclick,ondone:n.ondone};return t.notification(e),!0}}catch{}return  false}class Pg{lastSentAt=new Map;send(t,e={}){try{const i=e.key||t.tag||`${t.title??""}|${t.text??""}`,o=e.cooldownMs??0;if(!Lg(this.lastSentAt,i,o))return;const r={...t,title:t.title??pn()};Eg(r)?Ig(this.lastSentAt,i):A.log("[notify] unavailable",r);}catch{}}translationCompleted(t){const e=Ag("VOTTranslationCompletedNotify","The translation on the {0} has been completed!").replace("{0}",t);this.send({text:e,title:pn(),timeout:5e3,silent:true,tag:"VOTTranslationCompleted",onclick:()=>{try{globalThis.focus();}catch{}}},{key:`translation_completed_${t}`,cooldownMs:1e4});}translationFailed(t){const{videoId:e,message:i}=t;if(Nt(i))return;const o=Pr(i)||"Translation failed",r=pn();this.send({text:o,title:r,timeout:8e3,silent:true,tag:`VOTtranslationFailed_${e||"unknown"}`,onclick:()=>{try{globalThis.focus();}catch{}}},{key:`translation_failed_${e||"unknown"}`,cooldownMs:3e4});}}const Cg=["class","id","title"],We="__votAttachShadowHook";function Mg(){const n=globalThis,t=n[We];if(t?.original&&t.subscribers)return t;const e=Element.prototype.attachShadow;if(typeof e!="function")return null;const i={original:e,subscribers:new Set},o=function(r){const s=e.call(this,r);for(const a of i.subscribers)try{a(s);}catch{}return s};try{Object.defineProperty(Element.prototype,"attachShadow",{configurable:!0,enumerable:!0,writable:!0,value:o});}catch{return null}return n[We]=i,i}function Vg(n){const t=globalThis,e=t[We];if(e&&(e.subscribers.delete(n),!(e.subscribers.size>0))){try{Object.defineProperty(Element.prototype,"attachShadow",{configurable:!0,enumerable:!0,writable:!0,value:e.original});}catch{Element.prototype.attachShadow=e.original;}delete t[We];}}class Jt{static adKeywords=new Set(["advertise","advertisement","promo","sponsor","banner","commercial","preroll","midroll","postroll","ad-container","sponsored"]);seenVideos=new WeakSet;activeVideos=new WeakSet;observedRoots=new WeakSet;pendingAdded=new Set;pendingRemoved=new Set;flushPending=false;static MAX_FLUSH_BUDGET_MS=6;static MAX_NODES_PER_SLICE=120;onVideoAdded=new R;onVideoRemoved=new R;observer=new MutationObserver(t=>this.onMutations(t));intervalIdleChecker;checkerUnsubscribe=null;enabled=false;attachShadowSubscriber=null;onDocumentReady=null;onPageShow=()=>{const t=document.documentElement;t&&(this.pendingAdded.add(t),this.scheduleFlush());};constructor(t=Xn()){this.intervalIdleChecker=t;}static containsAdKeyword(t){for(const e of Jt.adKeywords)if(t===e||t.includes(e))return  true;return  false}isAdRelated(t){for(const e of Cg){const i=t.getAttribute(e);if(!i)continue;const o=i.toLowerCase(),r=e==="class"?o.split(/\s+/):[o];for(const s of r)if(s&&Jt.containsAdKeyword(s))return  true}return  false}isInsideAd(t){for(let e=t.parentElement;e;e=e.parentElement)if(this.isAdRelated(e))return  true;return  false}getCapturedAudioTrackCount(t){const e=t,i=e.captureStream??e.mozCaptureStream;if(typeof i!="function")return null;try{return i.call(t).getAudioTracks().length}catch{return null}}isLikelySilentDecorativeVideo(t){if(!(t.muted||t.defaultMuted)||!t.autoplay||!t.loop||t.controls)return  false;const e=t;if(typeof e.mozHasAudio=="boolean")return !e.mozHasAudio;if("audioTracks"in e&&typeof e.audioTracks?.length=="number"){if(e.audioTracks.length>0)return  false;const o=this.getCapturedAudioTrackCount(t);return o!==null?o===0:true}const i=this.getCapturedAudioTrackCount(t);return i!==null?i===0:false}hasAudio(t){const e=t;return t.srcObject instanceof MediaStream?t.srcObject.getAudioTracks().length>0:typeof e.mozHasAudio=="boolean"?e.mozHasAudio:typeof e.webkitAudioDecodedByteCount=="number"&&e.webkitAudioDecodedByteCount>0||"audioTracks"in e&&typeof e.audioTracks?.length=="number"&&e.audioTracks.length>0?true:!this.isLikelySilentDecorativeVideo(t)}isValidVideo(t){return !(this.isAdRelated(t)||this.isInsideAd(t)||!this.hasAudio(t))}observeRoot(t){this.observedRoots.has(t)||(this.observedRoots.add(t),this.observer.observe(t,{childList:true,subtree:true}));}scan(t){if(t instanceof HTMLVideoElement){this.trackVideo(t);return}if(t.nodeType!==Node.ELEMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&t.nodeType!==Node.DOCUMENT_NODE)return;const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const o=i;return o.tagName==="VIDEO"||o.shadowRoot?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;e.nextNode();){const i=e.currentNode;if(i instanceof HTMLVideoElement){this.trackVideo(i);continue}const o=i.shadowRoot;o&&(this.observeRoot(o),this.scan(o));}}trackVideo(t){if(this.seenVideos.has(t))return;this.seenVideos.add(t);const e=()=>{this.isValidVideo(t)&&(this.activeVideos.has(t)||(this.activeVideos.add(t),this.onVideoAdded.dispatch(t)));};if(t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA)e();else {t.addEventListener("loadeddata",e,{once:true});const i=()=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&e();};t.addEventListener("play",i,{once:true,passive:true});}t.addEventListener("emptied",()=>{t.isConnected||this.untrackVideo(t);},{passive:true});}untrackVideo(t){this.activeVideos.has(t)&&(this.onVideoRemoved.dispatch(t),this.activeVideos.delete(t)),this.seenVideos.delete(t);}collectVideos(t){const e=new Set,i=r=>{for(const s of r)e.add(s);};if(t instanceof HTMLVideoElement&&e.add(t),t instanceof ShadowRoot&&i(t.querySelectorAll("video")),t instanceof Element){i(t.querySelectorAll("video"));const r=t.shadowRoot;r&&i(r.querySelectorAll("video"));}const o=t;return o?.querySelectorAll&&i(o.querySelectorAll("video")),Array.from(e)}getNowMs(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}isSliceBudgetReached(t,e){return e>=Jt.MAX_NODES_PER_SLICE?true:this.getNowMs()-t>=Jt.MAX_FLUSH_BUDGET_MS}processPendingAdded(t){let e=0;for(;this.pendingAdded.size>0;){const i=this.pendingAdded.values().next();if(i.done||(this.pendingAdded.delete(i.value),this.scan(i.value),e+=1,this.isSliceBudgetReached(t,e)))break}return e}processPendingRemoved(t,e){let i=e;for(;this.pendingRemoved.size>0&&!this.isSliceBudgetReached(t,i);){const o=this.pendingRemoved.values().next();if(o.done)break;this.pendingRemoved.delete(o.value);for(const r of this.collectVideos(o.value))r.isConnected||this.untrackVideo(r);i+=1;}return i}flushSlice=()=>{if(!this.enabled){this.pendingAdded.clear(),this.pendingRemoved.clear(),this.flushPending=false;return}const t=this.getNowMs(),e=this.processPendingAdded(t);this.processPendingRemoved(t,e),this.flushPending=this.pendingAdded.size>0||this.pendingRemoved.size>0,this.flushPending&&this.intervalIdleChecker.requestImmediateTick();};onCheckerTick=()=>{this.flushPending&&this.flushSlice();};scheduleFlush=()=>{this.enabled&&(this.flushPending=true,this.intervalIdleChecker.requestImmediateTick());};installAttachShadowHook(){if(this.attachShadowSubscriber)return;const t=Mg();if(!t)return;const e=i=>{this.enabled&&(this.observeRoot(i),this.pendingAdded.add(i),this.scheduleFlush());};t.subscribers.add(e),this.attachShadowSubscriber=e;}uninstallAttachShadowHook(){this.attachShadowSubscriber&&(Vg(this.attachShadowSubscriber),this.attachShadowSubscriber=null);}enqueueAddedNode(t){if(t.nodeType===Node.ELEMENT_NODE){const e=t.shadowRoot;e&&this.observeRoot(e);}this.pendingAdded.add(t);}enqueueMutation(t){for(const e of t.addedNodes)this.enqueueAddedNode(e);for(const e of t.removedNodes)this.pendingRemoved.add(e);}onMutations(t){for(const e of t)e.type==="childList"&&this.enqueueMutation(e);(this.pendingAdded.size>0||this.pendingRemoved.size>0)&&this.scheduleFlush();}enable(){if(this.enabled)return;this.enabled=true,this.checkerUnsubscribe?.(),this.checkerUnsubscribe=this.intervalIdleChecker.subscribe(()=>{this.onCheckerTick();}),this.intervalIdleChecker.start(),this.intervalIdleChecker.markActivity("video-observer-enable"),this.installAttachShadowHook(),globalThis.addEventListener("pageshow",this.onPageShow,{passive:true});const t=document.documentElement;if(t){this.observeRoot(t),this.scan(t);return}const e=()=>{const i=document.documentElement;i&&(document.removeEventListener("readystatechange",e),this.onDocumentReady=null,this.enabled&&(this.observeRoot(i),this.scan(i)));};this.onDocumentReady=e,document.addEventListener("readystatechange",e),typeof queueMicrotask=="function"?queueMicrotask(e):Promise.resolve().then(e);}disable(){this.enabled&&(this.enabled=false,globalThis.removeEventListener("pageshow",this.onPageShow),this.onDocumentReady&&(document.removeEventListener("readystatechange",this.onDocumentReady),this.onDocumentReady=null),this.uninstallAttachShadowHook(),this.observer.disconnect(),this.flushPending=false,this.checkerUnsubscribe?.(),this.checkerUnsubscribe=null,this.intervalIdleChecker.stop(),this.pendingAdded.clear(),this.pendingRemoved.clear(),this.seenVideos=new WeakSet,this.activeVideos=new WeakSet,this.observedRoots=new WeakSet);}}const Fo={allowTouchMoveHandler:true,disableContainerDrag:false},_g={xvideos:{allowTouchMoveHandler:false},youtube:{disableContainerDrag:true}};function Og(n){if(!n)return Fo;const t=_g[n]??{};return {...Fo,...t}}function Os(n){const t=(i,o,r,s)=>{i.addEventListener(o,r,{signal:n,...s});};return {add:t,addMany:(i,o,r,s)=>{for(const a of o)t(i,a,r,s);}}}function No(n,t,e){n(t,["pointerenter","focusin"],i=>e.handleOverlayInteraction(i)),n(t,["pointermove"],i=>e.handleOverlayInteraction(i),{passive:true}),n(t,["pointerleave","focusout"],i=>e.scheduleHide(i));}function En(n,t=0){const e=typeof n=="number"?n:Number(n);return Number.isFinite(e)?Ht(e):t}function Bs(n,t,e={}){e.skipYouTubeLikeHosts&&us(n.site.host)||!n.data?.syncVolume||!n.audioPlayer?.player?.src||n.isLikelyInternalVideoVolumeChange(t)||n.syncVolumeWrapper("video",t);}function gn(n,t,e){const i=t.votMenu?.container;if(i){const s=e??n.video.getBoundingClientRect().height;i.style.setProperty("--vot-container-height",`${s}px`);}const{position:o,direction:r}=t.calcButtonLayout(n.data?.buttonPos??"default");t.updateButtonLayout(o,r);}function Ho(n,t){if(!t)return  false;const e=Vs(n).split("+").filter(Boolean),i=t.split("+").filter(Boolean);if(e.length!==i.length)return  false;const o=new Set(e);return i.every(r=>o.has(r))}function Bg(n){const{self:t,overlayView:e,addMany:i}=n;t.resizeObserver=new ResizeObserver(o=>{for(const r of o)gn(t,e,r.contentRect.height);}),t.resizeObserver.observe(t.video),gn(t,e),i(document,["fullscreenchange","webkitfullscreenchange"],()=>gn(t,e));}function Dg(n){const{self:t}=n;if(!hs(t.site))return;t.syncVolumeObserver=new MutationObserver(i=>{if(!t.audioPlayer?.player?.src)return;let o=false,r=null;for(const a of i){if(a.type!=="attributes"||a.attributeName!=="aria-valuenow")continue;o=true;const l=a.target instanceof Element?a.target.getAttribute("aria-valuenow"):null,c=l!=null?Number.parseFloat(l):Number.NaN;Number.isFinite(c)&&(r=c);}if(!o)return;let s;if(r!=null)s=En(r);else {const a=t.isMuted()?0:t.getVideoVolume();s=En(a*100);}t.syncVideoVolumeSlider(),Bs(t,s);});const e=document.querySelector(".ytp-volume-panel");e&&t.syncVolumeObserver.observe(e,{attributes:true,subtree:true,attributeFilter:["aria-valuenow"]});}function Rg(n){const{self:t}=n;if(t.site.host!=="youtube"||t.site.additionalData==="mobile")return;const e=async()=>{if(!t.videoData)return;const r=_.getPlayer(),s=r?.getAvailableAudioTracks?.()??null;if(!Array.isArray(s)||s.length<=1)return;const l=r?.getAudioTrack?.()?.getLanguageInfo?.()?.id??void 0,c=l&&l!=="und"?l.toLowerCase().split(/[-_.]/)[0]:_.getLanguage();if(c&&c!==t.videoData.detectedLanguage&&(t.setSelectMenuValues(c,t.videoData.responseLanguage),t.data?.autoTranslate&&c!==t.videoData.responseLanguage))try{await t.uiManager.handleTranslationBtnClick();}catch{}},i=_.getPlayer(),o=["onApiChange","onStateChange"];if(i?.addEventListener)for(const r of o)try{i.addEventListener(r,e);}catch{}e(),t.abortController.signal.addEventListener("abort",()=>{if(i?.removeEventListener)for(const r of o)try{i.removeEventListener(r,e);}catch{}},{once:true});}function Fg(n){const{self:t,overlayView:e,add:i,addMany:o,platformConfig:r}=n;i(document,"click",c=>{const d=c.target,u=e.votButton?.container,h=e.votMenu?.container,f=t.uiManager.votSettingsView?.dialog?.container,v=document.querySelector(".vot-dialog-temp"),b=d&&u?u.contains(d):false,y=d&&h?h.contains(d):false,x=d?t.container.contains(d):false,w=d&&f?f.contains(d):false,L=d?v?.contains(d)??false:false;b||y||w||L||(x||e.updateButtonOpacity(0),h&&!h.hidden&&(h.hidden=true,t.overlayVisibility?.queueAutoHide()));});const s=new Set,a=()=>s.clear();i(document,"keydown",async c=>{const d=c;if(d.repeat)return;s.add(d.code);const u=document.activeElement,h=u?.tagName?.toLowerCase?.()??"";if(!(["input","textarea"].includes(h)||u?.isContentEditable)){if(Ho(s,t.data?.translationHotkey)){a(),await t.uiManager.handleTranslationBtnClick();return}Ho(s,t.data?.subtitlesHotkey)&&(a(),await t.toggleSubtitlesForCurrentLangPair());}}),i(document,"keyup",c=>s.delete(c.code)),i(document,"blur",a),i(document,"visibilitychange",()=>{document.hidden&&a();}),i(globalThis,"blur",a);const l=t.getEventContainer();l&&(o(l,["pointerenter","pointerdown"],c=>t.overlayVisibility.handleHostInteraction(c)),i(l,"pointermove",c=>t.overlayVisibility.handleHostInteraction(c),{passive:true}),i(l,"pointerleave",c=>t.overlayVisibility.scheduleHide(c))),t.rebindOverlayVisibilityTargets(),r.allowTouchMoveHandler&&i(document,"touchmove",c=>t.overlayVisibility.handleHostInteraction(c),{passive:true}),r.disableContainerDrag&&(t.container.draggable=false);}function Ng(n){const{self:t,overlayView:e,add:i}=n,o=async()=>{try{await t.setCanPlay();}catch{}};let r=false;const s=()=>{r||(r=true,queueMicrotask(async()=>{r=false,await o();}));};i(t.video,"canplay",()=>{t.site.host==="rutube"&&t.video.src||s();}),i(t.video,"emptied",async()=>{let a;try{a=await kr(t.site,{fetchFn:nt,video:t.video});}catch{}t.video.src&&t.videoData&&a&&a===t.videoData.videoId||rs(t,e,{clearVideoData:true,hideMenu:true});}),Kf(t.site.host)||i(t.video,"volumechange",()=>{t.syncVideoVolumeSlider();const a=t.uiManager.votOverlayView;if(!a?.isInitialized())return;const l=En(a.videoVolumeSlider.value);Bs(t,l,{skipYouTubeLikeHosts:true});}),t.site.host==="youtube"&&!t.site.additionalData&&i(document,"yt-page-data-updated",()=>{globalThis.location.pathname.includes("/shorts/")&&s();});}function Hg(){const n=this.uiManager.votOverlayView;if(!n?.subtitlesSelect)return;const{add:t,addMany:e}=Os(this.abortController.signal),i={self:this,overlayView:n,platformConfig:Og(this.site.host),add:t,addMany:e};Bg(i),Dg(i),Rg(i),Fg(i),Ng(i);}function $g(){this.overlayVisibilityTargetsAbortController?.abort(),this.overlayVisibilityTargetsAbortController=new AbortController;const{signal:n}=this.overlayVisibilityTargetsAbortController,t=this.uiManager?.votOverlayView?.votButton?.container,e=this.uiManager?.votOverlayView?.votMenu?.container;if(!t||!e||!this.overlayVisibility)return;const i=this.overlayVisibility,{addMany:o}=Os(n);No(o,t,i),No(o,e,i);}function Ug(n){if(!(n instanceof Node))return  false;const t=this.uiManager?.votOverlayView,e=t?.votButton?.container,i=t?.votMenu?.container;return e instanceof Node&&e.contains(n)||i instanceof Node&&i.contains(n)}function zg(){const n=this.data?.autoHideButtonDelay;return typeof n=="number"&&Number.isFinite(n)?n:Hn}function Wg(){this.resizeObserver?.disconnect(),this.overlayVisibilityTargetsAbortController?.abort(),this.overlayVisibilityTargetsAbortController=void 0,hs(this.site)&&this.syncVolumeObserver?.disconnect();}let re;function qg(n){re=n;}let mn=null;async function Gg(){re||(mn??=(async()=>{try{const e=(await(await nt("https://cloudflare-dns.com/cdn-cgi/trace",{timeout:7e3})).text()).split(`
`).find(i=>i.startsWith("loc="));qg(e?.slice(4,6).toUpperCase());}catch(n){console.error("[VOT] Error getting country:",n);}})().finally(()=>{mn=null;}),await mn);}async function Kg(){if(this.initialized)return;const n=this.isAudioContextSupported;this.data=await E.getValues({autoTranslate:false,autoSubtitles:false,dontTranslateLanguages:[De],enabledDontTranslateLanguages:true,enabledAutoVolume:true,enabledSmartDucking:true,autoVolume:Xe,buttonPos:"default",showVideoSlider:true,syncVolume:false,downloadWithName:Bt,sendNotifyOnComplete:false,subtitlesMaxLength:300,subtitlesSmartLayout:true,highlightWords:false,subtitlesFontSize:20,subtitlesOpacity:20,subtitlesDownloadFormat:"srt",responseLanguage:De,defaultVolume:100,onlyBypassMediaCSP:n,newAudioPlayer:n,showPiPButton:false,translateAPIErrors:true,translationService:Je,detectService:Nn,translationHotkey:null,subtitlesHotkey:null,m3u8ProxyHost:ed,proxyWorkerHost:ge,translateProxyEnabled:0,translateProxyEnabledDefault:true,audioBooster:false,useLivelyVoice:false,autoHideButtonDelay:Hn,useAudioDownload:Yr||typeof IS_EXTENSION<"u"&&IS_EXTENSION,compatVersion:"",account:{},localeHash:"",localeUpdatedAt:0}),this.data.compatVersion!==me&&(this.data=await _d(this.data),await E.set("compatVersion",me));try{if(De==="en"&&this.data?.enabledDontTranslateLanguages&&Array.isArray(this.data?.dontTranslateLanguages)&&this.data.dontTranslateLanguages.length===1&&this.data.dontTranslateLanguages[0]==="en"&&typeof this.data.responseLanguage=="string"&&this.data.responseLanguage!=="en"){const t=this.data.responseLanguage;this.data.dontTranslateLanguages=[t],await E.set("dontTranslateLanguages",this.data.dontTranslateLanguages);}}catch{}this.uiManager.data=this.data,console.log("[VOT] data from db:",this.data),!this.data.translateProxyEnabled&&Kr&&(this.data.translateProxyEnabled=1),await Gg(),re&&zr.includes(re)&&this.data.translateProxyEnabledDefault&&(this.data.translateProxyEnabled=2),A.log("translateProxyEnabled",this.data.translateProxyEnabled,this.data.translateProxyEnabledDefault),this.initVOTClient(),this.uiManager.initUI(),this.uiManager.initUIEvents(),this.uiManager.votOverlayView?.votButton?.container&&(this.uiManager.votOverlayView.votButton.container.hidden=true),this.createPlayer(),this.translateToLang=this.data.responseLanguage??"ru",this.initExtraEvents(),this.initialized=true;}const jt="und",$o=new Map,Yg=()=>typeof Intl<"u"&&typeof Intl.Segmenter=="function",Uo=/[\p{L}\p{N}]+|[^\p{L}\p{N}]+/gu,Xg=/[\p{L}\p{N}]/u,Jg=n=>{if(typeof Intl>"u"||!n)return jt;try{return Intl.getCanonicalLocales(n)[0]||jt}catch{return jt}},jg=n=>{const t=Jg(n);return t===jt?void 0:Intl.Segmenter.supportedLocalesOf([t])[0]},Zg=n=>{if(!Yg())return null;const t=jg(n),e=t??jt,i=$o.get(e);if(i)return i;const o=new Intl.Segmenter(t,{granularity:"word"});return $o.set(e,o),o},Qg=n=>{const t=[];Uo.lastIndex=0;for(const e of n.matchAll(Uo)){const i=e[0];i&&t.push({text:i,index:e.index??0,isWordLike:Xg.test(i)});}return t},Ds=(n,t)=>{if(!n)return [];const e=Zg(t);if(!e)return Qg(n);const i=e.segment(n),o=[];for(const r of i)o.push({text:r.segment,index:r.index,isWordLike:!!r.isWordLike});return o},tm=n=>!!(n&&typeof n=="object"&&"format"in n&&"source"in n&&"url"in n),em=(n,t,e)=>{const i=n.subtitles;if(!Array.isArray(i)||i.length===0)return null;const o=t??e;if(o){const r=i.find(a=>a.language===o&&typeof a.translatedFromLanguage=="string");if(r)return r;const s=i.find(a=>a.language===o);if(s)return s}return i[0]??null},nm=n=>{const t=_.getPoToken();if(!t)return n;const i=_.getDeviceParams().replace(/^[?&]+/u,"");try{const o=new URL(n);if(o.searchParams.set("potc","1"),o.searchParams.set("pot",t),i){const r=new URLSearchParams(i);for(const[s,a]of r.entries())o.searchParams.set(s,a);}return o.toString()}catch{const o=n.includes("?")?"&":"?",r=i?`&${i}`:"";return `${n}${o}potc=1&pot=${encodeURIComponent(t)}${r}`}},zo=(n,t)=>n-t,_e=(n,t)=>n<t?-1:n>t?1:0,im=(n,t)=>{const e=Math.min(n.length,t.length);for(let i=0;i<e;i+=1){const o=n[i]-t[i];if(o!==0)return o}return n.length!==t.length?n.length-t.length:0},om=(n,t,e)=>n?t===0?e?1:0:e?0:1:0,rm=(n,t,e,i)=>!n||!t||e===i?0:1,Wo=(n,t)=>{const e=n.source==="yandex",i=e?0:1,o=n.language===$n?0:1,r=!!n.translatedFromLanguage,s=t&&n.language===t?0:1,a=om(e,s,r),l=rm(e,r,n.translatedFromLanguage,t),c=e&&!r?s:0,d=e?0:+!!n.isAutoGenerated;return [i,o,a,l,c,d]},sm=(n,t)=>{const e=n.map((i,o)=>({descriptor:i,index:o}));return e.sort((i,o)=>{const r=Wo(i.descriptor,t),s=Wo(o.descriptor,t),a=im(r,s);if(a!==0)return a;const l=_e(i.descriptor.language,o.descriptor.language)||_e(i.descriptor.translatedFromLanguage??"",o.descriptor.translatedFromLanguage??"")||_e(i.descriptor.source,o.descriptor.source)||_e(i.descriptor.url,o.descriptor.url)||zo(+!!i.descriptor.isAutoGenerated,+!!o.descriptor.isAutoGenerated);return l!==0?l:zo(i.index,o.index)}),e.map(i=>i.descriptor)},am=(n,t)=>typeof n=="boolean"?n:!!t.trim(),lm=n=>{if(!n||typeof n!="object")return {text:"",startMs:0,durationMs:0,isWordLike:false};const t=n,e=typeof t.text=="string"?t.text:"";return {text:e,startMs:typeof t.startMs=="number"?t.startMs:0,durationMs:typeof t.durationMs=="number"?t.durationMs:0,isWordLike:am(t.isWordLike,e)}},cm=n=>{if(!n||typeof n!="object")return {text:"",startMs:0,durationMs:0,speakerId:"0",tokens:[]};const t=n,e=Array.isArray(t.tokens)?t.tokens.map(lm):[];return {text:typeof t.text=="string"?t.text:"",startMs:typeof t.startMs=="number"?t.startMs:0,durationMs:typeof t.durationMs=="number"?t.durationMs:0,speakerId:typeof t.speakerId=="string"?t.speakerId:"0",tokens:e}},dm=n=>{if(!n||typeof n!="object")return {subtitles:[]};const t=n;return {subtitles:Array.isArray(t.subtitles)?t.subtitles.map(cm):[]}},qo=n=>{if(!n.includes("<")||typeof document>"u")return n;const t=document.createElement("template");return t.innerHTML=n,t.content.textContent??""},um=(n,t)=>!t||n.tStartMs+n.dDurationMs<=t.tStartMs?Math.max(0,n.dDurationMs):Math.max(0,t.tStartMs-n.tStartMs),hm=(n,t,e)=>{const i=[];let o="",r=e;for(let s=0;s<t.length;s+=1){const a=t[s],l=typeof a.utf8=="string"?a.utf8:"";if(!l)continue;const c=Math.max(0,a.tOffsetMs??0);let d=e;const u=t[s+1];if(u?.tOffsetMs!==void 0){const f=Math.max(c,u.tOffsetMs);d=Math.max(0,f-c),r=Math.max(r-d,0);}let h=Math.max(0,r);u&&(h=Math.max(0,d)),i.push({text:l,startMs:n.tStartMs+c,durationMs:h,isWordLike:!!l.trim()}),o+=l;}return {text:o,sourceTokens:i}},fm=n=>n.durationMs>0,Rs=n=>n.text?n.text:n.tokens.length?n.tokens.map(t=>t.text).join(""):"",Fs=(n,t,e)=>{if(!n.length)return [];const i=Math.max(0,e),o=n.map(l=>Math.max(l.length,1)),r=o.reduce((l,c)=>l+c,0),s=new Array(o.length+1).fill(0);for(let l=0;l<o.length;l+=1)s[l+1]=s[l]+o[l];const a=[];for(let l=0;l<n.length;l+=1){const c=Math.round(i*s[l]/r),d=l===n.length-1?i:Math.round(i*s[l+1]/r);a.push({startMs:t+c,durationMs:Math.max(0,d-c)});}return a},pm=(n,t)=>{const e=[];for(const i of n){if(!i.text||!fm(i))continue;const o=Ds(i.text,t).filter(s=>s.isWordLike&&s.text.trim());if(!o.length)continue;const r=Fs(o.map(s=>s.text),i.startMs,i.durationMs);e.push(...r);}return e},gm=(n,t)=>{const e=Rs(n);if(!e)return [];const i=t.language,o=Ds(e,i);if(!o.length)return [];const r=Fs(o.map(d=>d.text),n.startMs,n.durationMs),s=o.map((d,u)=>({text:d.text,startMs:r[u]?.startMs??n.startMs,durationMs:r[u]?.durationMs??0,isWordLike:d.isWordLike})),a=pm(n.tokens??[],i);if(!a.length)return s;const l=s.reduce((d,u,h)=>(u.isWordLike&&u.text.trim()&&d.push(h),d),[]);if(!l.length)return s;const c=l.length;for(let d=0;d<c;d+=1){const u=l[d],h=Math.floor(d*a.length/c),f=a[Math.min(h,a.length-1)];s[u]={...s[u],startMs:f.startMs,durationMs:f.durationMs};}return s},mm=async(n,t)=>{const e=await nt(n,{timeout:7e3});if(t==="vtt"||t==="srt"){const i=await e.text();return vr(i,"json")}return e.json()},vm=(n,t)=>{if(t.source==="youtube")return Se.formatYoutubeSubtitles(n,!!t.isAutoGenerated);const e=dm(n);return t.source==="vk"?Se.cleanJsonSubtitles(e):e},bm=(n,t)=>({subtitles:Se.processTokens(n,t)}),ym=n=>{const t=[],e=new Set;for(const i of n.subtitles??[])i.language&&!e.has(i.language)&&(e.add(i.language),t.push({source:"yandex",format:"json",language:i.language,url:i.url})),i.translatedLanguage&&t.push({source:"yandex",format:"json",language:i.translatedLanguage,translatedFromLanguage:i.language,url:i.translatedUrl??i.url});return t},Se={processTokens(n,t){const e=[];for(const i of n.subtitles){const o=Rs(i),r=gm({...i,text:o},t);e.push({...i,text:o,tokens:r});}return e},formatYoutubeSubtitles(n,t=false){const e=n.events??[];if(!e.length)return console.error("[VOT] Invalid YouTube subtitles format:",n),{subtitles:[]};const i=[];for(let o=0;o<e.length;o+=1){const r=e[o],s=r.segs;if(!s?.length)continue;const a=e[o+1],l=um(r,a),{text:c,sourceTokens:d}=hm(r,s,l),u=c.trim();u&&i.push({text:u,startMs:r.tStartMs,durationMs:l,speakerId:"0",tokens:t?d:[]});}return {subtitles:i}},cleanJsonSubtitles(n){return {subtitles:n.subtitles.map(t=>({...t,text:qo(t.text),tokens:t.tokens.map(e=>({...e,text:qo(e.text)}))}))}},async fetchSubtitles(n,t,e){const i=tm(n)?n:em(n,t,e);if(!i)return {subtitles:[]};const{source:o,format:r}=i;let{url:s}=i;o==="youtube"&&(s=nm(s));try{const a=await mm(s,r),l=vm(a,i),c=bm(l,i);return A.log("[VOT] Processed subtitles:",c),c}catch(a){return console.error("[VOT] Failed to process subtitles:",a),{subtitles:[]}}},async getSubtitles(n,t){const{host:e,url:i,detectedLanguage:o,videoId:r,duration:s,subtitles:a=[]}=t;try{const l={videoData:{host:e,url:i,videoId:r,duration:s},requestLang:o},d=await Promise.race([n.getSubtitles(l),Nr(5e3,"Timeout")]);A.log("[VOT] Subtitles response:",d),d.waiting&&console.error("[VOT] Failed to get Yandex subtitles");const h=[...ym(d),...a];return sm(h,o)}catch(l){let c="Error in getSubtitles function";throw l instanceof Error&&l.message==="Timeout"&&(c="Failed to get Yandex subtitles: timeout"),console.error(`[VOT] ${c}`,l),l}}},Pn="https://vtrans.s3-private.mds.yandex.net/tts/prod/",qe="/video-translation/audio-proxy/",Go="https://brosubs.s3-private.mds.yandex.net/vtrans/",wm="/video-subtitles/subtitles-proxy/";function Jn(n){return n??ge}function Ns(n){return n.translateProxyEnabled===2}function km(n,t){return !Ns(t)||!n.startsWith(Pn)?n:n.replace(Pn,`https://${Jn(t.proxyWorkerHost)}${qe}`)}function Sm(n){const t=String(n||"");if(!t)return t;try{const e=new URL(t);return e.pathname.startsWith(qe)?(e.host="vtrans.s3-private.mds.yandex.net",e.pathname=`/tts/prod/${e.pathname.slice(qe.length).replace(/^\/+/,"")}`,e.protocol="https:",e.toString()):t}catch{return t}}function xm(n,t){return n.startsWith(Pn)||n.startsWith(`https://${Jn(t.proxyWorkerHost)}${qe}`)}function Tm(n,t){if(!Ns(t)||!n.startsWith(Go))return n;const e=n.slice(Go.length);return `https://${Jn(t.proxyWorkerHost)}${wm}${e}`}const Am=new Set(["srt","vtt","json"]);function Lm(n){if(!n||typeof n!="object")return null;const t=n;return typeof t.source!="string"||typeof t.language!="string"||typeof t.url!="string"||typeof t.format!="string"||!Am.has(t.format)?null:{source:t.source,format:t.format,language:t.language,url:t.url,translatedFromLanguage:typeof t.translatedFromLanguage=="string"?t.translatedFromLanguage:void 0,isAutoGenerated:typeof t.isAutoGenerated=="boolean"?t.isAutoGenerated:void 0}}function jn(n){const t=[];for(let e=0;e<n.length;e+=1){const i=Lm(n[e]);i&&t.push({descriptor:i,index:e});}return t}function Im(n,t){return jn(n).find(e=>e.index===t)?.descriptor??null}function Ko(){return {label:g.get("VOTSubtitlesDisabled"),value:"disabled",selected:true,disabled:false}}function Hs(n){return n[Symbol.iterator]().next().value}function Em(n){const t=g.getLangLabel(n.language),e=n.translatedFromLanguage?` ${g.get("VOTTranslatedFrom")} ${g.getLangLabel(n.translatedFromLanguage)}`:"",i=n.source==="yandex"?"":`, ${globalThis.location.hostname}`,o=n.isAutoGenerated?` (${g.get("VOTAutogenerated")})`:"";return `${t}${e}${i}${o}`}function xe(n){return (n??"").toLowerCase()}function Ge(n){return xe(n).split(/[-_]/)[0]}function vt(n,t){if(!n||!t)return  false;const e=xe(n),i=xe(t);return e===i||Ge(e)===Ge(i)}function Pm(n,t,e){if(!n.length)return null;const i=xe(t),o=xe(e),r=i==="auto"||i==="",s=Ge(i),a=Ge(o),l=w=>w.source==="yandex",c=w=>!!w.isAutoGenerated,d=(w,L,D)=>vt(w.language,D)?r?true:vt(w.translatedFromLanguage,L):false,u=(w,L)=>vt(w.language,L)?w.translatedFromLanguage?vt(w.translatedFromLanguage,L):true:false,h=w=>n.find(({descriptor:L})=>w(L))?.index??null,f=()=>{const w=h(L=>!l(L)&&vt(L.language,o)&&!c(L));return w??h(L=>!l(L)&&vt(L.language,o)&&c(L))},v=h(w=>l(w)&&d(w,i,o));if(v!=null)return v;if(!r&&s&&a&&s===a){const w=h(N=>u(N,o)&&!c(N));if(w!=null)return w;const L=h(N=>u(N,o)&&c(N));if(L!=null)return L;const D=f();if(D!=null)return D;const K=h(N=>l(N)&&vt(N.language,o));if(K!=null)return K}const b=h(w=>l(w)&&vt(w.language,o));if(b!=null)return b;const y=h(w=>!l(w)&&d(w,i,o));if(y!=null)return y;const x=f();return x??null}async function Cm(n){const t=this.uiManager.votOverlayView;if(!t?.subtitlesSelect||!t.downloadSubtitlesButton)return this;if(t.subtitlesSelect.setSelectedValue(n),n==="disabled")return this.hasSubtitlesWidget()&&this.subtitlesWidget?.setContent(null),t.downloadSubtitlesButton.hidden=true,this.yandexSubtitles=null,this;const e=Number.parseInt(n,10),i=Im(this.subtitles,e);if(!i)return t.downloadSubtitlesButton.hidden=true,this.yandexSubtitles=null,this;let o={...i};const r=Tm(o.url,{translateProxyEnabled:this.data?.translateProxyEnabled,proxyWorkerHost:this.data?.proxyWorkerHost});return r!==o.url&&(o={...o,url:r},A.log(`[VOT] Subs proxied via ${o.url}`)),this.yandexSubtitles=await Se.fetchSubtitles(o),this.getSubtitlesWidget().setContent(this.yandexSubtitles,o.language),t.downloadSubtitlesButton.hidden=false,this}async function Mm(){const n=this.uiManager.votOverlayView;if(!n?.subtitlesSelect)return;const t=jn(this.subtitles);if(t.length===0){const i=[Ko()];n.subtitlesSelect.updateItems(i),await this.changeSubtitlesLang(i[0].value);return}const e=[Ko(),...t.map(({descriptor:i,index:o})=>({label:Em(i),value:String(o),selected:false,disabled:false}))];n.subtitlesSelect.updateItems(e),await this.changeSubtitlesLang(e[0].value);}async function Vm(){const n=this.uiManager.votOverlayView;if(!n?.subtitlesSelect)return this;if(!Array.isArray(this.subtitles)||this.subtitles.length===0)try{await this.loadSubtitles();}catch{return this}const t=this.videoData?.detectedLanguage??this.translateFromLang,e=this.videoData?.responseLanguage??this.translateToLang,i=Pm(jn(this.subtitles),t,e);return i==null?this:Hs(n.subtitlesSelect.selectedValues)===String(i)?this:(await this.changeSubtitlesLang(String(i)),this)}async function _m(){const n=this.uiManager.votOverlayView;if(!n?.subtitlesSelect)return this;const t=Hs(n.subtitlesSelect.selectedValues);return t&&t!=="disabled"?(await this.changeSubtitlesLang("disabled"),this):(await this.enableSubtitlesForCurrentLangPair(),this)}async function Om(){if(!this.videoData?.videoId){console.error(`[VOT] ${g.getDefault("VOTNoVideoIDFound")}`),this.subtitles=[];return}const n=this.getSubtitlesCacheKey(this.videoData.videoId,this.videoData.detectedLanguage,this.videoData.responseLanguage);try{let t=this.cacheManager.getSubtitles(n);if(!t){let e=this.subtitlesLoadPromises.get(n);e===void 0&&(e=Se.getSubtitles(this.votClient,this.videoData),this.subtitlesLoadPromises.set(n,e));try{t=await e,this.cacheManager.setSubtitles(n,t);}finally{this.subtitlesLoadPromises.get(n)===e&&this.subtitlesLoadPromises.delete(n);}}this.subtitles=t;}catch(t){console.error("[VOT] Failed to load subtitles:",t),this.subtitles=[];}await this.updateSubtitlesLangSelect();}const Zn={tickMs:50,thresholdOnRms:.012,thresholdOffRms:.009,rmsAttackTauMs:60,rmsReleaseTauMs:240,holdMs:520,attackTauMs:110,releaseTauMs:600,maxDownPerSec:3.5,maxUpPerSec:.9,rmsMissingGraceMs:200,maxDtMs:250,externalBaselineDelta01:.02,unduckTolerance01:.01,volumeStep01:Ue,applyDeltaThreshold01:Ue/2};function $s(n){return {isDucked:false,speechGateOpen:false,rmsEnvelope:0,baseline:te(n),lastApplied:void 0,lastTickAt:0,lastSoundAt:0,rmsMissingSinceAt:null}}function Bm(){return $s()}function Dm(n,t,e=Zn){const i=Rm(t),o=te(n.volumeOnStart);if(!n.translationActive||!n.enabledAutoVolume)return {kind:"stop",runtime:i,restoreVolume:i.baseline??o};const r=Number.isFinite(n.nowMs)?n.nowMs:Date.now(),s=i.lastTickAt||r,a=$(r-s,0,e.maxDtMs),l=a/1e3;i.lastTickAt=r;const c=Tt(n.rms),d=c&&typeof n.rms=="number"?$(n.rms,0,1):0,u=$(i.rmsEnvelope,0,1),h=d>u?e.rmsAttackTauMs:e.rmsReleaseTauMs,f=h>0?1-Math.exp(-a/h):1;i.rmsEnvelope=$(u+(d-u)*f,0,1);let v=i.speechGateOpen;n.smartEnabled?n.audioIsPlaying&&!c?(i.rmsMissingSinceAt??=r,v&&(i.lastSoundAt=r),i.rmsMissingSinceAt!==null&&r-i.rmsMissingSinceAt>=e.rmsMissingGraceMs&&(v=true,i.lastSoundAt=r)):(i.rmsMissingSinceAt=null,v?n.audioIsPlaying&&i.rmsEnvelope>=e.thresholdOffRms?i.lastSoundAt=r:r-i.lastSoundAt>e.holdMs&&(v=false):n.audioIsPlaying&&i.rmsEnvelope>=e.thresholdOnRms&&(v=true,i.lastSoundAt=r)):(v=true,i.lastSoundAt=r,i.rmsMissingSinceAt=null),i.speechGateOpen=v;const b=te(n.currentVideoVolume);if(!Tt(b))return {kind:"noop",runtime:i};i.isDucked&&Tt(i.lastApplied)&&Math.abs(b-i.lastApplied)>e.externalBaselineDelta01&&(i.baseline=b),i.isDucked||(i.baseline=b);const y=i.baseline??o??b;if(i.baseline=y,!n.hostVideoActive)return i.lastApplied=b,{kind:"noop",runtime:i};const x=te(n.duckingTarget01)??y,w=Math.min(y,x);let L=y;v?(i.isDucked||(i.baseline=y,i.isDucked=true),L=w):i.isDucked&&Math.abs(y-b)<e.unduckTolerance01&&(i.isDucked=false);const D=L<b?e.attackTauMs:e.releaseTauMs,K=D>0?1-Math.exp(-a/D):1;let N=b+(L-b)*K;const ht=(L<b?e.maxDownPerSec:e.maxUpPerSec)*l;Number.isFinite(ht)&&ht>0&&(N=$(N,b-ht,b+ht)),N=$(N,0,1);const lt=zf(N,b,L,e.volumeStep01);return !Tt(i.lastApplied)||Math.abs(lt-i.lastApplied)>=e.applyDeltaThreshold01?(i.lastApplied=lt,{kind:"apply",runtime:i,volume01:lt}):{kind:"noop",runtime:i}}function Rm(n){return {isDucked:!!n.isDucked,speechGateOpen:!!n.speechGateOpen,rmsEnvelope:$(n.rmsEnvelope??0,0,1),baseline:te(n.baseline),lastApplied:te(n.lastApplied),lastTickAt:Tt(n.lastTickAt)?n.lastTickAt:0,lastSoundAt:Tt(n.lastSoundAt)?n.lastSoundAt:0,rmsMissingSinceAt:Tt(n.rmsMissingSinceAt)?n.rmsMissingSinceAt:null}}function te(n){if(Tt(n))return $(n,0,1)}function Tt(n){return typeof n=="number"&&Number.isFinite(n)}function Fm(n){return {isDucked:n.smartVolumeIsDucked,speechGateOpen:n.smartVolumeSpeechGateOpen,rmsEnvelope:n.smartVolumeRmsEnvelope,baseline:n.smartVolumeDuckingBaseline,lastApplied:n.smartVolumeLastApplied,lastTickAt:n.smartVolumeLastTickAt,lastSoundAt:n.smartVolumeLastSoundAt,rmsMissingSinceAt:n.smartVolumeRmsMissingSinceAt}}function Ke(n,t){n.smartVolumeIsDucked=t.isDucked,n.smartVolumeSpeechGateOpen=t.speechGateOpen,n.smartVolumeRmsEnvelope=t.rmsEnvelope,n.smartVolumeDuckingBaseline=t.baseline,n.smartVolumeLastApplied=t.lastApplied,n.smartVolumeLastTickAt=t.lastTickAt,n.smartVolumeLastSoundAt=t.lastSoundAt,n.smartVolumeRmsMissingSinceAt=t.rmsMissingSinceAt;}function Qn(n,t={}){const{restoreVolume:e}=t;typeof n.smartVolumeDuckingInterval=="number"&&(clearInterval(n.smartVolumeDuckingInterval),n.smartVolumeDuckingInterval=void 0);const i=typeof e=="number"?e:n.smartVolumeDuckingBaseline??n.volumeOnStart;if(typeof i=="number"&&(typeof e=="number"||n.smartVolumeIsDucked))try{n.setVideoVolume(i);}catch{}Ke(n,Bm());}function Nm(n){typeof globalThis>"u"||typeof n.smartVolumeDuckingInterval!="number"&&(Ke(n,$s(n.getVideoVolume())),n.smartVolumeDuckingInterval=globalThis.setInterval(()=>{$m(n);},Zn.tickMs));}function Hm(){const n=this.audioPlayer?.player,t=n?.getAudioRms?.();if(typeof t=="number"&&Number.isFinite(t))return t;const e=n?.analyser;if(e)try{if(typeof e.getFloatTimeDomainData=="function"){let r=n?.analyserFloatData;r?.length!==e.fftSize&&(r=new Float32Array(e.fftSize),n.analyserFloatData=r),e.getFloatTimeDomainData(r);let s=0;for(const a of r)s+=a*a;return Math.sqrt(s/r.length)}let i=n?.analyserData;i?.length!==e.fftSize&&(i=new Uint8Array(e.fftSize),n.analyserData=i),e.getByteTimeDomainData(i);let o=0;for(const r of i){const s=(r-128)/128;o+=s*s;}return Math.sqrt(o/i.length)}catch{return}}function $m(n){const t=n.audioPlayer?.player,e=t?.getMediaElement?.()??t?.audio??t?.audioElement,i=!!e&&!e.paused&&!e.muted&&(e.volume??1)>.001,o=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),r=n.getVideoVolume(),s=n.video,a=!(s&&(s.paused||s.ended)),l=$(n.data?.autoVolume??Xe,0,100)/100;n.smartVolumeDuckingTarget=l;const c=Dm({nowMs:o,translationActive:n.hasActiveSource(),enabledAutoVolume:!!n.data?.enabledAutoVolume,smartEnabled:n.data?.enabledSmartDucking??true,audioIsPlaying:i,rms:i?Hm.call(n):0,currentVideoVolume:r,hostVideoActive:a,duckingTarget01:l,volumeOnStart:n.volumeOnStart},Fm(n),Zn);switch(c.kind){case "stop":Qn(n,{restoreVolume:c.restoreVolume});return;case "apply":n.setVideoVolume(c.volume01),Ke(n,c.runtime);return;case "noop":Ke(n,c.runtime);return;default:throw new TypeError("Unhandled smart ducking decision")}}async function Um(n,t){if(this.isActionStale(t))return n;try{const e=this.isMultiMethodS3(n)?{method:"HEAD"}:{headers:{range:"bytes=0-0"}},i=await nt(n,e);if(this.isActionStale(t))return n;if(A.log("Test audio response",i),i.ok)return A.log("Valid audioUrl",n),n;if(A.log("Yandex returned not valid audio, trying to fix..."),!this.videoData)return A.log("Skip audio fix - videoData is not available"),n;if(this.isActionStale(t))return n;const o=this.videoData.detectedLanguage||this.translateFromLang,r=await es(this.translationHandler,{videoData:this.videoData,requestLang:o,responseLang:this.translateToLang,translationHelp:this.videoData.translationHelp,useAudioDownload:!!this.data?.useAudioDownload,signal:this.actionsAbortController.signal});if(!r)return A.log("Failed to retranslate audio - using original url"),n;this.setSelectMenuValues(this.videoData.detectedLanguage,this.videoData.responseLanguage),this.scheduleTranslationRefresh(),n=r.url,A.log("Fixed audio audioUrl",n);}catch{}return n}function zm(){if(!this.videoData||this.videoData.isStream||!this.hasActiveSource())return;clearTimeout(this.translationRefreshTimeout);const n=Math.max(3e4,Sn-300*1e3);this.translationRefreshTimeout=setTimeout(()=>{this.refreshTranslationAudio().catch(t=>{});},n);}async function Us(n,t){const e=await mf({requester:n.translationHandler,request:{videoData:t.videoData,requestLang:t.requestLang,responseLang:t.responseLang,translationHelp:t.translationHelp,useAudioDownload:!!n.data?.useAudioDownload,signal:n.actionsAbortController.signal},actionContext:t.actionContext,isActionStale:i=>n.isActionStale(i),updateTranslation:(i,o)=>n.updateTranslation(i,o),scheduleTranslationRefresh:()=>n.scheduleTranslationRefresh()});return e?(t.onBeforeCache&&await t.onBeforeCache(e),vf({cacheKey:t.cacheKey,setTranslation:(i,o)=>n.cacheManager.setTranslation(i,o),videoId:t.cacheVideoId,requestLang:t.cacheRequestLang,responseLang:t.cacheResponseLang,fallbackUrl:e.url,downloadTranslationUrl:n.downloadTranslationUrl,usedLivelyVoice:e.usedLivelyVoice}),e):null}async function Wm(){if(!this.videoData||this.videoData.isStream||!this.hasActiveSource()||this.isRefreshingTranslation)return;const n=this.videoData.videoId;if(!n)return;this.actionsAbortController?.signal?.aborted&&this.resetActionsAbortController("refreshTranslationAudio"),this.isRefreshingTranslation=true;const t={gen:this.actionsGeneration,videoId:n},e=Wn(this.videoData.translationHelp);try{if(!await Us(this,{videoData:this.videoData,requestLang:this.translateFromLang,responseLang:this.translateToLang,translationHelp:e,actionContext:t,cacheKey:this.getTranslationCacheKey(n,this.translateFromLang,this.translateToLang,e),cacheVideoId:n,cacheRequestLang:this.translateFromLang,cacheResponseLang:this.translateToLang}))return}finally{this.isRefreshingTranslation=false;}}function qm(n){return km(n,{translateProxyEnabled:this.data?.translateProxyEnabled,proxyWorkerHost:this.data?.proxyWorkerHost})}function Gm(n){return Sm(n)}async function Km(n="proxySettingsChanged"){try{A.log(`[VOT] ${n}: clearing translation cache`),this.cacheManager.clear(),this.activeTranslation=null;}catch{}try{this.resetActionsAbortController(n);}catch{}try{if(this.videoData?.isStream)return;const t=this.downloadTranslationUrl||this.audioPlayer?.player?.currentSrc||this.audioPlayer?.player?.src;if(!t)return;await this.updateTranslation(this.unproxifyAudio(t));}catch{}}function Ym(n){return xm(n,{proxyWorkerHost:this.data?.proxyWorkerHost})}async function Xm(n,t){if(this.isActionStale(t))return;this.audioPlayer||this.createPlayer();const e=this.proxifyAudio(this.unproxifyAudio(n)),i=this.audioPlayer.player.currentSrc||this.audioPlayer.player.src||"",o=this.proxifyAudio(this.unproxifyAudio(i));let r=e;if(e!==o&&(r=await this.validateAudioUrl(e,t)),this.isActionStale(t))return;const s=this.audioPlayer.player.src!==r;s&&(this.audioPlayer.player.src=r);try{s&&this.audioPlayer.init();}catch(a){const l=a instanceof Error?a.message:String(a);this.transformBtn("error",l);}this.setupAudioSettings(),this.transformBtn("success",g.get("disableTranslate")),this.afterUpdateTranslation(r);}async function Jm(n,t,e,i,o){this.videoValidator(),this.actionsAbortController?.signal?.aborted&&this.resetActionsAbortController("translateFunc");const r=this.uiManager.votOverlayView;if(!r?.votButton)return;if(r.votButton.loading=true,this.hadAsyncWait=false,this.volumeOnStart=this.getVideoVolume(),!n){await this.updateTranslationErrorMsg(new rt("VOTNoVideoIDFound"),this.actionsAbortController.signal);return}const s=this.videoData;if(!s){await this.updateTranslationErrorMsg(new rt("VOTNoVideoIDFound"),this.actionsAbortController.signal);return}const a=Wn(o),l=this.getTranslationCacheKey(n,e,i,a),c=`video_${l}`;if(this.activeTranslation?.key===c){await this.activeTranslation.promise;return}const d={gen:this.actionsGeneration,videoId:n},u=(async()=>{if(this.isActionStale(d))return;const h=e,f=i,v=async x=>await ns({url:x,actionContext:d,isActionStale:w=>this.isActionStale(w),updateTranslation:(w,L)=>this.updateTranslation(w,L),scheduleTranslationRefresh:()=>this.scheduleTranslationRefresh()}),b=this.cacheManager.getTranslation(l);if(b?.url)return await v(b.url),void 0;await Us(this,{videoData:s,requestLang:h,responseLang:f,translationHelp:a,actionContext:d,cacheKey:l,cacheVideoId:n,cacheRequestLang:e,cacheResponseLang:i,onBeforeCache:async()=>{const x=this.videoData?this.getSubtitlesCacheKey(n,this.videoData.detectedLanguage,this.videoData.responseLanguage):null;(x?this.cacheManager.getSubtitles(x):null)?.some(L=>L.source==="yandex"&&L.translatedFromLanguage===s.detectedLanguage&&L.language===s.responseLanguage)||(x&&this.cacheManager.deleteSubtitles(x),this.subtitles=[]);}});})();this.activeTranslation={key:c,promise:u};try{return await u}catch(h){throw this.hadAsyncWait=is({aborted:this.actionsAbortController.signal.aborted,translateApiErrorsEnabled:!!this.data?.translateAPIErrors,hadAsyncWait:this.hadAsyncWait,videoId:n,error:h,notify:f=>this.notifier.translationFailed(f)}),h}finally{this.activeTranslation?.promise===u&&(this.activeTranslation=null);}}function jm(){return Yf(this.site.host)}function Zm(){typeof this.data?.defaultVolume=="number"&&(this.audioPlayer.player.volume=this.data.defaultVolume/100),this.data?.enabledAutoVolume?(this.smartVolumeDuckingTarget=$(this.data.autoVolume??Xe,0,100)/100,Nm(this)):Qn(this,{restoreVolume:this.smartVolumeDuckingBaseline??this.volumeOnStart});}const Qm=new Set(Vn),tv=n=>Qm.has(n);class ev{video;container;site;translateFromLang="auto";translateToLang=De;data;videoData;firstPlay=true;audioContext;votClient;audioPlayer;abortController;actionsAbortController;actionsGeneration=0;notifier=new Pg;cacheManager;subtitlesLoadPromises=new Map;downloadTranslationUrl=null;translationRefreshTimeout;isRefreshingTranslation=false;autoRetry;votOpts;volumeOnStart;volumeLinkState={initialized:false,lastVideoPercent:0,lastTranslationPercent:0};internalVideoVolumeSetAt=0;internalVideoVolumeSetPercent=null;internalVideoVolumeSuppressionMs=250;smartVolumeDuckingInterval;smartVolumeDuckingTarget=.2;smartVolumeDuckingBaseline;smartVolumeLastApplied;smartVolumeLastTickAt=0;smartVolumeLastSoundAt=0;smartVolumeRmsMissingSinceAt=null;smartVolumeRmsEnvelope=0;smartVolumeSpeechGateOpen=false;smartVolumeIsDucked=false;longWaitingResCount=0;hadAsyncWait=false;subtitles=[];subtitlesWidget;activeTranslation=null;interactionChecker;uiManager;overlayVisibility;overlayVisibilityTargetsAbortController;translationOrchestrator;lifecycleController;translationHandler;videoManager;yandexSubtitles=null;resizeObserver;syncVolumeObserver;initialized=false;mountCache;errorTranslationCache=new Map;getOverlayMountPoints(t=this.container){const e=this.site.host==="youtube"&&this.site.additionalData!=="mobile"?t.parentElement??t:t,i=this.mountCache;if(i?.container===t&&i.base===e&&(i.root.isConnected??document.documentElement.contains(i.root)))return {root:i.root,portalContainer:i.portalContainer};const o=qh(e),r=o;return this.mountCache={container:t,base:e,root:o,portalContainer:r},{root:o,portalContainer:r}}getOverlayMount(t=this.container){const{root:e,portalContainer:i}=this.getOverlayMountPoints(t);return {root:e,portalContainer:i,tooltipLayoutRoot:this.tooltipLayoutRoot}}getTranslationCacheKey(t,e,i,o){const r=this.getRequestLangForTranslation(e,i),s=this.isLivelyVoiceAllowed(r,i)&&this.data?.useLivelyVoice,a=o==null?"":fd(o),l=a?pd(a):"0";return `${t}_${r}_${i}_${s}_${l}`}getSubtitlesCacheKey(t,e,i){return `${t}_${e}_${i}_${!!this.data?.useLivelyVoice}`}isActionStale(t){return t?this.actionsGeneration!==t.gen||this.videoData?.videoId!==t.videoId:false}resetActionsAbortController(t){try{this.actionsAbortController?.abort(t);}catch{}this.actionsAbortController=new AbortController,this.actionsGeneration++,this.data&&this.initVOTClient();}constructor(t,e,i){this.video=t,this.container=e,this.site=i,this.abortController=new AbortController,this.actionsAbortController=new AbortController,this.cacheManager=new zh,this.interactionChecker=Xn(),this.interactionChecker.start();const o=()=>this,r=this.getOverlayMount(e);this.uiManager=new wg({mount:r,data:this.data,videoHandler:this,intervalIdleChecker:this.interactionChecker}),this.overlayVisibility=new kg({checker:this.interactionChecker,getOverlayView:()=>this.uiManager.votOverlayView??null,getAutoHideDelay:()=>this.getAutoHideDelay(),isInteractiveNode:a=>this.isOverlayInteractiveNode(a)}),this.translationOrchestrator=new kf({isFirstPlay:()=>this.firstPlay,setFirstPlay:a=>{this.firstPlay=a;},isAutoTranslateEnabled:()=>!!this.data?.autoTranslate,getVideoId:()=>this.videoData?.videoId,scheduleAutoTranslate:()=>this.runAutoTranslate(),isMobileYouTubeMuted:()=>this.site.host==="youtube"&&this.site.additionalData==="mobile"&&this.video.muted,setMuteWatcher:a=>{let l=false;const c=()=>{l||(l=true,this.video.removeEventListener("volumechange",d),a());},d=()=>{this.video.muted||c();};this.video.addEventListener("volumechange",d,{signal:this.abortController.signal}),queueMicrotask(()=>{this.video.muted||c();});}});const s={get video(){return o().video},get site(){return o().site},get container(){return o().container},set container(a){o().container=a,o().uiManager.updateMount(o().getOverlayMount(a));},get firstPlay(){return o().firstPlay},set firstPlay(a){o().firstPlay=a;},stopTranslation:()=>this.stopTranslation(),get uiManager(){return o().uiManager},getVideoData:()=>this.getVideoData(),cacheManager:{getSubtitles:a=>o().cacheManager.getSubtitles(a)??[]},getSubtitlesCacheKey:(a,l,c)=>this.getSubtitlesCacheKey(a,l,c),updateSubtitlesLangSelect:()=>this.updateSubtitlesLangSelect(),enableSubtitlesForCurrentLangPair:()=>this.enableSubtitlesForCurrentLangPair(),setSelectMenuValues:(a,l)=>this.setSelectMenuValues(a,l),get translateToLang(){return o().translateToLang},set translateToLang(a){tv(a)&&(o().translateToLang=a);},get data(){return o().data??{}},get subtitles(){return o().subtitles},set subtitles(a){o().subtitles=a;},get videoData(){return o().videoData},set videoData(a){o().videoData=a;},get actionsAbortController(){return o().actionsAbortController},set actionsAbortController(a){o().actionsAbortController=a;},resetActionsAbortController:a=>this.resetActionsAbortController(a),initVOTClient:()=>this.initVOTClient(),translationOrchestrator:this.translationOrchestrator,resetSubtitlesWidget:()=>this.resetSubtitlesWidget(),queueOverlayAutoHide:()=>this.overlayVisibility?.queueAutoHide()};this.lifecycleController=new xf(s),this.translationHandler=new wf(this),this.videoManager=new tp(this);}getSubtitlesWidget(){if(!this.subtitlesWidget){const t=this.uiManager.votOverlayView?.votOverlayPortal;if(!t)throw new Error("VOT UI is not initialized yet (missing overlay portal)");this.subtitlesWidget=new $p(this.video,this.portalContainer,t,this.interactionChecker,this.tooltipLayoutRoot),this.data&&(this.subtitlesWidget.setSmartLayout(typeof this.data.subtitlesSmartLayout=="boolean"?this.data.subtitlesSmartLayout:true),typeof this.data.subtitlesMaxLength=="number"&&this.subtitlesWidget.setMaxLength(this.data.subtitlesMaxLength),typeof this.data.highlightWords=="boolean"&&this.subtitlesWidget.setHighlightWords(this.data.highlightWords),typeof this.data.subtitlesFontSize=="number"&&this.subtitlesWidget.setFontSize(this.data.subtitlesFontSize),typeof this.data.subtitlesOpacity=="number"&&this.subtitlesWidget.setOpacity(this.data.subtitlesOpacity));}return this.subtitlesWidget}hasSubtitlesWidget(){return !!this.subtitlesWidget}resetSubtitlesWidget(){this.hasSubtitlesWidget()&&(this.subtitlesWidget?.release(),this.subtitlesWidget=void 0);}get uiRoot(){return this.getOverlayMountPoints().root}get portalContainer(){return this.getOverlayMountPoints().portalContainer}get tooltipLayoutRoot(){switch(this.site.host){case "kickstarter":return document.getElementById("react-project-header")??void 0;case "custom":return;default:return this.container}}getEventContainer(){return this.site.eventSelector?document.querySelector(this.site.eventSelector)??this.container:this.container}async runAutoTranslate(){try{this.videoManager.videoValidator(),await this.uiManager.handleTranslationBtnClick();}catch(t){throw console.error("[VOT]",t),t}}getAudioContext(){if(this.audioContext)return this.audioContext;if(this.isAudioContextSupported)try{return this.audioContext=Ar(),this.audioContext}catch(t){console.warn("[VOT] Failed to init AudioContext, falling back:",t);return}}get isAudioContextSupported(){return globalThis.AudioContext!==void 0||globalThis.webkitAudioContext!==void 0}getPreferAudio(){return !this.getAudioContext()||!this.data||!this.data.newAudioPlayer||this.videoData?.isStream?true:this.data.newAudioPlayer&&!this.data.onlyBypassMediaCSP?false:!this.site.needBypassCSP}createPlayer(){const t=this.getPreferAudio();return this.audioPlayer=new Lc({video:this.video,debug:false,fetchFn:nt,fetchOpts:{timeout:0},preferAudio:t}),this}isLikelyInternalVideoVolumeChange(t){return this.internalVideoVolumeSetPercent===null||Date.now()-this.internalVideoVolumeSetAt>this.internalVideoVolumeSuppressionMs?false:Math.abs(t-this.internalVideoVolumeSetPercent)<=1}callModule(t,...e){return t.call(this,...e)}async callModuleAsync(t,...e){return await t.call(this,...e)}async init(){return await Kg.call(this)}initVOTClient(){return this.votOpts={fetchFn:nt,fetchOpts:{signal:this.actionsAbortController.signal},apiToken:this.data?.account?.token,hostVOT:nd,host:this.data?.translateProxyEnabled?this.data?.proxyWorkerHost??ge:td},this.votClient=new(this.data?.translateProxyEnabled?Ba:Oa)(this.votOpts),this}transformBtn(t,e){return this.uiManager.transformBtn(t,e),this}hasActiveSource(){return !!this.audioPlayer?.player?.src}initExtraEvents(){return this.callModule(Hg)}rebindOverlayVisibilityTargets=$g;setCanPlay(){return this.lifecycleController.setCanPlay()}isOverlayInteractiveNode(t){return this.callModule(Ug,t)}getAutoHideDelay(){return this.callModule(zg)}changeSubtitlesLang=Cm;updateSubtitlesLangSelect=Mm;loadSubtitles=Om;async enableSubtitlesForCurrentLangPair(){return await this.callModuleAsync(Vm)}async toggleSubtitlesForCurrentLangPair(){return await this.callModuleAsync(_m)}getRequestLangForTranslation(t,e){return this.data?.useLivelyVoice&&this.data?.account?.token&&e==="ru"?"en":t}isLivelyVoiceAllowed(t=this.videoData?.detectedLanguage??"auto",e=this.videoData?.responseLanguage??this.translateToLang){return !(this.getRequestLangForTranslation(t,e)!=="en"||e!=="ru"||!this.data?.account?.token)}getVideoVolume(){return this.videoManager.getVideoVolume()}setVideoVolume(t){const e=Rt(t);return this.internalVideoVolumeSetAt=Date.now(),this.internalVideoVolumeSetPercent=cs(e),this.videoManager.setVideoVolume(e),this}onVideoVolumeSliderSynced(t){const e=Ht(t);if(!this.volumeLinkState.initialized){this.volumeLinkState.lastVideoPercent=e;return}this.data?.syncVolume&&this.hasActiveSource()&&!this.isLikelyInternalVideoVolumeChange(e)||(this.volumeLinkState.lastVideoPercent=e);}isMuted(){return this.videoManager.isMuted()}syncVideoVolumeSlider(){this.videoManager.syncVideoVolumeSlider();}setSelectMenuValues(t,e){this.videoManager.setSelectMenuValues(t,e);}syncVolumeWrapper(t,e){const i=this.uiManager.votOverlayView;if(!i?.isInitialized())return;const o=i.videoVolumeSlider,r=i.translationVolumeSlider;if(!o||!r)return;if(this.volumeLinkState.initialized||(this.volumeLinkState.lastVideoPercent=Number(o.value),this.volumeLinkState.lastTranslationPercent=Number(r.value),this.volumeLinkState.initialized=true),t==="video"){const d=this.volumeLinkState.lastVideoPercent,u=e-d;if(this.volumeLinkState.lastVideoPercent=e,!Number.isFinite(u)||u===0)return;const h=Number(r.value),f=ls(h+u,r.min,r.max);r.value=f,this.volumeLinkState.lastTranslationPercent=f,this.audioPlayer?.player&&(this.audioPlayer.player.volume=f/100);return}const s=this.volumeLinkState.lastTranslationPercent,a=e-s;if(this.volumeLinkState.lastTranslationPercent=e,!Number.isFinite(a)||a===0)return;const l=Number(o.value),c=Ht(l+a);o.value=c,this.volumeLinkState.lastVideoPercent=c,this.setVideoVolume(c/100);}async getVideoData(){return await this.videoManager.getVideoData()}videoValidator(){return this.videoManager.videoValidator()}stopTranslate(){if(this.audioPlayer?.player){try{this.audioPlayer.player.removeVideoEvents(),this.audioPlayer.player.clear(),this.audioPlayer.player.src="";}catch{}A.log("audioPlayer after stopTranslate",this.audioPlayer);}this.activeTranslation=null;const t=this.uiManager.votOverlayView;t&&(t.videoVolumeSlider&&(t.videoVolumeSlider.hidden=true),t.translationVolumeSlider&&(t.translationVolumeSlider.hidden=true),t.downloadTranslationButton&&(t.downloadTranslationButton.hidden=true)),this.downloadTranslationUrl=null,this.longWaitingResCount=0,this.hadAsyncWait=false,this.transformBtn("none",g.get("translateVideo")),A.log(`Volume on start: ${this.volumeOnStart}`);const e=typeof this.smartVolumeDuckingBaseline=="number"?this.smartVolumeDuckingBaseline:this.volumeOnStart;Qn(this,{restoreVolume:e}),this.volumeOnStart=void 0,this.autoRetry!==void 0&&(clearTimeout(this.autoRetry),this.autoRetry=void 0),this.translationRefreshTimeout!==void 0&&(clearTimeout(this.translationRefreshTimeout),this.translationRefreshTimeout=void 0),this.resetActionsAbortController("stopTranslate");}async updateTranslationErrorMsg(t,e){if(e?.aborted)return;const i=g.get("translationTake"),o=g.lang;if(this.longWaitingResCount=t===g.get("translationTakeAboutMinute")?this.longWaitingResCount+1:0,A.log("longWaitingResCount",this.longWaitingResCount),this.longWaitingResCount>sd&&(t=new rt("TranslationDelayed")),t?.name==="VOTLocalizedError")this.transformBtn("error",t.localizedMessage);else if(t instanceof Error)this.transformBtn("error",t?.message);else if(this.data?.translateAPIErrors&&o!=="ru"&&!t?.includes(i)){const r=this.uiManager.votOverlayView;if(!r?.votButton)return;const s=Array.isArray(t)?t.join(" "):String(t),a=`${o}:${s}`,l=this.errorTranslationCache.get(a);if(l)this.transformBtn("error",l);else {r.votButton.loading=true;const c=await Tn(s,"ru",o),d=Array.isArray(c)?c.join(`
`):String(c);if(e?.aborted)return;if(this.errorTranslationCache.set(a,d),this.errorTranslationCache.size>50){const u=this.errorTranslationCache.keys().next().value;u&&this.errorTranslationCache.delete(u);}this.transformBtn("error",d);}if(e?.aborted)return}else {const r=Array.isArray(t)?t.join(`
`):String(t??"");this.transformBtn("error",r);}e?.aborted||["Подготавливаем перевод","Видео передано в обработку","Ожидаем перевод видео","Загружаем переведенное аудио"].includes(t)&&this.uiManager.votOverlayView?.votButton&&(this.uiManager.votOverlayView.votButton.loading=true);}afterUpdateTranslation(t){const e=this.uiManager.votOverlayView;if(!e?.votButton)return;const i=e.votButton.container.dataset.status==="success";e.videoVolumeSlider&&(e.videoVolumeSlider.hidden=!this.data?.showVideoSlider||!i),e.translationVolumeSlider&&(e.translationVolumeSlider.hidden=!i),e.videoVolumeSlider&&e.translationVolumeSlider?(this.volumeLinkState.lastVideoPercent=Number(e.videoVolumeSlider.value),this.volumeLinkState.lastTranslationPercent=Number(e.translationVolumeSlider.value),this.volumeLinkState.initialized=true):this.volumeLinkState.initialized=false,this.videoData&&!this.videoData.isStream&&(e.downloadTranslationButton&&(e.downloadTranslationButton.hidden=false),this.downloadTranslationUrl=t),A.log("afterUpdateTranslation downloadTranslationUrl",this.downloadTranslationUrl),this.data?.sendNotifyOnComplete&&this.hadAsyncWait&&i&&(this.notifier.translationCompleted(globalThis.location.hostname),this.hadAsyncWait=false);}async validateAudioUrl(t,e){return await this.callModuleAsync(Um,t,e)}scheduleTranslationRefresh(){this.callModule(zm);}refreshTranslationAudio=Wm;proxifyAudio(t){return this.callModule(qm,t)}unproxifyAudio(t){return this.callModule(Gm,t)}handleProxySettingsChanged=Km;isMultiMethodS3(t){return this.callModule(Ym,t)}updateTranslation=Xm;async translateFunc(t,e,i,o,r){return await Jm.call(this,t,e,i,o,r)}isYouTubeHosts(){return this.callModule(jm)}setupAudioSettings(){return this.callModule(Zm)}stopTranslation=()=>{this.translationOrchestrator?.reset(),this.overlayVisibility?.cancel(),this.stopTranslate(),this.syncVideoVolumeSlider();};handleSrcChanged(){return this.lifecycleController.handleSrcChanged()}async release(){this.initialized=false;try{this.stopTranslation();}catch{}this.lifecycleController?.teardown(),this.abortController?.abort(),this.abortController=new AbortController,this.overlayVisibility?.release(),this.releaseExtraEvents(),this.hasSubtitlesWidget()&&(this.subtitlesWidget?.release(),this.subtitlesWidget=void 0),this.interactionChecker?.destroy(),this.uiManager.release();}collectReportInfo(){const t=Ms(),e=this.videoData?.detectedLanguage??"unknown",i=this.videoData?.responseLanguage??"unknown",o=`<details>
<summary>Autogenerated by VOT:</summary>
<ul>
  <li>OS: ${t.os}</li>
  <li>Browser: ${t.browser}</li>
  <li>Loader: ${t.loader}</li>
  <li>Script version: ${t.scriptVersion}</li>
  <li>URL: <code>${t.url}</code></li>
  <li>Lang: <code>${e}</code> -> <code>${i}</code> (Lively voice: ${this.data?.useLivelyVoice??false} | Audio download: ${this.data?.useAudioDownload??false})</li>
  <li>Player: ${this.data?.newAudioPlayer?"New":"Old"} (CSP only: ${this.data?.onlyBypassMediaCSP??false})</li>
  <li>Proxying mode: ${this.data?.translateProxyEnabled??0}</li>
</ul>
</details>`;return {assignees:"ilyhalight",template:`1-bug-report-${g.lang==="ru"?"ru":"en"}.yml`,os:t.os,"script-version":t.scriptVersion,"additional-info":o}}releaseExtraEvents=Wg}const nv=Xn(),Yo=new Jt(nv),iv=new WeakMap;let vn=null;const bt=Qc();function ov(){return {frame:Fn()?"iframe":"top",host:globalThis.location.hostname||"unknown",path:globalThis.location.pathname||"/"}}function Mt(n,t){const e=ov(),i={host:e.host,path:e.path};t&&Object.assign(i,t),console.log(`[VOT][bootstrap][${e.frame}] ${n}`,i);}function rv(){return vn||(vn=ec()),vn}function sv(n,t){if(!n.selector)return t.parentElement;const e=jr(t,n.selector);return n.shadowRoot,e||null}async function av(){const n=Uh({isIframe:Fn(),href:String(globalThis.location.href||""),origin:globalThis.location.origin,hash:globalThis.location.hash,iframeHash:Rn});if(n==="iframe-helper")return Mt("Starting iframe helper runtime"),Xc();if(n==="skip"){Mt("Skipping bootstrap for non-runnable iframe");return}Mt("Loading extension"),n==="top-full"?await uo("top-frame",Mt):Mt("Lazy iframe bootstrap enabled; waiting for video detection"),Hh({videoObserver:Yo,videosWrappers:iv,ensureRuntimeActivated:async t=>await uo(t,Mt),getServicesCached:rv,findContainer:sv,createVideoHandler:(t,e,i)=>new ev(t,e,i)}),Yo.enable();}if(bt.status==="booting"||bt.status==="booted")Mt("bootstrap already initialized, skipping duplicate run",{status:bt.status});else {const n=async()=>{try{await av(),bt.status="booted";}catch(t){bt.status="failed",bt.error=t,console.error("[VOT]",t);}};bt.status="booting",bt.promise=n();}

    })
  };
}));

System.register("./__vite-browser-external-BIHI7g3E-DUmwvnCo.js", [], (function (exports, module) {
	'use strict';
	return {
		execute: (function () {

			const e=exports("default", {});

		})
	};
}));

System.import("./__entry.js", "./");